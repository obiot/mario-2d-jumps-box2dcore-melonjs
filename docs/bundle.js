/*! For license information please see bundle.js.LICENSE.txt */
!function(){"use strict";var t={7118:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2BroadPhase=void 0;const s=i(2962),n=i(1006);e.b2BroadPhase=class{constructor(){this.m_tree=new n.b2DynamicTree,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[],this.m_queryProxy=new n.b2TreeNode,this.QueryCallback=t=>(t.id===this.m_queryProxy.id||t.moved&&t.id>this.m_queryProxy.id||(this.m_pairBuffer[this.m_pairCount]=t.id<this.m_queryProxy.id?[t,this.m_queryProxy]:[this.m_queryProxy,t],++this.m_pairCount),!0)}CreateProxy(t,e){const i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];if(null===e)continue;this.m_queryProxy=e;const i=e.aabb;this.m_tree.Query(i,this.QueryCallback)}for(let e=0;e<this.m_pairCount;++e){const i=this.m_pairBuffer[e];t((0,s.b2Verify)(i[0].userData),(0,s.b2Verify)(i[1].userData))}for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];e&&(e.moved=!1)}this.m_moveCount=0}Query(t,e){this.m_tree.Query(t,e)}QueryPoint(t,e){this.m_tree.QueryPoint(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}},1848:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ChainShape=void 0;const s=i(2962),n=i(6826),o=i(6955),r=i(7568);class a extends o.b2Shape{constructor(){super(o.b2ShapeType.e_chain,s.b2_polygonRadius),this.m_vertices=[],this.m_prevVertex=new n.b2Vec2,this.m_nextVertex=new n.b2Vec2}CreateLoop(t,e=t.length){if(e<3)return this;this.m_vertices.length=e+1;for(let i=0;i<e;++i){const{x:e,y:s}=t[i];this.m_vertices[i]=new n.b2Vec2(e,s)}return this.m_vertices[e]=this.m_vertices[0].Clone(),this.m_prevVertex.Copy(this.m_vertices[this.m_vertices.length-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this}CreateChain(t,e,i,s){this.m_vertices.length=e;for(let i=0;i<e;++i){const{x:e,y:s}=t[i];this.m_vertices[i]=new n.b2Vec2(e,s)}return this.m_prevVertex.Copy(i),this.m_nextVertex.Copy(s),this}Clone(){return(new a).Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_vertices.length,t.m_prevVertex,t.m_nextVertex)}GetChildCount(){return this.m_vertices.length-1}GetChildEdge(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),t.m_oneSided=!0,e>0?t.m_vertex0.Copy(this.m_vertices[e-1]):t.m_vertex0.Copy(this.m_prevVertex),e<this.m_vertices.length-2?t.m_vertex3.Copy(this.m_vertices[e+2]):t.m_vertex3.Copy(this.m_nextVertex)}TestPoint(t,e){return!1}RayCast(t,e,i,s){const n=a.RayCast_s_edgeShape,o=s;let r=s+1;return r===this.m_vertices.length&&(r=0),n.m_vertex1.Copy(this.m_vertices[o]),n.m_vertex2.Copy(this.m_vertices[r]),n.RayCast(t,e,i,0)}ComputeAABB(t,e,i){const s=i;let o=i+1;o===this.m_vertices.length&&(o=0);const r=n.b2Transform.MultiplyVec2(e,this.m_vertices[s],a.ComputeAABB_s_v1),h=n.b2Transform.MultiplyVec2(e,this.m_vertices[o],a.ComputeAABB_s_v2),l=n.b2Vec2.Min(r,h,a.ComputeAABB_s_lower),c=n.b2Vec2.Max(r,h,a.ComputeAABB_s_upper);t.lowerBound.x=l.x-this.m_radius,t.lowerBound.y=l.y-this.m_radius,t.upperBound.x=c.x+this.m_radius,t.upperBound.y=c.y+this.m_radius}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_vertices.length?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}Draw(t,e){const i=this.m_vertices;let s=i[0];for(let n=1;n<i.length;++n){const o=i[n];t.DrawSegment(s,o,e),s=o}}}e.b2ChainShape=a,a.RayCast_s_edgeShape=new r.b2EdgeShape,a.ComputeAABB_s_v1=new n.b2Vec2,a.ComputeAABB_s_v2=new n.b2Vec2,a.ComputeAABB_s_lower=new n.b2Vec2,a.ComputeAABB_s_upper=new n.b2Vec2},2985:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2CircleShape=void 0;const s=i(2962),n=i(6826),o=i(6955);class r extends o.b2Shape{constructor(t=0){super(o.b2ShapeType.e_circle,t),this.m_p=new n.b2Vec2}Set(t,e=this.m_radius){return this.m_p.Copy(t),this.m_radius=e,this}Clone(){return(new r).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const i=n.b2Transform.MultiplyVec2(t,this.m_p,r.TestPoint_s_center),s=n.b2Vec2.Subtract(e,i,r.TestPoint_s_d);return n.b2Vec2.Dot(s,s)<=this.m_radius**2}RayCast(t,e,i,o){const a=n.b2Transform.MultiplyVec2(i,this.m_p,r.RayCast_s_position),h=n.b2Vec2.Subtract(e.p1,a,r.RayCast_s_s),l=n.b2Vec2.Dot(h,h)-this.m_radius**2,c=n.b2Vec2.Subtract(e.p2,e.p1,r.RayCast_s_r),u=n.b2Vec2.Dot(h,c),m=n.b2Vec2.Dot(c,c),d=u*u-m*l;if(d<0||m<s.b2_epsilon)return!1;let p=-(u+Math.sqrt(d));return p>=0&&p<=e.maxFraction*m&&(p/=m,t.fraction=p,n.b2Vec2.AddScaled(h,p,c,t.normal).Normalize(),!0)}ComputeAABB(t,e,i){const s=n.b2Transform.MultiplyVec2(e,this.m_p,r.ComputeAABB_s_p);t.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}ComputeMass(t,e){const i=this.m_radius**2;t.mass=e*Math.PI*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+n.b2Vec2.Dot(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}Draw(t,e){const i=this.m_p,s=this.m_radius,o=n.b2Vec2.UNITX;t.DrawSolidCircle(i,s,o,e)}}e.b2CircleShape=r,r.TestPoint_s_center=new n.b2Vec2,r.TestPoint_s_d=new n.b2Vec2,r.RayCast_s_position=new n.b2Vec2,r.RayCast_s_s=new n.b2Vec2,r.RayCast_s_r=new n.b2Vec2,r.ComputeAABB_s_p=new n.b2Vec2},8503:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2CollidePolygonAndCircle=e.b2CollideCircles=void 0;const s=i(2962),n=i(6826),o=i(2472),r=new n.b2Vec2,a=new n.b2Vec2;e.b2CollideCircles=function(t,e,i,s,h){t.pointCount=0;const l=n.b2Transform.MultiplyVec2(i,e.m_p,r),c=n.b2Transform.MultiplyVec2(h,s.m_p,a),u=n.b2Vec2.DistanceSquared(l,c),m=e.m_radius+s.m_radius;u>m*m||(t.type=o.b2ManifoldType.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0)};const h=new n.b2Vec2,l=new n.b2Vec2,c=new n.b2Vec2;e.b2CollidePolygonAndCircle=function(t,e,i,r,a){t.pointCount=0;const u=n.b2Transform.MultiplyVec2(a,r.m_p,h),m=n.b2Transform.TransposeMultiplyVec2(i,u,l);let d=0,p=-s.b2_maxFloat;const _=e.m_radius+r.m_radius,b=e.m_count,y=e.m_vertices,f=e.m_normals;for(let t=0;t<b;++t){const e=n.b2Vec2.Dot(f[t],n.b2Vec2.Subtract(m,y[t],n.b2Vec2.s_t0));if(e>_)return;e>p&&(p=e,d=t)}const g=d,x=g+1<b?g+1:0,v=y[g],A=y[x];if(p<s.b2_epsilon)return t.pointCount=1,t.type=o.b2ManifoldType.e_faceA,t.localNormal.Copy(f[d]),n.b2Vec2.Mid(v,A,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);const w=n.b2Vec2.Dot(n.b2Vec2.Subtract(m,v,n.b2Vec2.s_t0),n.b2Vec2.Subtract(A,v,n.b2Vec2.s_t1)),S=n.b2Vec2.Dot(n.b2Vec2.Subtract(m,A,n.b2Vec2.s_t0),n.b2Vec2.Subtract(v,A,n.b2Vec2.s_t1));if(w<=0){if(n.b2Vec2.DistanceSquared(m,v)>_*_)return;t.pointCount=1,t.type=o.b2ManifoldType.e_faceA,n.b2Vec2.Subtract(m,v,t.localNormal).Normalize(),t.localPoint.Copy(v),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else if(S<=0){if(n.b2Vec2.DistanceSquared(m,A)>_*_)return;t.pointCount=1,t.type=o.b2ManifoldType.e_faceA,n.b2Vec2.Subtract(m,A,t.localNormal).Normalize(),t.localPoint.Copy(A),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else{const e=n.b2Vec2.Mid(v,A,c);if(n.b2Vec2.Dot(n.b2Vec2.Subtract(m,e,n.b2Vec2.s_t1),f[g])>_)return;t.pointCount=1,t.type=o.b2ManifoldType.e_faceA,t.localNormal.Copy(f[g]),t.localPoint.Copy(e),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}}},5814:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2CollideEdgeAndPolygon=e.b2CollideEdgeAndCircle=void 0;const s=i(2962),n=i(6826),o=i(2472),r=i(2952),a=new n.b2Vec2,h=new n.b2Vec2,l=new n.b2Vec2,c=new n.b2Vec2,u=new n.b2Vec2,m=new n.b2Vec2,d=new n.b2Vec2,p=new o.b2ContactID;var _;e.b2CollideEdgeAndCircle=function(t,e,i,s,r){t.pointCount=0;const _=n.b2Transform.TransposeMultiplyVec2(i,n.b2Transform.MultiplyVec2(r,s.m_p,n.b2Vec2.s_t0),a),b=e.m_vertex1,y=e.m_vertex2,f=n.b2Vec2.Subtract(y,b,h),g=d.Set(f.y,-f.x),x=n.b2Vec2.Dot(g,n.b2Vec2.Subtract(_,b,n.b2Vec2.s_t0));if(e.m_oneSided&&x<0)return;const v=n.b2Vec2.Dot(f,n.b2Vec2.Subtract(y,_,n.b2Vec2.s_t0)),A=n.b2Vec2.Dot(f,n.b2Vec2.Subtract(_,b,n.b2Vec2.s_t0)),w=e.m_radius+s.m_radius,S=p;if(S.cf.indexB=0,S.cf.typeB=o.b2ContactFeatureType.e_vertex,A<=0){const i=b,r=n.b2Vec2.Subtract(_,i,l);if(n.b2Vec2.Dot(r,r)>w*w)return;if(e.m_oneSided){const t=e.m_vertex0,i=b,s=n.b2Vec2.Subtract(i,t,c);if(n.b2Vec2.Dot(s,n.b2Vec2.Subtract(i,_,n.b2Vec2.s_t0))>0)return}return S.cf.indexA=0,S.cf.typeA=o.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=o.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(S),void t.points[0].localPoint.Copy(s.m_p)}if(v<=0){const i=y,r=n.b2Vec2.Subtract(_,i,l);if(n.b2Vec2.Dot(r,r)>w*w)return;if(e.m_oneSided){const t=e.m_vertex3,i=y,s=n.b2Vec2.Subtract(t,i,u);if(n.b2Vec2.Dot(s,n.b2Vec2.Subtract(_,i,n.b2Vec2.s_t0))>0)return}return S.cf.indexA=1,S.cf.typeA=o.b2ContactFeatureType.e_vertex,t.pointCount=1,t.type=o.b2ManifoldType.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(S),void t.points[0].localPoint.Copy(s.m_p)}const C=n.b2Vec2.Dot(f,f),V=m;V.x=1/C*(v*b.x+A*y.x),V.y=1/C*(v*b.y+A*y.y);const B=n.b2Vec2.Subtract(_,V,l);n.b2Vec2.Dot(B,B)>w*w||(x<0&&g.Set(-g.x,-g.y),g.Normalize(),S.cf.indexA=0,S.cf.typeA=o.b2ContactFeatureType.e_face,t.pointCount=1,t.type=o.b2ManifoldType.e_faceA,t.localNormal.Copy(g),t.localPoint.Copy(b),t.points[0].id.Copy(S),t.points[0].localPoint.Copy(s.m_p))},function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(_||(_={}));class b{constructor(){this.normal=new n.b2Vec2,this.type=_.e_unknown,this.index=0,this.separation=0}}const y=new b,f=[new n.b2Vec2,new n.b2Vec2],g=new b,x=new n.b2Vec2,v=new n.b2Transform,A=new n.b2Vec2,w=new n.b2Vec2,S=new n.b2Vec2,C=new n.b2Vec2,V=new n.b2Vec2,B=new n.b2Vec2,T=new n.b2Vec2,M=new class{constructor(){this.vertices=(0,s.b2MakeArray)(r.b2_maxPolygonVertices,n.b2Vec2),this.normals=(0,s.b2MakeArray)(r.b2_maxPolygonVertices,n.b2Vec2),this.count=0}},I=new class{constructor(){this.i1=0,this.i2=0,this.v1=new n.b2Vec2,this.v2=new n.b2Vec2,this.normal=new n.b2Vec2,this.sideNormal1=new n.b2Vec2,this.sideOffset1=0,this.sideNormal2=new n.b2Vec2,this.sideOffset2=0}},P=[new o.b2ClipVertex,new o.b2ClipVertex],E=[new o.b2ClipVertex,new o.b2ClipVertex],D=[new o.b2ClipVertex,new o.b2ClipVertex];e.b2CollideEdgeAndPolygon=function(t,e,i,r,a){t.pointCount=0;const h=n.b2Transform.TransposeMultiply(i,a,v),l=n.b2Transform.MultiplyVec2(h,r.m_centroid,A),c=e.m_vertex1,u=e.m_vertex2,m=n.b2Vec2.Subtract(u,c,w);m.Normalize();const d=S.Set(m.y,-m.x),p=n.b2Vec2.Dot(d,n.b2Vec2.Subtract(l,c,n.b2Vec2.s_t0)),b=e.m_oneSided;if(b&&p<0)return;const R=M;R.count=r.m_count;for(let t=0;t<r.m_count;++t)n.b2Transform.MultiplyVec2(h,r.m_vertices[t],R.vertices[t]),n.b2Rot.MultiplyVec2(h.q,r.m_normals[t],R.normals[t]);const L=r.m_radius+e.m_radius,G=function(t,e,i){const o=y;o.type=_.e_edgeA,o.index=-1,o.separation=-s.b2_maxFloat,o.normal.SetZero();const r=f;r[0].Copy(i),n.b2Vec2.Negate(i,r[1]);for(let i=0;i<2;++i){let a=s.b2_maxFloat;for(let s=0;s<t.count;++s){const o=n.b2Vec2.Dot(r[i],n.b2Vec2.Subtract(t.vertices[s],e,n.b2Vec2.s_t0));o<a&&(a=o)}a>o.separation&&(o.index=i,o.separation=a,o.normal.Copy(r[i]))}return o}(R,c,d);if(G.separation>L)return;const k=function(t,e,i){const o=g;o.type=_.e_unknown,o.index=-1,o.separation=-s.b2_maxFloat,o.normal.SetZero();for(let s=0;s<t.count;++s){const r=n.b2Vec2.Negate(t.normals[s],x),a=n.b2Vec2.Dot(r,n.b2Vec2.Subtract(t.vertices[s],e,n.b2Vec2.s_t0)),h=n.b2Vec2.Dot(r,n.b2Vec2.Subtract(t.vertices[s],i,n.b2Vec2.s_t0)),l=Math.min(a,h);l>o.separation&&(o.type=_.e_edgeB,o.index=s,o.separation=l,o.normal.Copy(r))}return o}(R,c,u);if(k.separation>L)return;let F;if(F=k.separation-L>.98*(G.separation-L)+.001?k:G,b){const t=n.b2Vec2.Subtract(c,e.m_vertex0,C);t.Normalize();const i=V.Set(t.y,-t.x),s=n.b2Vec2.Cross(t,m)>=0,o=n.b2Vec2.Subtract(e.m_vertex3,u,B);o.Normalize();const r=T.Set(o.y,-o.x),a=n.b2Vec2.Cross(m,o)>=0,h=.1;if(n.b2Vec2.Dot(F.normal,m)<=0)if(s){if(n.b2Vec2.Cross(F.normal,i)>h)return}else F=G;else if(a){if(n.b2Vec2.Cross(r,F.normal)>h)return}else F=G}const O=P,z=I;if(F.type===_.e_edgeA){t.type=o.b2ManifoldType.e_faceA;let e=0,i=n.b2Vec2.Dot(F.normal,R.normals[0]);for(let t=1;t<R.count;++t){const s=n.b2Vec2.Dot(F.normal,R.normals[t]);s<i&&(i=s,e=t)}const s=e,r=s+1<R.count?s+1:0;O[0].v.Copy(R.vertices[s]),O[0].id.cf.indexA=0,O[0].id.cf.indexB=s,O[0].id.cf.typeA=o.b2ContactFeatureType.e_face,O[0].id.cf.typeB=o.b2ContactFeatureType.e_vertex,O[1].v.Copy(R.vertices[r]),O[1].id.cf.indexA=0,O[1].id.cf.indexB=r,O[1].id.cf.typeA=o.b2ContactFeatureType.e_face,O[1].id.cf.typeB=o.b2ContactFeatureType.e_vertex,z.i1=0,z.i2=1,z.v1.Copy(c),z.v2.Copy(u),z.normal.Copy(F.normal),n.b2Vec2.Negate(m,z.sideNormal1),z.sideNormal2.Copy(m)}else t.type=o.b2ManifoldType.e_faceB,O[0].v.Copy(u),O[0].id.cf.indexA=1,O[0].id.cf.indexB=F.index,O[0].id.cf.typeA=o.b2ContactFeatureType.e_vertex,O[0].id.cf.typeB=o.b2ContactFeatureType.e_face,O[1].v.Copy(c),O[1].id.cf.indexA=0,O[1].id.cf.indexB=F.index,O[1].id.cf.typeA=o.b2ContactFeatureType.e_vertex,O[1].id.cf.typeB=o.b2ContactFeatureType.e_face,z.i1=F.index,z.i2=z.i1+1<R.count?z.i1+1:0,z.v1.Copy(R.vertices[z.i1]),z.v2.Copy(R.vertices[z.i2]),z.normal.Copy(R.normals[z.i1]),z.sideNormal1.Set(z.normal.y,-z.normal.x),n.b2Vec2.Negate(z.sideNormal1,z.sideNormal2);z.sideOffset1=n.b2Vec2.Dot(z.sideNormal1,z.v1),z.sideOffset2=n.b2Vec2.Dot(z.sideNormal2,z.v2);const j=E,N=D;let q;if(q=(0,o.b2ClipSegmentToLine)(j,O,z.sideNormal1,z.sideOffset1,z.i1),q<s.b2_maxManifoldPoints)return;if(q=(0,o.b2ClipSegmentToLine)(N,j,z.sideNormal2,z.sideOffset2,z.i2),q<s.b2_maxManifoldPoints)return;F.type===_.e_edgeA?(t.localNormal.Copy(z.normal),t.localPoint.Copy(z.v1)):(t.localNormal.Copy(r.m_normals[z.i1]),t.localPoint.Copy(r.m_vertices[z.i1]));let U=0;for(let e=0;e<s.b2_maxManifoldPoints;++e)if(n.b2Vec2.Dot(z.normal,n.b2Vec2.Subtract(N[e].v,z.v1,n.b2Vec2.s_t0))<=L){const i=t.points[U];F.type===_.e_edgeA?(n.b2Transform.TransposeMultiplyVec2(h,N[e].v,i.localPoint),i.id.Copy(N[e].id)):(i.localPoint.Copy(N[e].v),i.id.cf.typeA=N[e].id.cf.typeB,i.id.cf.typeB=N[e].id.cf.typeA,i.id.cf.indexA=N[e].id.cf.indexB,i.id.cf.indexB=N[e].id.cf.indexA),++U}t.pointCount=U}},1760:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2CollidePolygons=void 0;const s=i(2962),n=i(6826),o=i(2472),r=new n.b2Transform,a=new n.b2Vec2,h=new n.b2Vec2;function l(t,e,i,o,l){const c=e.m_count,u=o.m_count,m=e.m_normals,d=e.m_vertices,p=o.m_vertices,_=n.b2Transform.TransposeMultiply(l,i,r);let b=0,y=-s.b2_maxFloat;for(let t=0;t<c;++t){const e=n.b2Rot.MultiplyVec2(_.q,m[t],a),i=n.b2Transform.MultiplyVec2(_,d[t],h);let o=s.b2_maxFloat;for(let t=0;t<u;++t){const s=n.b2Vec2.Dot(e,n.b2Vec2.Subtract(p[t],i,n.b2Vec2.s_t0));s<o&&(o=s)}o>y&&(y=o,b=t)}return t[0]=b,y}const c=new n.b2Vec2,u=[new o.b2ClipVertex,new o.b2ClipVertex],m=[new o.b2ClipVertex,new o.b2ClipVertex],d=[new o.b2ClipVertex,new o.b2ClipVertex],p=[0],_=[0],b=new n.b2Vec2,y=new n.b2Vec2,f=new n.b2Vec2,g=new n.b2Vec2,x=new n.b2Vec2,v=new n.b2Vec2,A=new n.b2Vec2,w=new n.b2Vec2;e.b2CollidePolygons=function(t,e,i,r,a){t.pointCount=0;const h=e.m_radius+r.m_radius,S=p,C=l(S,e,i,r,a);if(C>h)return;const V=_,B=l(V,r,a,e,i);if(B>h)return;let T,M,I,P,E,D;B>C+.1*s.b2_linearSlop?(T=r,M=e,I=a,P=i,E=V[0],t.type=o.b2ManifoldType.e_faceB,D=1):(T=e,M=r,I=i,P=a,E=S[0],t.type=o.b2ManifoldType.e_faceA,D=0);const R=u;!function(t,e,i,r,a,h){const l=e.m_normals,u=a.m_count,m=a.m_vertices,d=a.m_normals,p=n.b2Rot.TransposeMultiplyVec2(h.q,n.b2Rot.MultiplyVec2(i.q,l[r],n.b2Vec2.s_t0),c);let _=0,b=s.b2_maxFloat;for(let t=0;t<u;++t){const e=n.b2Vec2.Dot(p,d[t]);e<b&&(b=e,_=t)}const y=_,f=y+1<u?y+1:0,g=t[0];n.b2Transform.MultiplyVec2(h,m[y],g.v);const x=g.id.cf;x.indexA=r,x.indexB=y,x.typeA=o.b2ContactFeatureType.e_face,x.typeB=o.b2ContactFeatureType.e_vertex;const v=t[1];n.b2Transform.MultiplyVec2(h,m[f],v.v);const A=v.id.cf;A.indexA=r,A.indexB=f,A.typeA=o.b2ContactFeatureType.e_face,A.typeB=o.b2ContactFeatureType.e_vertex}(R,T,I,E,M,P);const L=T.m_count,G=T.m_vertices,k=E,F=E+1<L?E+1:0;let O=G[k],z=G[F];const j=n.b2Vec2.Subtract(z,O,b);j.Normalize();const N=n.b2Vec2.CrossVec2One(j,y),q=n.b2Vec2.Mid(O,z,f),U=n.b2Rot.MultiplyVec2(I.q,j,x),J=n.b2Vec2.CrossVec2One(U,g);O=n.b2Transform.MultiplyVec2(I,O,A),z=n.b2Transform.MultiplyVec2(I,z,w);const X=n.b2Vec2.Dot(J,O),H=-n.b2Vec2.Dot(U,O)+h,W=n.b2Vec2.Dot(U,z)+h,Y=m,Z=d,K=n.b2Vec2.Negate(U,v);let Q=(0,o.b2ClipSegmentToLine)(Y,R,K,H,k);if(Q<2)return;if(Q=(0,o.b2ClipSegmentToLine)(Z,Y,U,W,F),Q<2)return;t.localNormal.Copy(N),t.localPoint.Copy(q);let $=0;for(let e=0;e<s.b2_maxManifoldPoints;++e){const i=Z[e];if(n.b2Vec2.Dot(J,i.v)-X<=h){const e=t.points[$];if(n.b2Transform.TransposeMultiplyVec2(P,i.v,e.localPoint),e.id.Copy(i.id),D){const{cf:t}=e.id;t.indexA=t.indexB,t.indexB=t.indexA,t.typeA=t.typeB,t.typeB=t.typeA}++$}}t.pointCount=$}},2472:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2TestOverlap=e.b2ClipSegmentToLine=e.b2AABB=e.b2RayCastOutput=e.b2RayCastInput=e.b2ClipVertex=e.b2GetPointStates=e.b2PointState=e.b2WorldManifold=e.b2Manifold=e.b2ManifoldType=e.b2ManifoldPoint=e.b2ContactID=e.b2ContactFeature=e.b2ContactFeatureType=void 0;const s=i(2962),n=i(6826),o=i(9007);var r,a,h;!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(r=e.b2ContactFeatureType||(e.b2ContactFeatureType={}));class l{constructor(){this.m_key=0,this.m_key_invalid=!1,this.m_indexA=0,this.m_indexB=0,this.m_typeA=r.e_vertex,this.m_typeB=r.e_vertex}get key(){return this.m_key_invalid&&(this.m_key_invalid=!1,this.m_key=this.m_indexA|this.m_indexB<<8|this.m_typeA<<16|this.m_typeB<<24),this.m_key}set key(t){this.m_key=t,this.m_key_invalid=!1,this.m_indexA=255&this.m_key,this.m_indexB=this.m_key>>8&255,this.m_typeA=this.m_key>>16&255,this.m_typeB=this.m_key>>24&255}get indexA(){return this.m_indexA}set indexA(t){this.m_indexA=t,this.m_key_invalid=!0}get indexB(){return this.m_indexB}set indexB(t){this.m_indexB=t,this.m_key_invalid=!0}get typeA(){return this.m_typeA}set typeA(t){this.m_typeA=t,this.m_key_invalid=!0}get typeB(){return this.m_typeB}set typeB(t){this.m_typeB=t,this.m_key_invalid=!0}}e.b2ContactFeature=l;class c{constructor(){this.cf=new l}Copy(t){return this.key=t.key,this}Clone(){return(new c).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}e.b2ContactID=c;class u{constructor(){this.localPoint=new n.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.id=new c}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}e.b2ManifoldPoint=u,function(t){t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(a=e.b2ManifoldType||(e.b2ManifoldType={}));class m{constructor(){this.points=(0,s.b2MakeArray)(s.b2_maxManifoldPoints,u),this.localNormal=new n.b2Vec2,this.localPoint=new n.b2Vec2,this.type=a.e_circles,this.pointCount=0}Reset(){for(let t=0;t<s.b2_maxManifoldPoints;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=a.e_circles,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<s.b2_maxManifoldPoints;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new m).Copy(this)}}e.b2Manifold=m;class d{constructor(){this.normal=new n.b2Vec2,this.points=(0,s.b2MakeArray)(s.b2_maxManifoldPoints,n.b2Vec2),this.separations=(0,s.b2MakeNumberArray)(s.b2_maxManifoldPoints)}Initialize(t,e,i,o,r){if(0!==t.pointCount)switch(t.type){case a.e_circles:{this.normal.Set(1,0);const a=n.b2Transform.MultiplyVec2(e,t.localPoint,d.Initialize_s_pointA),h=n.b2Transform.MultiplyVec2(o,t.points[0].localPoint,d.Initialize_s_pointB);n.b2Vec2.DistanceSquared(a,h)>s.b2_epsilon_sq&&n.b2Vec2.Subtract(h,a,this.normal).Normalize();const l=n.b2Vec2.AddScaled(a,i,this.normal,d.Initialize_s_cA),c=n.b2Vec2.SubtractScaled(h,r,this.normal,d.Initialize_s_cB);n.b2Vec2.Mid(l,c,this.points[0]),this.separations[0]=n.b2Vec2.Dot(n.b2Vec2.Subtract(c,l,n.b2Vec2.s_t0),this.normal);break}case a.e_faceA:{n.b2Rot.MultiplyVec2(e.q,t.localNormal,this.normal);const s=n.b2Transform.MultiplyVec2(e,t.localPoint,d.Initialize_s_planePoint);for(let e=0;e<t.pointCount;++e){const a=n.b2Transform.MultiplyVec2(o,t.points[e].localPoint,d.Initialize_s_clipPoint),h=i-n.b2Vec2.Dot(n.b2Vec2.Subtract(a,s,n.b2Vec2.s_t0),this.normal),l=n.b2Vec2.AddScaled(a,h,this.normal,d.Initialize_s_cA),c=n.b2Vec2.SubtractScaled(a,r,this.normal,d.Initialize_s_cB);n.b2Vec2.Mid(l,c,this.points[e]),this.separations[e]=n.b2Vec2.Dot(n.b2Vec2.Subtract(c,l,n.b2Vec2.s_t0),this.normal)}break}case a.e_faceB:{n.b2Rot.MultiplyVec2(o.q,t.localNormal,this.normal);const s=n.b2Transform.MultiplyVec2(o,t.localPoint,d.Initialize_s_planePoint);for(let o=0;o<t.pointCount;++o){const a=n.b2Transform.MultiplyVec2(e,t.points[o].localPoint,d.Initialize_s_clipPoint),h=r-n.b2Vec2.Dot(n.b2Vec2.Subtract(a,s,n.b2Vec2.s_t0),this.normal),l=n.b2Vec2.AddScaled(a,h,this.normal,d.Initialize_s_cB),c=n.b2Vec2.SubtractScaled(a,i,this.normal,d.Initialize_s_cA);n.b2Vec2.Mid(c,l,this.points[o]),this.separations[o]=n.b2Vec2.Dot(n.b2Vec2.Subtract(c,l,n.b2Vec2.s_t0),this.normal)}this.normal.Negate();break}}}}e.b2WorldManifold=d,d.Initialize_s_pointA=new n.b2Vec2,d.Initialize_s_pointB=new n.b2Vec2,d.Initialize_s_cA=new n.b2Vec2,d.Initialize_s_cB=new n.b2Vec2,d.Initialize_s_planePoint=new n.b2Vec2,d.Initialize_s_clipPoint=new n.b2Vec2,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(h=e.b2PointState||(e.b2PointState={})),e.b2GetPointStates=function(t,e,i,n){let o;for(o=0;o<i.pointCount;++o){const{key:e}=i.points[o].id;t[o]=h.b2_removeState;for(let i=0;i<n.pointCount;++i)if(n.points[i].id.key===e){t[o]=h.b2_persistState;break}}for(;o<s.b2_maxManifoldPoints;++o)t[o]=h.b2_nullState;for(o=0;o<n.pointCount;++o){const{key:t}=n.points[o].id;e[o]=h.b2_addState;for(let s=0;s<i.pointCount;++s)if(i.points[s].id.key===t){e[o]=h.b2_persistState;break}}for(;o<s.b2_maxManifoldPoints;++o)e[o]=h.b2_nullState},e.b2ClipVertex=class{constructor(){this.v=new n.b2Vec2,this.id=new c}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}},e.b2RayCastInput=class{constructor(){this.p1=new n.b2Vec2,this.p2=new n.b2Vec2,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}},e.b2RayCastOutput=class{constructor(){this.normal=new n.b2Vec2,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}},e.b2AABB=class{constructor(){this.lowerBound=new n.b2Vec2,this.upperBound=new n.b2Vec2}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){return this.lowerBound.IsValid()&&this.upperBound.IsValid()&&this.upperBound.x>=this.lowerBound.x&&this.upperBound.y>=this.lowerBound.y}GetCenter(t){return n.b2Vec2.Mid(this.lowerBound,this.upperBound,t)}GetExtents(t){return n.b2Vec2.Extents(this.lowerBound,this.upperBound,t)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}Combine1(t){return this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,i){return i.Combine2(t,e),i}Contains(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let i=-s.b2_maxFloat,n=s.b2_maxFloat;const o=e.p1.x,r=e.p1.y,a=e.p2.x-e.p1.x,h=e.p2.y-e.p1.y,l=Math.abs(a),c=Math.abs(h),{normal:u}=t;if(l<s.b2_epsilon){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else{const t=1/a;let e=(this.lowerBound.x-o)*t,s=(this.upperBound.x-o)*t,r=-1;if(e>s){const t=e;e=s,s=t,r=1}if(e>i&&(u.x=r,u.y=0,i=e),n=Math.min(n,s),i>n)return!1}if(c<s.b2_epsilon){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{const t=1/h;let e=(this.lowerBound.y-r)*t,s=(this.upperBound.y-r)*t,o=-1;if(e>s){const t=e;e=s,s=t,o=1}if(e>i&&(u.x=0,u.y=o,i=e),n=Math.min(n,s),i>n)return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,0))}TestContain(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}TestOverlap(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}},e.b2ClipSegmentToLine=function(t,[e,i],s,o,a){let h=0;const l=n.b2Vec2.Dot(s,e.v)-o,c=n.b2Vec2.Dot(s,i.v)-o;if(l<=0&&t[h++].Copy(e),c<=0&&t[h++].Copy(i),l*c<0){const s=l/(l-c),{v:n,id:o}=t[h];n.x=e.v.x+s*(i.v.x-e.v.x),n.y=e.v.y+s*(i.v.y-e.v.y),o.cf.indexA=a,o.cf.indexB=e.id.cf.indexB,o.cf.typeA=r.e_vertex,o.cf.typeB=r.e_face,++h}return h};const p=new o.b2DistanceInput,_=new o.b2SimplexCache,b=new o.b2DistanceOutput;e.b2TestOverlap=function(t,e,i,n,r,a){const h=p.Reset();h.proxyA.SetShape(t,e),h.proxyB.SetShape(i,n),h.transformA.Copy(r),h.transformB.Copy(a),h.useRadii=!0;const l=_.Reset();l.count=0;const c=b.Reset();return(0,o.b2Distance)(c,l,h),c.distance<10*s.b2_epsilon}},9007:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ShapeCast=e.b2Distance=e.b2Gjk=e.b2ShapeCastOutput=e.b2ShapeCastInput=e.b2DistanceOutput=e.b2DistanceInput=e.b2SimplexCache=e.b2DistanceProxy=void 0;const s=i(2962),n=i(6826);class o{constructor(){this.m_buffer=(0,s.b2MakeArray)(2,n.b2Vec2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Copy(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}SetVerticesRadius(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}GetSupport(t){let e=0,i=n.b2Vec2.Dot(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.b2Vec2.Dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e}GetSupportVertex(t){let e=0,i=n.b2Vec2.Dot(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.b2Vec2.Dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}e.b2DistanceProxy=o,e.b2SimplexCache=class{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}},e.b2DistanceInput=class{constructor(){this.proxyA=new o,this.proxyB=new o,this.transformA=new n.b2Transform,this.transformB=new n.b2Transform,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}},e.b2DistanceOutput=class{constructor(){this.pointA=new n.b2Vec2,this.pointB=new n.b2Vec2,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}},e.b2ShapeCastInput=class{constructor(){this.proxyA=new o,this.proxyB=new o,this.transformA=new n.b2Transform,this.transformB=new n.b2Transform,this.translationB=new n.b2Vec2}},e.b2ShapeCastOutput=class{constructor(){this.point=new n.b2Vec2,this.normal=new n.b2Vec2,this.lambda=0,this.iterations=0}},e.b2Gjk={calls:0,iters:0,maxIters:0,reset(){this.calls=0,this.iters=0,this.maxIters=0}};class r{constructor(){this.wA=new n.b2Vec2,this.wB=new n.b2Vec2,this.w=new n.b2Vec2,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class a{constructor(){this.m_v1=new r,this.m_v2=new r,this.m_v3=new r,this.m_count=0,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}ReadCache(t,e,i,o,r){this.m_count=t.count;const a=this.m_vertices;for(let s=0;s<this.m_count;++s){const h=a[s];h.indexA=t.indexA[s],h.indexB=t.indexB[s];const l=e.GetVertex(h.indexA),c=o.GetVertex(h.indexB);n.b2Transform.MultiplyVec2(i,l,h.wA),n.b2Transform.MultiplyVec2(r,c,h.wB),n.b2Vec2.Subtract(h.wB,h.wA,h.w),h.a=0}if(this.m_count>1){const e=t.metric,i=this.GetMetric();(i<.5*e||2*e<i||i<s.b2_epsilon)&&(this.m_count=0)}if(0===this.m_count){const t=a[0];t.indexA=0,t.indexB=0;const s=e.GetVertex(0),h=o.GetVertex(0);n.b2Transform.MultiplyVec2(i,s,t.wA),n.b2Transform.MultiplyVec2(r,h,t.wB),n.b2Vec2.Subtract(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const e=this.m_vertices;for(let i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return n.b2Vec2.Negate(this.m_v1.w,t);case 2:{const e=n.b2Vec2.Subtract(this.m_v2.w,this.m_v1.w,t);return n.b2Vec2.Cross(e,n.b2Vec2.Negate(this.m_v1.w,n.b2Vec2.s_t0))>0?n.b2Vec2.CrossOneVec2(e,t):n.b2Vec2.CrossVec2One(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:case 3:default:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y)}}GetWitnessPoints(t,e){switch(this.m_count){case 0:default:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return n.b2Vec2.Distance(this.m_v1.w,this.m_v2.w);case 3:return n.b2Vec2.Cross(n.b2Vec2.Subtract(this.m_v2.w,this.m_v1.w,n.b2Vec2.s_t0),n.b2Vec2.Subtract(this.m_v3.w,this.m_v1.w,n.b2Vec2.s_t1))}}Solve2(){const t=this.m_v1.w,e=this.m_v2.w,i=n.b2Vec2.Subtract(e,t,a.s_e12),s=-n.b2Vec2.Dot(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);const o=n.b2Vec2.Dot(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const r=1/(o+s);this.m_v1.a=o*r,this.m_v2.a=s*r,this.m_count=2}Solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=n.b2Vec2.Subtract(e,t,a.s_e12),o=n.b2Vec2.Dot(t,s),r=n.b2Vec2.Dot(e,s),h=-o,l=n.b2Vec2.Subtract(i,t,a.s_e13),c=n.b2Vec2.Dot(t,l),u=n.b2Vec2.Dot(i,l),m=-c,d=n.b2Vec2.Subtract(i,e,a.s_e23),p=n.b2Vec2.Dot(e,d),_=n.b2Vec2.Dot(i,d),b=-p,y=n.b2Vec2.Cross(s,l),f=y*n.b2Vec2.Cross(e,i),g=y*n.b2Vec2.Cross(i,t),x=y*n.b2Vec2.Cross(t,e);if(h<=0&&m<=0)return this.m_v1.a=1,void(this.m_count=1);if(r>0&&h>0&&x<=0){const t=1/(r+h);return this.m_v1.a=r*t,this.m_v2.a=h*t,void(this.m_count=2)}if(u>0&&m>0&&g<=0){const t=1/(u+m);return this.m_v1.a=u*t,this.m_v3.a=m*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(r<=0&&b<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(u<=0&&_<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(_>0&&b>0&&f<=0){const t=1/(_+b);return this.m_v2.a=_*t,this.m_v3.a=b*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const v=1/(f+g+x);this.m_v1.a=f*v,this.m_v2.a=g*v,this.m_v3.a=x*v,this.m_count=3}}a.s_e12=new n.b2Vec2,a.s_e13=new n.b2Vec2,a.s_e23=new n.b2Vec2;const h=new a,l=[0,0,0],c=[0,0,0],u=new n.b2Vec2,m=new n.b2Vec2,d=new n.b2Vec2,p=new n.b2Vec2,_=new n.b2Vec2;e.b2Distance=function(t,i,o){++e.b2Gjk.calls;const{proxyA:r,proxyB:a,transformA:b,transformB:y}=o,f=h;f.ReadCache(i,r,b,a,y);const g=f.m_vertices,x=l,v=c;let A=0,w=0;for(;w<20;){A=f.m_count;for(let t=0;t<A;++t)x[t]=g[t].indexA,v[t]=g[t].indexB;switch(f.m_count){case 1:break;case 2:f.Solve2();break;case 3:f.Solve3()}if(3===f.m_count)break;const t=f.GetSearchDirection(m);if(t.LengthSquared()<s.b2_epsilon_sq)break;const i=g[f.m_count];i.indexA=r.GetSupport(n.b2Rot.TransposeMultiplyVec2(b.q,n.b2Vec2.Negate(t,n.b2Vec2.s_t0),p)),n.b2Transform.MultiplyVec2(b,r.GetVertex(i.indexA),i.wA),i.indexB=a.GetSupport(n.b2Rot.TransposeMultiplyVec2(y.q,t,_)),n.b2Transform.MultiplyVec2(y,a.GetVertex(i.indexB),i.wB),n.b2Vec2.Subtract(i.wB,i.wA,i.w),++w,++e.b2Gjk.iters;let o=!1;for(let t=0;t<A;++t)if(i.indexA===x[t]&&i.indexB===v[t]){o=!0;break}if(o)break;++f.m_count}if(e.b2Gjk.maxIters=Math.max(e.b2Gjk.maxIters,w),f.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.b2Vec2.Distance(t.pointA,t.pointB),t.iterations=w,f.WriteCache(i),o.useRadii){const e=r.m_radius,i=a.m_radius;if(t.distance>e+i&&t.distance>s.b2_epsilon){t.distance-=e+i;const s=n.b2Vec2.Subtract(t.pointB,t.pointA,d);s.Normalize(),t.pointA.AddScaled(e,s),t.pointB.SubtractScaled(i,s)}else{const e=n.b2Vec2.Mid(t.pointA,t.pointB,u);t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0}}};const b=new n.b2Vec2,y=new a,f=new n.b2Vec2,g=new n.b2Vec2,x=new n.b2Vec2,v=new n.b2Vec2,A=new n.b2Vec2,w=new n.b2Vec2;e.b2ShapeCast=function(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();const{proxyA:i,proxyB:o}=e,r=Math.max(i.m_radius,s.b2_polygonRadius),a=r+Math.max(o.m_radius,s.b2_polygonRadius),h=e.transformA,l=e.transformB,c=e.translationB,u=b.SetZero();let m=0;const d=y;d.m_count=0;const p=d.m_vertices;let _=i.GetSupport(n.b2Rot.TransposeMultiplyVec2(h.q,n.b2Vec2.Negate(c,n.b2Vec2.s_t1),n.b2Vec2.s_t0)),S=n.b2Transform.MultiplyVec2(h,i.GetVertex(_),f),C=o.GetSupport(n.b2Rot.TransposeMultiplyVec2(l.q,c,n.b2Vec2.s_t0)),V=n.b2Transform.MultiplyVec2(l,o.GetVertex(C),g);const B=n.b2Vec2.Subtract(S,V,x),T=Math.max(s.b2_polygonRadius,a-s.b2_polygonRadius),M=.5*s.b2_linearSlop;let I=0;for(;I<20&&B.Length()-T>M;){t.iterations+=1,_=i.GetSupport(n.b2Rot.TransposeMultiplyVec2(h.q,n.b2Vec2.Negate(B,n.b2Vec2.s_t1),n.b2Vec2.s_t0)),S=n.b2Transform.MultiplyVec2(h,i.GetVertex(_),f),C=o.GetSupport(n.b2Rot.TransposeMultiplyVec2(l.q,B,n.b2Vec2.s_t0)),V=n.b2Transform.MultiplyVec2(l,o.GetVertex(C),g);const e=n.b2Vec2.Subtract(S,V,v);B.Normalize();const s=n.b2Vec2.Dot(B,e),r=n.b2Vec2.Dot(B,c);if(s-T>m*r){if(r<=0)return!1;if(m=(s-T)/r,m>1)return!1;n.b2Vec2.Negate(B,u),d.m_count=0}const a=p[d.m_count];switch(a.indexA=C,n.b2Vec2.AddScaled(V,m,c,a.wA),a.indexB=_,a.wB.Copy(S),n.b2Vec2.Subtract(a.wB,a.wA,a.w),a.a=1,d.m_count+=1,d.m_count){case 1:break;case 2:d.Solve2();break;case 3:d.Solve3()}if(3===d.m_count)return!1;d.GetClosestPoint(B),++I}if(0===I)return!1;const P=A,E=w;return d.GetWitnessPoints(P,E),B.LengthSquared()>0&&(n.b2Vec2.Negate(B,u),u.Normalize()),n.b2Vec2.AddScaled(P,r,u,t.point),t.normal.Copy(u),t.lambda=m,t.iterations=I,!0}},1006:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2DynamicTree=e.b2TreeNode=void 0;const s=i(2962),n=i(6826),o=i(2472),r={stack:[],t:new n.b2Vec2,r:new n.b2Vec2,v:new n.b2Vec2,abs_v:new n.b2Vec2,segmentAABB:new o.b2AABB,subInput:new o.b2RayCastInput,combinedAABB:new o.b2AABB,aabb:new o.b2AABB,fatAABB:new o.b2AABB,hugeAABB:new o.b2AABB,c:new n.b2Vec2,h:new n.b2Vec2};let a=0;class h{constructor(){this.aabb=new o.b2AABB,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.moved=!1,this.id=a++}Reset(){this.child1=null,this.child2=null,this.height=-1,this.userData=null}IsLeaf(){return null===this.child1}GetArea(){if(this.IsLeaf())return 0;let t=this.aabb.GetPerimeter();return this.child1&&(t+=this.child1.GetArea()),this.child2&&(t+=this.child2.GetArea()),t}ComputeHeight(){if(this.IsLeaf())return 0;(0,s.b2Assert)(null!==this.child1&&null!==this.child2);const t=(0,s.b2Verify)(this.child1).ComputeHeight(),e=(0,s.b2Verify)(this.child2).ComputeHeight();return 1+Math.max(t,e)}GetMaxBalance(){if(this.height<=1)return 0;const t=(0,s.b2Verify)(this.child1),e=(0,s.b2Verify)(this.child2);return Math.max(t.GetMaxBalance(),e.GetMaxBalance(),Math.abs(e.height-t.height))}ShiftOrigin(t){this.height<=1||((0,s.b2Verify)(this.child1).ShiftOrigin(t),(0,s.b2Verify)(this.child2).ShiftOrigin(t),this.aabb.lowerBound.Subtract(t),this.aabb.upperBound.Subtract(t))}}e.b2TreeNode=h,e.b2DynamicTree=class{constructor(){this.m_root=null,this.m_freeList=null}Query(t,e){const i=r.stack;i.length=0;let s=this.m_root;for(;s;){if(s.aabb.TestOverlap(t))if(s.IsLeaf()){if(!e(s))return}else i.push(s.child1),i.push(s.child2);s=i.pop()}}QueryPoint(t,e){const i=r.stack;i.length=0;let s=this.m_root;for(;s;){if(s.aabb.TestContain(t))if(s.IsLeaf()){if(!e(s))return}else i.push(s.child1),i.push(s.child2);s=i.pop()}}RayCast(t,e){const{p1:i,p2:s}=t,o=n.b2Vec2.Subtract(s,i,r.r);o.Normalize();const a=n.b2Vec2.CrossOneVec2(o,r.v),h=a.GetAbs(r.abs_v);let{maxFraction:l}=t;const{segmentAABB:c,subInput:u,c:m,h:d,t:p}=r;n.b2Vec2.AddScaled(i,l,n.b2Vec2.Subtract(s,i,p),p),n.b2Vec2.Min(i,p,c.lowerBound),n.b2Vec2.Max(i,p,c.upperBound);const _=r.stack;_.length=0;let b=this.m_root;for(;b;)if(b.aabb.TestOverlap(c))if(b.aabb.GetCenter(m),b.aabb.GetExtents(d),Math.abs(n.b2Vec2.Dot(a,n.b2Vec2.Subtract(i,m,n.b2Vec2.s_t0)))-n.b2Vec2.Dot(h,d)>0)b=_.pop();else{if(b.IsLeaf()){u.p1.Copy(t.p1),u.p2.Copy(t.p2),u.maxFraction=l;const o=e(u,b);if(0===o)return;o>0&&(l=o,n.b2Vec2.AddScaled(i,l,n.b2Vec2.Subtract(s,i,p),p),n.b2Vec2.Min(i,p,c.lowerBound),n.b2Vec2.Max(i,p,c.upperBound))}else _.push(b.child1),_.push(b.child2);b=_.pop()}else b=_.pop()}AllocateNode(){if(null===this.m_freeList)return new h;const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.moved=!1,t}FreeNode(t){t.parent=this.m_freeList,t.Reset(),this.m_freeList=t}CreateProxy(t,e){const i=this.AllocateNode(),n=s.b2_aabbExtension;return i.aabb.lowerBound.Set(t.lowerBound.x-n,t.lowerBound.y-n),i.aabb.upperBound.Set(t.upperBound.x+n,t.upperBound.y+n),i.userData=e,i.height=0,i.moved=!0,this.InsertLeaf(i),i}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,i){const{fatAABB:n,hugeAABB:o}=r,a=s.b2_aabbExtension;n.lowerBound.Set(e.lowerBound.x-a,e.lowerBound.y-a),n.upperBound.Set(e.upperBound.x+a,e.upperBound.y+a);const h=s.b2_aabbMultiplier*i.x,l=s.b2_aabbMultiplier*i.y;h<0?n.lowerBound.x+=h:n.upperBound.x+=h,l<0?n.lowerBound.y+=l:n.upperBound.y+=l;const c=t.aabb;if(c.Contains(e)){const t=4*s.b2_aabbExtension;if(o.lowerBound.Set(n.lowerBound.x-t,e.lowerBound.y-t),o.upperBound.Set(n.upperBound.x+t,e.upperBound.y+t),o.Contains(c))return!1}return this.RemoveLeaf(t),t.aabb.Copy(n),this.InsertLeaf(t),t.moved=!0,!0}InsertLeaf(t){if(null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const{combinedAABB:e,aabb:i}=r,n=t.aabb;let o=this.m_root;for(;!o.IsLeaf();){const t=(0,s.b2Verify)(o.child1),r=(0,s.b2Verify)(o.child2),a=o.aabb.GetPerimeter();e.Combine2(o.aabb,n);const h=e.GetPerimeter(),l=2*h,c=2*(h-a);let u,m,d,p;if(t.IsLeaf()?(i.Combine2(n,t.aabb),u=i.GetPerimeter()+c):(i.Combine2(n,t.aabb),m=t.aabb.GetPerimeter(),d=i.GetPerimeter(),u=d-m+c),r.IsLeaf()?(i.Combine2(n,r.aabb),p=i.GetPerimeter()+c):(i.Combine2(n,r.aabb),m=r.aabb.GetPerimeter(),d=i.GetPerimeter(),p=d-m+c),l<u&&l<p)break;o=u<p?t:r}const a=o.parent,h=this.AllocateNode();h.parent=a,h.userData=null,h.aabb.Combine2(n,o.aabb),h.height=o.height+1,null!==a?(a.child1===o?a.child1=h:a.child2=h,h.child1=o,h.child2=t,o.parent=h,t.parent=h):(h.child1=o,h.child2=t,o.parent=h,t.parent=h,this.m_root=h);let l=t.parent;for(;null!==l;){l=this.Balance(l);const t=(0,s.b2Verify)(l.child1),e=(0,s.b2Verify)(l.child2);l.height=1+Math.max(t.height,e.height),l.aabb.Combine2(t.aabb,e.aabb),l=l.parent}}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=(0,s.b2Verify)(t.parent),i=e.parent,n=(0,s.b2Verify)(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=n:i.child2=n,n.parent=i,this.FreeNode(e);let t=i;for(;null!==t;){t=this.Balance(t);const e=(0,s.b2Verify)(t.child1),i=(0,s.b2Verify)(t.child2);t.aabb.Combine2(e.aabb,i.aabb),t.height=1+Math.max(e.height,i.height),t=t.parent}}else this.m_root=n,n.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=(0,s.b2Verify)(t.child1),i=(0,s.b2Verify)(t.child2),n=i.height-e.height;if(n>1){const n=(0,s.b2Verify)(i.child1),o=(0,s.b2Verify)(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,n.height>o.height?(i.child2=n,t.child2=o,o.parent=t,t.aabb.Combine2(e.aabb,o.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+Math.max(e.height,o.height),i.height=1+Math.max(t.height,n.height)):(i.child2=o,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,o.aabb),t.height=1+Math.max(e.height,n.height),i.height=1+Math.max(t.height,o.height)),i}if(n<-1){const n=(0,s.b2Verify)(e.child1),o=(0,s.b2Verify)(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,n.height>o.height?(e.child2=n,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+Math.max(i.height,o.height),e.height=1+Math.max(t.height,n.height)):(e.child2=o,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+Math.max(i.height,n.height),e.height=1+Math.max(t.height,o.height)),e}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root,e=t.aabb.GetPerimeter();return t.GetArea()/e}GetMaxBalance(){return null===this.m_root?0:this.m_root.GetMaxBalance()}ShiftOrigin(t){var e;null===(e=this.m_root)||void 0===e||e.ShiftOrigin(t)}}},7568:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2EdgeShape=void 0;const s=i(2962),n=i(6826),o=i(6955);class r extends o.b2Shape{constructor(){super(o.b2ShapeType.e_edge,s.b2_polygonRadius),this.m_vertex1=new n.b2Vec2,this.m_vertex2=new n.b2Vec2,this.m_vertex0=new n.b2Vec2,this.m_vertex3=new n.b2Vec2,this.m_oneSided=!1}SetOneSided(t,e,i,s){return this.m_vertex0.Copy(t),this.m_vertex1.Copy(e),this.m_vertex2.Copy(i),this.m_vertex3.Copy(s),this.m_oneSided=!0,this}SetTwoSided(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_oneSided=!1,this}Clone(){return(new r).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_oneSided=t.m_oneSided,this}GetChildCount(){return 1}TestPoint(t,e){return!1}RayCast(t,e,i,s){const o=n.b2Transform.TransposeMultiplyVec2(i,e.p1,r.RayCast_s_p1),a=n.b2Transform.TransposeMultiplyVec2(i,e.p2,r.RayCast_s_p2),h=n.b2Vec2.Subtract(a,o,r.RayCast_s_d),l=this.m_vertex1,c=this.m_vertex2,u=n.b2Vec2.Subtract(c,l,r.RayCast_s_e),{normal:m}=t;m.Set(u.y,-u.x).Normalize();const d=n.b2Vec2.Dot(m,n.b2Vec2.Subtract(l,o,n.b2Vec2.s_t0));if(this.m_oneSided&&d>0)return!1;const p=n.b2Vec2.Dot(m,h);if(0===p)return!1;const _=d/p;if(_<0||e.maxFraction<_)return!1;const b=n.b2Vec2.AddScaled(o,_,h,r.RayCast_s_q),y=n.b2Vec2.Subtract(c,l,r.RayCast_s_r),f=n.b2Vec2.Dot(y,y);if(0===f)return!1;const g=n.b2Vec2.Dot(n.b2Vec2.Subtract(b,l,n.b2Vec2.s_t0),y)/f;return!(g<0||g>1||(t.fraction=_,n.b2Rot.MultiplyVec2(i.q,t.normal,t.normal),d>0&&t.normal.Negate(),0))}ComputeAABB(t,e,i){const s=n.b2Transform.MultiplyVec2(e,this.m_vertex1,r.ComputeAABB_s_v1),o=n.b2Transform.MultiplyVec2(e,this.m_vertex2,r.ComputeAABB_s_v2);n.b2Vec2.Min(s,o,t.lowerBound),n.b2Vec2.Max(s,o,t.upperBound);const a=this.m_radius;t.lowerBound.SubtractXY(a,a),t.upperBound.AddXY(a,a)}ComputeMass(t,e){t.mass=0,n.b2Vec2.Mid(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}Draw(t,e){const i=this.m_vertex1,s=this.m_vertex2;t.DrawSegment(i,s,e),!1===this.m_oneSided&&(t.DrawPoint(i,4,e),t.DrawPoint(s,4,e))}}e.b2EdgeShape=r,r.RayCast_s_p1=new n.b2Vec2,r.RayCast_s_p2=new n.b2Vec2,r.RayCast_s_d=new n.b2Vec2,r.RayCast_s_e=new n.b2Vec2,r.RayCast_s_q=new n.b2Vec2,r.RayCast_s_r=new n.b2Vec2,r.ComputeAABB_s_v1=new n.b2Vec2,r.ComputeAABB_s_v2=new n.b2Vec2},3152:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2PolygonShape=void 0;const s=i(2962),n=i(6826),o=i(2952),r=i(6955),a={ComputeCentroid:{s:new n.b2Vec2,p1:new n.b2Vec2,p2:new n.b2Vec2,p3:new n.b2Vec2,e1:new n.b2Vec2,e2:new n.b2Vec2},TestPoint:{pLocal:new n.b2Vec2},ComputeAABB:{v:new n.b2Vec2},ComputeMass:{center:new n.b2Vec2,s:new n.b2Vec2,e1:new n.b2Vec2,e2:new n.b2Vec2},Validate:{e:new n.b2Vec2,v:new n.b2Vec2},Set:{r:new n.b2Vec2,v:new n.b2Vec2},RayCast:{p1:new n.b2Vec2,p2:new n.b2Vec2,d:new n.b2Vec2},SetAsBox:{xf:new n.b2Transform}},h=(.5*s.b2_linearSlop)**2;class l extends r.b2Shape{constructor(){super(r.b2ShapeType.e_polygon,s.b2_polygonRadius),this.m_centroid=new n.b2Vec2,this.m_vertices=[],this.m_normals=[],this.m_count=0}Clone(){return(new l).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=(0,s.b2MakeArray)(this.m_count,n.b2Vec2),this.m_normals=(0,s.b2MakeArray)(this.m_count,n.b2Vec2);for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(t,e=t.length){if(e<3)return this.SetAsBox(1,1);let i=Math.min(e,o.b2_maxPolygonVertices);const r=[];for(let e=0;e<i;++e){const i=t[e];r.every((t=>n.b2Vec2.DistanceSquared(i,t)>=h))&&r.push(i)}if(i=r.length,i<3)return this.SetAsBox(1,1);let l=0,c=r[0].x;for(let t=1;t<i;++t){const{x:e}=r[t];(e>c||e===c&&r[t].y<r[l].y)&&(l=t,c=e)}const u=[];let m=0,d=l;for(;;){u[m]=d;let t=0;for(let e=1;e<i;++e){if(t===d){t=e;continue}const i=n.b2Vec2.Subtract(r[t],r[u[m]],a.Set.r),s=n.b2Vec2.Subtract(r[e],r[u[m]],a.Set.v),o=n.b2Vec2.Cross(i,s);o<0&&(t=e),0===o&&s.LengthSquared()>i.LengthSquared()&&(t=e)}if(++m,d=t,t===l)break}(0,s.b2Assert)(m>=3,"Polygon is degenerate"),this.m_count=m,this.m_vertices=(0,s.b2MakeArray)(this.m_count,n.b2Vec2),this.m_normals=(0,s.b2MakeArray)(this.m_count,n.b2Vec2);for(let t=0;t<m;++t)this.m_vertices[t].Copy(r[u[t]]);for(let t=0;t<m;++t){const e=t,i=t+1<m?t+1:0,s=n.b2Vec2.Subtract(this.m_vertices[i],this.m_vertices[e],n.b2Vec2.s_t0);n.b2Vec2.CrossVec2One(s,this.m_normals[t]).Normalize()}return function(t,e,i){const s=i;s.SetZero();let o=0;const{s:r,p1:h,p2:l,p3:c,e1:u,e2:m}=a.ComputeCentroid;r.Copy(t[0]);const d=1/3;for(let i=0;i<e;++i){n.b2Vec2.Subtract(t[0],r,h),n.b2Vec2.Subtract(t[i],r,l),n.b2Vec2.Subtract(t[i+1<e?i+1:0],r,c),n.b2Vec2.Subtract(l,h,u),n.b2Vec2.Subtract(c,h,m);const a=.5*n.b2Vec2.Cross(u,m);o+=a,s.x+=a*d*(h.x+l.x+c.x),s.y+=a*d*(h.y+l.y+c.y)}const p=1/o;s.x=p*s.x+r.x,s.y=p*s.y+r.y}(this.m_vertices,m,this.m_centroid),this}SetAsBox(t,e,i,o=0){if(this.m_count=4,this.m_vertices=(0,s.b2MakeArray)(this.m_count,n.b2Vec2),this.m_normals=(0,s.b2MakeArray)(this.m_count,n.b2Vec2),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),i){this.m_centroid.Copy(i);const{xf:t}=a.SetAsBox;t.SetPosition(i),t.SetRotationAngle(o);for(let e=0;e<this.m_count;++e)n.b2Transform.MultiplyVec2(t,this.m_vertices[e],this.m_vertices[e]),n.b2Rot.MultiplyVec2(t.q,this.m_normals[e],this.m_normals[e])}else this.m_centroid.SetZero();return this}TestPoint(t,e){const i=n.b2Transform.TransposeMultiplyVec2(t,e,a.TestPoint.pLocal);for(let t=0;t<this.m_count;++t)if(n.b2Vec2.Dot(this.m_normals[t],n.b2Vec2.Subtract(i,this.m_vertices[t],n.b2Vec2.s_t0))>0)return!1;return!0}RayCast(t,e,i,s){const o=n.b2Transform.TransposeMultiplyVec2(i,e.p1,a.RayCast.p1),r=n.b2Transform.TransposeMultiplyVec2(i,e.p2,a.RayCast.p2),h=n.b2Vec2.Subtract(r,o,a.RayCast.d);let l=0,c=e.maxFraction,u=-1;for(let t=0;t<this.m_count;++t){const e=n.b2Vec2.Dot(this.m_normals[t],n.b2Vec2.Subtract(this.m_vertices[t],o,n.b2Vec2.s_t0)),i=n.b2Vec2.Dot(this.m_normals[t],h);if(0===i){if(e<0)return!1}else i<0&&e<l*i?(l=e/i,u=t):i>0&&e<c*i&&(c=e/i);if(c<l)return!1}return u>=0&&(t.fraction=l,n.b2Rot.MultiplyVec2(i.q,this.m_normals[u],t.normal),!0)}ComputeAABB(t,e,i){const s=n.b2Transform.MultiplyVec2(e,this.m_vertices[0],t.lowerBound),o=t.upperBound.Copy(s);for(let t=1;t<this.m_count;++t){const i=n.b2Transform.MultiplyVec2(e,this.m_vertices[t],a.ComputeAABB.v);n.b2Vec2.Min(s,i,s),n.b2Vec2.Max(o,i,o)}const r=this.m_radius;s.SubtractXY(r,r),o.AddXY(r,r)}ComputeMass(t,e){const i=a.ComputeMass.center.SetZero();let s=0,o=0;const r=a.ComputeMass.s.Copy(this.m_vertices[0]),h=1/3;for(let t=0;t<this.m_count;++t){const e=n.b2Vec2.Subtract(this.m_vertices[t],r,a.ComputeMass.e1),l=n.b2Vec2.Subtract(this.m_vertices[t+1<this.m_count?t+1:0],r,a.ComputeMass.e2),c=n.b2Vec2.Cross(e,l),u=.5*c;s+=u,i.AddScaled(u*h,n.b2Vec2.Add(e,l,n.b2Vec2.s_t0));const m=e.x,d=e.y,p=l.x,_=l.y;o+=.25*h*c*(m*m+p*m+p*p+(d*d+_*d+_*_))}t.mass=e*s,i.Scale(1/s),n.b2Vec2.Add(i,r,t.center),t.I=e*o,t.I+=t.mass*(n.b2Vec2.Dot(t.center,t.center)-n.b2Vec2.Dot(i,i))}Validate(){const{e:t,v:e}=a.Validate;for(let i=0;i<this.m_count;++i){const s=i,o=i<this.m_count-1?s+1:0,r=this.m_vertices[s];n.b2Vec2.Subtract(this.m_vertices[o],r,t);for(let i=0;i<this.m_count;++i)if(i!==s&&i!==o&&(n.b2Vec2.Subtract(this.m_vertices[i],r,e),n.b2Vec2.Cross(t,e)<0))return!1}return!0}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}Draw(t,e){const i=this.m_count,s=this.m_vertices;t.DrawSolidPolygon(s,i,e)}}e.b2PolygonShape=l},6955:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Shape=e.b2ShapeType=e.b2MassData=void 0;const s=i(6826);var n;e.b2MassData=class{constructor(){this.mass=0,this.center=new s.b2Vec2,this.I=0}},(n=e.b2ShapeType||(e.b2ShapeType={}))[n.e_unknown=-1]="e_unknown",n[n.e_circle=0]="e_circle",n[n.e_edge=1]="e_edge",n[n.e_polygon=2]="e_polygon",n[n.e_chain=3]="e_chain",n[n.e_typeCount=4]="e_typeCount",e.b2Shape=class{constructor(t,e){this.m_radius=0,this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}},5608:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2TimeOfImpact=e.b2TOIOutput=e.b2TOIOutputState=e.b2TOIInput=e.b2Toi=void 0;const s=i(2962),n=i(2952),o=i(6826),r=i(2026),a=i(9007);e.b2Toi={time:0,maxTime:0,calls:0,iters:0,maxIters:0,rootIters:0,maxRootIters:0,reset(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}};const h=new o.b2Transform,l=new o.b2Transform,c=new o.b2Vec2,u=new o.b2Vec2,m=new o.b2Vec2,d=new o.b2Vec2,p=new o.b2Vec2;var _,b;e.b2TOIInput=class{constructor(){this.proxyA=new a.b2DistanceProxy,this.proxyB=new a.b2DistanceProxy,this.sweepA=new o.b2Sweep,this.sweepB=new o.b2Sweep,this.tMax=0}},function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(_=e.b2TOIOutputState||(e.b2TOIOutputState={})),e.b2TOIOutput=class{constructor(){this.state=_.e_unknown,this.t=0}},function(t){t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(b||(b={}));const y=new r.b2Timer,f=new a.b2SimplexCache,g=new a.b2DistanceInput,x=new a.b2DistanceOutput,v=new class{constructor(){this.m_sweepA=new o.b2Sweep,this.m_sweepB=new o.b2Sweep,this.m_type=b.e_points,this.m_localPoint=new o.b2Vec2,this.m_axis=new o.b2Vec2}Initialize(t,e,i,s,n,r){this.m_proxyA=e,this.m_proxyB=s;const{count:a}=t;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);const d=this.m_sweepA.GetTransform(h,r),p=this.m_sweepB.GetTransform(l,r);if(1===a){this.m_type=b.e_points;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyB.GetVertex(t.indexB[0]),s=o.b2Transform.MultiplyVec2(d,e,c),n=o.b2Transform.MultiplyVec2(p,i,u);return o.b2Vec2.Subtract(n,s,this.m_axis),this.m_axis.Normalize()}if(t.indexA[0]===t.indexA[1]){this.m_type=b.e_faceB;const e=this.m_proxyB.GetVertex(t.indexB[0]),i=this.m_proxyB.GetVertex(t.indexB[1]);o.b2Vec2.CrossVec2One(o.b2Vec2.Subtract(i,e,o.b2Vec2.s_t0),this.m_axis).Normalize();const s=o.b2Rot.MultiplyVec2(p.q,this.m_axis,m);o.b2Vec2.Mid(e,i,this.m_localPoint);const n=o.b2Transform.MultiplyVec2(p,this.m_localPoint,u),r=this.m_proxyA.GetVertex(t.indexA[0]),a=o.b2Transform.MultiplyVec2(d,r,c);let h=o.b2Vec2.Dot(o.b2Vec2.Subtract(a,n,o.b2Vec2.s_t0),s);return h<0&&(this.m_axis.Negate(),h=-h),h}this.m_type=b.e_faceA;const _=this.m_proxyA.GetVertex(t.indexA[0]),y=this.m_proxyA.GetVertex(t.indexA[1]);o.b2Vec2.CrossVec2One(o.b2Vec2.Subtract(y,_,o.b2Vec2.s_t0),this.m_axis).Normalize();const f=o.b2Rot.MultiplyVec2(d.q,this.m_axis,m);o.b2Vec2.Mid(_,y,this.m_localPoint);const g=o.b2Transform.MultiplyVec2(d,this.m_localPoint,c),x=this.m_proxyB.GetVertex(t.indexB[0]),v=o.b2Transform.MultiplyVec2(p,x,u);let A=o.b2Vec2.Dot(o.b2Vec2.Subtract(v,g,o.b2Vec2.s_t0),f);return A<0&&(this.m_axis.Negate(),A=-A),A}FindMinSeparation(t,e,i){const s=this.m_sweepA.GetTransform(h,i),n=this.m_sweepB.GetTransform(l,i);switch(this.m_type){case b.e_points:{const i=o.b2Rot.TransposeMultiplyVec2(s.q,this.m_axis,d),r=o.b2Rot.TransposeMultiplyVec2(n.q,o.b2Vec2.Negate(this.m_axis,o.b2Vec2.s_t0),p);t[0]=this.m_proxyA.GetSupport(i),e[0]=this.m_proxyB.GetSupport(r);const a=this.m_proxyA.GetVertex(t[0]),h=this.m_proxyB.GetVertex(e[0]),l=o.b2Transform.MultiplyVec2(s,a,c),m=o.b2Transform.MultiplyVec2(n,h,u);return o.b2Vec2.Dot(o.b2Vec2.Subtract(m,l,o.b2Vec2.s_t0),this.m_axis)}case b.e_faceA:{const i=o.b2Rot.MultiplyVec2(s.q,this.m_axis,m),r=o.b2Transform.MultiplyVec2(s,this.m_localPoint,c),a=o.b2Rot.TransposeMultiplyVec2(n.q,o.b2Vec2.Negate(i,o.b2Vec2.s_t0),p);t[0]=-1,e[0]=this.m_proxyB.GetSupport(a);const h=this.m_proxyB.GetVertex(e[0]),l=o.b2Transform.MultiplyVec2(n,h,u);return o.b2Vec2.Dot(o.b2Vec2.Subtract(l,r,o.b2Vec2.s_t0),i)}case b.e_faceB:{const i=o.b2Rot.MultiplyVec2(n.q,this.m_axis,m),r=o.b2Transform.MultiplyVec2(n,this.m_localPoint,u),a=o.b2Rot.TransposeMultiplyVec2(s.q,o.b2Vec2.Negate(i,o.b2Vec2.s_t0),d);e[0]=-1,t[0]=this.m_proxyA.GetSupport(a);const h=this.m_proxyA.GetVertex(t[0]),l=o.b2Transform.MultiplyVec2(s,h,c);return o.b2Vec2.Dot(o.b2Vec2.Subtract(l,r,o.b2Vec2.s_t0),i)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,i){const n=this.m_sweepA.GetTransform(h,i),r=this.m_sweepB.GetTransform(l,i);switch(this.m_type){case b.e_points:{const i=this.m_proxyA.GetVertex(t),s=this.m_proxyB.GetVertex(e),a=o.b2Transform.MultiplyVec2(n,i,c),h=o.b2Transform.MultiplyVec2(r,s,u);return o.b2Vec2.Dot(o.b2Vec2.Subtract(h,a,o.b2Vec2.s_t0),this.m_axis)}case b.e_faceA:{const t=o.b2Rot.MultiplyVec2(n.q,this.m_axis,m),i=o.b2Transform.MultiplyVec2(n,this.m_localPoint,c),s=this.m_proxyB.GetVertex(e),a=o.b2Transform.MultiplyVec2(r,s,u);return o.b2Vec2.Dot(o.b2Vec2.Subtract(a,i,o.b2Vec2.s_t0),t)}case b.e_faceB:{const e=o.b2Rot.MultiplyVec2(r.q,this.m_axis,m),i=o.b2Transform.MultiplyVec2(r,this.m_localPoint,u),s=this.m_proxyA.GetVertex(t),a=o.b2Transform.MultiplyVec2(n,s,c);return o.b2Vec2.Dot(o.b2Vec2.Subtract(a,i,o.b2Vec2.s_t0),e)}default:return(0,s.b2Assert)(!1),0}}},A=[0],w=[0],S=new o.b2Sweep,C=new o.b2Sweep;e.b2TimeOfImpact=function(t,i){const o=y.Reset();++e.b2Toi.calls,t.state=_.e_unknown,t.t=i.tMax;const{proxyA:r,proxyB:c,tMax:u}=i,m=Math.max(n.b2_maxPolygonVertices,r.m_count,c.m_count),d=S.Copy(i.sweepA),p=C.Copy(i.sweepB);d.Normalize(),p.Normalize();const b=r.m_radius+c.m_radius,V=Math.max(s.b2_linearSlop,b-3*s.b2_linearSlop),B=.25*s.b2_linearSlop;let T=0,M=0;const I=f;I.count=0;const P=g;for(P.proxyA.Copy(i.proxyA),P.proxyB.Copy(i.proxyB),P.useRadii=!1;;){const i=d.GetTransform(h,T),s=p.GetTransform(l,T);P.transformA.Copy(i),P.transformB.Copy(s);const n=x;if((0,a.b2Distance)(n,I,P),n.distance<=0){t.state=_.e_overlapped,t.t=0;break}if(n.distance<V+B){t.state=_.e_touching,t.t=T;break}const o=v;o.Initialize(I,r,d,c,p,T);let b=!1,y=u,f=0;for(;;){const i=A,s=w;let n=o.FindMinSeparation(i,s,y);if(n>V+B){t.state=_.e_separated,t.t=u,b=!0;break}if(n>V-B){T=y;break}let r=o.Evaluate(i[0],s[0],T);if(r<V-B){t.state=_.e_failed,t.t=T,b=!0;break}if(r<=V+B){t.state=_.e_touching,t.t=T,b=!0;break}let a=0,h=T,l=y;for(;;){let t;t=1&a?h+(V-r)*(l-h)/(n-r):.5*(h+l),++a,++e.b2Toi.rootIters;const c=o.Evaluate(i[0],s[0],t);if(Math.abs(c-V)<B){y=t;break}if(c>V?(h=t,r=c):(l=t,n=c),50===a)break}if(e.b2Toi.maxRootIters=Math.max(e.b2Toi.maxRootIters,a),++f,f===m)break}if(++M,++e.b2Toi.iters,b)break;if(20===M){t.state=_.e_failed,t.t=T;break}}e.b2Toi.maxIters=Math.max(e.b2Toi.maxIters,M);const E=o.GetMilliseconds();e.b2Toi.maxTime=Math.max(e.b2Toi.maxTime,E),e.b2Toi.time+=E}},6121:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.b2_augment=void 0,e.b2_augment=function(t,e){for(const i of Object.keys(e)){const s=e[i],n=t[i],o=function(...t){return s.call(this,n.bind(this),...t)};Object.defineProperty(o,"name",{value:i}),t[i]=o}}},2962:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2MakeArray=e.b2MakeBooleanArray=e.b2MakeNumberArray=e.b2_version=e.b2_angularSleepTolerance=e.b2_linearSleepTolerance=e.b2_timeToSleep=e.b2_toiBaumgarte=e.b2_baumgarte=e.b2_maxRotationSquared=e.b2_maxRotation=e.b2_maxTranslationSquared=e.b2_maxTranslation=e.b2_maxAngularCorrection=e.b2_maxLinearCorrection=e.b2_maxTOIContacts=e.b2_maxSubSteps=e.b2_polygonRadius=e.b2_angularSlop=e.b2_linearSlop=e.b2_aabbMultiplier=e.b2_aabbExtension=e.b2_maxManifoldPoints=e.b2_epsilon_sq=e.b2_epsilon=e.b2_maxFloat=e.b2Verify=e.b2Assert=void 0;const s=i(2952);e.b2Assert=function(t,e){if(!t)throw new Error(e)},e.b2Verify=function(t){if(null===t)throw new Error;return t},e.b2_maxFloat=1e37,e.b2_epsilon=1e-5,e.b2_epsilon_sq=e.b2_epsilon*e.b2_epsilon,e.b2_maxManifoldPoints=2,e.b2_aabbExtension=.1*s.b2_lengthUnitsPerMeter,e.b2_aabbMultiplier=4,e.b2_linearSlop=.005*s.b2_lengthUnitsPerMeter,e.b2_angularSlop=2/180*Math.PI,e.b2_polygonRadius=2*e.b2_linearSlop,e.b2_maxSubSteps=8,e.b2_maxTOIContacts=32,e.b2_maxLinearCorrection=.2*s.b2_lengthUnitsPerMeter,e.b2_maxAngularCorrection=8/180*Math.PI,e.b2_maxTranslation=2*s.b2_lengthUnitsPerMeter,e.b2_maxTranslationSquared=e.b2_maxTranslation*e.b2_maxTranslation,e.b2_maxRotation=.5*Math.PI,e.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation,e.b2_baumgarte=.2,e.b2_toiBaumgarte=.75,e.b2_timeToSleep=.5,e.b2_linearSleepTolerance=.01*s.b2_lengthUnitsPerMeter,e.b2_angularSleepTolerance=2/180*Math.PI,e.b2_version={major:2,minor:4,patch:0},e.b2MakeNumberArray=function(t,e=0){const i=new Array(t);for(let s=0;s<t;s++)i[s]=e;return i},e.b2MakeBooleanArray=function(t,e=!1){const i=new Array(t);for(let s=0;s<t;s++)i[s]=e;return i},e.b2MakeArray=function(t,e){const i=new Array(t);for(let s=0;s<t;s++)i[s]=new e;return i}},8991:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.debugColors=e.b2Color=void 0;class i{constructor(t=.5,e=.5,i=.5,s=1){this.r=t,this.g=e,this.b=i,this.a=s}Clone(){return new i(this.r,this.g,this.b,this.a)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,s){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=s/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}Add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Subtract(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Scale(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mix(t,e){i.MixColors(this,t,e)}static Add(t,e,i){return i.r=t.r+e.r,i.g=t.g+e.g,i.b=t.b+e.b,i.a=t.a+e.a,i}static Subtract(t,e,i){return i.r=t.r-e.r,i.g=t.g-e.g,i.b=t.b-e.b,i.a=t.a-e.a,i}static Scale(t,e,i){return i.r=t.r*e,i.g=t.g*e,i.b=t.b*e,i.a=t.a*e,i}static MixColors(t,e,i){const s=i*(e.r-t.r),n=i*(e.g-t.g),o=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=n,t.b+=o,t.a+=r,e.r-=s,e.g-=n,e.b-=o,e.a-=r}}e.b2Color=i,i.ZERO=new i(0,0,0,0),i.RED=new i(1,0,0),i.GREEN=new i(0,1,0),i.BLUE=new i(0,0,1),i.WHITE=new i(1,1,1),i.BLACK=new i(0,0,0),e.debugColors={badBody:new i(1,0,0),disabledBody:new i(.5,.5,.3),staticBody:new i(.5,.9,.5),kinematicBody:new i(.5,.5,.9),sleepingBody:new i(.6,.6,.6),body:new i(.9,.7,.7),pair:new i(.3,.9,.9),aabb:new i(.9,.3,.9),joint1:new i(.7,.7,.7),joint2:new i(.3,.9,.3),joint3:new i(.9,.3,.3),joint4:new i(.3,.3,.9),joint5:new i(.4,.4,.4),joint6:new i(.5,.8,.8),joint7:new i(0,1,0),joint8:new i(.8,.8,.8),rope:new i(.4,.5,.7),ropePointG:new i(.1,.8,.1),ropePointD:new i(.7,.2,.4)}},8755:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.DrawCenterOfMasses=e.DrawAABBs=e.DrawPairs=e.DrawJoints=e.DrawShapes=e.GetShapeColor=void 0;const s=i(6826),n=i(8991),o=i(3910),r=i(2962),a={cA:new s.b2Vec2,cB:new s.b2Vec2,vs:(0,r.b2MakeArray)(4,s.b2Vec2),xf:new s.b2Transform};function h(t){return t.GetType()===o.b2BodyType.b2_dynamicBody&&0===t.m_mass?n.debugColors.badBody:t.IsEnabled()?t.GetType()===o.b2BodyType.b2_staticBody?n.debugColors.staticBody:t.GetType()===o.b2BodyType.b2_kinematicBody?n.debugColors.kinematicBody:t.IsAwake()?n.debugColors.body:n.debugColors.sleepingBody:n.debugColors.disabledBody}function l(t,e){for(let i=0;i<t.m_proxyCount;i++)if(e.TestOverlap(t.GetAABB(i)))return!0;return!1}e.GetShapeColor=h,e.DrawShapes=function(t,e,i){for(let s=e.GetBodyList();s;s=s.m_next){const e=s.m_xf;t.PushTransform(e);for(let e=s.GetFixtureList();e;e=e.m_next)i&&!l(e,i)||e.GetShape().Draw(t,h(s));t.PopTransform(e)}},e.DrawJoints=function(t,e){for(let i=e.GetJointList();i;i=i.m_next)i.Draw(t)},e.DrawPairs=function(t,e){for(let i=e.GetContactList();i;i=i.m_next){const e=i.GetFixtureA(),s=i.GetFixtureB(),o=i.GetChildIndexA(),r=i.GetChildIndexB(),h=e.GetAABB(o).GetCenter(a.cA),l=s.GetAABB(r).GetCenter(a.cB);t.DrawSegment(h,l,n.debugColors.pair)}},e.DrawAABBs=function(t,e,i){const{vs:s}=a;for(let o=e.GetBodyList();o;o=o.m_next)if(o.IsEnabled())for(let e=o.GetFixtureList();e;e=e.m_next)for(let o=0;o<e.m_proxyCount;++o){const{aabb:r}=e.m_proxies[o].treeNode;i&&!i.TestOverlap(r)||(s[0].Set(r.lowerBound.x,r.lowerBound.y),s[1].Set(r.upperBound.x,r.lowerBound.y),s[2].Set(r.upperBound.x,r.upperBound.y),s[3].Set(r.lowerBound.x,r.upperBound.y),t.DrawPolygon(s,4,n.debugColors.aabb))}},e.DrawCenterOfMasses=function(t,e){const{xf:i}=a;for(let s=e.GetBodyList();s;s=s.m_next)i.q.Copy(s.m_xf.q),i.p.Copy(s.GetWorldCenter()),t.DrawTransform(i)}},6826:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Sweep=e.b2Transform=e.b2Rot=e.b2Mat33=e.b2Mat22=e.b2Vec3=e.b2Vec2=e.b2RandomInt=e.b2RandomFloat=e.b2Random=e.b2IsPowerOfTwo=e.b2NextPowerOfTwo=e.b2RadToDeg=e.b2DegToRad=e.b2Clamp=e.b2_two_pi=e.b2_180_over_pi=e.b2_pi_over_180=void 0;const s=i(2962);function n(t,e,i){return t<e?e:t>i?i:t}e.b2_pi_over_180=Math.PI/180,e.b2_180_over_pi=180/Math.PI,e.b2_two_pi=2*Math.PI,e.b2Clamp=n,e.b2DegToRad=function(t){return t*e.b2_pi_over_180},e.b2RadToDeg=function(t){return t*e.b2_180_over_pi},e.b2NextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},e.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},e.b2Random=function(){return 2*Math.random()-1},e.b2RandomFloat=function(t,e){return(e-t)*Math.random()+t},e.b2RandomInt=function(t,e){return Math.round((e-t)*Math.random()+t)};class o{constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new o(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}Add(t){return this.x+=t.x,this.y+=t.y,this}AddXY(t,e){return this.x+=t,this.y+=e,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this}SubtractXY(t,e){return this.x-=t,this.y-=e,this}Scale(t){return this.x*=t,this.y*=t,this}AddScaled(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SubtractScaled(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const{x:t,y:e}=this;return Math.sqrt(t*t+e*e)}LengthSquared(){const{x:t,y:e}=this;return t*t+e*e}Normalize(){const t=this.Length();if(t<s.b2_epsilon)return 0;const e=1/t;return this.x*=e,this.y*=e,t}Rotate(t){const e=Math.cos(t),i=Math.sin(t),{x:s}=this;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}RotateCosSin(t,e){const{x:i}=this;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}IsValid(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}Abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}GetAbs(t){return t.x=Math.abs(this.x),t.y=Math.abs(this.y),t}Negate(){return this.x=-this.x,this.y=-this.y,this}Skew(){const{x:t}=this;return this.x=-this.y,this.y=t,this}static Min(t,e,i){return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i}static Max(t,e,i){return i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i}static Clamp(t,e,i,s){return s.x=n(t.x,e.x,i.x),s.y=n(t.y,e.y,i.y),s}static Rotate(t,e,i){const s=t.x,n=t.y,o=Math.cos(e),r=Math.sin(e);return i.x=o*s-r*n,i.y=r*s+o*n,i}static Dot(t,e){return t.x*e.x+t.y*e.y}static Cross(t,e){return t.x*e.y-t.y*e.x}static CrossVec2Scalar(t,e,i){const s=t.x;return i.x=e*t.y,i.y=-e*s,i}static CrossVec2One(t,e){const i=t.x;return e.x=t.y,e.y=-i,e}static CrossScalarVec2(t,e,i){const s=e.x;return i.x=-t*e.y,i.y=t*s,i}static CrossOneVec2(t,e){const i=t.x;return e.x=-t.y,e.y=i,e}static Add(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}static Subtract(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}static Scale(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}static AddScaled(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}static SubtractScaled(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}static AddCrossScalarVec2(t,e,i,s){const n=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*n,s}static Mid(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}static Extents(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}static Equals(t,e){return t.x===e.x&&t.y===e.y}static Distance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}static DistanceSquared(t,e){return(t.x-e.x)**2+(t.y-e.y)**2}static Negate(t,e){return e.x=-t.x,e.y=-t.y,e}static Normalize(t,e){const i=t.x**2+t.y**2;if(i>=s.b2_epsilon_sq){const s=1/Math.sqrt(i);e.x=s*t.x,e.y=s*t.y}else e.x=0,e.y=0;return e}static Skew(t,e){const{x:i}=t;return e.x=-t.y,e.y=i,e}}e.b2Vec2=o,o.ZERO=new o,o.UNITX=new o(1,0),o.UNITY=new o(0,1),o.s_t0=new o,o.s_t1=new o,o.s_t2=new o,o.s_t3=new o;class r{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}Clone(){return new r(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}Set(t,e,i){return this.x=t,this.y=e,this.z=i,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}Negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}Add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}AddXYZ(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}Subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SubtractXYZ(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}Scale(t){return this.x*=t,this.y*=t,this.z*=t,this}static Dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static Cross(t,e,i){const s=t.x,n=t.y,o=t.z,r=e.x,a=e.y,h=e.z;return i.x=n*h-o*a,i.y=o*r-s*h,i.z=s*a-n*r,i}}e.b2Vec3=r,r.ZERO=new r(0,0,0),r.s_t0=new r;class a{constructor(){this.ex=new o(1,0),this.ey=new o(0,1)}Clone(){return(new a).Copy(this)}static FromColumns(t,e){return(new a).SetColumns(t,e)}static FromScalars(t,e,i,s){return(new a).SetScalars(t,e,i,s)}static FromAngle(t){return(new a).SetAngle(t)}SetScalars(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}SetColumns(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){const e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}Solve(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}Abs(){return this.ex.Abs(),this.ey.Abs(),this}Inverse(){return this.GetInverse(this),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this}Subtract(t){return this.ex.Subtract(t.ex),this.ey.Subtract(t.ey),this}GetInverse(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;return 0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.y=-o*s,t.ey.y=o*e,t}GetAbs(t){return t.ex.x=Math.abs(this.ex.x),t.ex.y=Math.abs(this.ex.y),t.ey.x=Math.abs(this.ey.x),t.ey.y=Math.abs(this.ey.y),t}static MultiplyVec2(t,e,i){const s=e.x,n=e.y;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}static TransposeMultiplyVec2(t,e,i){const s=e.x,n=e.y;return i.x=t.ex.x*s+t.ex.y*n,i.y=t.ey.x*s+t.ey.y*n,i}static Add(t,e,i){return i.ex.x=t.ex.x+e.ex.x,i.ex.y=t.ex.y+e.ex.y,i.ey.x=t.ey.x+e.ey.x,i.ey.y=t.ey.y+e.ey.y,i}static Multiply(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,h=e.ex.y,l=e.ey.x,c=e.ey.y;return i.ex.x=s*a+o*h,i.ex.y=n*a+r*h,i.ey.x=s*l+o*c,i.ey.y=n*l+r*c,i}static TransposeMultiply(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,h=e.ex.y,l=e.ey.x,c=e.ey.y;return i.ex.x=s*a+n*h,i.ex.y=o*a+r*h,i.ey.x=s*l+n*c,i.ey.y=o*l+r*c,i}}e.b2Mat22=a,a.IDENTITY=new a;class h{constructor(){this.ex=new r(1,0,0),this.ey=new r(0,1,0),this.ez=new r(0,0,1)}Clone(){return(new h).Copy(this)}SetColumns(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.Set(1,0,0),this.ey.Set(0,1,0),this.ez.Set(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}Add(t){return this.ex.Add(t.ex),this.ey.Add(t.ey),this.ez.Add(t.ez),this}Solve33(t,e,i,s){const n=this.ex.x,o=this.ex.y,r=this.ex.z,a=this.ey.x,h=this.ey.y,l=this.ey.z,c=this.ez.x,u=this.ez.y,m=this.ez.z;let d=n*(h*m-l*u)+o*(l*c-a*m)+r*(a*u-h*c);return 0!==d&&(d=1/d),s.x=d*(t*(h*m-l*u)+e*(l*c-a*m)+i*(a*u-h*c)),s.y=d*(n*(e*m-i*u)+o*(i*c-t*m)+r*(t*u-e*c)),s.z=d*(n*(h*i-l*e)+o*(l*t-a*i)+r*(a*e-h*t)),s}Solve22(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}GetInverse22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*s,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=r.Dot(this.ex,r.Cross(this.ey,this.ez,r.s_t0));0!==e&&(e=1/e);const i=this.ex.x,s=this.ey.x,n=this.ez.x,o=this.ey.y,a=this.ez.y,h=this.ez.z;t.ex.x=e*(o*h-a*a),t.ex.y=e*(n*a-s*h),t.ex.z=e*(s*a-n*o),t.ey.x=t.ex.y,t.ey.y=e*(i*h-n*n),t.ey.z=e*(n*s-i*a),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-s*s)}static MultiplyVec3(t,e,i){const{x:s,y:n,z:o}=e;return i.x=t.ex.x*s+t.ey.x*n+t.ez.x*o,i.y=t.ex.y*s+t.ey.y*n+t.ez.y*o,i.z=t.ex.z*s+t.ey.z*n+t.ez.z*o,i}static MultiplyVec2(t,e,i){const{x:s,y:n}=e;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}}e.b2Mat33=h,h.IDENTITY=new h;class l{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Clone(){return(new l).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}Set(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static Multiply(t,e,i){const s=t.s*e.c+t.c*e.s,n=t.c*e.c-t.s*e.s;return i.s=s,i.c=n,i}static TransposeMultiply(t,e,i){const s=t.c*e.s-t.s*e.c,n=t.c*e.c+t.s*e.s;return i.s=s,i.c=n,i}static MultiplyVec2(t,e,i){const s=e.x,n=e.y;return i.x=t.c*s-t.s*n,i.y=t.s*s+t.c*n,i}static TransposeMultiplyVec2(t,e,i){const s=e.x,n=e.y;return i.x=t.c*s+t.s*n,i.y=-t.s*s+t.c*n,i}}e.b2Rot=l,l.IDENTITY=new l;class c{constructor(){this.p=new o,this.q=new l}Clone(){return(new c).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.Set(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.Set(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetAngle(){return this.q.GetAngle()}static MultiplyVec2(t,e,i){const s=e.x,n=e.y;return i.x=t.q.c*s-t.q.s*n+t.p.x,i.y=t.q.s*s+t.q.c*n+t.p.y,i}static TransposeMultiplyVec2(t,e,i){const s=e.x-t.p.x,n=e.y-t.p.y;return i.x=t.q.c*s+t.q.s*n,i.y=-t.q.s*s+t.q.c*n,i}static Multiply(t,e,i){return l.Multiply(t.q,e.q,i.q),l.MultiplyVec2(t.q,e.p,i.p).Add(t.p),i}static TransposeMultiply(t,e,i){return l.TransposeMultiply(t.q,e.q,i.q),l.TransposeMultiplyVec2(t.q,o.Subtract(e.p,t.p,i.p),i.p),i}}e.b2Transform=c,c.IDENTITY=new c;class u{constructor(){this.localCenter=new o,this.c0=new o,this.c=new o,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new u).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){const i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;const s=i*this.a0+e*this.a;return t.q.Set(s),t.p.Subtract(l.MultiplyVec2(t.q,this.localCenter,o.s_t0)),t}Advance(t){const e=(t-this.alpha0)/(1-this.alpha0);this.c0.x+=e*(this.c.x-this.c0.x),this.c0.y+=e*(this.c.y-this.c0.y),this.a0+=e*(this.a-this.a0),this.alpha0=t}Normalize(){const t=e.b2_two_pi*Math.floor(this.a0/e.b2_two_pi);this.a0-=t,this.a-=t}}e.b2Sweep=u},2952:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.b2_maxPolygonVertices=e.b2_lengthUnitsPerMeter=void 0,e.b2_lengthUnitsPerMeter=1,e.b2_maxPolygonVertices=8},2026:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Timer=void 0,e.b2Timer=class{constructor(){this.m_start=performance.now()}Reset(){return this.m_start=performance.now(),this}GetMilliseconds(){return performance.now()-this.m_start}}},4143:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2AreaJoint=e.b2AreaJointDef=void 0;const s=i(2962),n=i(6826),o=i(5773),r=i(5354);class a extends o.b2JointDef{constructor(){super(o.b2JointType.e_areaJoint),this.bodies=[],this.stiffness=0,this.damping=0}AddBody(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}e.b2AreaJointDef=a;class h extends o.b2Joint{constructor(t){var e,i;super(t),this.m_stiffness=0,this.m_damping=0,this.m_impulse=0,this.m_targetArea=0,this.m_joints=[],this.m_delta=new n.b2Vec2,this.m_bodies=t.bodies,this.m_stiffness=null!==(e=t.stiffness)&&void 0!==e?e:0,this.m_damping=null!==(i=t.damping)&&void 0!==i?i:0,this.m_targetLengths=(0,s.b2MakeNumberArray)(t.bodies.length),this.m_normals=(0,s.b2MakeArray)(t.bodies.length,n.b2Vec2),this.m_deltas=(0,s.b2MakeArray)(t.bodies.length,n.b2Vec2);const o=new r.b2DistanceJointDef;o.stiffness=this.m_stiffness,o.damping=this.m_damping,this.m_targetArea=0;for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t],i=this.m_bodies[(t+1)%this.m_bodies.length],s=e.GetWorldCenter(),r=i.GetWorldCenter();this.m_targetLengths[t]=n.b2Vec2.Distance(s,r),this.m_targetArea+=n.b2Vec2.Cross(s,r),o.Initialize(e,i,s,r),this.m_joints[t]=e.GetWorld().CreateJoint(o)}this.m_targetArea*=.5}GetAnchorA(t){return t}GetAnchorB(t){return t}GetReactionForce(t,e){return e}GetReactionTorque(t){return 0}SetStiffness(t){this.m_stiffness=t;for(const e of this.m_joints)e.SetStiffness(t)}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t;for(const e of this.m_joints)e.SetDamping(t)}GetDamping(){return this.m_damping}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(e+1)%this.m_bodies.length],o=t.positions[i.m_islandIndex].c,r=t.positions[s.m_islandIndex].c,a=this.m_deltas[e];n.b2Vec2.Subtract(r,o,a)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],s=t.velocities[i.m_islandIndex].v,n=this.m_deltas[e];s.x+=i.m_invMass*n.y*.5*this.m_impulse,s.y+=i.m_invMass*-n.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,i=0;for(let s=0;s<this.m_bodies.length;++s){const o=this.m_bodies[s],r=t.velocities[o.m_islandIndex].v,a=this.m_deltas[s];e+=a.LengthSquared()/o.GetMass(),i+=n.b2Vec2.Cross(r,a)}const s=-2*i/e;this.m_impulse+=s;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],n=t.velocities[i.m_islandIndex].v,o=this.m_deltas[e];n.x+=i.m_invMass*o.y*.5*s,n.y+=i.m_invMass*-o.x*.5*s}}SolvePositionConstraints(t){let e=0,i=0;for(let o=0;o<this.m_bodies.length;++o){const r=this.m_bodies[o],a=this.m_bodies[(o+1)%this.m_bodies.length],h=t.positions[r.m_islandIndex].c,l=t.positions[a.m_islandIndex].c,c=n.b2Vec2.Subtract(l,h,this.m_delta);let u=c.Length();u<s.b2_epsilon&&(u=1),this.m_normals[o].x=c.y/u,this.m_normals[o].y=-c.x/u,e+=u,i+=n.b2Vec2.Cross(h,l)}i*=.5;const o=.5*(this.m_targetArea-i)/e;let r=!0;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],a=t.positions[i.m_islandIndex].c,h=(e+1)%this.m_bodies.length,l=n.b2Vec2.Add(this.m_normals[e],this.m_normals[h],this.m_delta);l.Scale(o);const c=l.LengthSquared();c>s.b2_maxLinearCorrection**2&&l.Scale(s.b2_maxLinearCorrection/Math.sqrt(c)),c>s.b2_linearSlop**2&&(r=!1),a.Add(l)}return r}}e.b2AreaJoint=h},3910:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Body=e.b2BodyType=void 0;const s=i(6826),n=i(6955),o=i(8913),r=i(2962);var a;!function(t){t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"}(a=e.b2BodyType||(e.b2BodyType={}));class h{constructor(t,e){var i,n,o,r,h,l,c,u,m,d,p,_,b,y;this.m_type=a.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_enabledFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new s.b2Transform,this.m_sweep=new s.b2Sweep,this.m_linearVelocity=new s.b2Vec2,this.m_angularVelocity=0,this.m_force=new s.b2Vec2,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_bulletFlag=null!==(i=t.bullet)&&void 0!==i&&i,this.m_fixedRotationFlag=null!==(n=t.fixedRotation)&&void 0!==n&&n,this.m_autoSleepFlag=null===(o=t.allowSleep)||void 0===o||o,null!==(r=t.awake)&&void 0!==r&&!r||(null!==(h=t.type)&&void 0!==h?h:a.b2_staticBody)===a.b2_staticBody||(this.m_awakeFlag=!0),this.m_enabledFlag=null===(l=t.enabled)||void 0===l||l,this.m_world=e,this.m_xf.p.Copy(null!==(c=t.position)&&void 0!==c?c:s.b2Vec2.ZERO),this.m_xf.q.Set(null!==(u=t.angle)&&void 0!==u?u:0),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(null!==(m=t.linearVelocity)&&void 0!==m?m:s.b2Vec2.ZERO),this.m_angularVelocity=null!==(d=t.angularVelocity)&&void 0!==d?d:0,this.m_linearDamping=null!==(p=t.linearDamping)&&void 0!==p?p:0,this.m_angularDamping=null!==(_=t.angularDamping)&&void 0!==_?_:0,this.m_gravityScale=null!==(b=t.gravityScale)&&void 0!==b?b:1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=null!==(y=t.type)&&void 0!==y?y:a.b2_staticBody,this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0}CreateFixture(t){(0,r.b2Assert)(!this.m_world.IsLocked());const e=new o.b2Fixture(this,t);if(this.m_enabledFlag){const t=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(t,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newContacts=!0,e}DestroyFixture(t){(0,r.b2Assert)(!this.m_world.IsLocked());let e=this.m_fixtureList,i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}let s=this.m_contactList;for(;s;){const e=s.contact;s=s.next;const i=e.GetFixtureA(),n=e.GetFixtureB();t!==i&&t!==n||this.m_world.m_contactManager.Destroy(e)}if(this.m_enabledFlag){const e=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(e)}t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,i){(0,r.b2Assert)(!this.m_world.IsLocked()),this.m_xf.q.Set(i),this.m_xf.p.Set(t,e),s.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;const n=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_newContacts=!0}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==a.b2_staticBody&&(s.b2Vec2.Dot(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==a.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}ApplyForce(t,e,i=!0){this.m_type===a.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===a.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===a.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,i=!0){this.m_type===a.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===a.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===a.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*s.b2Vec2.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*s.b2Vec2.Dot(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(t){if((0,r.b2Assert)(!this.m_world.IsLocked()),this.m_type!==a.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*s.b2Vec2.Dot(t.center,t.center),this.m_invI=1/this.m_I);const e=h.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),s.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),s.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,s.b2Vec2.Subtract(this.m_sweep.c,e,s.b2Vec2.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===a.b2_staticBody||this.m_type===a.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const t=h.ResetMassData_s_localCenter.SetZero();for(let e=this.m_fixtureList;e;e=e.m_next){if(0===e.m_density)continue;const i=e.GetMassData(h.ResetMassData_s_massData);this.m_mass+=i.mass,t.AddScaled(i.mass,i.center),this.m_I+=i.I}this.m_mass>0&&(this.m_invMass=1/this.m_mass,t.Scale(this.m_invMass)),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*s.b2Vec2.Dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=h.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),s.b2Transform.MultiplyVec2(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),s.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,s.b2Vec2.Subtract(this.m_sweep.c,e,s.b2Vec2.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return s.b2Transform.MultiplyVec2(this.m_xf,t,e)}GetWorldVector(t,e){return s.b2Rot.MultiplyVec2(this.m_xf.q,t,e)}GetLocalPoint(t,e){return s.b2Transform.TransposeMultiplyVec2(this.m_xf,t,e)}GetLocalVector(t,e){return s.b2Rot.TransposeMultiplyVec2(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return s.b2Vec2.AddCrossScalarVec2(this.m_linearVelocity,this.m_angularVelocity,s.b2Vec2.Subtract(t,this.m_sweep.c,s.b2Vec2.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if((0,r.b2Assert)(!this.m_world.IsLocked()),this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===a.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_awakeFlag=!1,this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;const i=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)for(const e of t.m_proxies)i.TouchProxy(e.treeNode)}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){this.m_type!==a.b2_staticBody&&(t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0))}IsAwake(){return this.m_awakeFlag}SetEnabled(t){if((0,r.b2Assert)(!this.m_world.IsLocked()),t===this.IsEnabled())return;this.m_enabledFlag=t;const e=this.m_world.m_contactManager.m_broadPhase;if(t){for(let t=this.m_fixtureList;t;t=t.m_next)t.CreateProxies(e,this.m_xf);this.m_world.m_newContacts=!0}else{for(let t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxies(e);let t=this.m_contactList;for(;t;){const e=t;t=t.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}IsEnabled(){return this.m_enabledFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}SynchronizeFixtures(){const t=this.m_world.m_contactManager.m_broadPhase;if(this.m_awakeFlag){const e=h.SynchronizeFixtures_s_xf1;e.q.Set(this.m_sweep.a0),s.b2Rot.MultiplyVec2(e.q,this.m_sweep.localCenter,e.p),s.b2Vec2.Subtract(this.m_sweep.c0,e.p,e.p);for(let i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(t,e,this.m_xf)}else for(let e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,this.m_xf,this.m_xf)}SynchronizeTransform(){this.m_xf.q.Set(this.m_sweep.a),s.b2Rot.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),s.b2Vec2.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return(this.m_type===a.b2_dynamicBody||t.m_type===a.b2_dynamicBody)&&this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),s.b2Rot.MultiplyVec2(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),s.b2Vec2.Subtract(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}}e.b2Body=h,h.SetMassData_s_oldCenter=new s.b2Vec2,h.ResetMassData_s_localCenter=new s.b2Vec2,h.ResetMassData_s_oldCenter=new s.b2Vec2,h.ResetMassData_s_massData=new n.b2MassData,h.SynchronizeFixtures_s_xf1=new s.b2Transform},7381:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ChainAndCircleContact=void 0;const s=i(5814),n=i(7568),o=i(6760);class r extends o.b2Contact{Evaluate(t,e,i){const n=r.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),(0,s.b2CollideEdgeAndCircle)(t,n,e,this.GetShapeB(),i)}}e.b2ChainAndCircleContact=r,r.Evaluate_s_edge=new n.b2EdgeShape},7562:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ChainAndPolygonContact=void 0;const s=i(5814),n=i(7568),o=i(6760);class r extends o.b2Contact{Evaluate(t,e,i){const n=r.Evaluate_s_edge;this.GetShapeA().GetChildEdge(n,this.m_indexA),(0,s.b2CollideEdgeAndPolygon)(t,n,e,this.GetShapeB(),i)}}e.b2ChainAndPolygonContact=r,r.Evaluate_s_edge=new n.b2EdgeShape},6031:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2CircleContact=void 0;const s=i(8503),n=i(6760);class o extends n.b2Contact{Evaluate(t,e,i){(0,s.b2CollideCircles)(t,this.GetShapeA(),e,this.GetShapeB(),i)}}e.b2CircleContact=o},6760:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Contact=e.b2ContactEdge=e.b2MixRestitutionThreshold=e.b2MixRestitution=e.b2MixFriction=void 0;const s=i(2962),n=i(2472);function o(t,e){return Math.sqrt(t*e)}function r(t,e){return t>e?t:e}function a(t,e){return t<e?t:e}e.b2MixFriction=o,e.b2MixRestitution=r,e.b2MixRestitutionThreshold=a;class h{constructor(t){this.m_other=null,this.prev=null,this.next=null,this.contact=t}get other(){return(0,s.b2Assert)(null!==this.m_other),this.m_other}set other(t){(0,s.b2Assert)(null===this.m_other),this.m_other=t}Reset(){this.m_other=null,this.prev=null,this.next=null}}e.b2ContactEdge=h,e.b2Contact=class{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new h(this),this.m_nodeB=new h(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new n.b2Manifold,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_tangentSpeed=0,this.m_oldManifold=new n.b2Manifold}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.GetShapeA(),n=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),n.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetShapeA(){return this.m_fixtureA.GetShape()}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}GetShapeB(){return this.m_fixtureB.GetShape()}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=o(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=r(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetRestitutionThreshold(){return this.m_restitutionThreshold}ResetRestitutionThreshold(){this.m_restitutionThreshold=a(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=o(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=r(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_restitutionThreshold=a(this.m_fixtureA.m_restitutionThreshold,this.m_fixtureB.m_restitutionThreshold)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let i=!1;const s=this.m_touchingFlag,o=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),a=o||r,h=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),c=h.GetTransform(),u=l.GetTransform();if(a){const t=this.GetShapeA(),e=this.GetShapeB();i=(0,n.b2TestOverlap)(t,this.m_indexA,e,this.m_indexB,c,u),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,c,u),i=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;const i=e.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const s=this.m_oldManifold.points[t];if(s.id.key===i.key){e.normalImpulse=s.normalImpulse,e.tangentImpulse=s.tangentImpulse;break}}}i!==s&&(h.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.BeginContact(this),s&&!i&&t&&t.EndContact(this),!a&&i&&t&&t.PreSolve(this,this.m_oldManifold)}}},1866:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ContactFactory=void 0;const s=i(6955),n=i(6031),o=i(4879),r=i(6067),a=i(5141),h=i(5345),l=i(7381),c=i(7562);e.b2ContactFactory=class{constructor(){const t=new Array(s.b2ShapeType.e_typeCount);for(let e=0;e<s.b2ShapeType.e_typeCount;e++)t[e]=new Array(s.b2ShapeType.e_typeCount);this.m_registers=t,this.AddType(n.b2CircleContact,s.b2ShapeType.e_circle,s.b2ShapeType.e_circle),this.AddType(r.b2PolygonAndCircleContact,s.b2ShapeType.e_polygon,s.b2ShapeType.e_circle),this.AddType(o.b2PolygonContact,s.b2ShapeType.e_polygon,s.b2ShapeType.e_polygon),this.AddType(a.b2EdgeAndCircleContact,s.b2ShapeType.e_edge,s.b2ShapeType.e_circle),this.AddType(h.b2EdgeAndPolygonContact,s.b2ShapeType.e_edge,s.b2ShapeType.e_polygon),this.AddType(l.b2ChainAndCircleContact,s.b2ShapeType.e_chain,s.b2ShapeType.e_circle),this.AddType(c.b2ChainAndPolygonContact,s.b2ShapeType.e_chain,s.b2ShapeType.e_polygon)}AddType(t,e,i){const s=[],n=t=>{s.push(t)};this.m_registers[e][i]={createFcn(e,i,n,o){var r;const a=null!==(r=s.pop())&&void 0!==r?r:new t;return a.Reset(e,i,n,o),a},destroyFcn:n},e!==i&&(this.m_registers[i][e]={createFcn(e,i,n,o){var r;const a=null!==(r=s.pop())&&void 0!==r?r:new t;return a.Reset(n,o,e,i),a},destroyFcn:n})}Create(t,e,i,s){const n=t.GetType(),o=i.GetType(),r=this.m_registers[n][o];return r?r.createFcn(t,e,i,s):null}Destroy(t){const e=t.m_fixtureA.GetType(),i=t.m_fixtureB.GetType(),s=this.m_registers[e][i];null==s||s.destroyFcn(t)}}},4361:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ContactManager=void 0;const s=i(7118),n=i(1866),o=i(3910),r=i(8287);e.b2ContactManager=class{constructor(){this.m_broadPhase=new s.b2BroadPhase,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=r.b2ContactFilter.b2_defaultFilter,this.m_contactListener=r.b2ContactListener.b2_defaultListener,this.m_contactFactory=new n.b2ContactFactory,this.AddPair=(t,e)=>{let i=t.fixture,s=e.fixture,n=t.childIndex,o=e.childIndex,r=i.GetBody(),a=s.GetBody();if(r===a)return;let h=a.GetContactList();for(;h;){if(h.other===r){const t=h.contact.GetFixtureA(),e=h.contact.GetFixtureB(),r=h.contact.GetChildIndexA(),a=h.contact.GetChildIndexB();if(t===i&&e===s&&r===n&&a===o)return;if(t===s&&e===i&&r===o&&a===n)return}h=h.next}if(!1===a.ShouldCollide(r))return;if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,s))return;const l=this.m_contactFactory.Create(i,n,s,o);null!==l&&(i=l.GetFixtureA(),s=l.GetFixtureB(),n=l.GetChildIndexA(),o=l.GetChildIndexB(),r=i.m_body,a=s.m_body,l.m_prev=null,l.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=l),this.m_contactList=l,l.m_nodeA.other=a,l.m_nodeA.prev=null,l.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=l.m_nodeA),r.m_contactList=l.m_nodeA,l.m_nodeB.other=r,l.m_nodeB.prev=null,l.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=l.m_nodeB),a.m_contactList=l.m_nodeB,++this.m_contactCount)}}FindNewContacts(){this.m_broadPhase.UpdatePairs(this.AddPair)}Destroy(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),n=t.GetChildIndexB(),r=e.GetBody(),a=i.GetBody();if(t.m_filterFlag){if(!a.ShouldCollide(r)||this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){const e=t;t=e.m_next,this.Destroy(e);continue}t.m_filterFlag=!1}const h=r.IsAwake()&&r.m_type!==o.b2BodyType.b2_staticBody,l=a.IsAwake()&&a.m_type!==o.b2BodyType.b2_staticBody;if(!h&&!l){t=t.m_next;continue}const c=e.m_proxies[s].treeNode,u=i.m_proxies[n].treeNode;if(c.aabb.TestOverlap(u.aabb))t.Update(this.m_contactListener),t=t.m_next;else{const e=t;t=e.m_next,this.Destroy(e)}}}}},8995:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ContactSolver=e.b2ContactSolverDef=e.b2ContactVelocityConstraint=e.b2GetBlockSolve=e.b2SetBlockSolve=void 0;const s=i(2962),n=i(6826),o=i(2472),r=i(6174);let a=!0;e.b2SetBlockSolve=function(t){a=t},e.b2GetBlockSolve=function(){return a};class h{constructor(){this.rA=new n.b2Vec2,this.rB=new n.b2Vec2,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}}class l{constructor(){this.points=(0,s.b2MakeArray)(s.b2_maxManifoldPoints,h),this.normal=new n.b2Vec2,this.tangent=new n.b2Vec2,this.normalMass=new n.b2Mat22,this.K=new n.b2Mat22,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.threshold=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}}e.b2ContactVelocityConstraint=l;class c{constructor(){this.localPoints=(0,s.b2MakeArray)(s.b2_maxManifoldPoints,n.b2Vec2),this.localNormal=new n.b2Vec2,this.localPoint=new n.b2Vec2,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new n.b2Vec2,this.localCenterB=new n.b2Vec2,this.invIA=0,this.invIB=0,this.type=o.b2ManifoldType.e_circles,this.radiusA=0,this.radiusB=0,this.pointCount=0}}e.b2ContactSolverDef=class{constructor(){this.step=r.b2TimeStep.Create(),this.count=0}};class u{constructor(){this.normal=new n.b2Vec2,this.point=new n.b2Vec2,this.separation=0}Initialize(t,e,i,s){const r=u.Initialize_s_pointA,a=u.Initialize_s_pointB,h=u.Initialize_s_planePoint,l=u.Initialize_s_clipPoint;switch(t.type){case o.b2ManifoldType.e_circles:n.b2Transform.MultiplyVec2(e,t.localPoint,r),n.b2Transform.MultiplyVec2(i,t.localPoints[0],a),n.b2Vec2.Subtract(a,r,this.normal).Normalize(),n.b2Vec2.Mid(r,a,this.point),this.separation=n.b2Vec2.Dot(n.b2Vec2.Subtract(a,r,n.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB;break;case o.b2ManifoldType.e_faceA:n.b2Rot.MultiplyVec2(e.q,t.localNormal,this.normal),n.b2Transform.MultiplyVec2(e,t.localPoint,h),n.b2Transform.MultiplyVec2(i,t.localPoints[s],l),this.separation=n.b2Vec2.Dot(n.b2Vec2.Subtract(l,h,n.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l);break;case o.b2ManifoldType.e_faceB:n.b2Rot.MultiplyVec2(i.q,t.localNormal,this.normal),n.b2Transform.MultiplyVec2(i,t.localPoint,h),n.b2Transform.MultiplyVec2(e,t.localPoints[s],l),this.separation=n.b2Vec2.Dot(n.b2Vec2.Subtract(l,h,n.b2Vec2.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l),this.normal.Negate()}}}u.Initialize_s_pointA=new n.b2Vec2,u.Initialize_s_pointB=new n.b2Vec2,u.Initialize_s_planePoint=new n.b2Vec2,u.Initialize_s_clipPoint=new n.b2Vec2;class m{constructor(){this.m_step=r.b2TimeStep.Create(),this.m_positionConstraints=(0,s.b2MakeArray)(1024,c),this.m_velocityConstraints=(0,s.b2MakeArray)(1024,l),this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=Math.max(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new c}if(this.m_velocityConstraints.length<this.m_count){const t=Math.max(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new l}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const e=this.m_contacts[t],i=e.m_fixtureA,s=e.m_fixtureB,n=i.GetShape(),o=s.GetShape(),r=n.m_radius,a=o.m_radius,h=i.GetBody(),l=s.GetBody(),c=e.GetManifold(),{pointCount:u}=c,m=this.m_velocityConstraints[t];m.friction=e.m_friction,m.restitution=e.m_restitution,m.threshold=e.m_restitutionThreshold,m.tangentSpeed=e.m_tangentSpeed,m.indexA=h.m_islandIndex,m.indexB=l.m_islandIndex,m.invMassA=h.m_invMass,m.invMassB=l.m_invMass,m.invIA=h.m_invI,m.invIB=l.m_invI,m.contactIndex=t,m.pointCount=u,m.K.SetZero(),m.normalMass.SetZero();const d=this.m_positionConstraints[t];d.indexA=h.m_islandIndex,d.indexB=l.m_islandIndex,d.invMassA=h.m_invMass,d.invMassB=l.m_invMass,d.localCenterA.Copy(h.m_sweep.localCenter),d.localCenterB.Copy(l.m_sweep.localCenter),d.invIA=h.m_invI,d.invIB=l.m_invI,d.localNormal.Copy(c.localNormal),d.localPoint.Copy(c.localPoint),d.pointCount=u,d.radiusA=r,d.radiusB=a,d.type=c.type;for(let t=0;t<u;++t){const e=c.points[t],i=m.points[t];this.m_step.warmStarting?(i.normalImpulse=this.m_step.dtRatio*e.normalImpulse,i.tangentImpulse=this.m_step.dtRatio*e.tangentImpulse):(i.normalImpulse=0,i.tangentImpulse=0),i.rA.SetZero(),i.rB.SetZero(),i.normalMass=0,i.tangentMass=0,i.velocityBias=0,d.localPoints[t].Copy(e.localPoint)}}return this}InitializeVelocityConstraints(){const t=m.InitializeVelocityConstraints_s_xfA,e=m.InitializeVelocityConstraints_s_xfB,i=m.InitializeVelocityConstraints_s_worldManifold;for(let s=0;s<this.m_count;++s){const o=this.m_velocityConstraints[s],r=this.m_positionConstraints[s],{radiusA:h,radiusB:l,localCenterA:c,localCenterB:u}=r,m=this.m_contacts[o.contactIndex].GetManifold(),{indexA:d,indexB:p,tangent:_,pointCount:b}=o,y=o.invMassA,f=o.invMassB,g=o.invIA,x=o.invIB,v=this.m_positions[d].c,A=this.m_positions[d].a,w=this.m_velocities[d].v,S=this.m_velocities[d].w,C=this.m_positions[p].c,V=this.m_positions[p].a,B=this.m_velocities[p].v,T=this.m_velocities[p].w;t.q.Set(A),e.q.Set(V),n.b2Vec2.Subtract(v,n.b2Rot.MultiplyVec2(t.q,c,n.b2Vec2.s_t0),t.p),n.b2Vec2.Subtract(C,n.b2Rot.MultiplyVec2(e.q,u,n.b2Vec2.s_t0),e.p),i.Initialize(m,t,h,e,l),o.normal.Copy(i.normal),n.b2Vec2.CrossVec2One(o.normal,_);for(let t=0;t<b;++t){const e=o.points[t];n.b2Vec2.Subtract(i.points[t],v,e.rA),n.b2Vec2.Subtract(i.points[t],C,e.rB);const s=n.b2Vec2.Cross(e.rA,o.normal),r=n.b2Vec2.Cross(e.rB,o.normal),a=y+f+g*s*s+x*r*r;e.normalMass=a>0?1/a:0;const h=n.b2Vec2.Cross(e.rA,_),l=n.b2Vec2.Cross(e.rB,_),c=y+f+g*h*h+x*l*l;e.tangentMass=c>0?1/c:0,e.velocityBias=0;const u=n.b2Vec2.Dot(o.normal,n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(B,T,e.rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(w,S,e.rA,n.b2Vec2.s_t1),n.b2Vec2.s_t0));u<-o.threshold&&(e.velocityBias=-o.restitution*u)}if(2===o.pointCount&&a){const t=o.points[0],e=o.points[1],i=n.b2Vec2.Cross(t.rA,o.normal),s=n.b2Vec2.Cross(t.rB,o.normal),r=n.b2Vec2.Cross(e.rA,o.normal),a=n.b2Vec2.Cross(e.rB,o.normal),h=y+f+g*i*i+x*s*s,l=y+f+g*r*r+x*a*a,c=y+f+g*i*r+x*s*a;h*h<1e3*(h*l-c*c)?(o.K.ex.Set(h,c),o.K.ey.Set(c,l),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}WarmStart(){const t=m.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],{indexA:s,indexB:o,pointCount:r,normal:a,tangent:h}=i,l=i.invMassA,c=i.invIA,u=i.invMassB,m=i.invIB,d=this.m_velocities[s].v;let p=this.m_velocities[s].w;const _=this.m_velocities[o].v;let b=this.m_velocities[o].w;for(let e=0;e<r;++e){const s=i.points[e];n.b2Vec2.Add(n.b2Vec2.Scale(s.normalImpulse,a,n.b2Vec2.s_t0),n.b2Vec2.Scale(s.tangentImpulse,h,n.b2Vec2.s_t1),t),p-=c*n.b2Vec2.Cross(s.rA,t),d.SubtractScaled(l,t),b+=m*n.b2Vec2.Cross(s.rB,t),_.AddScaled(u,t)}this.m_velocities[s].w=p,this.m_velocities[o].w=b}}SolveVelocityConstraints(){const t=m.SolveVelocityConstraints_s_dv,e=m.SolveVelocityConstraints_s_dv1,i=m.SolveVelocityConstraints_s_dv2,s=m.SolveVelocityConstraints_s_P,o=m.SolveVelocityConstraints_s_a,r=m.SolveVelocityConstraints_s_b,h=m.SolveVelocityConstraints_s_x,l=m.SolveVelocityConstraints_s_d,c=m.SolveVelocityConstraints_s_P1,u=m.SolveVelocityConstraints_s_P2,d=m.SolveVelocityConstraints_s_P1P2;for(let m=0;m<this.m_count;++m){const p=this.m_velocityConstraints[m],{indexA:_,indexB:b,pointCount:y,normal:f,tangent:g,friction:x}=p,v=p.invMassA,A=p.invIA,w=p.invMassB,S=p.invIB,C=this.m_velocities[_].v;let V=this.m_velocities[_].w;const B=this.m_velocities[b].v;let T=this.m_velocities[b].w;for(let e=0;e<y;++e){const i=p.points[e];n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(B,T,i.rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(C,V,i.rA,n.b2Vec2.s_t1),t);const o=n.b2Vec2.Dot(t,g)-p.tangentSpeed;let r=i.tangentMass*-o;const a=x*i.normalImpulse,h=(0,n.b2Clamp)(i.tangentImpulse+r,-a,a);r=h-i.tangentImpulse,i.tangentImpulse=h,n.b2Vec2.Scale(r,g,s),C.SubtractScaled(v,s),V-=A*n.b2Vec2.Cross(i.rA,s),B.AddScaled(w,s),T+=S*n.b2Vec2.Cross(i.rB,s)}if(1===p.pointCount||!1===a)for(let e=0;e<y;++e){const i=p.points[e];n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(B,T,i.rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(C,V,i.rA,n.b2Vec2.s_t1),t);const o=n.b2Vec2.Dot(t,f);let r=-i.normalMass*(o-i.velocityBias);const a=Math.max(i.normalImpulse+r,0);r=a-i.normalImpulse,i.normalImpulse=a,n.b2Vec2.Scale(r,f,s),C.SubtractScaled(v,s),V-=A*n.b2Vec2.Cross(i.rA,s),B.AddScaled(w,s),T+=S*n.b2Vec2.Cross(i.rB,s)}else{const t=p.points[0],s=p.points[1];o.Set(t.normalImpulse,s.normalImpulse),n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(B,T,t.rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(C,V,t.rA,n.b2Vec2.s_t1),e),n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(B,T,s.rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(C,V,s.rA,n.b2Vec2.s_t1),i);let a=n.b2Vec2.Dot(e,f),m=n.b2Vec2.Dot(i,f);for(r.x=a-t.velocityBias,r.y=m-s.velocityBias,r.Subtract(n.b2Mat22.MultiplyVec2(p.K,o,n.b2Vec2.s_t0));;){if(n.b2Mat22.MultiplyVec2(p.normalMass,r,h).Negate(),h.x>=0&&h.y>=0){n.b2Vec2.Subtract(h,o,l),n.b2Vec2.Scale(l.x,f,c),n.b2Vec2.Scale(l.y,f,u),n.b2Vec2.Add(c,u,d),C.SubtractScaled(v,d),V-=A*(n.b2Vec2.Cross(t.rA,c)+n.b2Vec2.Cross(s.rA,u)),B.AddScaled(w,d),T+=S*(n.b2Vec2.Cross(t.rB,c)+n.b2Vec2.Cross(s.rB,u)),t.normalImpulse=h.x,s.normalImpulse=h.y;break}if(h.x=-t.normalMass*r.x,h.y=0,a=0,m=p.K.ex.y*h.x+r.y,h.x>=0&&m>=0){n.b2Vec2.Subtract(h,o,l),n.b2Vec2.Scale(l.x,f,c),n.b2Vec2.Scale(l.y,f,u),n.b2Vec2.Add(c,u,d),C.SubtractScaled(v,d),V-=A*(n.b2Vec2.Cross(t.rA,c)+n.b2Vec2.Cross(s.rA,u)),B.AddScaled(w,d),T+=S*(n.b2Vec2.Cross(t.rB,c)+n.b2Vec2.Cross(s.rB,u)),t.normalImpulse=h.x,s.normalImpulse=h.y;break}if(h.x=0,h.y=-s.normalMass*r.y,a=p.K.ey.x*h.y+r.x,m=0,h.y>=0&&a>=0){n.b2Vec2.Subtract(h,o,l),n.b2Vec2.Scale(l.x,f,c),n.b2Vec2.Scale(l.y,f,u),n.b2Vec2.Add(c,u,d),C.SubtractScaled(v,d),V-=A*(n.b2Vec2.Cross(t.rA,c)+n.b2Vec2.Cross(s.rA,u)),B.AddScaled(w,d),T+=S*(n.b2Vec2.Cross(t.rB,c)+n.b2Vec2.Cross(s.rB,u)),t.normalImpulse=h.x,s.normalImpulse=h.y;break}if(h.x=0,h.y=0,a=r.x,m=r.y,a>=0&&m>=0){n.b2Vec2.Subtract(h,o,l),n.b2Vec2.Scale(l.x,f,c),n.b2Vec2.Scale(l.y,f,u),n.b2Vec2.Add(c,u,d),C.SubtractScaled(v,d),V-=A*(n.b2Vec2.Cross(t.rA,c)+n.b2Vec2.Cross(s.rA,u)),B.AddScaled(w,d),T+=S*(n.b2Vec2.Cross(t.rB,c)+n.b2Vec2.Cross(s.rB,u)),t.normalImpulse=h.x,s.normalImpulse=h.y;break}break}}this.m_velocities[_].w=V,this.m_velocities[b].w=T}}StoreImpulses(){for(let t=0;t<this.m_count;++t){const e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold();for(let t=0;t<e.pointCount;++t)i.points[t].normalImpulse=e.points[t].normalImpulse,i.points[t].tangentImpulse=e.points[t].tangentImpulse}}SolvePositionConstraints(){const t=m.SolvePositionConstraints_s_xfA,e=m.SolvePositionConstraints_s_xfB,i=m.SolvePositionConstraints_s_psm,o=m.SolvePositionConstraints_s_rA,r=m.SolvePositionConstraints_s_rB,a=m.SolvePositionConstraints_s_P;let h=0;for(let l=0;l<this.m_count;++l){const c=this.m_positionConstraints[l],{indexA:u,indexB:m,localCenterA:d,localCenterB:p,pointCount:_}=c,b=c.invMassA,y=c.invIA,f=c.invMassB,g=c.invIB,x=this.m_positions[u].c;let v=this.m_positions[u].a;const A=this.m_positions[m].c;let w=this.m_positions[m].a;for(let l=0;l<_;++l){t.q.Set(v),e.q.Set(w),n.b2Vec2.Subtract(x,n.b2Rot.MultiplyVec2(t.q,d,n.b2Vec2.s_t0),t.p),n.b2Vec2.Subtract(A,n.b2Rot.MultiplyVec2(e.q,p,n.b2Vec2.s_t0),e.p),i.Initialize(c,t,e,l);const{normal:u,point:m,separation:_}=i;n.b2Vec2.Subtract(m,x,o),n.b2Vec2.Subtract(m,A,r),h=Math.min(h,_);const S=(0,n.b2Clamp)(s.b2_baumgarte*(_+s.b2_linearSlop),-s.b2_maxLinearCorrection,0),C=n.b2Vec2.Cross(o,u),V=n.b2Vec2.Cross(r,u),B=b+f+y*C*C+g*V*V,T=B>0?-S/B:0;n.b2Vec2.Scale(T,u,a),x.SubtractScaled(b,a),v-=y*n.b2Vec2.Cross(o,a),A.AddScaled(f,a),w+=g*n.b2Vec2.Cross(r,a)}this.m_positions[u].c.Copy(x),this.m_positions[u].a=v,this.m_positions[m].c.Copy(A),this.m_positions[m].a=w}return h>=-3*s.b2_linearSlop}SolveTOIPositionConstraints(t,e){const i=m.SolveTOIPositionConstraints_s_xfA,o=m.SolveTOIPositionConstraints_s_xfB,r=m.SolveTOIPositionConstraints_s_psm,a=m.SolveTOIPositionConstraints_s_rA,h=m.SolveTOIPositionConstraints_s_rB,l=m.SolveTOIPositionConstraints_s_P;let c=0;for(let u=0;u<this.m_count;++u){const m=this.m_positionConstraints[u],{indexA:d,indexB:p,localCenterA:_,localCenterB:b,pointCount:y}=m;let f=0,g=0;d!==t&&d!==e||(f=m.invMassA,g=m.invIA);let x=0,v=0;p!==t&&p!==e||(x=m.invMassB,v=m.invIB);const A=this.m_positions[d].c;let w=this.m_positions[d].a;const S=this.m_positions[p].c;let C=this.m_positions[p].a;for(let t=0;t<y;++t){i.q.Set(w),o.q.Set(C),n.b2Vec2.Subtract(A,n.b2Rot.MultiplyVec2(i.q,_,n.b2Vec2.s_t0),i.p),n.b2Vec2.Subtract(S,n.b2Rot.MultiplyVec2(o.q,b,n.b2Vec2.s_t0),o.p),r.Initialize(m,i,o,t);const{normal:e,point:u,separation:d}=r;n.b2Vec2.Subtract(u,A,a),n.b2Vec2.Subtract(u,S,h),c=Math.min(c,d);const p=(0,n.b2Clamp)(s.b2_toiBaumgarte*(d+s.b2_linearSlop),-s.b2_maxLinearCorrection,0),y=n.b2Vec2.Cross(a,e),V=n.b2Vec2.Cross(h,e),B=f+x+g*y*y+v*V*V,T=B>0?-p/B:0;n.b2Vec2.Scale(T,e,l),A.SubtractScaled(f,l),w-=g*n.b2Vec2.Cross(a,l),S.AddScaled(x,l),C+=v*n.b2Vec2.Cross(h,l)}this.m_positions[d].a=w,this.m_positions[p].a=C}return c>=-1.5*s.b2_linearSlop}}e.b2ContactSolver=m,m.InitializeVelocityConstraints_s_xfA=new n.b2Transform,m.InitializeVelocityConstraints_s_xfB=new n.b2Transform,m.InitializeVelocityConstraints_s_worldManifold=new o.b2WorldManifold,m.WarmStart_s_P=new n.b2Vec2,m.SolveVelocityConstraints_s_dv=new n.b2Vec2,m.SolveVelocityConstraints_s_dv1=new n.b2Vec2,m.SolveVelocityConstraints_s_dv2=new n.b2Vec2,m.SolveVelocityConstraints_s_P=new n.b2Vec2,m.SolveVelocityConstraints_s_a=new n.b2Vec2,m.SolveVelocityConstraints_s_b=new n.b2Vec2,m.SolveVelocityConstraints_s_x=new n.b2Vec2,m.SolveVelocityConstraints_s_d=new n.b2Vec2,m.SolveVelocityConstraints_s_P1=new n.b2Vec2,m.SolveVelocityConstraints_s_P2=new n.b2Vec2,m.SolveVelocityConstraints_s_P1P2=new n.b2Vec2,m.SolvePositionConstraints_s_xfA=new n.b2Transform,m.SolvePositionConstraints_s_xfB=new n.b2Transform,m.SolvePositionConstraints_s_psm=new u,m.SolvePositionConstraints_s_rA=new n.b2Vec2,m.SolvePositionConstraints_s_rB=new n.b2Vec2,m.SolvePositionConstraints_s_P=new n.b2Vec2,m.SolveTOIPositionConstraints_s_xfA=new n.b2Transform,m.SolveTOIPositionConstraints_s_xfB=new n.b2Transform,m.SolveTOIPositionConstraints_s_psm=new u,m.SolveTOIPositionConstraints_s_rA=new n.b2Vec2,m.SolveTOIPositionConstraints_s_rB=new n.b2Vec2,m.SolveTOIPositionConstraints_s_P=new n.b2Vec2},5354:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2DistanceJoint=e.b2DistanceJointDef=void 0;const s=i(2962),n=i(6826),o=i(5773),r=i(8991),a={worldPointA:new n.b2Vec2,worldPointB:new n.b2Vec2,vpA:new n.b2Vec2,vpB:new n.b2Vec2,vpBA:new n.b2Vec2,P:new n.b2Vec2,qA:new n.b2Rot,qB:new n.b2Rot,lalcA:new n.b2Vec2,lalcB:new n.b2Vec2,Draw:{pA:new n.b2Vec2,pB:new n.b2Vec2,axis:new n.b2Vec2,pRest:new n.b2Vec2,p1:new n.b2Vec2,p2:new n.b2Vec2}};class h extends o.b2JointDef{constructor(){super(o.b2JointType.e_distanceJoint),this.localAnchorA=new n.b2Vec2,this.localAnchorB=new n.b2Vec2,this.length=1,this.minLength=0,this.maxLength=s.b2_maxFloat,this.stiffness=0,this.damping=0}Initialize(t,e,i,o){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.length=Math.max(n.b2Vec2.Distance(i,o),s.b2_linearSlop),this.minLength=this.length,this.maxLength=this.length}}e.b2DistanceJointDef=h;class l extends o.b2Joint{constructor(t){var e,i;super(t),this.m_bias=0,this.m_localAnchorA=new n.b2Vec2,this.m_localAnchorB=new n.b2Vec2,this.m_gamma=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new n.b2Vec2,this.m_rA=new n.b2Vec2,this.m_rB=new n.b2Vec2,this.m_localCenterA=new n.b2Vec2,this.m_localCenterB=new n.b2Vec2,this.m_currentLength=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_softMass=0,this.m_mass=0,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=Math.max(t.length,s.b2_linearSlop),this.m_minLength=Math.max(t.minLength,s.b2_linearSlop),this.m_maxLength=Math.max(t.maxLength,this.m_minLength),this.m_stiffness=null!==(e=t.stiffness)&&void 0!==e?e:0,this.m_damping=null!==(i=t.damping)&&void 0!==i?i:0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const i=t*(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse);return e.x=i*this.m_u.x,e.y=i*this.m_u.y,e}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){return this.m_impulse=0,this.m_length=Math.max(s.b2_linearSlop,t),this.m_length}GetLength(){return this.m_length}SetMinLength(t){return this.m_lowerImpulse=0,this.m_minLength=(0,n.b2Clamp)(t,s.b2_linearSlop,this.m_maxLength),this.m_minLength}GetMinLength(){return this.m_minLength}SetMaxLength(t){return this.m_upperImpulse=0,this.m_maxLength=Math.max(t,this.m_minLength),this.m_maxLength}GetMaxLength(){return this.m_maxLength}GetCurrentLength(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,a.worldPointA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,a.worldPointB);return n.b2Vec2.Distance(e,t)}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,o=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const h=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const{qA:m,qB:d,lalcA:p,lalcB:_}=a;m.Set(i),d.Set(l),n.b2Rot.MultiplyVec2(m,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),n.b2Rot.MultiplyVec2(d,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,_),this.m_rB),this.m_u.x=h.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=h.y+this.m_rB.y-e.y-this.m_rA.y,this.m_currentLength=this.m_u.Length(),this.m_currentLength>s.b2_linearSlop?this.m_u.Scale(1/this.m_currentLength):(this.m_u.SetZero(),this.m_mass=0,this.m_impulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0);const b=n.b2Vec2.Cross(this.m_rA,this.m_u),y=n.b2Vec2.Cross(this.m_rB,this.m_u);let f=this.m_invMassA+this.m_invIA*b*b+this.m_invMassB+this.m_invIB*y*y;if(this.m_mass=0!==f?1/f:0,this.m_stiffness>0&&this.m_minLength<this.m_maxLength){const e=this.m_currentLength-this.m_length,i=this.m_damping,s=this.m_stiffness,n=t.step.dt;this.m_gamma=n*(i+n*s),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=e*n*s*this.m_gamma,f+=this.m_gamma,this.m_softMass=0!==f?1/f:0}else this.m_gamma=0,this.m_bias=0,this.m_softMass=this.m_mass;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const{P:e}=a;n.b2Vec2.Scale(this.m_impulse+this.m_lowerImpulse-this.m_upperImpulse,this.m_u,e),o.SubtractScaled(this.m_invMassA,e),r-=this.m_invIA*n.b2Vec2.Cross(this.m_rA,e),c.AddScaled(this.m_invMassB,e),u+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;if(this.m_minLength<this.m_maxLength){if(this.m_stiffness>0){const t=n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,a.vpA),r=n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,a.vpB),h=n.b2Vec2.Dot(this.m_u,n.b2Vec2.Subtract(r,t,a.vpBA)),l=-this.m_softMass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;const c=n.b2Vec2.Scale(l,this.m_u,a.P);e.SubtractScaled(this.m_invMassA,c),i-=this.m_invIA*n.b2Vec2.Cross(this.m_rA,c),s.AddScaled(this.m_invMassB,c),o+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,c)}{const r=this.m_currentLength-this.m_minLength,h=Math.max(0,r)*t.step.inv_dt,l=n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,a.vpA),c=n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,a.vpB),u=n.b2Vec2.Dot(this.m_u,n.b2Vec2.Subtract(c,l,a.vpBA));let m=-this.m_mass*(u+h);const d=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(0,this.m_lowerImpulse+m),m=this.m_lowerImpulse-d;const p=n.b2Vec2.Scale(m,this.m_u,a.P);e.SubtractScaled(this.m_invMassA,p),i-=this.m_invIA*n.b2Vec2.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),o+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,p)}{const r=this.m_maxLength-this.m_currentLength,h=Math.max(0,r)*t.step.inv_dt,l=n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,a.vpA),c=n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,a.vpB),u=n.b2Vec2.Dot(this.m_u,n.b2Vec2.Subtract(l,c,a.vpBA));let m=-this.m_mass*(u+h);const d=this.m_upperImpulse;this.m_upperImpulse=Math.max(0,this.m_upperImpulse+m),m=this.m_upperImpulse-d;const p=n.b2Vec2.Scale(-m,this.m_u,a.P);e.SubtractScaled(this.m_invMassA,p),i-=this.m_invIA*n.b2Vec2.Cross(this.m_rA,p),s.AddScaled(this.m_invMassB,p),o+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,p)}}else{const t=n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,a.vpA),r=n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,a.vpB),h=n.b2Vec2.Dot(this.m_u,n.b2Vec2.Subtract(r,t,a.vpBA)),l=-this.m_mass*h;this.m_impulse+=l;const c=n.b2Vec2.Scale(l,this.m_u,a.P);e.SubtractScaled(this.m_invMassA,c),i-=this.m_invIA*n.b2Vec2.Cross(this.m_rA,c),s.AddScaled(this.m_invMassB,c),o+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,c)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=o}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const o=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:h,qB:l,lalcA:c,lalcB:u,P:m}=a;h.Set(i),l.Set(r);const d=n.b2Rot.MultiplyVec2(h,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,c),this.m_rA),p=n.b2Rot.MultiplyVec2(l,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),this.m_rB);this.m_u.x=o.x+p.x-e.x-d.x,this.m_u.y=o.y+p.y-e.y-d.y;const _=this.m_u.Normalize();let b;if(this.m_minLength===this.m_maxLength)b=_-this.m_minLength;else if(_<this.m_minLength)b=_-this.m_minLength;else{if(!(this.m_maxLength<_))return!0;b=_-this.m_maxLength}const y=-this.m_mass*b;return n.b2Vec2.Scale(y,this.m_u,m),e.SubtractScaled(this.m_invMassA,m),i-=this.m_invIA*n.b2Vec2.Cross(d,m),o.AddScaled(this.m_invMassB,m),r+=this.m_invIB*n.b2Vec2.Cross(p,m),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Math.abs(b)<s.b2_linearSlop}Draw(t){const{pA:e,pB:i,axis:o,pRest:h}=a.Draw,l=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();if(n.b2Transform.MultiplyVec2(l,this.m_localAnchorA,e),n.b2Transform.MultiplyVec2(c,this.m_localAnchorB,i),n.b2Vec2.Subtract(i,e,o),o.Normalize(),t.DrawSegment(e,i,r.debugColors.joint5),n.b2Vec2.AddScaled(e,this.m_length,o,h),t.DrawPoint(h,8,r.debugColors.joint1),this.m_minLength!==this.m_maxLength){if(this.m_minLength>s.b2_linearSlop){const i=n.b2Vec2.AddScaled(e,this.m_minLength,o,a.Draw.p1);t.DrawPoint(i,4,r.debugColors.joint2)}if(this.m_maxLength<s.b2_maxFloat){const i=n.b2Vec2.AddScaled(e,this.m_maxLength,o,a.Draw.p1);t.DrawPoint(i,4,r.debugColors.joint3)}}}}e.b2DistanceJoint=l},5141:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2EdgeAndCircleContact=void 0;const s=i(5814),n=i(6760);class o extends n.b2Contact{Evaluate(t,e,i){(0,s.b2CollideEdgeAndCircle)(t,this.GetShapeA(),e,this.GetShapeB(),i)}}e.b2EdgeAndCircleContact=o},5345:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2EdgeAndPolygonContact=void 0;const s=i(5814),n=i(6760);class o extends n.b2Contact{Evaluate(t,e,i){(0,s.b2CollideEdgeAndPolygon)(t,this.GetShapeA(),e,this.GetShapeB(),i)}}e.b2EdgeAndPolygonContact=o},8913:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Fixture=e.b2FixtureProxy=e.b2DefaultFilter=void 0;const s=i(6826),n=i(2472),o=i(6955),r=i(2962),a=i(2952),h={c1:new s.b2Vec2,c2:new s.b2Vec2};e.b2DefaultFilter={categoryBits:1,maskBits:65535,groupIndex:0};class l{constructor(t,e,i,s){this.aabb=new n.b2AABB,this.fixture=t,this.childIndex=s,t.m_shape.ComputeAABB(this.aabb,i,s),this.treeNode=e.CreateProxy(this.aabb,this)}}e.b2FixtureProxy=l;const c=new n.b2AABB,u=new n.b2AABB,m=new s.b2Vec2;e.b2Fixture=class{constructor(t,i){var s,n,o,r,h;this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_restitutionThreshold=0,this.m_proxies=[],this.m_isSensor=!1,this.m_userData=null,this.m_body=t,this.m_shape=i.shape.Clone(),this.m_userData=i.userData,this.m_friction=null!==(s=i.friction)&&void 0!==s?s:.2,this.m_restitution=null!==(n=i.restitution)&&void 0!==n?n:0,this.m_restitutionThreshold=null!==(o=i.restitutionThreshold)&&void 0!==o?o:a.b2_lengthUnitsPerMeter,this.m_filter={...e.b2DefaultFilter,...i.filter},this.m_isSensor=null!==(r=i.isSensor)&&void 0!==r&&r,this.m_density=null!==(h=i.density)&&void 0!==h?h:0}get m_proxyCount(){return this.m_proxies.length}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){var i,s,n;this.m_filter.categoryBits=null!==(i=t.categoryBits)&&void 0!==i?i:e.b2DefaultFilter.categoryBits,this.m_filter.groupIndex=null!==(s=t.groupIndex)&&void 0!==s?s:e.b2DefaultFilter.groupIndex,this.m_filter.maskBits=null!==(n=t.maskBits)&&void 0!==n?n:e.b2DefaultFilter.maskBits,this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){let t=this.m_body.GetContactList();for(;t;){const{contact:e}=t,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}const e=this.m_body.GetWorld().m_contactManager.m_broadPhase;for(const t of this.m_proxies)e.TouchProxy(t.treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}RayCast(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}GetMassData(t=new o.b2MassData){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}SetRestitutionThreshold(t){this.m_restitutionThreshold=t}GetAABB(t){return this.m_proxies[t].aabb}CreateProxies(t,e){(0,r.b2Assert)(0===this.m_proxies.length),this.m_proxies.length=this.m_shape.GetChildCount();for(let i=0;i<this.m_proxies.length;++i)this.m_proxies[i]=new l(this,t,e,i)}DestroyProxies(t){for(const e of this.m_proxies)t.DestroyProxy(e.treeNode);this.m_proxies.length=0}Synchronize(t,e,i){const{c1:n,c2:o}=h,r=m;for(const a of this.m_proxies){const h=c,l=u;this.m_shape.ComputeAABB(h,e,a.childIndex),this.m_shape.ComputeAABB(l,i,a.childIndex),a.aabb.Combine2(h,l),s.b2Vec2.Subtract(l.GetCenter(o),h.GetCenter(n),r),t.MoveProxy(a.treeNode,a.aabb,r)}}}},9566:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2FrictionJoint=e.b2FrictionJointDef=void 0;const s=i(6826),n=i(5773),o={qA:new s.b2Rot,qB:new s.b2Rot,lalcA:new s.b2Vec2,lalcB:new s.b2Vec2,Cdot:new s.b2Vec2,impulse:new s.b2Vec2,oldImpulse:new s.b2Vec2};class r extends n.b2JointDef{constructor(){super(n.b2JointType.e_frictionJoint),this.localAnchorA=new s.b2Vec2,this.localAnchorB=new s.b2Vec2,this.maxForce=0,this.maxTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}e.b2FrictionJointDef=r;class a extends n.b2Joint{constructor(t){var e,i;super(t),this.m_localAnchorA=new s.b2Vec2,this.m_localAnchorB=new s.b2Vec2,this.m_linearImpulse=new s.b2Vec2,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.b2Vec2,this.m_rB=new s.b2Vec2,this.m_localCenterA=new s.b2Vec2,this.m_localCenterB=new s.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new s.b2Mat22,this.m_angularMass=0,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=null!==(e=t.maxForce)&&void 0!==e?e:0,this.m_maxTorque=null!==(i=t.maxTorque)&&void 0!==i?i:0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const{qA:l,qB:c,lalcA:u,lalcB:m}=o;l.Set(e),c.Set(r),s.b2Rot.MultiplyVec2(l,s.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),s.b2Rot.MultiplyVec2(c,s.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB);const d=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,b=this.m_invIB,y=this.m_linearMass;if(y.ex.x=d+p+_*this.m_rA.y*this.m_rA.y+b*this.m_rB.y*this.m_rB.y,y.ex.y=-_*this.m_rA.x*this.m_rA.y-b*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=d+p+_*this.m_rA.x*this.m_rA.x+b*this.m_rB.x*this.m_rB.x,y.Inverse(),this.m_angularMass=_+b,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.Scale(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;i.SubtractScaled(d,e),n-=_*(s.b2Vec2.Cross(this.m_rA,e)+this.m_angularImpulse),a.AddScaled(p,e),h+=b*(s.b2Vec2.Cross(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,u=t.step.dt;{const t=r-i;let e=-this.m_angularMass*t;const n=this.m_angularImpulse,o=u*this.m_maxTorque;this.m_angularImpulse=(0,s.b2Clamp)(this.m_angularImpulse+e,-o,o),e=this.m_angularImpulse-n,i-=l*e,r+=c*e}{const{Cdot:t,impulse:m,oldImpulse:d}=o;s.b2Vec2.Subtract(s.b2Vec2.AddCrossScalarVec2(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,s.b2Vec2.s_t1),t),s.b2Mat22.MultiplyVec2(this.m_linearMass,t,m).Negate(),d.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(m);const p=u*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(p)),s.b2Vec2.Subtract(this.m_linearImpulse,d,m),e.SubtractScaled(a,m),i-=l*s.b2Vec2.Cross(this.m_rA,m),n.AddScaled(h,m),r+=c*s.b2Vec2.Cross(this.m_rB,m)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}}e.b2FrictionJoint=a},5731:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2GearJoint=e.b2GearJointDef=void 0;const s=i(2962),n=i(6826),o=i(5773),r={qA:new n.b2Rot,qB:new n.b2Rot,qC:new n.b2Rot,qD:new n.b2Rot,lalcA:new n.b2Vec2,lalcB:new n.b2Vec2,lalcC:new n.b2Vec2,lalcD:new n.b2Vec2,u:new n.b2Vec2,rA:new n.b2Vec2,rB:new n.b2Vec2,rC:new n.b2Vec2,rD:new n.b2Vec2,JvAC:new n.b2Vec2,JvBD:new n.b2Vec2};class a extends o.b2JointDef{constructor(){super(o.b2JointType.e_gearJoint),this.ratio=1}}e.b2GearJointDef=a;class h extends o.b2Joint{constructor(t){var e;let i,s;super(t),this.m_typeA=o.b2JointType.e_unknownJoint,this.m_typeB=o.b2JointType.e_unknownJoint,this.m_localAnchorA=new n.b2Vec2,this.m_localAnchorB=new n.b2Vec2,this.m_localAnchorC=new n.b2Vec2,this.m_localAnchorD=new n.b2Vec2,this.m_localAxisC=new n.b2Vec2,this.m_localAxisD=new n.b2Vec2,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new n.b2Vec2,this.m_lcB=new n.b2Vec2,this.m_lcC=new n.b2Vec2,this.m_lcD=new n.b2Vec2,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new n.b2Vec2,this.m_JvBD=new n.b2Vec2,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_joint1=t.joint1,this.m_joint2=t.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const r=this.m_bodyA.m_xf,a=this.m_bodyA.m_sweep.a,h=this.m_bodyC.m_xf,l=this.m_bodyC.m_sweep.a;if(this.m_typeA===o.b2JointType.e_revoluteJoint){const e=t.joint1;this.m_localAnchorC.Copy(e.m_localAnchorA),this.m_localAnchorA.Copy(e.m_localAnchorB),this.m_referenceAngleA=e.m_referenceAngle,this.m_localAxisC.SetZero(),i=a-l-this.m_referenceAngleA}else{const e=t.joint1;this.m_localAnchorC.Copy(e.m_localAnchorA),this.m_localAnchorA.Copy(e.m_localAnchorB),this.m_referenceAngleA=e.m_referenceAngle,this.m_localAxisC.Copy(e.m_localXAxisA);const s=this.m_localAnchorC,o=n.b2Rot.TransposeMultiplyVec2(h.q,n.b2Rot.MultiplyVec2(r.q,this.m_localAnchorA,n.b2Vec2.s_t0).Add(r.p).Subtract(h.p),n.b2Vec2.s_t0);i=n.b2Vec2.Dot(o.Subtract(s),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const c=this.m_bodyB.m_xf,u=this.m_bodyB.m_sweep.a,m=this.m_bodyD.m_xf,d=this.m_bodyD.m_sweep.a;if(this.m_typeB===o.b2JointType.e_revoluteJoint){const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.SetZero(),s=u-d-this.m_referenceAngleB}else{const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.Copy(e.m_localXAxisA);const i=this.m_localAnchorD,o=n.b2Rot.TransposeMultiplyVec2(m.q,n.b2Rot.MultiplyVec2(c.q,this.m_localAnchorB,n.b2Vec2.s_t0).Add(c.p).Subtract(m.p),n.b2Vec2.s_t0);s=n.b2Vec2.Dot(o.Subtract(i),this.m_localAxisD)}this.m_ratio=null!==(e=t.ratio)&&void 0!==e?e:1,this.m_constant=i+this.m_ratio*s,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const c=t.positions[this.m_indexC].a,u=t.velocities[this.m_indexC].v;let m=t.velocities[this.m_indexC].w;const d=t.positions[this.m_indexD].a,p=t.velocities[this.m_indexD].v;let _=t.velocities[this.m_indexD].w;const{qA:b,qB:y,qC:f,qD:g}=r;if(b.Set(e),y.Set(a),f.Set(c),g.Set(d),this.m_mass=0,this.m_typeA===o.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const{u:t,rC:e,rA:i,lalcA:s,lalcC:o}=r;n.b2Rot.MultiplyVec2(f,this.m_localAxisC,t),n.b2Rot.MultiplyVec2(f,n.b2Vec2.Subtract(this.m_localAnchorC,this.m_lcC,o),e),n.b2Rot.MultiplyVec2(b,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_lcA,s),i),this.m_JvAC.Copy(t),this.m_JwC=n.b2Vec2.Cross(e,t),this.m_JwA=n.b2Vec2.Cross(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===o.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const{u:t,rB:e,rD:i,lalcB:s,lalcD:o}=r;n.b2Rot.MultiplyVec2(g,this.m_localAxisD,t),n.b2Rot.MultiplyVec2(g,n.b2Vec2.Subtract(this.m_localAnchorD,this.m_lcD,o),i),n.b2Rot.MultiplyVec2(y,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_lcB,s),e),n.b2Vec2.Scale(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*n.b2Vec2.Cross(i,t),this.m_JwB=this.m_ratio*n.b2Vec2.Cross(e,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.AddScaled(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,h.AddScaled(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,u.SubtractScaled(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,p.SubtractScaled(this.m_mD*this.m_impulse,this.m_JvBD),_-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=_}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const r=t.velocities[this.m_indexC].v;let a=t.velocities[this.m_indexC].w;const h=t.velocities[this.m_indexD].v;let l=t.velocities[this.m_indexD].w,c=n.b2Vec2.Dot(this.m_JvAC,n.b2Vec2.Subtract(e,r,n.b2Vec2.s_t0))+n.b2Vec2.Dot(this.m_JvBD,n.b2Vec2.Subtract(s,h,n.b2Vec2.s_t0));c+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*o-this.m_JwD*l);const u=-this.m_mass*c;this.m_impulse+=u,e.AddScaled(this.m_mA*u,this.m_JvAC),i+=this.m_iA*u*this.m_JwA,s.AddScaled(this.m_mB*u,this.m_JvBD),o+=this.m_iB*u*this.m_JwB,r.SubtractScaled(this.m_mC*u,this.m_JvAC),a-=this.m_iC*u*this.m_JwC,h.SubtractScaled(this.m_mD*u,this.m_JvBD),l-=this.m_iD*u*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=o,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=l}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const a=t.positions[this.m_indexB].c;let h=t.positions[this.m_indexB].a;const l=t.positions[this.m_indexC].c;let c=t.positions[this.m_indexC].a;const u=t.positions[this.m_indexD].c;let m=t.positions[this.m_indexD].a;const{qA:d,qB:p,qC:_,qD:b,JvAC:y,JvBD:f}=r;d.Set(i),p.Set(h),_.Set(c),b.Set(m);let g,x,v,A,w,S,C=0;if(this.m_typeA===o.b2JointType.e_revoluteJoint)y.SetZero(),v=1,w=1,C+=this.m_iA+this.m_iC,g=i-c-this.m_referenceAngleA;else{const{u:t,rC:i,rA:s,lalcC:o,lalcA:a}=r;n.b2Rot.MultiplyVec2(_,this.m_localAxisC,t),n.b2Rot.MultiplyVec2(_,n.b2Vec2.Subtract(this.m_localAnchorC,this.m_lcC,o),i),n.b2Rot.MultiplyVec2(d,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_lcA,a),s),y.Copy(t),w=n.b2Vec2.Cross(i,t),v=n.b2Vec2.Cross(s,t),C+=this.m_mC+this.m_mA+this.m_iC*w*w+this.m_iA*v*v;const h=o,c=n.b2Rot.TransposeMultiplyVec2(_,n.b2Vec2.Add(s,e,n.b2Vec2.s_t0).Subtract(l),n.b2Vec2.s_t0);g=n.b2Vec2.Dot(n.b2Vec2.Subtract(c,h,n.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB===o.b2JointType.e_revoluteJoint)f.SetZero(),A=this.m_ratio,S=this.m_ratio,C+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),x=h-m-this.m_referenceAngleB;else{const{u:t,rD:e,rB:i,lalcD:s,lalcB:o}=r;n.b2Rot.MultiplyVec2(b,this.m_localAxisD,t),n.b2Rot.MultiplyVec2(b,n.b2Vec2.Subtract(this.m_localAnchorD,this.m_lcD,s),e),n.b2Rot.MultiplyVec2(p,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_lcB,o),i),n.b2Vec2.Scale(this.m_ratio,t,f),S=this.m_ratio*n.b2Vec2.Cross(e,t),A=this.m_ratio*n.b2Vec2.Cross(i,t),C+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*S*S+this.m_iB*A*A;const h=s,l=n.b2Rot.TransposeMultiplyVec2(b,n.b2Vec2.Add(i,a,n.b2Vec2.s_t0).Subtract(u),n.b2Vec2.s_t0);x=n.b2Vec2.Dot(l.Subtract(h),this.m_localAxisD)}const V=g+this.m_ratio*x-this.m_constant;let B=0;return C>0&&(B=-V/C),e.AddScaled(this.m_mA*B,y),i+=this.m_iA*B*v,a.AddScaled(this.m_mB*B,f),h+=this.m_iB*B*A,l.SubtractScaled(this.m_mC*B,y),c-=this.m_iC*B*w,u.SubtractScaled(this.m_mD*B,f),m-=this.m_iD*B*S,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=h,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=m,0<s.b2_linearSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return n.b2Vec2.Scale(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}}e.b2GearJoint=h},6166:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Island=void 0;const s=i(2962),n=i(6826),o=i(2026),r=i(8995),a=i(3910),h=i(6174),l=i(8287);class c{constructor(t,e,i,n){this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=t,this.m_listener=n,this.m_bodies=new Array(t),this.m_contacts=new Array(e),this.m_joints=new Array(i),this.m_velocities=(0,s.b2MakeArray)(t,h.b2Velocity),this.m_positions=(0,s.b2MakeArray)(t,h.b2Position),this.Resize(t)}Resize(t){for(;this.m_bodyCapacity<t;)this.m_velocities[this.m_bodyCapacity]=new h.b2Velocity,this.m_positions[this.m_bodyCapacity]=new h.b2Position,this.m_bodyCapacity++}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=t,++this.m_bodyCount}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(t,e,i,o){const r=c.s_timer.Reset(),h=e.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c);const{a:s}=e.m_sweep,n=this.m_velocities[t].v.Copy(e.m_linearVelocity);let o=e.m_angularVelocity;e.m_sweep.c0.Copy(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_type===a.b2BodyType.b2_dynamicBody&&(n.x+=h*e.m_invMass*(e.m_gravityScale*e.m_mass*i.x+e.m_force.x),n.y+=h*e.m_invMass*(e.m_gravityScale*e.m_mass*i.y+e.m_force.y),o+=h*e.m_invI*e.m_torque,n.Scale(1/(1+h*e.m_linearDamping)),o*=1/(1+h*e.m_angularDamping)),this.m_positions[t].a=s,this.m_velocities[t].w=o}r.Reset();const l=c.s_solverData;l.step.Copy(e),l.positions=this.m_positions,l.velocities=this.m_velocities;const u=c.s_contactSolverDef;u.step.Copy(e),u.contacts=this.m_contacts,u.count=this.m_contactCount,u.positions=this.m_positions,u.velocities=this.m_velocities;const m=c.s_contactSolver.Initialize(u);m.InitializeVelocityConstraints(),e.warmStarting&&m.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(l);t.solveInit=r.GetMilliseconds(),r.Reset();for(let t=0;t<e.config.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(l);m.SolveVelocityConstraints()}m.StoreImpulses(),t.solveVelocity=r.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const{c:e}=this.m_positions[t];let{a:i}=this.m_positions[t];const{v:o}=this.m_velocities[t];let{w:r}=this.m_velocities[t];const a=n.b2Vec2.Scale(h,o,c.s_translation);if(n.b2Vec2.Dot(a,a)>s.b2_maxTranslationSquared){const t=s.b2_maxTranslation/a.Length();o.Scale(t)}const l=h*r;l*l>s.b2_maxRotationSquared&&(r*=s.b2_maxRotation/Math.abs(l)),e.AddScaled(h,o),i+=h*r,this.m_positions[t].a=i,this.m_velocities[t].w=r}r.Reset();let d=!1;for(let t=0;t<e.config.positionIterations;++t){const t=m.SolvePositionConstraints();let e=!0;for(let t=0;t<this.m_jointCount;++t){const i=this.m_joints[t].SolvePositionConstraints(l);e=e&&i}if(t&&e){d=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.m_sweep.c.Copy(this.m_positions[t].c),e.m_sweep.a=this.m_positions[t].a,e.m_linearVelocity.Copy(this.m_velocities[t].v),e.m_angularVelocity=this.m_velocities[t].w,e.SynchronizeTransform()}if(t.solvePosition=r.GetMilliseconds(),this.Report(m.m_velocityConstraints),o){let t=s.b2_maxFloat;const e=s.b2_linearSleepTolerance*s.b2_linearSleepTolerance,i=s.b2_angularSleepTolerance*s.b2_angularSleepTolerance;for(let s=0;s<this.m_bodyCount;++s){const o=this.m_bodies[s];o.GetType()!==a.b2BodyType.b2_staticBody&&(!o.m_autoSleepFlag||o.m_angularVelocity*o.m_angularVelocity>i||n.b2Vec2.Dot(o.m_linearVelocity,o.m_linearVelocity)>e?(o.m_sleepTime=0,t=0):(o.m_sleepTime+=h,t=Math.min(t,o.m_sleepTime)))}if(t>=s.b2_timeToSleep&&d)for(let t=0;t<this.m_bodyCount;++t)this.m_bodies[t].SetAwake(!1)}}SolveTOI(t,e,i){for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c),this.m_positions[t].a=e.m_sweep.a,this.m_velocities[t].v.Copy(e.m_linearVelocity),this.m_velocities[t].w=e.m_angularVelocity}const o=c.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;const r=c.s_contactSolver.Initialize(o);for(let s=0;s<t.config.positionIterations&&!r.SolveTOIPositionConstraints(e,i);++s);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(let e=0;e<t.config.velocityIterations;++e)r.SolveVelocityConstraints();const a=t.dt;for(let t=0;t<this.m_bodyCount;++t){const{c:e}=this.m_positions[t];let{a:i}=this.m_positions[t];const{v:o}=this.m_velocities[t];let{w:r}=this.m_velocities[t];const h=n.b2Vec2.Scale(a,o,c.s_translation);if(n.b2Vec2.Dot(h,h)>s.b2_maxTranslationSquared){const t=s.b2_maxTranslation/h.Length();o.Scale(t)}const l=a*r;l*l>s.b2_maxRotationSquared&&(r*=s.b2_maxRotation/Math.abs(l)),e.AddScaled(a,o),i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r;const u=this.m_bodies[t];u.m_sweep.c.Copy(e),u.m_sweep.a=i,u.m_linearVelocity.Copy(o),u.m_angularVelocity=r,u.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){for(let e=0;e<this.m_contactCount;++e){const i=this.m_contacts[e],s=t[e],n=c.s_impulse;n.count=s.pointCount;for(let t=0;t<s.pointCount;++t)n.normalImpulses[t]=s.points[t].normalImpulse,n.tangentImpulses[t]=s.points[t].tangentImpulse;this.m_listener.PostSolve(i,n)}}}e.b2Island=c,c.s_timer=new o.b2Timer,c.s_solverData=new h.b2SolverData,c.s_contactSolverDef=new r.b2ContactSolverDef,c.s_contactSolver=new r.b2ContactSolver,c.s_translation=new n.b2Vec2,c.s_impulse=new l.b2ContactImpulse},5773:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Joint=e.b2AngularStiffness=e.b2LinearStiffness=e.b2JointDef=e.b2JointEdge=e.b2JointType=void 0;const s=i(8991),n=i(6826),o={pA:new n.b2Vec2,pB:new n.b2Vec2};var r;!function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_motorJoint=10]="e_motorJoint",t[t.e_areaJoint=11]="e_areaJoint"}(r=e.b2JointType||(e.b2JointType={}));class a{constructor(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e}}e.b2JointEdge=a,e.b2JointDef=class{constructor(t){this.userData=null,this.collideConnected=!1,this.type=t}},e.b2LinearStiffness=function(t,e,i,s,n){const o=s.GetMass(),r=n.GetMass();let a;a=o>0&&r>0?o*r/(o+r):o>0?o:r;const h=2*Math.PI*e;t.stiffness=a*h*h,t.damping=2*a*i*h},e.b2AngularStiffness=function(t,e,i,s,n){const o=s.GetInertia(),r=n.GetInertia();let a;a=o>0&&r>0?o*r/(o+r):o>0?o:r;const h=2*Math.PI*e;t.stiffness=a*h*h,t.damping=2*a*i*h},e.b2Joint=class{constructor(t){var e;this.m_type=r.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new a(this,t.bodyB),this.m_edgeB=new a(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=null!==(e=t.collideConnected)&&void 0!==e&&e,this.m_userData=t.userData}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsEnabled(){return this.m_bodyA.IsEnabled()&&this.m_bodyB.IsEnabled()}GetCollideConnected(){return this.m_collideConnected}ShiftOrigin(t){}Draw(t){const e=this.m_bodyA.GetTransform().p,i=this.m_bodyB.GetTransform().p,n=this.GetAnchorA(o.pA),r=this.GetAnchorB(o.pB);t.DrawSegment(e,n,s.debugColors.joint6),t.DrawSegment(n,r,s.debugColors.joint6),t.DrawSegment(i,r,s.debugColors.joint6)}}},620:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2MotorJoint=e.b2MotorJointDef=void 0;const s=i(6826),n=i(5773),o={qA:new s.b2Rot,qB:new s.b2Rot,K:new s.b2Mat22,Cdot:new s.b2Vec2,impulse:new s.b2Vec2,oldImpulse:new s.b2Vec2};class r extends n.b2JointDef{constructor(){super(n.b2JointType.e_motorJoint),this.linearOffset=new s.b2Vec2,this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(e.GetPosition(),this.linearOffset);const i=t.GetAngle(),s=e.GetAngle();this.angularOffset=s-i}}e.b2MotorJointDef=r;class a extends n.b2Joint{constructor(t){var e,i,n,o,r;super(t),this.m_linearOffset=new s.b2Vec2,this.m_linearImpulse=new s.b2Vec2,this.m_angularImpulse=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new s.b2Vec2,this.m_rB=new s.b2Vec2,this.m_localCenterA=new s.b2Vec2,this.m_localCenterB=new s.b2Vec2,this.m_linearError=new s.b2Vec2,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new s.b2Mat22,this.m_angularMass=0,this.m_linearOffset.Copy(null!==(e=t.linearOffset)&&void 0!==e?e:s.b2Vec2.ZERO),this.m_angularOffset=null!==(i=t.angularOffset)&&void 0!==i?i:0,this.m_linearImpulse.SetZero(),this.m_maxForce=null!==(n=t.maxForce)&&void 0!==n?n:1,this.m_maxTorque=null!==(o=t.maxTorque)&&void 0!==o?o:1,this.m_correctionFactor=null!==(r=t.correctionFactor)&&void 0!==r?r:.3}GetAnchorA(t){const e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}GetAnchorB(t){const e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}GetReactionForce(t,e){return s.b2Vec2.Scale(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){s.b2Vec2.Equals(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}GetCorrectionFactor(){return this.m_correctionFactor}SetCorrectionFactor(t){this.m_correctionFactor=t}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const{qA:u,qB:m}=o;u.Set(i),m.Set(h);const d=s.b2Rot.MultiplyVec2(u,s.b2Vec2.Subtract(this.m_linearOffset,this.m_localCenterA,s.b2Vec2.s_t0),this.m_rA),p=s.b2Rot.MultiplyVec2(m,s.b2Vec2.Negate(this.m_localCenterB,s.b2Vec2.s_t0),this.m_rB),_=this.m_invMassA,b=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,g=this.m_linearMass;if(g.ex.x=_+b+y*d.y*d.y+f*p.y*p.y,g.ex.y=-y*d.x*d.y-f*p.x*p.y,g.ey.x=g.ex.y,g.ey.y=_+b+y*d.x*d.x+f*p.x*p.x,g.Inverse(),this.m_angularMass=y+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),s.b2Vec2.Subtract(s.b2Vec2.Add(a,p,s.b2Vec2.s_t0),s.b2Vec2.Add(e,d,s.b2Vec2.s_t1),this.m_linearError),this.m_angularError=h-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.Scale(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;n.SubtractScaled(_,e),r-=y*(s.b2Vec2.Cross(d,e)+this.m_angularImpulse),l.AddScaled(b,e),c+=f*(s.b2Vec2.Cross(p,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const n=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,u=t.step.dt,m=t.step.inv_dt;{const t=r-i+m*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const n=this.m_angularImpulse,o=u*this.m_maxTorque;this.m_angularImpulse=(0,s.b2Clamp)(this.m_angularImpulse+e,-o,o),e=this.m_angularImpulse-n,i-=l*e,r+=c*e}{const{impulse:t,oldImpulse:d,Cdot:p}=o;s.b2Vec2.AddScaled(s.b2Vec2.Subtract(s.b2Vec2.AddCrossScalarVec2(n,r,this.m_rB,s.b2Vec2.s_t0),s.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,s.b2Vec2.s_t1),s.b2Vec2.s_t2),m*this.m_correctionFactor,this.m_linearError,p),s.b2Mat22.MultiplyVec2(this.m_linearMass,p,t).Negate(),d.Copy(this.m_linearImpulse),this.m_linearImpulse.Add(t);const _=u*this.m_maxForce;this.m_linearImpulse.LengthSquared()>_*_&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Scale(_)),s.b2Vec2.Subtract(this.m_linearImpulse,d,t),e.SubtractScaled(a,t),i-=l*s.b2Vec2.Cross(this.m_rA,t),n.AddScaled(h,t),r+=c*s.b2Vec2.Cross(this.m_rB,t)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}SolvePositionConstraints(t){return!0}}e.b2MotorJoint=a},2493:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2MouseJoint=e.b2MouseJointDef=void 0;const s=i(8991),n=i(6826),o=i(5773),r={qB:new n.b2Rot,lalcB:new n.b2Vec2,Cdot:new n.b2Vec2,impulse:new n.b2Vec2,oldImpulse:new n.b2Vec2,pA:new n.b2Vec2,pB:new n.b2Vec2};class a extends o.b2JointDef{constructor(){super(o.b2JointType.e_mouseJoint),this.target=new n.b2Vec2,this.maxForce=0,this.stiffness=0,this.damping=0}}e.b2MouseJointDef=a;class h extends o.b2Joint{constructor(t){var e,i,s,o;super(t),this.m_localAnchorB=new n.b2Vec2,this.m_targetA=new n.b2Vec2,this.m_stiffness=0,this.m_damping=0,this.m_beta=0,this.m_impulse=new n.b2Vec2,this.m_maxForce=0,this.m_gamma=0,this.m_indexB=0,this.m_rB=new n.b2Vec2,this.m_localCenterB=new n.b2Vec2,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new n.b2Mat22,this.m_C=new n.b2Vec2,this.m_targetA.Copy(null!==(e=t.target)&&void 0!==e?e:n.b2Vec2.ZERO),n.b2Transform.TransposeMultiplyVec2(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=null!==(i=t.maxForce)&&void 0!==i?i:0,this.m_stiffness=null!==(s=t.stiffness)&&void 0!==s?s:0,this.m_damping=null!==(o=t.damping)&&void 0!==o?o:0,this.m_beta=0,this.m_gamma=0}SetTarget(t){n.b2Vec2.Equals(t,this.m_targetA)||(this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t))}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const{qB:a,lalcB:h}=r;a.Set(i);const l=this.m_damping,c=this.m_stiffness,u=t.step.dt;this.m_gamma=u*(l+u*c),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*c*this.m_gamma,n.b2Rot.MultiplyVec2(a,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,h),this.m_rB);const m=this.m_mass;m.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,m.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,m.ey.x=m.ex.y,m.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,m.Inverse(),n.b2Vec2.Add(e,this.m_rB,this.m_C).Subtract(this.m_targetA),this.m_C.Scale(this.m_beta),o*=.98,t.step.warmStarting?(this.m_impulse.Scale(t.step.dtRatio),s.AddScaled(this.m_invMassB,this.m_impulse),o+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=o}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let i=t.velocities[this.m_indexB].w;const{Cdot:s,impulse:o,oldImpulse:a}=r;n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rB,s),n.b2Mat22.MultiplyVec2(this.m_mass,n.b2Vec2.Add(s,this.m_C,o).AddScaled(this.m_gamma,this.m_impulse).Negate(),o),a.Copy(this.m_impulse),this.m_impulse.Add(o);const h=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>h*h&&this.m_impulse.Scale(h/this.m_impulse.Length()),n.b2Vec2.Subtract(this.m_impulse,a,o),e.AddScaled(this.m_invMassB,o),i+=this.m_invIB*n.b2Vec2.Cross(this.m_rB,o),t.velocities[this.m_indexB].w=i}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return n.b2Vec2.Scale(t,this.m_impulse,e)}GetReactionTorque(t){return 0}ShiftOrigin(t){this.m_targetA.Subtract(t)}Draw(t){const e=this.GetAnchorA(r.pA),i=this.GetAnchorB(r.pB);t.DrawPoint(e,4,s.debugColors.joint7),t.DrawPoint(i,4,s.debugColors.joint7),t.DrawSegment(e,i,s.debugColors.joint8)}}e.b2MouseJoint=h},6067:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2PolygonAndCircleContact=void 0;const s=i(8503),n=i(6760);class o extends n.b2Contact{Evaluate(t,e,i){(0,s.b2CollidePolygonAndCircle)(t,this.GetShapeA(),e,this.GetShapeB(),i)}}e.b2PolygonAndCircleContact=o},4879:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2PolygonContact=void 0;const s=i(1760),n=i(6760);class o extends n.b2Contact{Evaluate(t,e,i){(0,s.b2CollidePolygons)(t,this.GetShapeA(),e,this.GetShapeB(),i)}}e.b2PolygonContact=o},639:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2PrismaticJoint=e.b2PrismaticJointDef=void 0;const s=i(2962),n=i(8991),o=i(6826),r=i(5773),a={K3:new o.b2Mat33,K2:new o.b2Mat22,qA:new o.b2Rot,qB:new o.b2Rot,lalcA:new o.b2Vec2,lalcB:new o.b2Vec2,rA:new o.b2Vec2,rB:new o.b2Vec2,GetJointTranslation:{pA:new o.b2Vec2,pB:new o.b2Vec2,d:new o.b2Vec2,axis:new o.b2Vec2},InitVelocityConstraints:{d:new o.b2Vec2,P:new o.b2Vec2},SolveVelocityConstraints:{P:new o.b2Vec2,df:new o.b2Vec2},SolvePositionConstraints:{d:new o.b2Vec2,impulse:new o.b2Vec3,impulse1:new o.b2Vec2,P:new o.b2Vec2},Draw:{p1:new o.b2Vec2,p2:new o.b2Vec2,pA:new o.b2Vec2,pB:new o.b2Vec2,axis:new o.b2Vec2,lower:new o.b2Vec2,upper:new o.b2Vec2,perp:new o.b2Vec2}};class h extends r.b2JointDef{constructor(){super(r.b2JointType.e_prismaticJoint),this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.localAxisA=new o.b2Vec2(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}e.b2PrismaticJointDef=h;class l extends r.b2Joint{constructor(t){var e,i,s,n,r,a,h,l,c,u;super(t),this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_localXAxisA=new o.b2Vec2,this.m_localYAxisA=new o.b2Vec2,this.m_referenceAngle=0,this.m_impulse=new o.b2Vec2,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new o.b2Vec2,this.m_perp=new o.b2Vec2,this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new o.b2Mat22,this.m_translation=0,this.m_axialMass=0,this.m_localAnchorA.Copy(null!==(e=t.localAnchorA)&&void 0!==e?e:o.b2Vec2.ZERO),this.m_localAnchorB.Copy(null!==(i=t.localAnchorB)&&void 0!==i?i:o.b2Vec2.ZERO),o.b2Vec2.Normalize(null!==(s=t.localAxisA)&&void 0!==s?s:o.b2Vec2.UNITX,this.m_localXAxisA),o.b2Vec2.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=null!==(n=t.referenceAngle)&&void 0!==n?n:0,this.m_lowerTranslation=null!==(r=t.lowerTranslation)&&void 0!==r?r:0,this.m_upperTranslation=null!==(a=t.upperTranslation)&&void 0!==a?a:0,this.m_maxMotorForce=null!==(h=t.maxMotorForce)&&void 0!==h?h:0,this.m_motorSpeed=null!==(l=t.motorSpeed)&&void 0!==l?l:0,this.m_enableLimit=null!==(c=t.enableLimit)&&void 0!==c&&c,this.m_enableMotor=null!==(u=t.enableMotor)&&void 0!==u&&u}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const{qA:u,qB:m,lalcA:d,lalcB:p,rA:_,rB:b}=a;u.Set(i),m.Set(h),o.b2Rot.MultiplyVec2(u,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,d),_),o.b2Rot.MultiplyVec2(m,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,p),b);const y=o.b2Vec2.Subtract(r,e,a.InitVelocityConstraints.d).Add(b).Subtract(_),f=this.m_invMassA,g=this.m_invMassB,x=this.m_invIA,v=this.m_invIB;o.b2Rot.MultiplyVec2(u,this.m_localXAxisA,this.m_axis),this.m_a1=o.b2Vec2.Cross(o.b2Vec2.Add(y,_,o.b2Vec2.s_t0),this.m_axis),this.m_a2=o.b2Vec2.Cross(b,this.m_axis),this.m_axialMass=f+g+x*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_axialMass>0&&(this.m_axialMass=1/this.m_axialMass),o.b2Rot.MultiplyVec2(u,this.m_localYAxisA,this.m_perp),this.m_s1=o.b2Vec2.Cross(o.b2Vec2.Add(y,_,o.b2Vec2.s_t0),this.m_perp),this.m_s2=o.b2Vec2.Cross(b,this.m_perp);const A=f+g+x*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,w=x*this.m_s1+v*this.m_s2;let S=x+v;if(0===S&&(S=1),this.m_K.ex.Set(A,w),this.m_K.ey.Set(w,S),this.m_enableLimit?this.m_translation=o.b2Vec2.Dot(this.m_axis,y):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const e=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:i}=a.InitVelocityConstraints;o.b2Vec2.Scale(this.m_impulse.x,this.m_perp,i).AddScaled(e,this.m_axis);const r=this.m_impulse.x*this.m_s1+this.m_impulse.y+e*this.m_a1,h=this.m_impulse.x*this.m_s2+this.m_impulse.y+e*this.m_a2;s.SubtractScaled(f,i),n-=x*r,l.AddScaled(g,i),c+=v*h}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,{P:u,df:m}=a.SolveVelocityConstraints;if(this.m_enableMotor){const a=o.b2Vec2.Dot(this.m_axis,o.b2Vec2.Subtract(s,e,o.b2Vec2.s_t0))+this.m_a2*n-this.m_a1*i;let m=this.m_axialMass*(this.m_motorSpeed-a);const d=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=(0,o.b2Clamp)(this.m_motorImpulse+m,-p,p),m=this.m_motorImpulse-d,o.b2Vec2.Scale(m,this.m_axis,u);const _=m*this.m_a1,b=m*this.m_a2;e.SubtractScaled(r,u),i-=l*_,s.AddScaled(h,u),n+=c*b}if(this.m_enableLimit){{const a=this.m_translation-this.m_lowerTranslation,m=o.b2Vec2.Dot(this.m_axis,o.b2Vec2.Subtract(s,e,o.b2Vec2.s_t0))+this.m_a2*n-this.m_a1*i;let d=-this.m_axialMass*(m+Math.max(a,0)*t.step.inv_dt);const p=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+d,0),d=this.m_lowerImpulse-p,o.b2Vec2.Scale(d,this.m_axis,u);const _=d*this.m_a1,b=d*this.m_a2;e.SubtractScaled(r,u),i-=l*_,s.AddScaled(h,u),n+=c*b}{const a=this.m_upperTranslation-this.m_translation,m=o.b2Vec2.Dot(this.m_axis,o.b2Vec2.Subtract(e,s,o.b2Vec2.s_t0))+this.m_a1*i-this.m_a2*n;let d=-this.m_axialMass*(m+Math.max(a,0)*t.step.inv_dt);const p=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+d,0),d=this.m_upperImpulse-p,o.b2Vec2.Scale(d,this.m_axis,u);const _=d*this.m_a1,b=d*this.m_a2;e.AddScaled(r,u),i+=l*_,s.SubtractScaled(h,u),n-=c*b}}{const t=o.b2Vec2.Dot(this.m_perp,o.b2Vec2.Subtract(s,e,o.b2Vec2.s_t0))+this.m_s2*n-this.m_s1*i,a=n-i;this.m_K.Solve(-t,-a,m),this.m_impulse.Add(m),o.b2Vec2.Scale(m.x,this.m_perp,u);const d=m.x*this.m_s1+m.y,p=m.x*this.m_s2+m.y;e.SubtractScaled(r,u),i-=l*d,s.AddScaled(h,u),n+=c*p}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:h,qB:l,lalcA:c,lalcB:u,rA:m,rB:d}=a;h.Set(i),l.Set(r);const p=this.m_invMassA,_=this.m_invMassB,b=this.m_invIA,y=this.m_invIB,{d:f,impulse:g,P:x}=a.SolvePositionConstraints;o.b2Rot.MultiplyVec2(h,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,c),m),o.b2Rot.MultiplyVec2(l,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),d),o.b2Vec2.Add(n,d,f).Subtract(e).Subtract(m);const v=o.b2Rot.MultiplyVec2(h,this.m_localXAxisA,this.m_axis),A=o.b2Vec2.Cross(o.b2Vec2.Add(f,m,o.b2Vec2.s_t0),v),w=o.b2Vec2.Cross(d,v),S=o.b2Rot.MultiplyVec2(h,this.m_localYAxisA,this.m_perp),C=o.b2Vec2.Cross(o.b2Vec2.Add(f,m,o.b2Vec2.s_t0),S),V=o.b2Vec2.Cross(d,S),B=o.b2Vec2.Dot(S,f),T=r-i-this.m_referenceAngle;let M=Math.abs(B);const I=Math.abs(T);let P=!1,E=0;if(this.m_enableLimit){const t=o.b2Vec2.Dot(v,f);Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*s.b2_linearSlop?(E=t,M=Math.max(M,Math.abs(t)),P=!0):t<=this.m_lowerTranslation?(E=Math.min(t-this.m_lowerTranslation,0),M=Math.max(M,this.m_lowerTranslation-t),P=!0):t>=this.m_upperTranslation&&(E=Math.max(t-this.m_upperTranslation,0),M=Math.max(M,t-this.m_upperTranslation),P=!0)}if(P){const t=p+_+b*C*C+y*V*V,e=b*C+y*V,i=b*C*A+y*V*w;let s=b+y;0===s&&(s=1);const n=b*A+y*w,o=p+_+b*A*A+y*w*w,r=a.K3;r.ex.Set(t,e,i),r.ey.Set(e,s,n),r.ez.Set(i,n,o),r.Solve33(-B,-T,-E,g)}else{const t=p+_+b*C*C+y*V*V,e=b*C+y*V;let i=b+y;0===i&&(i=1);const s=a.K2;s.ex.Set(t,e),s.ey.Set(e,i);const n=s.Solve(-B,-T,a.SolvePositionConstraints.impulse1);g.x=n.x,g.y=n.y,g.z=0}o.b2Vec2.Scale(g.x,S,x).AddScaled(g.z,v);const D=g.x*C+g.y+g.z*A,R=g.x*V+g.y+g.z*w;return e.SubtractScaled(p,x),i-=b*D,n.AddScaled(_,x),r+=y*R,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,M<=s.b2_linearSlop&&I<=s.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const i=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse;return e.x=t*(this.m_impulse.x*this.m_perp.x+i*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+i*this.m_axis.y),e}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const{pA:t,pB:e,axis:i,d:s}=a.GetJointTranslation;return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t),this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e),o.b2Vec2.Subtract(e,t,s),this.m_bodyA.GetWorldVector(this.m_localXAxisA,i),o.b2Vec2.Dot(s,i)}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB,{lalcA:i,lalcB:s,rA:n,rB:r}=a;o.b2Rot.MultiplyVec2(t.m_xf.q,o.b2Vec2.Subtract(this.m_localAnchorA,t.m_sweep.localCenter,i),n),o.b2Rot.MultiplyVec2(e.m_xf.q,o.b2Vec2.Subtract(this.m_localAnchorB,e.m_sweep.localCenter,s),r);const h=o.b2Vec2.Add(t.m_sweep.c,n,o.b2Vec2.s_t0),l=o.b2Vec2.Add(e.m_sweep.c,r,o.b2Vec2.s_t1),c=o.b2Vec2.Subtract(l,h,o.b2Vec2.s_t2),u=o.b2Rot.MultiplyVec2(t.m_xf.q,this.m_localXAxisA,this.m_axis),m=t.m_linearVelocity,d=e.m_linearVelocity,p=t.m_angularVelocity,_=e.m_angularVelocity;return o.b2Vec2.Dot(c,o.b2Vec2.CrossScalarVec2(p,u,o.b2Vec2.s_t0))+o.b2Vec2.Dot(u,o.b2Vec2.Subtract(o.b2Vec2.AddCrossScalarVec2(d,_,r,o.b2Vec2.s_t0),o.b2Vec2.AddCrossScalarVec2(m,p,n,o.b2Vec2.s_t1),o.b2Vec2.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Draw(t){const{p1:e,p2:i,pA:s,pB:r,axis:h}=a.Draw,l=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();if(o.b2Transform.MultiplyVec2(l,this.m_localAnchorA,s),o.b2Transform.MultiplyVec2(c,this.m_localAnchorB,r),o.b2Rot.MultiplyVec2(l.q,this.m_localXAxisA,h),t.DrawSegment(s,r,n.debugColors.joint5),this.m_enableLimit){const{lower:r,upper:c,perp:u}=a.Draw;o.b2Vec2.AddScaled(s,this.m_lowerTranslation,h,r),o.b2Vec2.AddScaled(s,this.m_upperTranslation,h,c),o.b2Rot.MultiplyVec2(l.q,this.m_localYAxisA,u),t.DrawSegment(r,c,n.debugColors.joint1),t.DrawSegment(o.b2Vec2.SubtractScaled(r,.5,u,e),o.b2Vec2.AddScaled(r,.5,u,i),n.debugColors.joint2),t.DrawSegment(o.b2Vec2.SubtractScaled(c,.5,u,e),o.b2Vec2.AddScaled(c,.5,u,i),n.debugColors.joint3)}else t.DrawSegment(o.b2Vec2.Subtract(s,h,e),o.b2Vec2.Add(s,h,i),n.debugColors.joint1);t.DrawPoint(s,5,n.debugColors.joint1),t.DrawPoint(r,5,n.debugColors.joint4)}}e.b2PrismaticJoint=l},2934:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2PulleyJoint=e.b2PulleyJointDef=e.b2_minPulleyLength=void 0;const s=i(2962),n=i(8991),o=i(6826),r=i(5773);e.b2_minPulleyLength=2;const a={qA:new o.b2Rot,qB:new o.b2Rot,lalcA:new o.b2Vec2,lalcB:new o.b2Vec2,p:new o.b2Vec2,PA:new o.b2Vec2,PB:new o.b2Vec2,vpA:new o.b2Vec2,vpB:new o.b2Vec2,pA:new o.b2Vec2,pB:new o.b2Vec2};class h extends r.b2JointDef{constructor(){super(r.b2JointType.e_pulleyJoint),this.groundAnchorA=new o.b2Vec2(-1,1),this.groundAnchorB=new o.b2Vec2(1,1),this.localAnchorA=new o.b2Vec2(-1,0),this.localAnchorB=new o.b2Vec2(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,e,i,s,n,r,a){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=o.b2Vec2.Distance(n,i),this.lengthB=o.b2Vec2.Distance(r,s),this.ratio=a}}e.b2PulleyJointDef=h;const l=new o.b2Vec2(-1,1),c=o.b2Vec2.UNITX,u=new o.b2Vec2(-1,0),m=o.b2Vec2.UNITX;class d extends r.b2Joint{constructor(t){var e,i,s,n,r,a,h;super(t),this.m_groundAnchorA=new o.b2Vec2,this.m_groundAnchorB=new o.b2Vec2,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new o.b2Vec2,this.m_uB=new o.b2Vec2,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_groundAnchorA.Copy(null!==(e=t.groundAnchorA)&&void 0!==e?e:l),this.m_groundAnchorB.Copy(null!==(i=t.groundAnchorB)&&void 0!==i?i:c),this.m_localAnchorA.Copy(null!==(s=t.localAnchorA)&&void 0!==s?s:u),this.m_localAnchorB.Copy(null!==(n=t.localAnchorB)&&void 0!==n?n:m),this.m_lengthA=null!==(r=t.lengthA)&&void 0!==r?r:0,this.m_lengthB=null!==(a=t.lengthB)&&void 0!==a?a:0,this.m_ratio=null!==(h=t.ratio)&&void 0!==h?h:1,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const h=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v;let u=t.velocities[this.m_indexB].w;const{qA:m,qB:d,lalcA:p,lalcB:_}=a;m.Set(i),d.Set(l),o.b2Rot.MultiplyVec2(m,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,p),this.m_rA),o.b2Rot.MultiplyVec2(d,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,_),this.m_rB),o.b2Vec2.Add(e,this.m_rA,this.m_uA).Subtract(this.m_groundAnchorA),o.b2Vec2.Add(h,this.m_rB,this.m_uB).Subtract(this.m_groundAnchorB);const b=this.m_uA.Length(),y=this.m_uB.Length();b>10*s.b2_linearSlop?this.m_uA.Scale(1/b):this.m_uA.SetZero(),y>10*s.b2_linearSlop?this.m_uB.Scale(1/y):this.m_uB.SetZero();const f=o.b2Vec2.Cross(this.m_rA,this.m_uA),g=o.b2Vec2.Cross(this.m_rB,this.m_uB),x=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=x+this.m_ratio*this.m_ratio*v,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const{PA:e,PB:i}=a;o.b2Vec2.Scale(-this.m_impulse,this.m_uA,e),o.b2Vec2.Scale(-this.m_ratio*this.m_impulse,this.m_uB,i),n.AddScaled(this.m_invMassA,e),r+=this.m_invIA*o.b2Vec2.Cross(this.m_rA,e),c.AddScaled(this.m_invMassB,i),u+=this.m_invIB*o.b2Vec2.Cross(this.m_rB,i)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const{PA:r,PB:h,vpA:l,vpB:c}=a;o.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,l),o.b2Vec2.AddCrossScalarVec2(s,n,this.m_rB,c);const u=-o.b2Vec2.Dot(this.m_uA,l)-this.m_ratio*o.b2Vec2.Dot(this.m_uB,c),m=-this.m_mass*u;this.m_impulse+=m,o.b2Vec2.Scale(-m,this.m_uA,r),o.b2Vec2.Scale(-this.m_ratio*m,this.m_uB,h),e.AddScaled(this.m_invMassA,r),i+=this.m_invIA*o.b2Vec2.Cross(this.m_rA,r),s.AddScaled(this.m_invMassB,h),n+=this.m_invIB*o.b2Vec2.Cross(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:h,qB:l,lalcA:c,lalcB:u,PA:m,PB:d}=a;h.Set(i),l.Set(r);const p=o.b2Rot.MultiplyVec2(h,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,c),this.m_rA),_=o.b2Rot.MultiplyVec2(l,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),this.m_rB),b=o.b2Vec2.Add(e,p,this.m_uA).Subtract(this.m_groundAnchorA),y=o.b2Vec2.Add(n,_,this.m_uB).Subtract(this.m_groundAnchorB),f=b.Length(),g=y.Length();f>10*s.b2_linearSlop?b.Scale(1/f):b.SetZero(),g>10*s.b2_linearSlop?y.Scale(1/g):y.SetZero();const x=o.b2Vec2.Cross(p,b),v=o.b2Vec2.Cross(_,y),A=this.m_invMassA+this.m_invIA*x*x,w=this.m_invMassB+this.m_invIB*v*v;let S=A+this.m_ratio*this.m_ratio*w;S>0&&(S=1/S);const C=this.m_constant-f-this.m_ratio*g,V=Math.abs(C),B=-S*C;return o.b2Vec2.Scale(-B,b,m),o.b2Vec2.Scale(-this.m_ratio*B,y,d),e.AddScaled(this.m_invMassA,m),i+=this.m_invIA*o.b2Vec2.Cross(p,m),n.AddScaled(this.m_invMassB,d),r+=this.m_invIB*o.b2Vec2.Cross(_,d),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,V<s.b2_linearSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,a.p),e=this.m_groundAnchorA;return o.b2Vec2.Distance(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,a.p),e=this.m_groundAnchorB;return o.b2Vec2.Distance(t,e)}ShiftOrigin(t){this.m_groundAnchorA.Subtract(t),this.m_groundAnchorB.Subtract(t)}Draw(t){const e=this.GetAnchorA(a.pA),i=this.GetAnchorB(a.pB),s=this.GetGroundAnchorA(),o=this.GetGroundAnchorB();t.DrawSegment(s,e,n.debugColors.joint6),t.DrawSegment(o,i,n.debugColors.joint6),t.DrawSegment(s,o,n.debugColors.joint6)}}e.b2PulleyJoint=d},8985:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2RevoluteJoint=e.b2RevoluteJointDef=void 0;const s=i(2962),n=i(8991),o=i(6826),r=i(5773),a={qA:new o.b2Rot,qB:new o.b2Rot,lalcA:new o.b2Vec2,lalcB:new o.b2Vec2,P:new o.b2Vec2,Cdot:new o.b2Vec2,C:new o.b2Vec2,impulse:new o.b2Vec2,p2:new o.b2Vec2,r:new o.b2Vec2,pA:new o.b2Vec2,pB:new o.b2Vec2,rlo:new o.b2Vec2,rhi:new o.b2Vec2};class h extends r.b2JointDef{constructor(){super(r.b2JointType.e_revoluteJoint),this.localAnchorA=new o.b2Vec2,this.localAnchorB=new o.b2Vec2,this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}e.b2RevoluteJointDef=h;class l extends r.b2Joint{constructor(t){var e,i,s,n,r,a,h,l,c;super(t),this.m_localAnchorA=new o.b2Vec2,this.m_localAnchorB=new o.b2Vec2,this.m_impulse=new o.b2Vec2,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.b2Vec2,this.m_rB=new o.b2Vec2,this.m_localCenterA=new o.b2Vec2,this.m_localCenterB=new o.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_K=new o.b2Mat22,this.m_angle=0,this.m_axialMass=0,this.m_localAnchorA.Copy(null!==(e=t.localAnchorA)&&void 0!==e?e:o.b2Vec2.ZERO),this.m_localAnchorB.Copy(null!==(i=t.localAnchorB)&&void 0!==i?i:o.b2Vec2.ZERO),this.m_referenceAngle=null!==(s=t.referenceAngle)&&void 0!==s?s:0,this.m_impulse.SetZero(),this.m_lowerAngle=null!==(n=t.lowerAngle)&&void 0!==n?n:0,this.m_upperAngle=null!==(r=t.upperAngle)&&void 0!==r?r:0,this.m_maxMotorTorque=null!==(a=t.maxMotorTorque)&&void 0!==a?a:0,this.m_motorSpeed=null!==(h=t.motorSpeed)&&void 0!==h?h:0,this.m_enableLimit=null!==(l=t.enableLimit)&&void 0!==l&&l,this.m_enableMotor=null!==(c=t.enableMotor)&&void 0!==c&&c}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const{qA:l,qB:c,lalcA:u,lalcB:m}=a;l.Set(e),c.Set(n),o.b2Rot.MultiplyVec2(l,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),o.b2Rot.MultiplyVec2(c,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB);const d=this.m_invMassA,p=this.m_invMassB,_=this.m_invIA,b=this.m_invIB;let y;if(this.m_K.ex.x=d+p+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*b,this.m_K.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*b,this.m_K.ex.y=this.m_K.ey.x,this.m_K.ey.y=d+p+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*b,this.m_axialMass=_+b,this.m_axialMass>0?(this.m_axialMass=1/this.m_axialMass,y=!1):y=!0,this.m_angle=n-e-this.m_referenceAngle,(!1===this.m_enableLimit||y)&&(this.m_lowerImpulse=0,this.m_upperImpulse=0),(!1===this.m_enableMotor||y)&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio,this.m_lowerImpulse*=t.step.dtRatio,this.m_upperImpulse*=t.step.dtRatio;const e=this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse,n=a.P.Set(this.m_impulse.x,this.m_impulse.y);i.SubtractScaled(d,n),s-=_*(o.b2Vec2.Cross(this.m_rA,n)+e),r.AddScaled(p,n),h+=b*(o.b2Vec2.Cross(this.m_rB,n)+e)}else this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,c=this.m_invIB,u=l+c===0;if(this.m_enableMotor&&!u){const e=n-i-this.m_motorSpeed;let s=-this.m_axialMass*e;const r=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=(0,o.b2Clamp)(this.m_motorImpulse+s,-a,a),s=this.m_motorImpulse-r,i-=l*s,n+=c*s}if(this.m_enableLimit&&!u){{const e=this.m_angle-this.m_lowerAngle,s=n-i;let o=-this.m_axialMass*(s+Math.max(e,0)*t.step.inv_dt);const r=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+o,0),o=this.m_lowerImpulse-r,i-=l*o,n+=c*o}{const e=this.m_upperAngle-this.m_angle,s=i-n;let o=-this.m_axialMass*(s+Math.max(e,0)*t.step.inv_dt);const r=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+o,0),o=this.m_upperImpulse-r,i+=l*o,n-=c*o}}{const{Cdot:t,impulse:u}=a;o.b2Vec2.Subtract(o.b2Vec2.AddCrossScalarVec2(s,n,this.m_rB,o.b2Vec2.s_t0),o.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,o.b2Vec2.s_t1),t),this.m_K.Solve(-t.x,-t.y,u),this.m_impulse.x+=u.x,this.m_impulse.y+=u.y,e.SubtractScaled(r,u),i-=l*o.b2Vec2.Cross(this.m_rA,u),s.AddScaled(h,u),n+=c*o.b2Vec2.Cross(this.m_rB,u)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const n=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const{qA:h,qB:l,lalcA:c,lalcB:u,impulse:m}=a;h.Set(i),l.Set(r);let d=0,p=0;const _=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&!_){const t=r-i-this.m_referenceAngle;let e=0;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*s.b2_angularSlop?e=(0,o.b2Clamp)(t-this.m_lowerAngle,-s.b2_maxAngularCorrection,s.b2_maxAngularCorrection):t<=this.m_lowerAngle?e=(0,o.b2Clamp)(t-this.m_lowerAngle+s.b2_angularSlop,-s.b2_maxAngularCorrection,0):t>=this.m_upperAngle&&(e=(0,o.b2Clamp)(t-this.m_upperAngle-s.b2_angularSlop,0,s.b2_maxAngularCorrection));const n=-this.m_axialMass*e;i-=this.m_invIA*n,r+=this.m_invIB*n,d=Math.abs(e)}{h.Set(i),l.Set(r);const t=o.b2Rot.MultiplyVec2(h,o.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,c),this.m_rA),s=o.b2Rot.MultiplyVec2(l,o.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),this.m_rB),d=o.b2Vec2.Add(n,s,a.C).Subtract(e).Subtract(t);p=d.Length();const _=this.m_invMassA,b=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,g=this.m_K;g.ex.x=_+b+y*t.y*t.y+f*s.y*s.y,g.ex.y=-y*t.x*t.y-f*s.x*s.y,g.ey.x=g.ex.y,g.ey.y=_+b+y*t.x*t.x+f*s.x*s.x,g.Solve(d.x,d.y,m).Negate(),e.SubtractScaled(_,m),i-=y*o.b2Vec2.Cross(t,m),n.AddScaled(b,m),r+=f*o.b2Vec2.Cross(s,m)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,p<=s.b2_linearSlop&&d<=s.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*(this.m_motorImpulse+this.m_lowerImpulse-this.m_upperImpulse)}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}Draw(t){const{p2:e,r:i,pA:s,pB:r}=a,h=this.m_bodyA.GetTransform(),l=this.m_bodyB.GetTransform();o.b2Transform.MultiplyVec2(h,this.m_localAnchorA,s),o.b2Transform.MultiplyVec2(l,this.m_localAnchorB,r),t.DrawPoint(s,5,n.debugColors.joint4),t.DrawPoint(r,5,n.debugColors.joint5);const c=this.m_bodyA.GetAngle(),u=this.m_bodyB.GetAngle()-c-this.m_referenceAngle,m=.5;if(i.Set(Math.cos(u),Math.sin(u)).Scale(m),t.DrawSegment(r,o.b2Vec2.Add(r,i,e),n.debugColors.joint1),t.DrawCircle(r,m,n.debugColors.joint1),this.m_enableLimit){const{rlo:i,rhi:s}=a;i.Set(Math.cos(this.m_lowerAngle),Math.sin(this.m_lowerAngle)).Scale(m),s.Set(Math.cos(this.m_upperAngle),Math.sin(this.m_upperAngle)).Scale(m),t.DrawSegment(r,o.b2Vec2.Add(r,i,e),n.debugColors.joint2),t.DrawSegment(r,o.b2Vec2.Add(r,s,e),n.debugColors.joint3)}t.DrawSegment(h.p,s,n.debugColors.joint6),t.DrawSegment(s,r,n.debugColors.joint6),t.DrawSegment(l.p,r,n.debugColors.joint6)}}e.b2RevoluteJoint=l},6174:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2SolverData=e.b2Velocity=e.b2Position=e.b2TimeStep=e.b2Profile=void 0;const s=i(6826);e.b2Profile=class{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}};class n{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.config={velocityIterations:0,positionIterations:0},this.warmStarting=!1}static Create(){return new n}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.config={...t.config},this.warmStarting=t.warmStarting,this}}e.b2TimeStep=n,e.b2Position=class{constructor(){this.c=new s.b2Vec2,this.a=0}},e.b2Velocity=class{constructor(){this.v=new s.b2Vec2,this.w=0}},e.b2SolverData=class{constructor(){this.step=n.Create()}}},4006:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2WeldJoint=e.b2WeldJointDef=void 0;const s=i(2962),n=i(6826),o=i(5773),r={qA:new n.b2Rot,qB:new n.b2Rot,rA:new n.b2Vec2,rB:new n.b2Vec2,lalcA:new n.b2Vec2,lalcB:new n.b2Vec2,K:new n.b2Mat33,P:new n.b2Vec2,Cdot1:new n.b2Vec3,impulse1:new n.b2Vec2,impulse:new n.b2Vec3,C1:new n.b2Vec2,C:new n.b2Vec3};class a extends o.b2JointDef{constructor(){super(o.b2JointType.e_weldJoint),this.localAnchorA=new n.b2Vec2,this.localAnchorB=new n.b2Vec2,this.referenceAngle=0,this.stiffness=0,this.damping=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}e.b2WeldJointDef=a;class h extends o.b2Joint{constructor(t){var e,i,s,o,r;super(t),this.m_stiffness=0,this.m_damping=0,this.m_bias=0,this.m_localAnchorA=new n.b2Vec2,this.m_localAnchorB=new n.b2Vec2,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new n.b2Vec3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new n.b2Vec2,this.m_rB=new n.b2Vec2,this.m_localCenterA=new n.b2Vec2,this.m_localCenterB=new n.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new n.b2Mat33,this.m_localAnchorA.Copy(null!==(e=t.localAnchorA)&&void 0!==e?e:n.b2Vec2.ZERO),this.m_localAnchorB.Copy(null!==(i=t.localAnchorB)&&void 0!==i?i:n.b2Vec2.ZERO),this.m_referenceAngle=null!==(s=t.referenceAngle)&&void 0!==s?s:0,this.m_stiffness=null!==(o=t.stiffness)&&void 0!==o?o:0,this.m_damping=null!==(r=t.damping)&&void 0!==r?r:0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const{qA:l,qB:c,lalcA:u,lalcB:m,K:d}=r;l.Set(e),c.Set(o),n.b2Rot.MultiplyVec2(l,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,u),this.m_rA),n.b2Rot.MultiplyVec2(c,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,m),this.m_rB);const p=this.m_invMassA,_=this.m_invMassB,b=this.m_invIA,y=this.m_invIB;if(d.ex.x=p+_+this.m_rA.y*this.m_rA.y*b+this.m_rB.y*this.m_rB.y*y,d.ey.x=-this.m_rA.y*this.m_rA.x*b-this.m_rB.y*this.m_rB.x*y,d.ez.x=-this.m_rA.y*b-this.m_rB.y*y,d.ex.y=d.ey.x,d.ey.y=p+_+this.m_rA.x*this.m_rA.x*b+this.m_rB.x*this.m_rB.x*y,d.ez.y=this.m_rA.x*b+this.m_rB.x*y,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=b+y,this.m_stiffness>0){d.GetInverse22(this.m_mass);let i=b+y;const s=o-e-this.m_referenceAngle,n=this.m_damping,r=this.m_stiffness,a=t.step.dt;this.m_gamma=a*(n+a*r),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=s*a*r*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else 0===d.ez.z?(d.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(d.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.step.warmStarting){this.m_impulse.Scale(t.step.dtRatio);const{P:e}=r;e.Copy(this.m_impulse),i.SubtractScaled(p,e),s-=b*(n.b2Vec2.Cross(this.m_rA,e)+this.m_impulse.z),a.AddScaled(_,e),h+=y*(n.b2Vec2.Cross(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let o=t.velocities[this.m_indexB].w;const a=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,c=this.m_invIB;if(this.m_stiffness>0){const t=o-i,u=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,i-=l*u,o+=c*u;const{Cdot1:m,impulse1:d}=r;n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,n.b2Vec2.s_t1),m),n.b2Mat33.MultiplyVec2(this.m_mass,m,d).Negate(),this.m_impulse.x+=d.x,this.m_impulse.y+=d.y;const p=d;e.SubtractScaled(a,p),i-=l*n.b2Vec2.Cross(this.m_rA,p),s.AddScaled(h,p),o+=c*n.b2Vec2.Cross(this.m_rB,p)}else{const{Cdot1:t,impulse:u,P:m}=r;n.b2Vec2.Subtract(n.b2Vec2.AddCrossScalarVec2(s,o,this.m_rB,n.b2Vec2.s_t0),n.b2Vec2.AddCrossScalarVec2(e,i,this.m_rA,n.b2Vec2.s_t1),t),t.z=o-i,n.b2Mat33.MultiplyVec3(this.m_mass,t,u).Negate(),this.m_impulse.Add(u),m.Set(u.x,u.y),e.SubtractScaled(a,m),i-=l*(n.b2Vec2.Cross(this.m_rA,m)+u.z),s.AddScaled(h,m),o+=c*(n.b2Vec2.Cross(this.m_rB,m)+u.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=o}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const o=t.positions[this.m_indexB].c;let a=t.positions[this.m_indexB].a;const{qA:h,qB:l,lalcA:c,lalcB:u,K:m,C1:d,P:p,rA:_,rB:b}=r;h.Set(i),l.Set(a);const y=this.m_invMassA,f=this.m_invMassB,g=this.m_invIA,x=this.m_invIB;let v,A;if(n.b2Rot.MultiplyVec2(h,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,c),_),n.b2Rot.MultiplyVec2(l,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,u),b),m.ex.x=y+f+_.y*_.y*g+b.y*b.y*x,m.ey.x=-_.y*_.x*g-b.y*b.x*x,m.ez.x=-_.y*g-b.y*x,m.ex.y=m.ey.x,m.ey.y=y+f+_.x*_.x*g+b.x*b.x*x,m.ez.y=_.x*g+b.x*x,m.ex.z=m.ez.x,m.ey.z=m.ez.y,m.ez.z=g+x,this.m_stiffness>0)n.b2Vec2.Add(o,b,d).Subtract(e).Subtract(_),v=d.Length(),A=0,m.Solve22(d.x,d.y,p).Negate(),e.SubtractScaled(y,p),i-=g*n.b2Vec2.Cross(_,p),o.AddScaled(f,p),a+=x*n.b2Vec2.Cross(b,p);else{n.b2Vec2.Add(o,b,d).Subtract(e).Subtract(_),n.b2Vec2.Subtract(n.b2Vec2.Add(o,b,n.b2Vec2.s_t0),n.b2Vec2.Add(e,_,n.b2Vec2.s_t1),d);const t=a-i-this.m_referenceAngle;v=d.Length(),A=Math.abs(t);const{impulse:s,C:h}=r;h.Set(d.x,d.y,t),m.ez.z>0?m.Solve33(h.x,h.y,h.z,s).Negate():(m.Solve22(d.x,d.y,s).Negate(),s.z=0),p.Copy(s),e.SubtractScaled(y,p),i-=g*(n.b2Vec2.Cross(_,p)+s.z),o.AddScaled(f,p),a+=x*(n.b2Vec2.Cross(b,p)+s.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,v<=s.b2_linearSlop&&A<=s.b2_angularSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}}e.b2WeldJoint=h},2924:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2WheelJoint=e.b2WheelJointDef=void 0;const s=i(2962),n=i(6826),o=i(5773),r=i(8991),a={qA:new n.b2Rot,qB:new n.b2Rot,lalcA:new n.b2Vec2,lalcB:new n.b2Vec2,rA:new n.b2Vec2,rB:new n.b2Vec2,d:new n.b2Vec2,P:new n.b2Vec2,ay:new n.b2Vec2,pA:new n.b2Vec2,pB:new n.b2Vec2,axis:new n.b2Vec2,Draw:{p1:new n.b2Vec2,p2:new n.b2Vec2,pA:new n.b2Vec2,pB:new n.b2Vec2,axis:new n.b2Vec2,lower:new n.b2Vec2,upper:new n.b2Vec2,perp:new n.b2Vec2}};class h extends o.b2JointDef{constructor(){super(o.b2JointType.e_wheelJoint),this.localAnchorA=new n.b2Vec2,this.localAnchorB=new n.b2Vec2,this.localAxisA=new n.b2Vec2(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.stiffness=0,this.damping=0}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}}e.b2WheelJointDef=h;class l extends o.b2Joint{constructor(t){var e,i,s,o,r,a,h,l,c,u,m;super(t),this.m_localAnchorA=new n.b2Vec2,this.m_localAnchorB=new n.b2Vec2,this.m_localXAxisA=new n.b2Vec2,this.m_localYAxisA=new n.b2Vec2,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0,this.m_translation=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_stiffness=0,this.m_damping=0,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new n.b2Vec2,this.m_localCenterB=new n.b2Vec2,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new n.b2Vec2,this.m_ay=new n.b2Vec2,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_axialMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_localAnchorA.Copy(null!==(e=t.localAnchorA)&&void 0!==e?e:n.b2Vec2.ZERO),this.m_localAnchorB.Copy(null!==(i=t.localAnchorB)&&void 0!==i?i:n.b2Vec2.ZERO),this.m_localXAxisA.Copy(null!==(s=t.localAxisA)&&void 0!==s?s:n.b2Vec2.UNITX),n.b2Vec2.CrossOneVec2(this.m_localXAxisA,this.m_localYAxisA),this.m_lowerTranslation=null!==(o=t.lowerTranslation)&&void 0!==o?o:0,this.m_upperTranslation=null!==(r=t.upperTranslation)&&void 0!==r?r:0,this.m_enableLimit=null!==(a=t.enableLimit)&&void 0!==a&&a,this.m_maxMotorTorque=null!==(h=t.maxMotorTorque)&&void 0!==h?h:0,this.m_motorSpeed=null!==(l=t.motorSpeed)&&void 0!==l?l:0,this.m_enableMotor=null!==(c=t.enableMotor)&&void 0!==c&&c,this.m_ax.SetZero(),this.m_ay.SetZero(),this.m_stiffness=null!==(u=t.stiffness)&&void 0!==u?u:0,this.m_damping=null!==(m=t.damping)&&void 0!==m?m:0}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetStiffness(t){this.m_stiffness=t}GetStiffness(){return this.m_stiffness}SetDamping(t){this.m_damping=t}GetDamping(){return this.m_damping}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,r=t.positions[this.m_indexA].c,h=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const u=t.positions[this.m_indexB].c,m=t.positions[this.m_indexB].a,d=t.velocities[this.m_indexB].v;let p=t.velocities[this.m_indexB].w;const{qA:_,qB:b,lalcA:y,lalcB:f,rA:g,rB:x,d:v}=a;_.Set(h),b.Set(m),n.b2Rot.MultiplyVec2(_,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,y),g),n.b2Rot.MultiplyVec2(b,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,f),x),n.b2Vec2.Add(u,x,v).Subtract(r).Subtract(g),n.b2Rot.MultiplyVec2(_,this.m_localYAxisA,this.m_ay),this.m_sAy=n.b2Vec2.Cross(n.b2Vec2.Add(v,g,n.b2Vec2.s_t0),this.m_ay),this.m_sBy=n.b2Vec2.Cross(x,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),n.b2Rot.MultiplyVec2(_,this.m_localXAxisA,this.m_ax),this.m_sAx=n.b2Vec2.Cross(n.b2Vec2.Add(v,g,n.b2Vec2.s_t0),this.m_ax),this.m_sBx=n.b2Vec2.Cross(x,this.m_ax);const A=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(this.m_axialMass=A>0?1/A:0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_stiffness>0&&A>0){this.m_springMass=1/A;const e=n.b2Vec2.Dot(v,this.m_ax),i=t.step.dt;this.m_gamma=i*(this.m_damping+i*this.m_stiffness),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*i*this.m_stiffness*this.m_gamma,this.m_springMass=A+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}else this.m_springImpulse=0;if(this.m_enableLimit?this.m_translation=n.b2Vec2.Dot(this.m_ax,v):(this.m_lowerImpulse=0,this.m_upperImpulse=0),this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const e=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse,{P:i}=a;n.b2Vec2.Scale(this.m_impulse,this.m_ay,i).AddScaled(e,this.m_ax);const s=this.m_impulse*this.m_sAy+e*this.m_sAx+this.m_motorImpulse,o=this.m_impulse*this.m_sBy+e*this.m_sBx+this.m_motorImpulse;l.SubtractScaled(this.m_invMassA,i),c-=this.m_invIA*s,d.AddScaled(this.m_invMassB,i),p+=this.m_invIB*o}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0,this.m_lowerImpulse=0,this.m_upperImpulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=p}SolveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,r=t.velocities[this.m_indexA].v;let h=t.velocities[this.m_indexA].w;const l=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const{P:u}=a;{const t=n.b2Vec2.Dot(this.m_ax,n.b2Vec2.Subtract(l,r,n.b2Vec2.s_t0))+this.m_sBx*c-this.m_sAx*h,a=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=a,n.b2Vec2.Scale(a,this.m_ax,u);const m=a*this.m_sAx,d=a*this.m_sBx;r.SubtractScaled(e,u),h-=s*m,l.AddScaled(i,u),c+=o*d}{const e=c-h-this.m_motorSpeed;let i=-this.m_motorMass*e;const r=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=(0,n.b2Clamp)(this.m_motorImpulse+i,-a,a),i=this.m_motorImpulse-r,h-=s*i,c+=o*i}if(this.m_enableLimit){{const a=this.m_translation-this.m_lowerTranslation,m=n.b2Vec2.Dot(this.m_ax,n.b2Vec2.Subtract(l,r,n.b2Vec2.s_t0))+this.m_sBx*c-this.m_sAx*h;let d=-this.m_axialMass*(m+Math.max(a,0)*t.step.inv_dt);const p=this.m_lowerImpulse;this.m_lowerImpulse=Math.max(this.m_lowerImpulse+d,0),d=this.m_lowerImpulse-p,n.b2Vec2.Scale(d,this.m_ax,u);const _=d*this.m_sAx,b=d*this.m_sBx;r.SubtractScaled(e,u),h-=s*_,l.AddScaled(i,u),c+=o*b}{const a=this.m_upperTranslation-this.m_translation,m=n.b2Vec2.Dot(this.m_ax,n.b2Vec2.Subtract(r,l,n.b2Vec2.s_t0))+this.m_sAx*h-this.m_sBx*c;let d=-this.m_axialMass*(m+Math.max(a,0)*t.step.inv_dt);const p=this.m_upperImpulse;this.m_upperImpulse=Math.max(this.m_upperImpulse+d,0),d=this.m_upperImpulse-p,n.b2Vec2.Scale(d,this.m_ax,u);const _=d*this.m_sAx,b=d*this.m_sBx;r.AddScaled(e,u),h+=s*_,l.SubtractScaled(i,u),c-=o*b}}{const t=n.b2Vec2.Dot(this.m_ay,n.b2Vec2.Subtract(l,r,n.b2Vec2.s_t0))+this.m_sBy*c-this.m_sAy*h,a=-this.m_mass*t;this.m_impulse+=a,n.b2Vec2.Scale(a,this.m_ay,u);const m=a*this.m_sAy,d=a*this.m_sBy;r.SubtractScaled(e,u),h-=s*m,l.AddScaled(i,u),c+=o*d}t.velocities[this.m_indexA].w=h,t.velocities[this.m_indexB].w=c}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const o=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a,h=0;const{qA:l,qB:c,lalcA:u,lalcB:m,rA:d,rB:p,d:_,P:b,ay:y}=a;if(this.m_enableLimit){l.Set(i),c.Set(r),n.b2Rot.MultiplyVec2(l,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,u),d),n.b2Rot.MultiplyVec2(c,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,m),p),n.b2Vec2.Subtract(o,e,_).Add(p).Subtract(d);const t=n.b2Rot.MultiplyVec2(l,this.m_localXAxisA,this.m_ax),a=n.b2Vec2.Cross(n.b2Vec2.Add(_,d,n.b2Vec2.s_t0),this.m_ax),y=n.b2Vec2.Cross(p,this.m_ax);let f=0;const g=n.b2Vec2.Dot(t,_);if(Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*s.b2_linearSlop?f=g:g<=this.m_lowerTranslation?f=Math.min(g-this.m_lowerTranslation,0):g>=this.m_upperTranslation&&(f=Math.max(g-this.m_upperTranslation,0)),0!==f){const s=this.m_invMassA+this.m_invMassB+this.m_invIA*a*a+this.m_invIB*y*y;let l=0;0!==s&&(l=-f/s),n.b2Vec2.Scale(l,t,b);const c=l*a,u=l*y;e.SubtractScaled(this.m_invMassA,b),i-=this.m_invIA*c,o.AddScaled(this.m_invMassB,b),r+=this.m_invIB*u,h=Math.abs(f)}}{l.Set(i),c.Set(r),n.b2Rot.MultiplyVec2(l,n.b2Vec2.Subtract(this.m_localAnchorA,this.m_localCenterA,u),d),n.b2Rot.MultiplyVec2(c,n.b2Vec2.Subtract(this.m_localAnchorB,this.m_localCenterB,m),p),n.b2Vec2.Subtract(o,e,_).Add(p).Subtract(d),n.b2Rot.MultiplyVec2(l,this.m_localYAxisA,y);const t=n.b2Vec2.Cross(n.b2Vec2.Add(_,d,n.b2Vec2.s_t0),y),s=n.b2Vec2.Cross(p,y),a=n.b2Vec2.Dot(_,y),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let g=0;0!==f&&(g=-a/f),n.b2Vec2.Scale(g,y,b);const x=g*t,v=g*s;e.SubtractScaled(this.m_invMassA,b),i-=this.m_invIA*x,o.AddScaled(this.m_invMassB,b),r+=this.m_invIB*v,h=Math.max(h,Math.abs(a))}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,h<=s.b2_linearSlop}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){const i=this.m_springImpulse+this.m_lowerImpulse-this.m_upperImpulse;return e.x=t*(this.m_impulse*this.m_ay.x+i*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+i*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,{pA:i,pB:s,d:o,axis:r}=a;return t.GetWorldPoint(this.m_localAnchorA,i),e.GetWorldPoint(this.m_localAnchorB,s),n.b2Vec2.Subtract(s,i,o),t.GetWorldVector(this.m_localXAxisA,r),n.b2Vec2.Dot(o,r)}GetJointLinearSpeed(){const t=this.m_bodyA,e=this.m_bodyB,{rA:i,rB:s,lalcA:o,lalcB:r,axis:h}=a;n.b2Rot.MultiplyVec2(t.m_xf.q,n.b2Vec2.Subtract(this.m_localAnchorA,t.m_sweep.localCenter,o),i),n.b2Rot.MultiplyVec2(e.m_xf.q,n.b2Vec2.Subtract(this.m_localAnchorB,e.m_sweep.localCenter,r),s);const l=n.b2Vec2.Add(t.m_sweep.c,i,n.b2Vec2.s_t0),c=n.b2Vec2.Add(e.m_sweep.c,s,n.b2Vec2.s_t1),u=n.b2Vec2.Subtract(c,l,n.b2Vec2.s_t2);n.b2Rot.MultiplyVec2(t.m_xf.q,this.m_localXAxisA,h);const m=t.m_linearVelocity,d=e.m_linearVelocity,p=t.m_angularVelocity,_=e.m_angularVelocity;return n.b2Vec2.Dot(u,n.b2Vec2.CrossScalarVec2(p,h,n.b2Vec2.s_t0))+n.b2Vec2.Dot(h,n.b2Vec2.AddCrossScalarVec2(d,_,s,n.b2Vec2.s_t0).Subtract(m).Subtract(n.b2Vec2.CrossScalarVec2(p,i,n.b2Vec2.s_t1)))}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetJointAngularSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){return t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t),t}SetMotorSpeed(t){return t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t),t}SetMaxMotorTorque(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}GetMotorTorque(t){return t*this.m_motorImpulse}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){return t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_lowerImpulse=0,this.m_upperImpulse=0),t}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_lowerImpulse=0,this.m_upperImpulse=0)}Draw(t){const{p1:e,p2:i,pA:s,pB:o,axis:h}=a.Draw,l=this.m_bodyA.GetTransform(),c=this.m_bodyB.GetTransform();if(n.b2Transform.MultiplyVec2(l,this.m_localAnchorA,s),n.b2Transform.MultiplyVec2(c,this.m_localAnchorB,o),n.b2Rot.MultiplyVec2(l.q,this.m_localXAxisA,h),t.DrawSegment(s,o,r.debugColors.joint5),this.m_enableLimit){const{lower:o,upper:c,perp:u}=a.Draw;n.b2Vec2.AddScaled(s,this.m_lowerTranslation,h,o),n.b2Vec2.AddScaled(s,this.m_upperTranslation,h,c),n.b2Rot.MultiplyVec2(l.q,this.m_localYAxisA,u),t.DrawSegment(o,c,r.debugColors.joint1),t.DrawSegment(n.b2Vec2.SubtractScaled(o,.5,u,e),n.b2Vec2.AddScaled(o,.5,u,i),r.debugColors.joint2),t.DrawSegment(n.b2Vec2.SubtractScaled(c,.5,u,e),n.b2Vec2.AddScaled(c,.5,u,i),r.debugColors.joint3)}else t.DrawSegment(n.b2Vec2.Subtract(s,h,e),n.b2Vec2.Add(s,h,i),r.debugColors.joint1);t.DrawPoint(s,5,r.debugColors.joint1),t.DrawPoint(o,5,r.debugColors.joint4)}}e.b2WheelJoint=l},3698:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2World=void 0;const s=i(2962),n=i(6826),o=i(2026),r=i(2472),a=i(5608),h=i(5773),l=i(4143),c=i(5354),u=i(9566),m=i(5731),d=i(620),p=i(2493),_=i(639),b=i(2934),y=i(8985),f=i(4006),g=i(2924),x=i(3910),v=i(4361),A=i(6166),w=i(6174);class S{constructor(t){this.m_contactManager=new v.b2ContactManager,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new n.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_inv_dt0=0,this.m_newContacts=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new w.b2Profile,this.m_island=new A.b2Island(2*s.b2_maxTOIContacts,s.b2_maxTOIContacts,0,this.m_contactManager.m_contactListener),this.s_stack=[],this.m_gravity.Copy(t)}static Create(t){return new S(t)}SetDestructionListener(t){this.m_destructionListener=t}GetDestructionListener(){return this.m_destructionListener}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t,this.m_island.m_listener=t}CreateBody(t={}){(0,s.b2Assert)(!this.IsLocked());const e=new x.b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){var e,i;(0,s.b2Assert)(!this.IsLocked());let n=t.m_jointList;for(;n;){const i=n;n=n.next,null===(e=this.m_destructionListener)||void 0===e||e.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=n}t.m_jointList=null;let o=t.m_contactList;for(;o;){const t=o;o=o.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;const r=this.m_contactManager.m_broadPhase;let a=t.m_fixtureList;for(;a;){const e=a;a=a.m_next,null===(i=this.m_destructionListener)||void 0===i||i.SayGoodbyeFixture(e),e.DestroyProxies(r),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}static Joint_Create(t){switch(t.type){case h.b2JointType.e_distanceJoint:return new c.b2DistanceJoint(t);case h.b2JointType.e_mouseJoint:return new p.b2MouseJoint(t);case h.b2JointType.e_prismaticJoint:return new _.b2PrismaticJoint(t);case h.b2JointType.e_revoluteJoint:return new y.b2RevoluteJoint(t);case h.b2JointType.e_pulleyJoint:return new b.b2PulleyJoint(t);case h.b2JointType.e_gearJoint:return new m.b2GearJoint(t);case h.b2JointType.e_wheelJoint:return new g.b2WheelJoint(t);case h.b2JointType.e_weldJoint:return new f.b2WeldJoint(t);case h.b2JointType.e_frictionJoint:return new u.b2FrictionJoint(t);case h.b2JointType.e_motorJoint:return new d.b2MotorJoint(t);case h.b2JointType.e_areaJoint:return new l.b2AreaJoint(t)}throw new Error}CreateJoint(t){(0,s.b2Assert)(!this.IsLocked());const e=S.Joint_Create(t);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const i=e.m_bodyA,n=e.m_bodyB;if(!t.collideConnected){let t=n.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}return e}DestroyJoint(t){(0,s.b2Assert)(!this.IsLocked()),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const e=t.m_bodyA,i=t.m_bodyB,n=t.m_collideConnected;if(e.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!n){let t=i.GetContactList();for(;t;)t.other===e&&t.contact.FlagForFiltering(),t=t.next}}Step(t,e){const i=S.Step_s_stepTimer.Reset();this.m_newContacts&&(this.m_contactManager.FindNewContacts(),this.m_newContacts=!1),this.m_locked=!0;const s=S.Step_s_step;s.dt=t,s.config={...e},s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting;{const t=S.Step_s_timer.Reset();this.m_contactManager.Collide(),this.m_profile.collide=t.GetMilliseconds()}if(this.m_stepComplete&&s.dt>0){const t=S.Step_s_timer.Reset();this.Solve(s),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){const t=S.Step_s_timer.Reset();this.SolveTOI(s),this.m_profile.solveTOI=t.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=i.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.GetNext())t.m_force.SetZero(),t.m_torque=0}QueryAABB(t,e){this.m_contactManager.m_broadPhase.Query(t,(t=>{const i=(0,s.b2Verify)(t.userData);return e(i.fixture)}))}QueryAllAABB(t,e=[]){return this.QueryAABB(t,(t=>(e.push(t),!0))),e}QueryPointAABB(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,(t=>{const i=(0,s.b2Verify)(t.userData);return e(i.fixture)}))}QueryAllPointAABB(t,e=[]){return this.QueryPointAABB(t,(t=>(e.push(t),!0))),e}QueryFixtureShape(t,e,i,n){const o=S.QueryFixtureShape_s_aabb;t.ComputeAABB(o,i,e),this.m_contactManager.m_broadPhase.Query(o,(o=>{const a=(0,s.b2Verify)(o.userData),{fixture:h}=a;return!(0,r.b2TestOverlap)(t,e,h.GetShape(),a.childIndex,i,h.GetBody().GetTransform())||n(h)}))}QueryAllFixtureShape(t,e,i,s=[]){return this.QueryFixtureShape(t,e,i,(t=>(s.push(t),!0))),s}QueryFixturePoint(t,e){this.m_contactManager.m_broadPhase.QueryPoint(t,(i=>{const n=(0,s.b2Verify)(i.userData),{fixture:o}=n;return!o.TestPoint(t)||e(o)}))}QueryAllFixturePoint(t,e=[]){return this.QueryFixturePoint(t,(t=>(e.push(t),!0))),e}RayCast(t,e,i){const n=S.RayCast_s_input;n.maxFraction=1,n.p1.Copy(t),n.p2.Copy(e),this.m_contactManager.m_broadPhase.RayCast(n,((n,o)=>{const r=(0,s.b2Verify)(o.userData),{fixture:a}=r,h=r.childIndex,l=S.RayCast_s_output;if(a.RayCast(l,n,h)){const{fraction:s}=l,n=S.RayCast_s_point;return n.Set((1-s)*t.x+s*e.x,(1-s)*t.y+s*e.y),i(a,n,l.normal,s)}return n.maxFraction}))}RayCastOne(t,e){let i=null,s=1;return this.RayCast(t,e,((t,e,n,o)=>(o<s&&(s=o,i=t),s))),i}RayCastAll(t,e,i=[]){return this.RayCast(t,e,(t=>(i.push(t),1))),i}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t){this.m_gravity.Copy(t)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){(0,s.b2Assert)(!this.IsLocked());for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.Subtract(t),e.m_sweep.c0.Subtract(t),e.m_sweep.c.Subtract(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Solve(t){this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Resize(this.m_bodyCount),e.Clear();for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.s_stack;for(let n=this.m_bodyList;n;n=n.m_next){if(n.m_islandFlag)continue;if(!n.IsAwake()||!n.IsEnabled())continue;if(n.GetType()===x.b2BodyType.b2_staticBody)continue;e.Clear();let o=0;for(i[o++]=n,n.m_islandFlag=!0;o>0;){const t=i[--o];if((0,s.b2Assert)(null!==t),e.AddBody(t),t.GetType()!==x.b2BodyType.b2_staticBody){t.m_awakeFlag=!0;for(let s=t.m_contactList;s;s=s.next){const{contact:t}=s;if(t.m_islandFlag)continue;if(!t.IsEnabled()||!t.IsTouching())continue;const n=t.m_fixtureA.m_isSensor,r=t.m_fixtureB.m_isSensor;if(n||r)continue;e.AddContact(t),t.m_islandFlag=!0;const{other:a}=s;a.m_islandFlag||(i[o++]=a,a.m_islandFlag=!0)}for(let s=t.m_jointList;s;s=s.next){if(s.joint.m_islandFlag)continue;const{other:t}=s;t.IsEnabled()&&(e.AddJoint(s.joint),s.joint.m_islandFlag=!0,t.m_islandFlag||(i[o++]=t,t.m_islandFlag=!0))}}}const r=new w.b2Profile;e.Solve(r,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=r.solveInit,this.m_profile.solveVelocity+=r.solveVelocity,this.m_profile.solvePosition+=r.solvePosition;for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];i.GetType()===x.b2BodyType.b2_staticBody&&(i.m_islandFlag=!1)}}for(let t=0;t<i.length&&i[t];++t)i[t]=null;const n=new o.b2Timer;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==x.b2BodyType.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=n.GetMilliseconds()}SolveTOI(t){const e=this.m_island;if(e.Clear(),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let i=null,n=1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next){if(!t.IsEnabled())continue;if(t.m_toiCount>s.b2_maxSubSteps)continue;let e=1;if(t.m_toiFlag)e=t.m_toi;else{const i=t.GetFixtureA(),s=t.GetFixtureB();if(i.IsSensor()||s.IsSensor())continue;const n=i.GetBody(),o=s.GetBody(),r=n.m_type,h=o.m_type,l=n.IsAwake()&&r!==x.b2BodyType.b2_staticBody,c=o.IsAwake()&&h!==x.b2BodyType.b2_staticBody;if(!l&&!c)continue;const u=n.IsBullet()||r!==x.b2BodyType.b2_dynamicBody,m=o.IsBullet()||h!==x.b2BodyType.b2_dynamicBody;if(!u&&!m)continue;let{alpha0:d}=n.m_sweep;n.m_sweep.alpha0<o.m_sweep.alpha0?(d=o.m_sweep.alpha0,n.m_sweep.Advance(d)):o.m_sweep.alpha0<n.m_sweep.alpha0&&(d=n.m_sweep.alpha0,o.m_sweep.Advance(d));const p=t.GetChildIndexA(),_=t.GetChildIndexB(),b=S.SolveTOI_s_toi_input;b.proxyA.SetShape(i.GetShape(),p),b.proxyB.SetShape(s.GetShape(),_),b.sweepA.Copy(n.m_sweep),b.sweepB.Copy(o.m_sweep),b.tMax=1;const y=S.SolveTOI_s_toi_output;(0,a.b2TimeOfImpact)(y,b);const f=y.t;e=y.state===a.b2TOIOutputState.e_touching?Math.min(d+(1-d)*f,1):1,t.m_toi=e,t.m_toiFlag=!0}e<n&&(i=t,n=e)}if(null===i||1-10*s.b2_epsilon<n){this.m_stepComplete=!0;break}const o=i.GetFixtureA(),r=i.GetFixtureB(),h=o.GetBody(),l=r.GetBody(),c=S.SolveTOI_s_backup1.Copy(h.m_sweep),u=S.SolveTOI_s_backup2.Copy(l.m_sweep);if(h.Advance(n),l.Advance(n),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,!i.IsEnabled()||!i.IsTouching()){i.SetEnabled(!1),h.m_sweep.Copy(c),l.m_sweep.Copy(u),h.SynchronizeTransform(),l.SynchronizeTransform();continue}h.SetAwake(!0),l.SetAwake(!0),e.Clear(),e.AddBody(h),e.AddBody(l),e.AddContact(i),h.m_islandFlag=!0,l.m_islandFlag=!0,i.m_islandFlag=!0;for(let t=0;t<2;++t){const i=0===t?h:l;if(i.m_type===x.b2BodyType.b2_dynamicBody)for(let t=i.m_contactList;t&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==s.b2_maxTOIContacts;t=t.next){const{contact:s}=t;if(s.m_islandFlag)continue;const{other:o}=t;if(o.m_type===x.b2BodyType.b2_dynamicBody&&!i.IsBullet()&&!o.IsBullet())continue;const r=s.m_fixtureA.m_isSensor,a=s.m_fixtureB.m_isSensor;if(r||a)continue;const h=S.SolveTOI_s_backup.Copy(o.m_sweep);o.m_islandFlag||o.Advance(n),s.Update(this.m_contactManager.m_contactListener),s.IsEnabled()&&s.IsTouching()?(s.m_islandFlag=!0,e.AddContact(s),o.m_islandFlag||(o.m_islandFlag=!0,o.m_type!==x.b2BodyType.b2_staticBody&&o.SetAwake(!0),e.AddBody(o))):(o.m_sweep.Copy(h),o.SynchronizeTransform())}}const m=S.SolveTOI_s_subStep;m.dt=(1-n)*t.dt,m.inv_dt=1/m.dt,m.dtRatio=1,m.config={...t.config,positionIterations:20},m.warmStarting=!1,e.SolveTOI(m,h.m_islandIndex,l.m_islandIndex);for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];if(i.m_islandFlag=!1,i.m_type===x.b2BodyType.b2_dynamicBody){i.SynchronizeFixtures();for(let t=i.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}}e.b2World=S,S.Step_s_step=w.b2TimeStep.Create(),S.Step_s_stepTimer=new o.b2Timer,S.Step_s_timer=new o.b2Timer,S.QueryFixtureShape_s_aabb=new r.b2AABB,S.RayCast_s_input=new r.b2RayCastInput,S.RayCast_s_output=new r.b2RayCastOutput,S.RayCast_s_point=new n.b2Vec2,S.SolveTOI_s_subStep=w.b2TimeStep.Create(),S.SolveTOI_s_backup=new n.b2Sweep,S.SolveTOI_s_backup1=new n.b2Sweep,S.SolveTOI_s_backup2=new n.b2Sweep,S.SolveTOI_s_toi_input=new a.b2TOIInput,S.SolveTOI_s_toi_output=new a.b2TOIOutput},8287:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2ContactListener=e.b2ContactImpulse=e.b2ContactFilter=e.b2DestructionListener=void 0;const s=i(2962);e.b2DestructionListener=class{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}};class n{ShouldCollide(t,e){const i=t.GetFilterData(),s=e.GetFilterData();return i.groupIndex===s.groupIndex&&0!==i.groupIndex?i.groupIndex>0:0!=(i.maskBits&s.categoryBits)&&0!=(i.categoryBits&s.maskBits)}}e.b2ContactFilter=n,n.b2_defaultFilter=new n,e.b2ContactImpulse=class{constructor(){this.normalImpulses=(0,s.b2MakeNumberArray)(s.b2_maxManifoldPoints),this.tangentImpulses=(0,s.b2MakeNumberArray)(s.b2_maxManifoldPoints),this.count=0}};class o{BeginContact(t){}EndContact(t){}PreSolve(t,e){}PostSolve(t,e){}}e.b2ContactListener=o,o.b2_defaultListener=new o},2511:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.b2GetBlockSolve=e.b2SetBlockSolve=e.b2World=e.b2BodyType=e.b2Body=void 0,n(i(2962),e),n(i(2952),e),n(i(6826),e),n(i(8991),e),n(i(8755),e),n(i(2026),e),n(i(6121),e),n(i(2472),e),n(i(9007),e),n(i(7118),e),n(i(1006),e),n(i(5608),e),n(i(8503),e),n(i(1760),e),n(i(5814),e),n(i(6955),e),n(i(2985),e),n(i(3152),e),n(i(7568),e),n(i(1848),e),n(i(8913),e);var o=i(3910);Object.defineProperty(e,"b2Body",{enumerable:!0,get:function(){return o.b2Body}}),Object.defineProperty(e,"b2BodyType",{enumerable:!0,get:function(){return o.b2BodyType}});var r=i(3698);Object.defineProperty(e,"b2World",{enumerable:!0,get:function(){return r.b2World}}),n(i(8287),e),n(i(6174),e),n(i(4361),e),n(i(6760),e),n(i(1866),e);var a=i(8995);Object.defineProperty(e,"b2SetBlockSolve",{enumerable:!0,get:function(){return a.b2SetBlockSolve}}),Object.defineProperty(e,"b2GetBlockSolve",{enumerable:!0,get:function(){return a.b2GetBlockSolve}}),n(i(5773),e),n(i(4143),e),n(i(5354),e),n(i(9566),e),n(i(5731),e),n(i(620),e),n(i(2493),e),n(i(639),e),n(i(2934),e),n(i(8985),e),n(i(4006),e),n(i(2924),e),n(i(9448),e)},9448:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.b2Rope=e.b2RopeTuning=e.b2BendingModel=e.b2StretchingModel=void 0;const s=i(2962),n=i(8991),o=i(6826),r={J1:new o.b2Vec2,J2:new o.b2Vec2,J3:new o.b2Vec2,r:new o.b2Vec2,e1:new o.b2Vec2,e2:new o.b2Vec2,Jd1:new o.b2Vec2,Jd2:new o.b2Vec2,d:new o.b2Vec2,u:new o.b2Vec2,dp1:new o.b2Vec2,dp2:new o.b2Vec2,dp3:new o.b2Vec2,d1:new o.b2Vec2,d2:new o.b2Vec2,dHat:new o.b2Vec2};var a,h;!function(t){t[t.b2_pbdStretchingModel=0]="b2_pbdStretchingModel",t[t.b2_xpbdStretchingModel=1]="b2_xpbdStretchingModel"}(a=e.b2StretchingModel||(e.b2StretchingModel={})),function(t){t[t.b2_springAngleBendingModel=0]="b2_springAngleBendingModel",t[t.b2_pbdAngleBendingModel=1]="b2_pbdAngleBendingModel",t[t.b2_xpbdAngleBendingModel=2]="b2_xpbdAngleBendingModel",t[t.b2_pbdDistanceBendingModel=3]="b2_pbdDistanceBendingModel",t[t.b2_pbdHeightBendingModel=4]="b2_pbdHeightBendingModel",t[t.b2_pbdTriangleBendingModel=5]="b2_pbdTriangleBendingModel"}(h=e.b2BendingModel||(e.b2BendingModel={}));class l{constructor(){this.stretchingModel=a.b2_pbdStretchingModel,this.bendingModel=h.b2_pbdAngleBendingModel,this.damping=0,this.stretchStiffness=1,this.stretchHertz=0,this.stretchDamping=0,this.bendStiffness=.5,this.bendHertz=1,this.bendDamping=0,this.isometric=!1,this.fixedEffectiveMass=!1,this.warmStart=!1}Copy(t){return this.stretchingModel=t.stretchingModel,this.bendingModel=t.bendingModel,this.damping=t.damping,this.stretchStiffness=t.stretchStiffness,this.stretchHertz=t.stretchHertz,this.stretchDamping=t.stretchDamping,this.bendStiffness=t.bendStiffness,this.bendHertz=t.bendHertz,this.bendDamping=t.bendDamping,this.isometric=t.isometric,this.fixedEffectiveMass=t.fixedEffectiveMass,this.warmStart=t.warmStart,this}}e.b2RopeTuning=l;class c{constructor(){this.i1=0,this.i2=0,this.invMass1=0,this.invMass2=0,this.L=0,this.lambda=0,this.spring=0,this.damper=0}}class u{constructor(){this.i1=0,this.i2=0,this.i3=0,this.invMass1=0,this.invMass2=0,this.invMass3=0,this.invEffectiveMass=0,this.lambda=0,this.L1=0,this.L2=0,this.alpha1=0,this.alpha2=0,this.spring=0,this.damper=0}}e.b2Rope=class{constructor(t){this.m_position=new o.b2Vec2,this.m_count=0,this.m_stretchCount=0,this.m_bendCount=0,this.m_gravity=new o.b2Vec2,this.m_tuning=new l,(0,s.b2Assert)(t.vertices.length>=3),this.m_position.Copy(t.position),this.m_count=t.vertices.length,this.m_bindPositions=(0,s.b2MakeArray)(this.m_count,o.b2Vec2),this.m_ps=(0,s.b2MakeArray)(this.m_count,o.b2Vec2),this.m_p0s=(0,s.b2MakeArray)(this.m_count,o.b2Vec2),this.m_vs=(0,s.b2MakeArray)(this.m_count,o.b2Vec2),this.m_invMasses=(0,s.b2MakeNumberArray)(this.m_count);for(let e=0;e<this.m_count;++e){this.m_bindPositions[e].Copy(t.vertices[e]),o.b2Vec2.Add(t.vertices[e],this.m_position,this.m_ps[e]),o.b2Vec2.Add(t.vertices[e],this.m_position,this.m_p0s[e]),this.m_vs[e].SetZero();const i=t.masses[e];this.m_invMasses[e]=i>0?1/i:0}this.m_stretchCount=this.m_count-1,this.m_bendCount=this.m_count-2,this.m_stretchConstraints=new Array(this.m_stretchCount);for(let t=0;t<this.m_stretchCount;t++)this.m_stretchConstraints[t]=new c;this.m_bendConstraints=new Array(this.m_bendCount);for(let t=0;t<this.m_bendCount;t++)this.m_bendConstraints[t]=new u;for(let t=0;t<this.m_stretchCount;++t){const e=this.m_stretchConstraints[t],i=this.m_ps[t],s=this.m_ps[t+1];e.i1=t,e.i2=t+1,e.L=o.b2Vec2.Distance(i,s),e.invMass1=this.m_invMasses[t],e.invMass2=this.m_invMasses[t+1],e.lambda=0,e.damper=0,e.spring=0}const{J1:e,J2:i,r:n,e1:a,e2:h,Jd1:m,Jd2:d}=r;for(let t=0;t<this.m_bendCount;++t){const s=this.m_bendConstraints[t],r=this.m_ps[t],l=this.m_ps[t+1],c=this.m_ps[t+2];s.i1=t,s.i2=t+1,s.i3=t+2,s.invMass1=this.m_invMasses[t],s.invMass2=this.m_invMasses[t+1],s.invMass3=this.m_invMasses[t+2],s.invEffectiveMass=0,s.L1=o.b2Vec2.Distance(r,l),s.L2=o.b2Vec2.Distance(l,c),s.lambda=0,o.b2Vec2.Subtract(l,r,a),o.b2Vec2.Subtract(c,l,h);const u=a.LengthSquared(),p=h.LengthSquared();if(u*p==0)continue;o.b2Vec2.Skew(a,m).Scale(-1/u),o.b2Vec2.Skew(h,d).Scale(1/p),o.b2Vec2.Negate(m,e),o.b2Vec2.Subtract(m,d,i);const _=d;s.invEffectiveMass=s.invMass1*o.b2Vec2.Dot(e,e)+s.invMass2*o.b2Vec2.Dot(i,i)+s.invMass3*o.b2Vec2.Dot(_,_),o.b2Vec2.Subtract(c,r,n);const b=n.LengthSquared();0!==b&&(s.alpha1=o.b2Vec2.Dot(h,n)/b,s.alpha2=o.b2Vec2.Dot(a,n)/b)}this.m_gravity.Copy(t.gravity),this.SetTuning(t.tuning)}SetTuning(t){this.m_tuning.Copy(t);const e=2*Math.PI*this.m_tuning.bendHertz;for(let t=0;t<this.m_bendCount;++t){const i=this.m_bendConstraints[t],s=i.L1*i.L1,n=i.L2*i.L2;if(s*n==0){i.spring=0,i.damper=0;continue}const o=1/i.L1+1/i.L2,r=i.invMass1/s+i.invMass2*o*o+i.invMass3/n;if(0===r){i.spring=0,i.damper=0;continue}const a=1/r;i.spring=a*e*e,i.damper=2*a*this.m_tuning.bendDamping*e}const i=2*Math.PI*this.m_tuning.stretchHertz;for(let t=0;t<this.m_stretchCount;++t){const e=this.m_stretchConstraints[t],s=e.invMass1+e.invMass2;if(0===s)continue;const n=1/s;e.spring=n*i*i,e.damper=2*n*this.m_tuning.stretchDamping*i}}Step(t,e,i){if(0===t)return;const s=1/t,n=Math.exp(-t*this.m_tuning.damping);for(let e=0;e<this.m_count;++e)this.m_invMasses[e]>0?(this.m_vs[e].Scale(n),this.m_vs[e].AddScaled(t,this.m_gravity)):(this.m_vs[e].x=s*(this.m_bindPositions[e].x+i.x-this.m_p0s[e].x),this.m_vs[e].y=s*(this.m_bindPositions[e].y+i.y-this.m_p0s[e].y));this.m_tuning.bendingModel===h.b2_springAngleBendingModel&&this.ApplyBendForces(t);for(let t=0;t<this.m_bendCount;++t)this.m_bendConstraints[t].lambda=0;for(let t=0;t<this.m_stretchCount;++t)this.m_stretchConstraints[t].lambda=0;for(let e=0;e<this.m_count;++e)this.m_ps[e].AddScaled(t,this.m_vs[e]);for(let i=0;i<e;++i)this.m_tuning.bendingModel===h.b2_pbdAngleBendingModel?this.SolveBend_PBD_Angle():this.m_tuning.bendingModel===h.b2_xpbdAngleBendingModel?this.SolveBend_XPBD_Angle(t):this.m_tuning.bendingModel===h.b2_pbdDistanceBendingModel?this.SolveBend_PBD_Distance():this.m_tuning.bendingModel===h.b2_pbdHeightBendingModel?this.SolveBend_PBD_Height():this.m_tuning.bendingModel===h.b2_pbdTriangleBendingModel&&this.SolveBend_PBD_Triangle(),this.m_tuning.stretchingModel===a.b2_pbdStretchingModel?this.SolveStretch_PBD():this.m_tuning.stretchingModel===a.b2_xpbdStretchingModel&&this.SolveStretch_XPBD(t);for(let t=0;t<this.m_count;++t)this.m_vs[t].x=s*(this.m_ps[t].x-this.m_p0s[t].x),this.m_vs[t].y=s*(this.m_ps[t].y-this.m_p0s[t].y),this.m_p0s[t].Copy(this.m_ps[t])}Reset(t){this.m_position.Copy(t);for(let t=0;t<this.m_count;++t)o.b2Vec2.Add(this.m_bindPositions[t],this.m_position,this.m_ps[t]),this.m_p0s[t].Copy(this.m_ps[t]),this.m_vs[t].SetZero();for(let t=0;t<this.m_bendCount;++t)this.m_bendConstraints[t].lambda=0;for(let t=0;t<this.m_stretchCount;++t)this.m_stretchConstraints[t].lambda=0}SolveStretch_PBD(){const t=this.m_tuning.stretchStiffness,{d:e}=r;for(let i=0;i<this.m_stretchCount;++i){const s=this.m_stretchConstraints[i],n=this.m_ps[s.i1],r=this.m_ps[s.i2];o.b2Vec2.Subtract(r,n,e);const a=e.Normalize(),h=s.invMass1+s.invMass2;if(0===h)continue;const l=s.invMass1/h,c=s.invMass2/h;n.SubtractScaled(t*l*(s.L-a),e),r.AddScaled(t*c*(s.L-a),e)}}SolveStretch_XPBD(t){const{dp1:e,dp2:i,u:s,J1:n}=r;for(let r=0;r<this.m_stretchCount;++r){const a=this.m_stretchConstraints[r],h=this.m_ps[a.i1],l=this.m_ps[a.i2];o.b2Vec2.Subtract(h,this.m_p0s[a.i1],e),o.b2Vec2.Subtract(l,this.m_p0s[a.i2],i),o.b2Vec2.Subtract(l,h,s);const c=s.Normalize();o.b2Vec2.Negate(s,n);const u=s,m=a.invMass1+a.invMass2;if(0===m)continue;const d=1/(a.spring*t*t),p=d*(t*t*a.damper)/t,_=c-a.L,b=o.b2Vec2.Dot(n,e)+o.b2Vec2.Dot(u,i),y=-(_+d*a.lambda+p*b)/((1+p)*m+d);h.AddScaled(a.invMass1*y,n),l.AddScaled(a.invMass2*y,u),a.lambda+=y}}SolveBend_PBD_Angle(){const t=this.m_tuning.bendStiffness,{Jd1:e,Jd2:i,J1:s,J2:n,d1:a,d2:h}=r;for(let r=0;r<this.m_bendCount;++r){const l=this.m_bendConstraints[r],c=this.m_ps[l.i1],u=this.m_ps[l.i2],m=this.m_ps[l.i3];o.b2Vec2.Subtract(u,c,a),o.b2Vec2.Subtract(m,u,h);const d=o.b2Vec2.Cross(a,h),p=o.b2Vec2.Dot(a,h),_=Math.atan2(d,p);let b,y;if(this.m_tuning.isometric?(b=l.L1*l.L1,y=l.L2*l.L2):(b=a.LengthSquared(),y=h.LengthSquared()),b*y==0)continue;o.b2Vec2.Skew(a,e).Scale(-1/b),o.b2Vec2.Skew(h,i).Scale(1/y),o.b2Vec2.Negate(e,s),o.b2Vec2.Subtract(e,i,n);const f=i;let g;g=this.m_tuning.fixedEffectiveMass?l.invEffectiveMass:l.invMass1*o.b2Vec2.Dot(s,s)+l.invMass2*o.b2Vec2.Dot(n,n)+l.invMass3*o.b2Vec2.Dot(f,f),0===g&&(g=l.invEffectiveMass);const x=-t*_/g;c.AddScaled(l.invMass1*x,s),u.AddScaled(l.invMass2*x,n),m.AddScaled(l.invMass3*x,f)}}SolveBend_XPBD_Angle(t){const{dp1:e,dp2:i,dp3:s,d1:n,d2:a,Jd1:h,Jd2:l,J1:c,J2:u}=r;for(let r=0;r<this.m_bendCount;++r){const m=this.m_bendConstraints[r],d=this.m_ps[m.i1],p=this.m_ps[m.i2],_=this.m_ps[m.i3];let b,y;if(o.b2Vec2.Subtract(d,this.m_p0s[m.i1],e),o.b2Vec2.Subtract(p,this.m_p0s[m.i2],i),o.b2Vec2.Subtract(_,this.m_p0s[m.i3],s),o.b2Vec2.Subtract(p,d,n),o.b2Vec2.Subtract(_,p,a),this.m_tuning.isometric?(b=m.L1*m.L1,y=m.L2*m.L2):(b=n.LengthSquared(),y=a.LengthSquared()),b*y==0)continue;const f=o.b2Vec2.Cross(n,a),g=o.b2Vec2.Dot(n,a),x=Math.atan2(f,g);o.b2Vec2.Skew(n,h).Scale(-1/b),o.b2Vec2.Skew(a,l).Scale(1/y),o.b2Vec2.Negate(h,c),o.b2Vec2.Subtract(h,l,u);const v=l;let A;if(A=this.m_tuning.fixedEffectiveMass?m.invEffectiveMass:m.invMass1*o.b2Vec2.Dot(c,c)+m.invMass2*o.b2Vec2.Dot(u,u)+m.invMass3*o.b2Vec2.Dot(v,v),0===A)continue;const w=1/(m.spring*t*t),S=w*(t*t*m.damper)/t,C=x,V=o.b2Vec2.Dot(c,e)+o.b2Vec2.Dot(u,i)+o.b2Vec2.Dot(v,s),B=-(C+w*m.lambda+S*V)/((1+S)*A+w);d.AddScaled(m.invMass1*B,c),p.AddScaled(m.invMass2*B,u),_.AddScaled(m.invMass3*B,v),m.lambda+=B}}SolveBend_PBD_Distance(){const t=this.m_tuning.bendStiffness,{d:e}=r;for(let i=0;i<this.m_bendCount;++i){const s=this.m_bendConstraints[i],{i1:n}=s,r=s.i3,a=this.m_ps[n],h=this.m_ps[r];o.b2Vec2.Subtract(h,a,e);const l=e.Normalize(),c=s.invMass1+s.invMass3;if(0===c)continue;const u=s.invMass1/c,m=s.invMass3/c;a.SubtractScaled(t*u*(s.L1+s.L2-l),e),h.AddScaled(t*m*(s.L1+s.L2-l),e)}}SolveBend_PBD_Height(){const t=this.m_tuning.bendStiffness,{dHat:e,J1:i,J2:s,J3:n,d:a}=r;for(let r=0;r<this.m_bendCount;++r){const h=this.m_bendConstraints[r],l=this.m_ps[h.i1],c=this.m_ps[h.i2],u=this.m_ps[h.i3];a.x=h.alpha1*l.x+h.alpha2*u.x-c.x,a.y=h.alpha1*l.y+h.alpha2*u.y-c.y;const m=a.Length();if(0===m)continue;o.b2Vec2.Scale(1/m,a,e),o.b2Vec2.Scale(h.alpha1,e,i),o.b2Vec2.Negate(e,s),o.b2Vec2.Scale(h.alpha2,e,n);const d=h.invMass1*h.alpha1*h.alpha1+h.invMass2+h.invMass3*h.alpha2*h.alpha2;if(0===d)continue;const p=1/d*-t*m;l.AddScaled(h.invMass1*p,i),c.AddScaled(h.invMass2*p,s),u.AddScaled(h.invMass3*p,n)}}SolveBend_PBD_Triangle(){const t=this.m_tuning.bendStiffness,{d:e}=r;for(let i=0;i<this.m_bendCount;++i){const s=this.m_bendConstraints[i],n=this.m_ps[s.i1],o=this.m_ps[s.i2],r=this.m_ps[s.i3],a=s.invMass1,h=s.invMass2,l=s.invMass3,c=t/(a+l+2*h);e.x=o.x-1/3*(n.x+o.x+r.x),e.y=o.y-1/3*(n.y+o.y+r.y),n.AddScaled(2*a*c,e),o.AddScaled(-4*h*c,e),r.AddScaled(2*l*c,e)}}ApplyBendForces(t){const e=2*Math.PI*this.m_tuning.bendHertz,{d1:i,d2:s,Jd1:n,Jd2:a,J1:h,J2:l}=r;for(let r=0;r<this.m_bendCount;++r){const c=this.m_bendConstraints[r],u=this.m_ps[c.i1],m=this.m_ps[c.i2],d=this.m_ps[c.i3],p=this.m_vs[c.i1],_=this.m_vs[c.i2],b=this.m_vs[c.i3];let y,f;if(o.b2Vec2.Subtract(m,u,i),o.b2Vec2.Subtract(d,m,s),this.m_tuning.isometric?(y=c.L1*c.L1,f=c.L2*c.L2):(y=i.LengthSquared(),f=s.LengthSquared()),y*f==0)continue;const g=o.b2Vec2.Cross(i,s),x=o.b2Vec2.Dot(i,s),v=Math.atan2(g,x);o.b2Vec2.Skew(i,n).Scale(-1/y),o.b2Vec2.Skew(s,a).Scale(1/f),o.b2Vec2.Negate(n,h),o.b2Vec2.Subtract(n,a,l);const A=a;let w;if(w=this.m_tuning.fixedEffectiveMass?c.invEffectiveMass:c.invMass1*o.b2Vec2.Dot(h,h)+c.invMass2*o.b2Vec2.Dot(l,l)+c.invMass3*o.b2Vec2.Dot(A,A),0===w)continue;const S=1/w,C=-t*(S*e*e*v+2*S*this.m_tuning.bendDamping*e*(o.b2Vec2.Dot(h,p)+o.b2Vec2.Dot(l,_)+o.b2Vec2.Dot(A,b)));this.m_vs[c.i1].AddScaled(c.invMass1*C,h),this.m_vs[c.i2].AddScaled(c.invMass2*C,l),this.m_vs[c.i3].AddScaled(c.invMass3*C,A)}}Draw(t){for(let e=0;e<this.m_count-1;++e){t.DrawSegment(this.m_ps[e],this.m_ps[e+1],n.debugColors.rope);const i=this.m_invMasses[e]>0?n.debugColors.ropePointD:n.debugColors.ropePointG;t.DrawPoint(this.m_ps[e],5,i)}const e=this.m_invMasses[this.m_count-1]>0?n.debugColors.ropePointD:n.debugColors.ropePointG;t.DrawPoint(this.m_ps[this.m_count-1],5,e)}}},7834:function(t,e,i){const s=i(2511);new s.b2Color(.5,.9,.5)},1424:function(t,e,i){var s=i(8081),n=i.n(s),o=i(3645),r=i.n(o)()(n());r.push([t.id,"body {\n\n    background-color: black;\n    color: white;\n\n    /* Allow mouse dragging. */\n    -moz-user-select: none;\n    -ms-user-select: none;\n    -o-user-select: none;\n    -webkit-user-select: none;\n    user-select: none;\n\n    /* disable touch panning/zooming */\n    -ms-touch-action: none;\n    touch-action: none;\n\n    /* Allow canvas to hit the edges of the browser viewport. */\n    margin: 0;\n}\n\n#screen canvas {\n    margin: auto;\n    /* Hide the gap for font descenders. */\n    display: block;\n}\n",""]),e.Z=r},3645:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,s,n,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(s)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(r[h]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);s&&r[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),e.push(c))}},e}},8081:function(t){t.exports=function(t){return t[1]}},3379:function(t){var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var o={},r=[],a=0;a<t.length;a++){var h=t[a],l=s.base?h[0]+s.base:h[0],c=o[l]||0,u="".concat(l," ").concat(c);o[l]=c+1;var m=i(u),d={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==m)e[m].references++,e[m].updater(d);else{var p=n(d,s);s.byIndex=a,e.splice(a,0,{identifier:u,updater:p,references:1})}r.push(u)}return r}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var o=s(t=t||[],n=n||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var a=i(o[r]);e[a].references--}for(var h=s(t,n),l=0;l<o.length;l++){var c=i(o[l]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}o=h}}},569:function(t){var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},9216:function(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:function(t,e,i){t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},7795:function(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var o=i.sourceMap;o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:function(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={id:s,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.nc=void 0,function(){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s,n,o=function(t){return t&&t.Math==Math&&t},r=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),a={},h=function(t){try{return!!t()}catch(t){return!0}},l=!h((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),c=!h((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),u=c,m=Function.prototype.call,d=u?m.bind(m):function(){return m.apply(m,arguments)},p={},_={}.propertyIsEnumerable,b=Object.getOwnPropertyDescriptor,y=b&&!_.call({1:2},1),f=(p.f=y?function(t){var e=b(this,t);return!!e&&e.enumerable}:_,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}),g=c,x=Function.prototype,v=x.call,A=g&&x.bind.bind(v,v),w=g?A:function(t){return function(){return v.apply(t,arguments)}},S=w,C=S({}.toString),V=S("".slice),B=function(t){return V(C(t),8,-1)},T=h,M=B,I=Object,P=w("".split),E=T((function(){return!I("z").propertyIsEnumerable(0)}))?function(t){return"String"==M(t)?P(t,""):I(t)}:I,D=function(t){return null==t},R=D,L=TypeError,G=function(t){if(R(t))throw L("Can't call method on "+t);return t},k=E,F=G,O=function(t){return k(F(t))},z="object"==typeof document&&document.all,j={all:z,IS_HTMLDDA:void 0===z&&void 0!==z},N=j.all,q=j.IS_HTMLDDA?function(t){return"function"==typeof t||t===N}:function(t){return"function"==typeof t},U=q,J=j.all,X=j.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:U(t)||t===J}:function(t){return"object"==typeof t?null!==t:U(t)},H=r,W=q,Y=function(t,e){return arguments.length<2?(i=H[t],W(i)?i:void 0):H[t]&&H[t][e];var i},Z=w({}.isPrototypeOf),K=r,Q="undefined"!=typeof navigator&&String(navigator.userAgent)||"",$=K.process,tt=K.Deno,et=$&&$.versions||tt&&tt.version,it=et&&et.v8;it&&(n=(s=it.split("."))[0]>0&&s[0]<4?1:+(s[0]+s[1])),!n&&Q&&(!(s=Q.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=Q.match(/Chrome\/(\d+)/))&&(n=+s[1]);var st=n,nt=h,ot=r.String,rt=!!Object.getOwnPropertySymbols&&!nt((function(){var t=Symbol();return!ot(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&st&&st<41})),at=rt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ht=Y,lt=q,ct=Z,ut=Object,mt=at?function(t){return"symbol"==typeof t}:function(t){var e=ht("Symbol");return lt(e)&&ct(e.prototype,ut(t))},dt=String,pt=q,_t=function(t){try{return dt(t)}catch(t){return"Object"}},bt=TypeError,yt=function(t){if(pt(t))return t;throw bt(_t(t)+" is not a function")},ft=D,gt=d,xt=q,vt=X,At=TypeError,wt={exports:{}},St=r,Ct=Object.defineProperty,Vt=function(t,e){try{Ct(St,t,{value:e,configurable:!0,writable:!0})}catch(i){St[t]=e}return e},Bt=Vt,Tt="__core-js_shared__",Mt=r[Tt]||Bt(Tt,{}),It=(wt.exports,Mt);(wt.exports=function(t,e){return It[t]||(It[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.32.0",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Pt=wt.exports,Et=G,Dt=Object,Rt=function(t){return Dt(Et(t))},Lt=w({}.hasOwnProperty),Gt=Object.hasOwn||function(t,e){return Lt(Rt(t),e)},kt=w,Ft=0,Ot=Math.random(),zt=kt(1..toString),jt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+zt(++Ft+Ot,36)},Nt=Pt,qt=Gt,Ut=jt,Jt=rt,Xt=at,Ht=r.Symbol,Wt=Nt("wks"),Yt=Xt?Ht.for||Ht:Ht&&Ht.withoutSetter||Ut,Zt=function(t){return qt(Wt,t)||(Wt[t]=Jt&&qt(Ht,t)?Ht[t]:Yt("Symbol."+t)),Wt[t]},Kt=d,Qt=X,$t=mt,te=function(t,e){var i=t[e];return ft(i)?void 0:yt(i)},ee=function(t,e){var i,s;if("string"===e&&xt(i=t.toString)&&!vt(s=gt(i,t)))return s;if(xt(i=t.valueOf)&&!vt(s=gt(i,t)))return s;if("string"!==e&&xt(i=t.toString)&&!vt(s=gt(i,t)))return s;throw At("Can't convert object to primitive value")},ie=TypeError,se=Zt("toPrimitive"),ne=function(t,e){if(!Qt(t)||$t(t))return t;var i,s=te(t,se);if(s){if(void 0===e&&(e="default"),i=Kt(s,t,e),!Qt(i)||$t(i))return i;throw ie("Can't convert object to primitive value")}return void 0===e&&(e="number"),ee(t,e)},oe=mt,re=function(t){var e=ne(t,"string");return oe(e)?e:e+""},ae=X,he=r.document,le=ae(he)&&ae(he.createElement),ce=function(t){return le?he.createElement(t):{}},ue=!l&&!h((function(){return 7!=Object.defineProperty(ce("div"),"a",{get:function(){return 7}}).a})),me=l,de=d,pe=p,_e=f,be=O,ye=re,fe=Gt,ge=ue,xe=Object.getOwnPropertyDescriptor,ve=(a.f=me?xe:function(t,e){if(t=be(t),e=ye(e),ge)try{return xe(t,e)}catch(t){}if(fe(t,e))return _e(!de(pe.f,t,e),t[e])},{}),Ae=l&&h((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),we=X,Se=String,Ce=TypeError,Ve=function(t){if(we(t))return t;throw Ce(Se(t)+" is not an object")},Be=l,Te=ue,Me=Ae,Ie=Ve,Pe=re,Ee=TypeError,De=Object.defineProperty,Re=Object.getOwnPropertyDescriptor,Le="enumerable",Ge="configurable",ke="writable",Fe=(ve.f=Be?Me?function(t,e,i){if(Ie(t),e=Pe(e),Ie(i),"function"==typeof t&&"prototype"===e&&"value"in i&&ke in i&&!i[ke]){var s=Re(t,e);s&&s[ke]&&(t[e]=i.value,i={configurable:Ge in i?i[Ge]:s[Ge],enumerable:Le in i?i[Le]:s[Le],writable:!1})}return De(t,e,i)}:De:function(t,e,i){if(Ie(t),e=Pe(e),Ie(i),Te)try{return De(t,e,i)}catch(t){}if("get"in i||"set"in i)throw Ee("Accessors not supported");return"value"in i&&(t[e]=i.value),t},ve),Oe=f,ze=l?function(t,e,i){return Fe.f(t,e,Oe(1,i))}:function(t,e,i){return t[e]=i,t},je={exports:{}},Ne=l,qe=Gt,Ue=Function.prototype,Je=Ne&&Object.getOwnPropertyDescriptor,Xe=qe(Ue,"name"),He={EXISTS:Xe,PROPER:Xe&&"something"===function(){}.name,CONFIGURABLE:Xe&&(!Ne||Ne&&Je(Ue,"name").configurable)},We=q,Ye=Mt,Ze=w(Function.toString);We(Ye.inspectSource)||(Ye.inspectSource=function(t){return Ze(t)});var Ke,Qe,$e,ti=Ye.inspectSource,ei=q,ii=r.WeakMap,si=ei(ii)&&/native code/.test(String(ii)),ni=jt,oi=Pt("keys"),ri={},ai=si,hi=r,li=X,ci=ze,ui=Gt,mi=Mt,di=function(t){return oi[t]||(oi[t]=ni(t))},pi=ri,_i="Object already initialized",bi=hi.TypeError,yi=hi.WeakMap;if(ai||mi.state){var fi=mi.state||(mi.state=new yi);fi.get=fi.get,fi.has=fi.has,fi.set=fi.set,Ke=function(t,e){if(fi.has(t))throw bi(_i);return e.facade=t,fi.set(t,e),e},Qe=function(t){return fi.get(t)||{}},$e=function(t){return fi.has(t)}}else{var gi=di("state");pi[gi]=!0,Ke=function(t,e){if(ui(t,gi))throw bi(_i);return e.facade=t,ci(t,gi,e),e},Qe=function(t){return ui(t,gi)?t[gi]:{}},$e=function(t){return ui(t,gi)}}var xi={set:Ke,get:Qe,has:$e,enforce:function(t){return $e(t)?Qe(t):Ke(t,{})},getterFor:function(t){return function(e){var i;if(!li(e)||(i=Qe(e)).type!==t)throw bi("Incompatible receiver, "+t+" required");return i}}},vi=(je.exports,w),Ai=h,wi=q,Si=Gt,Ci=l,Vi=He.CONFIGURABLE,Bi=ti,Ti=xi.enforce,Mi=xi.get,Ii=String,Pi=Object.defineProperty,Ei=vi("".slice),Di=vi("".replace),Ri=vi([].join),Li=Ci&&!Ai((function(){return 8!==Pi((function(){}),"length",{value:8}).length})),Gi=String(String).split("String"),ki=je.exports=function(t,e,i){"Symbol("===Ei(Ii(e),0,7)&&(e="["+Di(Ii(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!Si(t,"name")||Vi&&t.name!==e)&&(Ci?Pi(t,"name",{value:e,configurable:!0}):t.name=e),Li&&i&&Si(i,"arity")&&t.length!==i.arity&&Pi(t,"length",{value:i.arity});try{i&&Si(i,"constructor")&&i.constructor?Ci&&Pi(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var s=Ti(t);return Si(s,"source")||(s.source=Ri(Gi,"string"==typeof e?e:"")),t};Function.prototype.toString=ki((function(){return wi(this)&&Mi(this).source||Bi(this)}),"toString");var Fi=je.exports,Oi=q,zi=ve,ji=Fi,Ni=Vt,qi={},Ui=Math.ceil,Ji=Math.floor,Xi=Math.trunc||function(t){var e=+t;return(e>0?Ji:Ui)(e)},Hi=function(t){var e=+t;return e!=e||0===e?0:Xi(e)},Wi=Hi,Yi=Math.max,Zi=Math.min,Ki=Hi,Qi=Math.min,$i=function(t){return t>0?Qi(Ki(t),9007199254740991):0},ts=O,es=function(t,e){var i=Wi(t);return i<0?Yi(i+e,0):Zi(i,e)},is=function(t){return $i(t.length)},ss=function(t){return function(e,i,s){var n,o=ts(e),r=is(o),a=es(s,r);if(t&&i!=i){for(;r>a;)if((n=o[a++])!=n)return!0}else for(;r>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}},ns={includes:ss(!0),indexOf:ss(!1)},os=Gt,rs=O,as=ns.indexOf,hs=ri,ls=w([].push),cs=function(t,e){var i,s=rs(t),n=0,o=[];for(i in s)!os(hs,i)&&os(s,i)&&ls(o,i);for(;e.length>n;)os(s,i=e[n++])&&(~as(o,i)||ls(o,i));return o},us=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),ms=(qi.f=Object.getOwnPropertyNames||function(t){return cs(t,us)},{}),ds=(ms.f=Object.getOwnPropertySymbols,Y),ps=qi,_s=ms,bs=Ve,ys=w([].concat),fs=ds("Reflect","ownKeys")||function(t){var e=ps.f(bs(t)),i=_s.f;return i?ys(e,i(t)):e},gs=Gt,xs=fs,vs=a,As=ve,ws=h,Ss=q,Cs=/#|\.prototype\./,Vs=function(t,e){var i=Ts[Bs(t)];return i==Is||i!=Ms&&(Ss(e)?ws(e):!!e)},Bs=Vs.normalize=function(t){return String(t).replace(Cs,".").toLowerCase()},Ts=Vs.data={},Ms=Vs.NATIVE="N",Is=Vs.POLYFILL="P",Ps=Vs,Es=r,Ds=a.f,Rs=ze,Ls=function(t,e,i,s){s||(s={});var n=s.enumerable,o=void 0!==s.name?s.name:e;if(Oi(i)&&ji(i,o,s),s.global)n?t[e]=i:Ni(e,i);else{try{s.unsafe?t[e]&&(n=!0):delete t[e]}catch(t){}n?t[e]=i:zi.f(t,e,{value:i,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t},Gs=Vt,ks=function(t,e,i){for(var s=xs(e),n=As.f,o=vs.f,r=0;r<s.length;r++){var a=s[r];gs(t,a)||i&&gs(i,a)||n(t,a,o(e,a))}},Fs=Ps,Os=function(t,e){var i,s,n,o,r,a=t.target,h=t.global,l=t.stat;if(i=h?Es:l?Es[a]||Gs(a,{}):(Es[a]||{}).prototype)for(s in e){if(o=e[s],n=t.dontCallGetSet?(r=Ds(i,s))&&r.value:i[s],!Fs(h?s:a+(l?".":"#")+s,t.forced)&&void 0!==n){if(typeof o==typeof n)continue;ks(o,n)}(t.sham||n&&n.sham)&&Rs(o,"sham",!0),Ls(i,s,o,t)}},zs=r;Os({global:!0,forced:zs.globalThis!==zs},{globalThis:zs});var js={};js[Zt("toStringTag")]="z";var Ns="[object z]"===String(js),qs=q,Us=B,Js=Zt("toStringTag"),Xs=Object,Hs="Arguments"==Us(function(){return arguments}()),Ws=Ns?Us:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Xs(t),Js))?i:Hs?Us(e):"Object"==(s=Us(e))&&qs(e.callee)?"Arguments":s},Ys=String,Zs="\t\n\v\f\r \u2028\u2029\ufeff",Ks=G,Qs=function(t){if("Symbol"===Ws(t))throw TypeError("Cannot convert a Symbol value to a string");return Ys(t)},$s=Zs,tn=w("".replace),en=RegExp("^["+$s+"]+"),sn=RegExp("(^|[^"+$s+"])["+$s+"]+$"),nn=function(t){return function(e){var i=Qs(Ks(e));return 1&t&&(i=tn(i,en,"")),2&t&&(i=tn(i,sn,"$1")),i}},on={start:nn(1),end:nn(2),trim:nn(3)},rn=He.PROPER,an=h,hn=Zs,ln=function(t){return an((function(){return!!hn[t]()||""!==""[t]()||rn&&hn[t].name!==t}))},cn=on.start,un=ln("trimStart")?function(){return cn(this)}:"".trimStart;Os({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==un},{trimLeft:un}),Os({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==un},{trimStart:un});var mn=r,dn=w,pn=function(t,e){return dn(mn[t].prototype[e])},_n=(pn("String","trimLeft"),on.end),bn=ln("trimEnd")?function(){return _n(this)}:"".trimEnd;Os({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==bn},{trimRight:bn}),Os({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==bn},{trimEnd:bn}),pn("String","trimRight"),"undefined"!=typeof globalThis&&void 0===globalThis.console&&(globalThis.console={},globalThis.console.log=function(){},globalThis.console.assert=function(){},globalThis.console.warn=function(){},globalThis.console.error=function(){alert(Array.prototype.slice.call(arguments).join(", "))}),(()=>{function t(t,e,i,s,n){if(![t,e,i,s].every((t=>Number.isFinite(t))))return;let o,r,a,h;if(4===(n=function(t){const e=typeof t;return"undefined"===e||null===t?[0]:"function"===e?[NaN]:"object"===e?"function"==typeof t[Symbol.iterator]?[...t].map((t=>{const e=typeof t;return"undefined"===e||null===t?0:"function"===e?NaN:"object"===e?u(t):m(t)})):[u(t)]:[m(t)]}(n)).length)o=d(n[0]),r=d(n[1]),a=d(n[2]),h=d(n[3]);else if(3===n.length)o=d(n[0]),r=d(n[1]),h=d(n[1]),a=d(n[2]);else if(2===n.length)o=d(n[0]),a=d(n[0]),r=d(n[1]),h=d(n[1]);else{if(1!==n.length)throw new Error(n.length+" is not a valid size for radii sequence.");o=d(n[0]),r=d(n[0]),a=d(n[0]),h=d(n[0])}const l=[o,r,a,h],c=l.find((({x:t,y:e})=>t<0||e<0));if(!l.some((({x:t,y:e})=>!Number.isFinite(t)||!Number.isFinite(e)))){if(c)throw new Error("Radius value "+c+" is negative.");!function(t){const[e,n,o,r]=t,a=[Math.abs(i)/(e.x+n.x),Math.abs(s)/(n.y+o.y),Math.abs(i)/(o.x+r.x),Math.abs(s)/(e.y+r.y)],h=Math.min(...a);h<=1&&t.forEach((t=>{t.x*=h,t.y*=h}))}(l),i<0&&s<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+r.x,e-r.y,r.x,r.y,0,1.5*-Math.PI,-Math.PI),this.ellipse(t+i+a.x,e+s+a.y,a.x,a.y,0,-Math.PI,-Math.PI/2),this.ellipse(t-h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,0),this.ellipse(t-o.x,e-o.y,o.x,o.y,0,0,-Math.PI/2)):i<0?(this.moveTo(t-o.x,e),this.ellipse(t+i+r.x,e+r.y,r.x,r.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+i+a.x,e+s-a.y,a.x,a.y,0,-Math.PI,1.5*-Math.PI,1),this.ellipse(t-h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,0,1),this.ellipse(t-o.x,e+o.y,o.x,o.y,0,0,-Math.PI/2,1)):s<0?(this.moveTo(t+o.x,e),this.ellipse(t+i-r.x,e-r.y,r.x,r.y,0,Math.PI/2,0,1),this.ellipse(t+i-a.x,e+s+a.y,a.x,a.y,0,0,-Math.PI/2,1),this.ellipse(t+h.x,e+s+h.y,h.x,h.y,0,-Math.PI/2,-Math.PI,1),this.ellipse(t+o.x,e-o.y,o.x,o.y,0,-Math.PI,1.5*-Math.PI,1)):(this.moveTo(t+o.x,e),this.ellipse(t+i-r.x,e+r.y,r.x,r.y,0,-Math.PI/2,0),this.ellipse(t+i-a.x,e+s-a.y,a.x,a.y,0,0,Math.PI/2),this.ellipse(t+h.x,e+s-h.y,h.x,h.y,0,Math.PI/2,Math.PI),this.ellipse(t+o.x,e+o.y,o.x,o.y,0,Math.PI,1.5*Math.PI)),this.closePath(),this.moveTo(t,e)}function u(t){const{x:e,y:i,z:s,w:n}=t;return{x:e,y:i,z:s,w:n}}function m(t){return+t}function d(t){const e=m(t);return Number.isFinite(e)?{x:e,y:e}:Object(t)===t?{x:m(t.x||0),y:m(t.y||0)}:{x:NaN,y:NaN}}}globalThis.CanvasRenderingContext2D&&void 0===globalThis.Path2D.prototype.roundRect&&(globalThis.Path2D.prototype.roundRect=t),globalThis.CanvasRenderingContext2D&&void 0===globalThis.CanvasRenderingContext2D.prototype.roundRect&&(globalThis.CanvasRenderingContext2D.prototype.roundRect=t),globalThis.OffscreenCanvasRenderingContext2D&&void 0===globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect&&(globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=t)})();const yn=Math.PI/180,fn=(Math.PI,2*Math.PI),gn=.5*Math.PI;function xn(t){return 0==(t&t-1)}function vn(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function An(t){return t*yn}function wn(t,e,i){return t<e?e:t>i?i:+t}function Sn(t,e){return~~(Math.random()*(e-t))+t}function Cn(t,e){return Math.random()*(e-t)+t}function Vn(t,e,i=2){return Math.abs(t-e)<Math.pow(10,-i)/2}let Bn=new class{constructor(){this.objectClass={},this.instance_counter=0}register(t,e,i=!1){if(void 0===e)throw new Error("Cannot register object '"+t+"', invalid class");this.objectClass[t]={class:e,pool:i?[]:void 0}}pull(t,...e){let i=this.objectClass[t];if(i){let s,n=i.class,o=i.pool;return o&&(s=o.pop())?(s.onResetEvent.apply(s,e),this.instance_counter--):(s=new(n.bind.apply(n,[n,...e])),o&&(s.className=t)),s}throw new Error("Cannot instantiate object of type '"+t+"'")}purge(){for(let t in this.objectClass)this.objectClass[t]&&(this.objectClass[t].pool=[]);this.instance_counter=0}push(t,e=!0){if(!this.poolable(t)){if(!0===e)throw new Error("me.pool: object "+t+" cannot be recycled");return!1}return this.objectClass[t.className].pool.push(t),this.instance_counter++,!0}exists(t){return t in this.objectClass}poolable(t){let e=t.className;return void 0!==e&&"function"==typeof t.onResetEvent&&e in this.objectClass&&void 0!==this.objectClass[e].pool}getInstanceCount(){return this.instance_counter}};const Tn=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function Mn(t){return Tn[(240&t)>>4]+Tn[15&t]}function In(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}const Pn=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,En=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Dn=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,Rn=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,Ln=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;let Gn=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((t=>{Gn.set(t[0],t[1])}));class kn{constructor(t=0,e=0,i=0,s=1){this.onResetEvent(t,e,i,s)}onResetEvent(t=0,e=0,i=0,s=1){void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,s)}get r(){return~~(255*this.glArray[0])}set r(t){this.glArray[0]=wn(~~t||0,0,255)/255}get g(){return~~(255*this.glArray[1])}set g(t){this.glArray[1]=wn(~~t||0,0,255)/255}get b(){return~~(255*this.glArray[2])}set b(t){this.glArray[2]=wn(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t=1){this.glArray[3]=wn(+t,0,1)}setColor(t,e,i,s=1){return this.r=t,this.g=e,this.b=i,this.alpha=s,this}setFloat(t,e,i,s=1){const n=this.glArray;return n[0]=wn(+t,0,1),n[1]=wn(+e,0,1),n[2]=wn(+i,0,1),n[3]=wn(+s,0,1),this}setHSV(t,e,i){let s,n,o,r=Math.floor(6*t),a=6*t-r,h=i*(1-e),l=i*(1-a*e),c=i*(1-(1-a)*e);switch(r%6){case 0:s=i,n=c,o=h;break;case 1:s=l,n=i,o=h;break;case 2:s=h,n=i,o=c;break;case 3:s=h,n=l,o=i;break;case 4:s=c,n=h,o=i;break;case 5:s=i,n=h,o=l}return this.setColor(255*s,255*n,255*o)}setHSL(t,e,i){let s,n,o;if(0===e)s=n=o=i;else{let r=i<.5?i*(1+e):i+e-i*e,a=2*i-r;s=In(a,r,t+1/3),n=In(a,r,t),o=In(a,r,t-1/3)}return this.setColor(255*s,255*n,255*o)}clone(){return Bn.pull("Color").copy(this)}copy(t){return"string"==typeof t?this.parseCSS(t):(this.glArray.set(t.glArray),this)}add(t){return this.glArray[0]=wn(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=wn(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=wn(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=wn(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=wn(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=wn(t,0,1),this.glArray[0]=wn(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=wn(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=wn(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(Sn(t,e),Sn(t,e),Sn(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return Gn.has(t)?this.setColor.apply(this,Gn.get(t)):this.parseRGB(t)}parseRGB(t){let e=Pn.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){let i;if(i=Ln.exec(t))return this.setColor(parseInt(i[!1===e?1:2],16),parseInt(i[!1===e?2:3],16),parseInt(i[!1===e?3:4],16),(wn(parseInt(i[!1===e?4:1],16),0,255)/255).toFixed(1));if(i=Rn.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=Dn.exec(t)){let t=i[!1===e?1:2],s=i[!1===e?2:3],n=i[!1===e?3:4],o=i[!1===e?4:1];return this.setColor(parseInt(t+t,16),parseInt(s+s,16),parseInt(n+n,16),(wn(parseInt(o+o,16),0,255)/255).toFixed(1))}if(i=En.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toUint32(t=1){const e=this.glArray;return 255*t>>0<<24|255*e[0]>>0<<16|255*e[1]>>0<<8|255*e[2]>>0}toArray(){return this.glArray}toHex(){return"#"+Mn(this.r)+Mn(this.g)+Mn(this.b)}toHex8(t=this.alpha){return"#"+Mn(this.r)+Mn(this.g)+Mn(this.b)+Mn(255*t)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(t=this.alpha){return"rgba("+this.r+","+this.g+","+this.b+","+t+")"}}class Fn{constructor(t=0,e=0){this.onResetEvent(t,e)}onResetEvent(t=0,e=0){this.x=t,this.y=e}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e=t){return this._set(this.x*t,this.y*e)}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y))}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new Fn(wn(this.x,t,e),wn(this.y,t,e))}clampSelf(t,e){return this._set(wn(this.x,t,e),wn(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new Fn(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new Fn(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new Fn(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){let t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){let i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,r=Math.cos(t),a=Math.sin(t);return this._set(n*r-o*a+i,n*a+o*r+s)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(wn(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dot(t)/t.length2())}projectN(t){return this.scale(this.dot(t))}clone(){return Bn.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}class On{constructor(t=0,e=0,i=0){this.onResetEvent(t,e,i)}onResetEvent(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||void 0!==i&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e=t,i=1){return this._set(this.x*t,this.y*e,this.z*i)}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new On(wn(this.x,t,e),wn(this.y,t,e),wn(this.z,t,e))}clampSelf(t,e){return this._set(wn(this.x,t,e),wn(this.y,t,e),wn(this.z,t,e))}minV(t){let e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){let e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new On(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new On(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new On(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){let t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),void 0===i&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){let i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,r=Math.cos(t),a=Math.sin(t);return this._set(n*r-o*a+i,n*a+o*r+s,this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*(void 0!==t.z?t.z:this.z)}cross(t){let e=this.x,i=this.y,s=this.z,n=t.x,o=t.y,r=t.z;return this.x=i*r-s*o,this.y=s*n-e*r,this.z=e*o-i*n,this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}moveTowards(t,e){let i=Math.atan2(t.y-this.y,t.x-this.x),s=this.x-t.x,n=this.y-t.y,o=Math.sqrt(s*s+n*n);return 0===o||e>=0&&o<=e*e?t:(this.x+=Math.cos(i)*e,this.y+=Math.sin(i)*e,this)}distance(t){let e=this.x-t.x,i=this.y-t.y,s=this.z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}angle(t){return Math.acos(wn(this.dot(t)/(this.length()*t.length()),-1,1))}project(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}projectN(t){let e=this.dot(t)/t.length2();return this.scale(e,e,e)}clone(){return Bn.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class zn extends Fn{constructor(t=0,e=0,i){if(super(t,e),void 0===i)throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){this.setMuted(t,e),void 0!==i&&this.setCallback(i.onUpdate,i.scope)}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);this._y=e&&"y"in e?e.y:t}_set(t,e){let i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e=t){return this._set(this._x*t,this._y*e)}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new zn(wn(this.x,t,e),wn(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(wn(this._x,t,e),wn(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new zn(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new zn(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new zn(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){let i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);let n=this._x-i,o=this._y-s,r=Math.cos(t),a=Math.sin(t);return this._set(n*r-o*a+i,n*a+o*r+s)}dot(t){return this._x*t.x+this._y*t.y}cross(t){return this._x*t.y-this._y*t.x}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),s=this.distance(t);return 0===s||e>=0&&s<=e*e?t:(this._x+=Math.cos(i)*e,this._y+=Math.sin(i)*e,this)}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return Bn.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return Bn.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class jn extends On{constructor(t=0,e=0,i=0,s){if(super(t,e,i),void 0===s)throw new Error("undefined `onUpdate` callback");this.setCallback(s.onUpdate,s.scope)}onResetEvent(t=0,e=0,i=0,s){return this.setMuted(t,e,i),void 0!==s&&this.setCallback(s.onUpdate,s.scope),this}get x(){return this._x}set x(t){let e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){let e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);this._y=e&&"y"in e?e.y:t}get z(){return this._z}set z(t){let e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);this._z=e&&"z"in e?e.z:t}_set(t,e,i){let s=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return s&&"x"in s&&"y"in s&&"z"in s?(this._x=s.x,this._y=s.y,this._z=s.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e=t,i=1){return this._set(this._x*t,this._y*e,this._z*i)}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new jn(wn(this._x,t,e),wn(this._y,t,e),wn(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(wn(this._x,t,e),wn(this._y,t,e),wn(this._z,t,e))}minV(t){let e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){let e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new jn(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new jn(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new jn(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){let i=0,s=0;"object"==typeof e&&(i=e.x,s=e.y);let n=this.x-i,o=this.y-s,r=Math.cos(t),a=Math.sin(t);return this._set(n*r-o*a+i,n*a+o*r+s,this.z)}dot(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}cross(t){let e=this._x,i=this._y,s=this._z,n=t.x,o=t.y,r=t.z;return this._set(i*r-s*o,s*n-e*r,e*o-i*n)}lerp(t,e){return this._set(this._x+(t.x-this._x)*e,this._y+(t.y-this._y)*e,this._z+(t.z-this._z)*e)}moveTowards(t,e){let i=Math.atan2(t.y-this._y,t.x-this._x),s=this._x-t.x,n=this._y-t.y,o=Math.sqrt(s*s+n*n);return 0===o||e>=0&&o<=e*e?t:this._set(this._x+Math.cos(i)*e,this._y+Math.sin(i)*e,this._z)}distance(t){let e=this._x-t.x,i=this._y-t.y,s=this._z-(t.z||0);return Math.sqrt(e*e+i*i+s*s)}clone(){return Bn.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return Bn.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}class Nn{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;if(void 0===this.val&&(this.val=new Float32Array(9)),1===e)if(9===t.val.length)this.copy(t);else{if(16!==t.val.length)throw new Error("invalid Matrix2d constructor parameter");this.fromMat3d(arguments[0])}else arguments.length>=6?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){let t=this.val;return 9===arguments.length?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):6===arguments.length&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}copy(t){return this.val.set(t.val),this}fromMat3d(t){let e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){let e=t.val,i=this.val,s=i[0],n=i[1],o=i[3],r=i[4],a=e[0],h=e[1],l=e[3],c=e[4],u=e[6],m=e[7];return i[0]=s*a+o*h,i[1]=n*a+r*h,i[3]=s*l+o*c,i[4]=n*l+r*c,i[6]+=s*u+o*m,i[7]+=n*u+r*m,this}transpose(){let t=this.val,e=t[1],i=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=s,this}invert(){let t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],o=t[4],r=t[5],a=t[6],h=t[7],l=t[8],c=l*o-r*h,u=r*a-l*n,m=h*n-o*a,d=e*c+i*u+s*m;return t[0]=c/d,t[1]=(s*h-l*i)/d,t[2]=(r*i-s*o)/d,t[3]=u/d,t[4]=(l*e-s*a)/d,t[5]=(s*n-r*e)/d,t[6]=m/d,t[7]=(i*a-h*e)/d,t[8]=(o*e-i*n)/d,this}apply(t){let e=this.val,i=t.x,s=t.y,n=void 0!==t.z?t.z:1;return t.x=i*e[0]+s*e[3]+n*e[6],t.y=i*e[1]+s*e[4]+n*e[7],void 0!==t.z&&(t.z=i*e[2]+s*e[5]+n*e[8]),t}applyInverse(t){let e=this.val,i=t.x,s=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*s+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*s+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e=t){let i=this.val;return i[0]*=t,i[1]*=t,i[3]*=e,i[4]*=e,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(0!==t){let e=this.val,i=e[0],s=e[1],n=e[2],o=e[3],r=e[4],a=e[5],h=Math.sin(t),l=Math.cos(t);e[0]=l*i+h*o,e[1]=l*s+h*r,e[2]=l*n+h*a,e[3]=l*o-h*i,e[4]=l*r-h*s,e[5]=l*a-h*n}return this}translate(){let t,e,i=this.val;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),i[6]+=i[0]*t+i[3]*e,i[7]+=i[1]*t+i[4]*e,this}isIdentity(){let t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return Bn.pull("Matrix2d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}class qn{constructor(...t){this.onResetEvent(...t)}onResetEvent(){const t=arguments[0],e=arguments.length;void 0===this.val&&(this.val=new Float32Array(16)),1===e&&16===t.val.length?this.copy(t):16===e?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,s,n,o,r,a,h,l,c,u,m,d,p,_){let b=this.val;return b[0]=t,b[1]=e,b[2]=i,b[3]=s,b[4]=n,b[5]=o,b[6]=r,b[7]=a,b[8]=h,b[9]=l,b[10]=c,b[11]=u,b[12]=m,b[13]=d,b[14]=p,b[15]=_,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){let e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){let e=this.val,i=t.val,s=e[0],n=e[1],o=e[2],r=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],m=e[9],d=e[10],p=e[11],_=e[12],b=e[13],y=e[14],f=e[15],g=i[0],x=i[1],v=i[2],A=i[3];return e[0]=g*s+x*a+v*u+A*_,e[1]=g*n+x*h+v*m+A*b,e[2]=g*o+x*l+v*d+A*y,e[3]=g*r+x*c+v*p+A*f,g=i[4],x=i[5],v=i[6],A=i[7],e[4]=g*s+x*a+v*u+A*_,e[5]=g*n+x*h+v*m+A*b,e[6]=g*o+x*l+v*d+A*y,e[7]=g*r+x*c+v*p+A*f,g=i[8],x=i[9],v=i[10],A=i[11],e[8]=g*s+x*a+v*u+A*_,e[9]=g*n+x*h+v*m+A*b,e[10]=g*o+x*l+v*d+A*y,e[11]=g*r+x*c+v*p+A*f,g=i[12],x=i[13],v=i[14],A=i[15],e[12]=g*s+x*a+v*u+A*_,e[13]=g*n+x*h+v*m+A*b,e[14]=g*o+x*l+v*d+A*y,e[15]=g*r+x*c+v*p+A*f,this}transpose(){let t=this.val,e=t[1],i=t[2],s=t[3],n=t[6],o=t[7],r=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=s,t[13]=o,t[14]=r,this}invert(){let t=this.val,e=t[0],i=t[1],s=t[2],n=t[3],o=t[4],r=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],m=t[11],d=t[12],p=t[13],_=t[14],b=t[15],y=e*r-i*o,f=e*a-s*o,g=e*h-n*o,x=i*a-s*r,v=i*h-n*r,A=s*h-n*a,w=l*p-c*d,S=l*_-u*d,C=l*b-m*d,V=c*_-u*p,B=c*b-m*p,T=u*b-m*_,M=y*T-f*B+g*V+x*C-v*S+A*w;return M?(M=1/M,t[0]=(r*T-a*B+h*V)*M,t[1]=(s*B-i*T-n*V)*M,t[2]=(p*A-_*v+b*x)*M,t[3]=(u*v-c*A-m*x)*M,t[4]=(a*C-o*T-h*S)*M,t[5]=(e*T-s*C+n*S)*M,t[6]=(_*g-d*A-b*f)*M,t[7]=(l*A-u*g+m*f)*M,t[8]=(o*B-r*C+h*w)*M,t[9]=(i*C-e*B-n*w)*M,t[10]=(d*v-p*g+b*y)*M,t[11]=(c*g-l*v-m*y)*M,t[12]=(r*S-o*V-a*w)*M,t[13]=(e*V-i*S+s*w)*M,t[14]=(p*f-d*x-_*y)*M,t[15]=(l*x-c*f+u*y)*M,this):null}apply(t){let e=this.val,i=t.x,s=t.y,n=void 0!==t.z?t.z:1,o=e[3]*i+e[7]*s+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*s+e[8]*n+e[12])/o,t.y=(e[1]*i+e[5]*s+e[9]*n+e[13])/o,void 0!==t.z&&(t.z=(e[2]*i+e[6]*s+e[10]*n+e[14])/o),t}applyInverse(t){let e=Bn.pull("Matrix3d",this).invert();return e.apply(t),Bn.push(e),t}ortho(t,e,i,s,n,o){let r=this.val,a=1/(t-e),h=1/(i-s),l=1/(n-o);return r[0]=-2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*l,r[11]=0,r[12]=(t+e)*a,r[13]=(s+i)*h,r[14]=(o+n)*l,r[15]=1,this}scale(t,e=t,i=0){let s=this.val;return s[0]=s[0]*t,s[1]=s[1]*t,s[2]=s[2]*t,s[3]=s[3]*t,s[4]=s[4]*e,s[5]=s[5]*e,s[6]=s[6]*e,s[7]=s[7]*e,s[8]=s[8]*i,s[9]=s[9]*i,s[10]=s[10]*i,s[11]=s[11]*i,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){if(0!==t){let i,s,n,o,r,a,h,l,c,u,m,d,p,_,b,y,f,g,x,v,A,w,S,C,V=this.val,B=e.x,T=e.y,M=e.z,I=Math.sqrt(B*B+T*T+M*M);if(I<1e-6)return null;I=1/I,B*=I,T*=I,M*=I,i=Math.sin(t),s=Math.cos(t),n=1-s,o=V[0],r=V[1],a=V[2],h=V[3],l=V[4],c=V[5],u=V[6],m=V[7],d=V[8],p=V[9],_=V[10],b=V[11],y=B*B*n+s,f=T*B*n+M*i,g=M*B*n-T*i,x=B*T*n-M*i,v=T*T*n+s,A=M*T*n+B*i,w=B*M*n+T*i,S=T*M*n-B*i,C=M*M*n+s,V[0]=o*y+l*f+d*g,V[1]=r*y+c*f+p*g,V[2]=a*y+u*f+_*g,V[3]=h*y+m*f+b*g,V[4]=o*x+l*v+d*A,V[5]=r*x+c*v+p*A,V[6]=a*x+u*v+_*A,V[7]=h*x+m*v+b*A,V[8]=o*w+l*S+d*C,V[9]=r*w+c*S+p*C,V[10]=a*w+u*S+_*C,V[11]=h*w+m*S+b*C}return this}translate(){let t,e,i,s=this.val;return arguments.length>1?(t=arguments[0],e=arguments[1],i=void 0===arguments[2]?0:arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=void 0===arguments[0].z?0:arguments[0].z),s[12]=s[0]*t+s[4]*e+s[8]*i+s[12],s[13]=s[1]*t+s[5]*e+s[9]*i+s[13],s[14]=s[2]*t+s[6]*e+s[10]*i+s[14],s[15]=s[3]*t+s[7]*e+s[11]*i+s[15],this}isIdentity(){let t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}equals(t){let e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return Bn.pull("Matrix3d",this)}toArray(){return this.val}toString(){let t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}var Un={exports:{}};function Jn(t,e,i){i=i||2;var s,n,o,r,a,h,l,c=e&&e.length,u=c?e[0]*i:t.length,m=Xn(t,0,u,i,!0),d=[];if(!m||m.next===m.prev)return d;if(c&&(m=function(t,e,i,s){var n,o,r,a=[];for(n=0,o=e.length;n<o;n++)(r=Xn(t,e[n]*s,n<o-1?e[n+1]*s:t.length,s,!1))===r.next&&(r.steiner=!0),a.push(so(r));for(a.sort($n),n=0;n<a.length;n++)i=to(a[n],i);return i}(t,e,m,i)),t.length>80*i){s=o=t[0],n=r=t[1];for(var p=i;p<u;p+=i)(a=t[p])<s&&(s=a),(h=t[p+1])<n&&(n=h),a>o&&(o=a),h>r&&(r=h);l=0!==(l=Math.max(o-s,r-n))?32767/l:0}return Wn(m,d,i,s,n,l,0),d}function Xn(t,e,i,s,n){var o,r;if(n===yo(t,e,i,s)>0)for(o=e;o<i;o+=s)r=po(o,t[o],t[o+1],r);else for(o=i-s;o>=e;o-=s)r=po(o,t[o],t[o+1],r);return r&&ao(r,r.next)&&(_o(r),r=r.next),r}function Hn(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!ao(s,s.next)&&0!==ro(s.prev,s,s.next))s=s.next;else{if(_o(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function Wn(t,e,i,s,n,o,r){if(t){!r&&o&&function(t,e,i,s){var n=t;do{0===n.z&&(n.z=io(n.x,n.y,e,i,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,s,n,o,r,a,h,l=1;do{for(i=t,t=null,o=null,r=0;i;){for(r++,s=i,a=0,e=0;e<l&&(a++,s=s.nextZ);e++);for(h=l;a>0||h>0&&s;)0!==a&&(0===h||!s||i.z<=s.z)?(n=i,i=i.nextZ,a--):(n=s,s=s.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=s}o.nextZ=null,l*=2}while(r>1)}(n)}(t,s,n,o);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?Zn(t,s,n,o):Yn(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),_o(t),t=h.next,l=h.next;else if((t=h)===l){r?1===r?Wn(t=Kn(Hn(t),e,i),e,i,s,n,o,2):2===r&&Qn(t,e,i,s,n,o):Wn(Hn(t),e,i,s,n,o,1);break}}}function Yn(t){var e=t.prev,i=t,s=t.next;if(ro(e,i,s)>=0)return!1;for(var n=e.x,o=i.x,r=s.x,a=e.y,h=i.y,l=s.y,c=n<o?n<r?n:r:o<r?o:r,u=a<h?a<l?a:l:h<l?h:l,m=n>o?n>r?n:r:o>r?o:r,d=a>h?a>l?a:l:h>l?h:l,p=s.next;p!==e;){if(p.x>=c&&p.x<=m&&p.y>=u&&p.y<=d&&no(n,a,o,h,r,l,p.x,p.y)&&ro(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Zn(t,e,i,s){var n=t.prev,o=t,r=t.next;if(ro(n,o,r)>=0)return!1;for(var a=n.x,h=o.x,l=r.x,c=n.y,u=o.y,m=r.y,d=a<h?a<l?a:l:h<l?h:l,p=c<u?c<m?c:m:u<m?u:m,_=a>h?a>l?a:l:h>l?h:l,b=c>u?c>m?c:m:u>m?u:m,y=io(d,p,e,i,s),f=io(_,b,e,i,s),g=t.prevZ,x=t.nextZ;g&&g.z>=y&&x&&x.z<=f;){if(g.x>=d&&g.x<=_&&g.y>=p&&g.y<=b&&g!==n&&g!==r&&no(a,c,h,u,l,m,g.x,g.y)&&ro(g.prev,g,g.next)>=0)return!1;if(g=g.prevZ,x.x>=d&&x.x<=_&&x.y>=p&&x.y<=b&&x!==n&&x!==r&&no(a,c,h,u,l,m,x.x,x.y)&&ro(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;g&&g.z>=y;){if(g.x>=d&&g.x<=_&&g.y>=p&&g.y<=b&&g!==n&&g!==r&&no(a,c,h,u,l,m,g.x,g.y)&&ro(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;x&&x.z<=f;){if(x.x>=d&&x.x<=_&&x.y>=p&&x.y<=b&&x!==n&&x!==r&&no(a,c,h,u,l,m,x.x,x.y)&&ro(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Kn(t,e,i){var s=t;do{var n=s.prev,o=s.next.next;!ao(n,o)&&ho(n,s,s.next,o)&&uo(n,o)&&uo(o,n)&&(e.push(n.i/i|0),e.push(s.i/i|0),e.push(o.i/i|0),_o(s),_o(s.next),s=t=o),s=s.next}while(s!==t);return Hn(s)}function Qn(t,e,i,s,n,o){var r=t;do{for(var a=r.next.next;a!==r.prev;){if(r.i!==a.i&&oo(r,a)){var h=mo(r,a);return r=Hn(r,r.next),h=Hn(h,h.next),Wn(r,e,i,s,n,o,0),void Wn(h,e,i,s,n,o,0)}a=a.next}r=r.next}while(r!==t)}function $n(t,e){return t.x-e.x}function to(t,e){var i=function(t,e){var i,s=e,n=t.x,o=t.y,r=-1/0;do{if(o<=s.y&&o>=s.next.y&&s.next.y!==s.y){var a=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=n&&a>r&&(r=a,i=s.x<s.next.x?s:s.next,a===n))return i}s=s.next}while(s!==e);if(!i)return null;var h,l=i,c=i.x,u=i.y,m=1/0;s=i;do{n>=s.x&&s.x>=c&&n!==s.x&&no(o<u?n:r,o,c,u,o<u?r:n,o,s.x,s.y)&&(h=Math.abs(o-s.y)/(n-s.x),uo(s,t)&&(h<m||h===m&&(s.x>i.x||s.x===i.x&&eo(i,s)))&&(i=s,m=h)),s=s.next}while(s!==l);return i}(t,e);if(!i)return e;var s=mo(i,t);return Hn(s,s.next),Hn(i,i.next)}function eo(t,e){return ro(t.prev,t,e.prev)<0&&ro(e.next,t,t.next)<0}function io(t,e,i,s,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function so(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function no(t,e,i,s,n,o,r,a){return(n-r)*(e-a)>=(t-r)*(o-a)&&(t-r)*(s-a)>=(i-r)*(e-a)&&(i-r)*(o-a)>=(n-r)*(s-a)}function oo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&ho(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(uo(t,e)&&uo(e,t)&&function(t,e){var i=t,s=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)&&(ro(t.prev,t,e.prev)||ro(t,e.prev,e))||ao(t,e)&&ro(t.prev,t,t.next)>0&&ro(e.prev,e,e.next)>0)}function ro(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ao(t,e){return t.x===e.x&&t.y===e.y}function ho(t,e,i,s){var n=co(ro(t,e,i)),o=co(ro(t,e,s)),r=co(ro(i,s,t)),a=co(ro(i,s,e));return n!==o&&r!==a||!(0!==n||!lo(t,i,e))||!(0!==o||!lo(t,s,e))||!(0!==r||!lo(i,t,s))||!(0!==a||!lo(i,e,s))}function lo(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function co(t){return t>0?1:t<0?-1:0}function uo(t,e){return ro(t.prev,t,t.next)<0?ro(t,e,t.next)>=0&&ro(t,t.prev,e)>=0:ro(t,e,t.prev)<0||ro(t,t.next,e)<0}function mo(t,e){var i=new bo(t.i,t.x,t.y),s=new bo(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s}function po(t,e,i,s){var n=new bo(t,e,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function _o(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bo(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yo(t,e,i,s){for(var n=0,o=e,r=i-s;o<i;o+=s)n+=(t[r]-t[o])*(t[o+1]+t[r+1]),r=o;return n}Un.exports,Un.exports=Jn,Un.exports.default=Jn,Jn.deviation=function(t,e,i,s){var n=e&&e.length,o=n?e[0]*i:t.length,r=Math.abs(yo(t,0,o,i));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,c=a<h-1?e[a+1]*i:t.length;r-=Math.abs(yo(t,l,c,i))}var u=0;for(a=0;a<s.length;a+=3){var m=s[a]*i,d=s[a+1]*i,p=s[a+2]*i;u+=Math.abs((t[m]-t[p])*(t[d+1]-t[m+1])-(t[m]-t[d])*(t[p+1]-t[m+1]))}return 0===r&&0===u?0:Math.abs((u-r)/r)},Jn.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var r=0;r<e;r++)i.vertices.push(t[n][o][r]);n>0&&(s+=t[n-1].length,i.holes.push(s))}return i};var fo=e(Un.exports);class go{constructor(t,e,i){this.pos=Bn.pull("Vector2d"),this.points=[],this.edges=[],this.indices=[],this.normals=[],this._bounds,this.shapeType="Polygon",this.setShape(t,e,i)}onResetEvent(t,e,i){this.setShape(t,e,i)}setShape(t,e,i){return this.pos.set(t,e),this.setVertices(i),this}setVertices(t){if(!Array.isArray(t))return this;if("object"==typeof t[0])"function"==typeof t[0].setV?this.points=t:(this.points.length=0,t.forEach((t=>{this.points.push(Bn.pull("Vector2d",t.x,t.y))})));else{let e=t.length;this.points.length=0;for(let i=0;i<e;i+=2)this.points.push(Bn.pull("Vector2d",t[i],t[i+1]))}return this.recalc(),this.updateBounds(),this}transform(t){let e=this.points,i=e.length;for(let s=0;s<i;s++)t.apply(e[s]);return this.recalc(),this.updateBounds(),this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(t,e){if(0!==t){let i=this.points,s=i.length;for(let n=0;n<s;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this}scale(t,e=t){let i=this.points,s=i.length;for(let n=0;n<s;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this}scaleV(t){return this.scale(t.x,t.y)}recalc(){let t=this.edges,e=this.normals,i=this.indices,s=this.points,n=s.length;if(n<3)throw new Error("Requires at least 3 points");for(let i=0;i<n;i++){let o=t[i];void 0===o&&(o=t[i]=Bn.pull("Vector2d")),o.copy(s[(i+1)%n]).sub(s[i]);let r=e[i];void 0===r&&(r=e[i]=Bn.pull("Vector2d")),r.copy(o).perp().normalize()}for(let i=n;i<t.length;i++)Bn.push(t[i]),Bn.push(e[i]);return t.length=n,e.length=n,i.length=0,this}getIndices(){return 0===this.indices.length&&(this.indices=fo(this.points.flatMap((t=>[t.x,t.y])))),this.indices}isConvex(){let t=0,e=this.points,i=e.length;if(i<3)return null;for(let s=0;s<i;s++){let n=(s+1)%i,o=(s+2)%i,r=(e[n].x-e[s].x)*(e[o].y-e[n].y);if(r-=(e[n].y-e[s].y)*(e[o].x-e[n].x),r<0?t|=1:r>0&&(t|=2),3===t)return!1}return 0!==t||null}translate(){let t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}shift(){let t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x=t,this.pos.y=e,this.updateBounds()}contains(){let t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);let i=!1,s=this.pos.x,n=this.pos.y,o=this.points,r=o.length;for(let a=0,h=r-1;a<r;h=a++){const r=o[a].y+n,l=o[a].x+s,c=o[h].y+n,u=o[h].x+s;r>e!=c>e&&t<(u-l)*(e-r)/(c-r)+l&&(i=!i)}return i}getBounds(){return void 0===this._bounds&&(this._bounds=Bn.pull("Bounds")),this._bounds}updateBounds(){let t=this.getBounds();return t.update(this.points),t.translate(this.pos),t}clone(){let t=[];return this.points.forEach((e=>{t.push(e.clone())})),new go(this.pos.x,this.pos.y,t)}}class xo extends go{contains(){let t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;let i=this.points[0],s=this.points[1];return(e-i.y)*(s.x-i.x)==(s.y-i.y)*(t-i.x)}recalc(){let t=this.edges,e=this.normals,i=this.indices,s=this.points;if(2!==s.length)throw new Error("Requires exactly 2 points");return void 0===t[0]&&(t[0]=Bn.pull("Vector2d")),t[0].copy(s[1]).sub(s[0]),void 0===e[0]&&(e[0]=Bn.pull("Vector2d")),e[0].copy(t[0]).perp().normalize(),i.length=0,this}clone(){let t=[];return this.points.forEach((e=>{t.push(e.clone())})),new xo(this.pos.x,this.pos.y,t)}}class vo{constructor(t,e,i,s){this.pos=Bn.pull("Vector2d"),this._bounds=void 0,this.radius=NaN,this.radiusV=Bn.pull("Vector2d"),this.radiusSq=Bn.pull("Vector2d"),this.ratio=Bn.pull("Vector2d"),this.shapeType="Ellipse",this.setShape(t,e,i,s)}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){const n=i/2,o=s/2,r=Math.max(n,o),a=r*r;this.pos.set(t,e),this.radius=r,this.ratio.set(n/r,o/r),this.radiusV.set(r,r).scaleV(this.ratio),this.radiusSq.set(a,a).scaleV(this.ratio);let h=this.getBounds();return h.setMinMax(t,e,t+i,t+s),h.translate(-this.radiusV.x,-this.radiusV.y),this}rotate(t,e){let i=this.getBounds();return this.pos.rotate(t,e),i.shift(this.pos),i.translate(-this.radiusV.x,-this.radiusV.y),this}scale(t,e=t){return this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*t,2*this.radiusV.y*e)}scaleV(t){return this.scale(t.x,t.y)}transform(t){return this}translate(){let t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this}contains(){let t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y,t*t/this.radiusSq.x+e*e/this.radiusSq.y<=1}getBounds(){return void 0===this._bounds&&(this._bounds=Bn.pull("Bounds")),this._bounds}clone(){return new vo(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}}class Ao{constructor(t=0,e=0){this.x=t,this.y=e}onResetEvent(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}equals(){let t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}clone(){return new Ao(this.x,this.y)}}class wo extends go{constructor(t,e,i,s){super(t,e,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",i,0),Bn.pull("Vector2d",i,s),Bn.pull("Vector2d",0,s)]),this.shapeType="Rectangle"}onResetEvent(t,e,i,s){this.setShape(t,e,i,s)}setShape(t,e,i,s){let n=i;return this.pos.set(t,e),4===arguments.length&&(n=this.points,n[0].set(0,0),n[1].set(i,0),n[2].set(i,s),n[3].set(0,s)),this.setVertices(n),this}get left(){return this.pos.x}get right(){let t=this.width;return this.left+t||t}get top(){return this.pos.y}get bottom(){let t=this.height;return this.top+t||t}get width(){return this.points[2].x}set width(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()}get height(){return this.points[2].y}set height(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()}get centerX(){return isFinite(this.width)?this.left+this.width/2:this.width}set centerX(t){this.pos.x=t-this.width/2,this.recalc(),this.updateBounds()}get centerY(){return isFinite(this.height)?this.top+this.height/2:this.height}set centerY(t){this.pos.y=t-this.height/2,this.recalc(),this.updateBounds()}centerOn(t,e){return this.centerX=t,this.centerY=e,this}resize(t,e){return this.width=t,this.height=e,this}scale(t,e=t){return this.width*=t,this.height*=e,this}clone(){return new wo(this.left,this.top,this.width,this.height)}copy(t){return this.setShape(t.left,t.top,t.width,t.height)}union(t){let e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this}overlaps(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom}contains(){let t,e,i,s,n=arguments[0];return 2===arguments.length?(t=e=n,i=s=arguments[1]):"number"==typeof n.bottom?(t=n.left,e=n.right,i=n.top,s=n.bottom):(t=e=n.x,i=s=n.y),t>=this.left&&e<=this.right&&i>=this.top&&s<=this.bottom}equals(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom}isFinite(){return isFinite(this.left)&&isFinite(this.top)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return Bn.pull("Polygon",this.left,this.top,this.points)}}class So extends wo{constructor(t,e,i,s,n=20){super(t,e,i,s),this.radius=n}onResetEvent(t,e,i,s,n){super.setShape(t,e,i,s),this.radius=n}get radius(){return this._radius}set radius(t){this.width<2*t&&(t=this.width/2),this.height<2*t&&(t=this.height/2),this._radius=t}copy(t){return super.setShape(t.pos.x,t.pos.y,t.width,t.height),this.radius=t.radius,this}contains(){let t,e,i,s,n=arguments[0];if(2===arguments.length)t=n,e=arguments[1];else{if(void 0===n.radius&&"number"==typeof n.bottom)return super.contains(n);t=n.x,e=n.y}if(t<this.left||t>=this.right||e<this.top||e>=this.bottom)return!1;if(t>=this.left+this.radius&&t<=this.right-this.radius||e>=this.top+this.radius&&e<=this.bottom-this.radius)return!0;const o=Math.max(0,Math.min(this.radius,this.width/2)),r=Math.max(0,Math.min(this.radius,this.height/2));if(t<this.left+o&&e<this.top+r)i=t-this.left-o,s=e-this.top-r;else if(t>this.right-o&&e<this.top+r)i=t-this.right+o,s=e-this.top-r;else if(t>this.right-o&&e>this.bottom-r)i=t-this.right+o,s=e-this.bottom+r;else{if(!(t<this.left+o&&e>this.bottom-r))return!1;i=t-this.left-o,s=e-this.bottom+r}return i*i+s*s<=o*r}equals(t){return super.equals(t)&&this.radius===t.radius}clone(){return new So(this.pos.x,this.pos.y,this.width,this.height,this.radius)}}function Co(t,e){let i=Array.prototype.indexOf.call(t,e);return-1!==i&&Array.prototype.splice.call(t,i,1),t}let Vo=[];function Bo(t,e,i=4,s=4,n=0){if(Vo.length>0){let o=Vo.pop();return o.world=t,o.bounds=e,o.max_objects=i,o.max_levels=s,o.level=n,o}return new Mo(t,e,i,s,n)}let To=new Fn;class Mo{constructor(t,e,i=4,s=4,n=0){this.world=t,this.bounds=e,this.max_objects=i,this.max_levels=s,this.level=n,this.objects=[],this.nodes=[]}split(){let t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,s=this.bounds.left,n=this.bounds.top;this.nodes[0]=Bo(this.world,{left:s+e,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=Bo(this.world,{left:s,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=Bo(this.world,{left:s,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=Bo(this.world,{left:s+e,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t)}getIndex(t){let e,i=t.getBounds();e=!0===t.isFloating?this.world.app.viewport.localToWorld(i.left,i.top,To):To.set(t.left,t.top);let s=-1,n=e.x,o=e.y,r=i.width,a=i.height,h=this.bounds.left+this.bounds.width/2,l=this.bounds.top+this.bounds.height/2,c=o<l&&o+a<l,u=o>l;return n<h&&n+r<h?c?s=1:u&&(s=2):n>h&&(c?s=0:u&&(s=3)),s}insertContainer(t){const e=t.children;for(let t,i=e.length;i--,t=e[i];)!0!==t.isKinematic&&("function"==typeof t.addChild?("rootContainer"!==t.name&&this.insert(t),this.insertContainer(t)):"function"==typeof t.getBounds&&this.insert(t))}insert(t){let e=-1;if(this.nodes.length>0&&(e=this.getIndex(t),-1!==e))this.nodes[e].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();let t=0;for(;t<this.objects.length;)e=this.getIndex(this.objects[t]),-1!==e?this.nodes[e].insert(this.objects.splice(t,1)[0]):t+=1}}retrieve(t,e){let i=this.objects;if(this.nodes.length>0){let e=this.getIndex(t);if(-1!==e)i=i.concat(this.nodes[e].retrieve(t));else for(let e=0;e<this.nodes.length;e+=1)i=i.concat(this.nodes[e].retrieve(t))}return"function"==typeof e&&i.sort(e),i}remove(t){let e=!1;if(void 0===t.getBounds)return!1;if(this.nodes.length>0){let i=this.getIndex(t);-1!==i&&(e=Co(this.nodes[i],t),e&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1))}return!1===e&&-1!==this.objects.indexOf(t)&&(Co(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(let t=0;t<this.nodes.length;t+=1){const e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(let t=0;t<this.nodes.length;t++)this.nodes[t].clear(),e=this.nodes[t],Vo.push(e);var e;this.nodes.length=0,void 0!==t&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}class Io{constructor(t){this._center=new Fn,this.onResetEvent(t)}onResetEvent(t){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==t&&this.update(t)}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,s){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=s}get x(){return this.min.x}set x(t){let e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){let e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}centerOn(t,e){return this.shift(t-this.width/2,e-this.height/2),this}update(t){this.add(t,!0)}add(t,e=!1){const i=t.length;!0===e&&this.clear();for(let e=0;e<i;e++){const i=t[e];i.x>this.max.x&&(this.max.x=i.x),i.x<this.min.x&&(this.min.x=i.x),i.y>this.max.y&&(this.max.y=i.y),i.y<this.min.y&&(this.min.y=i.y)}}addBounds(t,e=!1){!0===e?(this.max.x=t.max.x,this.min.x=t.min.x,this.max.y=t.max.y,this.min.y=t.min.y):(t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y))}addPoint(t,e){void 0!==e&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,s,n){let o=Bn.pull("Point");this.addPoint(o.set(t,e),n),this.addPoint(o.set(i,e),n),this.addPoint(o.set(t,s),n),this.addPoint(o.set(i,s),n),Bn.push(o)}contains(){let t,e,i,s,n=arguments[0];return 2===arguments.length?(t=e=n,i=s=arguments[1]):void 0!==n.max?(t=n.min.x,e=n.max.x,i=n.min.y,s=n.max.y):(t=e=n.x,i=s=n.y),t>=this.min.x&&e<=this.max.x&&i>=this.min.y&&s<=this.max.y}overlaps(t){return!(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){let t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){let t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);let i=this.max.x-this.min.x,s=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+s}clone(){let t=new Io;return t.addBounds(this),t}toPolygon(){return Bn.pull("Polygon",this.x,this.y,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height),Bn.pull("Vector2d",0,this.height)])}}let Po={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},rayCast(t,e){return mm.world.detector.rayCast(t,e)}};function Eo(t,e,...i){return setTimeout(t.bind(e),.01,...i)}function Do(t,e,i){let s,n=globalThis.performance.now();return"boolean"!=typeof i&&(i=!1),function(){let o=globalThis.performance.now(),r=o-n,a=arguments;if(!(r<e))return n=o,t.apply(null,a);!1===i&&(clearTimeout(s),s=setTimeout((()=>(n=o,t.apply(null,a))),r))}}var Ro={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function s(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,s,o,r){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,o||t,r),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,n=[];if(0===this._eventsCount)return n;for(s in t=this._events)e.call(t,s)&&n.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,o=s.length,r=new Array(o);n<o;n++)r[n]=s[n].fn;return r},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,n,o,r){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,n),!0;case 5:return c.fn.call(c.context,e,s,n,o),!0;case 6:return c.fn.call(c.context,e,s,n,o,r),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var m,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,s);break;case 4:c[l].fn.call(c[l].context,e,s,n);break;default:if(!h)for(m=1,h=new Array(u-1);m<u;m++)h[m-1]=arguments[m];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,n){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return r(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||n&&!a.once||s&&a.context!==s||r(this,o);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||n&&!a[h].once||s&&a[h].context!==s)&&l.push(a[h]);l.length?this._events[o]=1===l.length?l[0]:l:r(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&r(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}(Ro);let Lo=new(e(Ro.exports));const Go="dom_ready",ko="me.boot",Fo="me.tick",Oo="me.blur",zo="me.focus",jo="me.state.onPause",No="me.state.onResume",qo="me.state.onStop",Uo="me.state.onRestart",Jo="me.state.onChange",Xo="me.stage.onReset",Ho="me.video.onInit",Wo="me.game.onInit",Yo="me.game.onReset",Zo="me.game.beforeUpdate",Ko="me.game.afterUpdate",Qo="me.game.onUpdate",$o="me.game.beforeDraw",tr="me.game.afterDraw",er="me.game.onLevelLoaded",ir="me.loader.onload",sr="me.loader.onProgress",nr="me.input.keydown",or="me.input.keyup",rr="gamepad.connected",ar="gamepad.disconnected",hr="gamepad.update",lr="me.event.pointermove",cr="me.event.pointerlockChange",ur="globalThis.onresize",mr="canvas.onresize",dr="viewport.onresize",pr="globalThis.orientationchange",_r="globalThis.onscroll",br="viewport.onchange",yr="renderer.contextlost",fr="renderer.contextrestored";function gr(t,...e){return Lo.emit(t,...e)}function xr(t,e,i){return Lo.on(t,e,i)}function vr(t,e,i){return Lo.once(t,e,i)}function Ar(t,e){return Lo.off(t,e)}var wr,Sr={__proto__:null,BLUR:Oo,BOOT:ko,CANVAS_ONRESIZE:mr,DOM_READY:Go,DRAGEND:"me.game.dragend",DRAGSTART:"me.game.dragstart",FOCUS:zo,GAMEPAD_CONNECTED:rr,GAMEPAD_DISCONNECTED:ar,GAMEPAD_UPDATE:hr,GAME_AFTER_DRAW:tr,GAME_AFTER_UPDATE:Ko,GAME_BEFORE_DRAW:$o,GAME_BEFORE_UPDATE:Zo,GAME_INIT:Wo,GAME_RESET:Yo,GAME_UPDATE:Qo,KEYDOWN:nr,KEYUP:or,LEVEL_LOADED:er,LOADER_COMPLETE:ir,LOADER_PROGRESS:sr,ONCONTEXT_LOST:yr,ONCONTEXT_RESTORED:fr,POINTERLOCKCHANGE:cr,POINTERMOVE:lr,STAGE_RESET:Xo,STATE_CHANGE:Jo,STATE_PAUSE:jo,STATE_RESTART:Uo,STATE_RESUME:No,STATE_STOP:qo,TICK:Fo,VIDEO_INIT:Ho,VIEWPORT_ONCHANGE:br,VIEWPORT_ONRESIZE:dr,WINDOW_ONORIENTATION_CHANGE:pr,WINDOW_ONRESIZE:ur,WINDOW_ONSCROLL:_r,emit:gr,off:Ar,on:xr,once:vr},Cr={};wr=Cr,function(){var e=function(){this.init()};e.prototype={init:function(){var t=this||i;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||i;if(t=parseFloat(t),e.ctx||c(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var n=e._howls[s]._getSoundIds(),o=0;o<n.length;o++){var r=e._howls[s]._soundById(n[o]);r&&r._node&&(r._node.volume=r._volume*t)}return e}return e._volume},mute:function(t){var e=this||i;e.ctx||c(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,i.ctx.currentTime);for(var s=0;s<e._howls.length;s++)if(!e._howls[s]._webAudio)for(var n=e._howls[s]._getSoundIds(),o=0;o<n.length;o++){var r=e._howls[s]._soundById(n[o]);r&&r._node&&(r._node.muted=!!t||r._muted)}return e},stop:function(){for(var t=this||i,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||i,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,c()),t},codecs:function(t){return(this||i)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||i;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||i,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var s=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",o=n.match(/OPR\/([0-6].)/g),r=o&&parseInt(o[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),h=n.match(/Version\/(.*?) /),l=a&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(r||!s&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!s,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||i;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,t._releaseHtml5Audio(s)}catch(i){t.noAudio=!0;break}for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var o=t._howls[n]._getSoundIds(),r=0;r<o.length;r++){var a=t._howls[n]._soundById(o[r]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var h=t.ctx.createBufferSource();h.buffer=t._scratchBuffer,h.connect(t.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),h.onended=function(){h.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||i;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||i;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&i.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var s=0;s<t._howls[e]._sounds.length;s++)if(!t._howls[e]._sounds[s]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&i.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var i=new e,s=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(t){var e=this;return i.ctx||c(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=i.usingWebAudio&&!e._html5,void 0!==i.ctx&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(i.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var s=0;s<t._src.length;s++){var o,a;if(t._format&&t._format[s])o=t._format[s];else{if("string"!=typeof(a=t._src[s])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(o=/^data:audio\/([^;,]+);/i.exec(a))||(o=/\.([^.]+)$/.exec(a.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&i.codecs(o)){e=t._src[s];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new n(t),t._webAudio&&r(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var s=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===s._state&&!s._sprite[t])return null;if(void 0===t&&(t="__default",!s._playLock)){for(var o=0,r=0;r<s._sounds.length;r++)s._sounds[r]._paused&&!s._sounds[r]._ended&&(o++,n=s._sounds[r]._id);1===o?t=null:n=null}}var a=n?s._soundById(n):s._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==s._state){a._sprite=t,a._ended=!1;var h=a._id;return s._queue.push({event:"play",action:function(){s.play(h)}}),h}if(n&&!a._paused)return e||s._loadQueue("play"),a._id;s._webAudio&&i._autoResume();var l=Math.max(0,a._seek>0?a._seek:s._sprite[t][0]/1e3),c=Math.max(0,(s._sprite[t][0]+s._sprite[t][1])/1e3-l),u=1e3*c/Math.abs(a._rate),m=s._sprite[t][0]/1e3,d=(s._sprite[t][0]+s._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var p=function(){a._paused=!1,a._seek=l,a._start=m,a._stop=d,a._loop=!(!a._loop&&!s._sprite[t][2])};if(!(l>=d)){var _=a._node;if(s._webAudio){var b=function(){s._playLock=!1,p(),s._refreshBuffer(a);var t=a._muted||s._muted?0:a._volume;_.gain.setValueAtTime(t,i.ctx.currentTime),a._playStart=i.ctx.currentTime,void 0===_.bufferSource.start?a._loop?_.bufferSource.noteGrainOn(0,l,86400):_.bufferSource.noteGrainOn(0,l,c):a._loop?_.bufferSource.start(0,l,86400):_.bufferSource.start(0,l,c),u!==1/0&&(s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),u)),e||setTimeout((function(){s._emit("play",a._id),s._loadQueue()}),0)};"running"===i.state&&"interrupted"!==i.ctx.state?b():(s._playLock=!0,s.once("resume",b),s._clearTimer(a._id))}else{var y=function(){_.currentTime=l,_.muted=a._muted||s._muted||i._muted||_.muted,_.volume=a._volume*i.volume(),_.playbackRate=a._rate;try{var n=_.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(s._playLock=!0,p(),n.then((function(){s._playLock=!1,_._unlocked=!0,e?s._loadQueue():s._emit("play",a._id)})).catch((function(){s._playLock=!1,s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(s._playLock=!1,p(),s._emit("play",a._id)),_.playbackRate=a._rate,_.paused)return void s._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?s._endTimers[a._id]=setTimeout(s._ended.bind(s,a),u):(s._endTimers[a._id]=function(){s._ended(a),_.removeEventListener("ended",s._endTimers[a._id],!1)},_.addEventListener("ended",s._endTimers[a._id],!1))}catch(t){s._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===_.src&&(_.src=s._src,_.load());var f=window&&window.ejecta||!_.readyState&&i._navigator.isCocoonJS;if(_.readyState>=3||f)y();else{s._playLock=!0,s._state="loading";var g=function(){s._state="loaded",y(),_.removeEventListener(i._canPlayEvent,g,!1)};_.addEventListener(i._canPlayEvent,g,!1),s._clearTimer(a._id)}}return a._id}s._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),s=0;s<i.length;s++){e._clearTimer(i[s]);var n=e._soundById(i[s]);if(n&&!n._paused&&(n._seek=e.seek(i[s]),n._rateSeek=0,n._paused=!0,e._stopFade(i[s]),n._node))if(e._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),e._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||e._emit("pause",n?n._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var s=i._getSoundIds(t),n=0;n<s.length;n++){i._clearTimer(s[n]);var o=i._soundById(s[n]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,i._stopFade(s[n]),o._node&&(i._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),i._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&i._clearSound(o._node))),e||i._emit("stop",o._id))}return i},mute:function(t,e){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"mute",action:function(){s.mute(t,e)}}),s;if(void 0===e){if("boolean"!=typeof t)return s._muted;s._muted=t}for(var n=s._getSoundIds(e),o=0;o<n.length;o++){var r=s._soundById(n[o]);r&&(r._muted=t,r._interval&&s._stopFade(r._id),s._webAudio&&r._node?r._node.gain.setValueAtTime(t?0:r._volume,i.ctx.currentTime):r._node&&(r._node.muted=!!i._muted||t),s._emit("mute",r._id))}return s},volume:function(){var t,e,s,n=this,o=arguments;if(0===o.length)return n._volume;if(1===o.length||2===o.length&&void 0===o[1]?n._getSoundIds().indexOf(o[0])>=0?e=parseInt(o[0],10):t=parseFloat(o[0]):o.length>=2&&(t=parseFloat(o[0]),e=parseInt(o[1],10)),!(void 0!==t&&t>=0&&t<=1))return(s=e?n._soundById(e):n._sounds[0])?s._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,o)}}),n;void 0===e&&(n._volume=t),e=n._getSoundIds(e);for(var r=0;r<e.length;r++)(s=n._soundById(e[r]))&&(s._volume=t,o[2]||n._stopFade(e[r]),n._webAudio&&s._node&&!s._muted?s._node.gain.setValueAtTime(t,i.ctx.currentTime):s._node&&!s._muted&&(s._node.volume=t*i.volume()),n._emit("volume",s._id));return n},fade:function(t,e,s,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(t,e,s,n)}}),o;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),s=parseFloat(s),o.volume(t,n);for(var r=o._getSoundIds(n),a=0;a<r.length;a++){var h=o._soundById(r[a]);if(h){if(n||o._stopFade(r[a]),o._webAudio&&!h._muted){var l=i.ctx.currentTime,c=l+s/1e3;h._volume=t,h._node.gain.setValueAtTime(t,l),h._node.gain.linearRampToValueAtTime(e,c)}o._startFadeInterval(h,t,e,s,r[a],void 0===n)}}return o},_startFadeInterval:function(t,e,i,s,n,o){var r=this,a=e,h=i-e,l=Math.abs(h/.01),c=Math.max(4,l>0?s/l:s),u=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var n=(Date.now()-u)/s;u=Date.now(),a+=h*n,a=Math.round(100*a)/100,a=h<0?Math.max(i,a):Math.min(i,a),r._webAudio?t._volume=a:r.volume(a,t._id,!0),o&&(r._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,r.volume(i,t._id),r._emit("fade",t._id))}),c)},_stopFade:function(t){var e=this,s=e._soundById(t);return s&&s._interval&&(e._webAudio&&s._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(s._interval),s._interval=null,e.volume(s._fadeTo,t),s._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,i,s=this,n=arguments;if(0===n.length)return s._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(i=s._soundById(parseInt(n[0],10)))&&i._loop;t=n[0],s._loop=t}else 2===n.length&&(t=n[0],e=parseInt(n[1],10));for(var o=s._getSoundIds(e),r=0;r<o.length;r++)(i=s._soundById(o[r]))&&(i._loop=t,s._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,s.playing(o[r])&&(s.pause(o[r],!0),s.play(o[r],!0)))));return s},rate:function(){var t,e,s,n=this,o=arguments;if(0===o.length?e=n._sounds[0]._id:1===o.length?n._getSoundIds().indexOf(o[0])>=0?e=parseInt(o[0],10):t=parseFloat(o[0]):2===o.length&&(t=parseFloat(o[0]),e=parseInt(o[1],10)),"number"!=typeof t)return(s=n._soundById(e))?s._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,o)}}),n;void 0===e&&(n._rate=t),e=n._getSoundIds(e);for(var r=0;r<e.length;r++)if(s=n._soundById(e[r])){n.playing(e[r])&&(s._rateSeek=n.seek(e[r]),s._playStart=n._webAudio?i.ctx.currentTime:s._playStart),s._rate=t,n._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.setValueAtTime(t,i.ctx.currentTime):s._node&&(s._node.playbackRate=t);var a=n.seek(e[r]),h=1e3*((n._sprite[s._sprite][0]+n._sprite[s._sprite][1])/1e3-a)/Math.abs(s._rate);!n._endTimers[e[r]]&&s._paused||(n._clearTimer(e[r]),n._endTimers[e[r]]=setTimeout(n._ended.bind(n,s),h)),n._emit("rate",s._id)}return n},seek:function(){var t,e,s=this,n=arguments;if(0===n.length?s._sounds.length&&(e=s._sounds[0]._id):1===n.length?s._getSoundIds().indexOf(n[0])>=0?e=parseInt(n[0],10):s._sounds.length&&(e=s._sounds[0]._id,t=parseFloat(n[0])):2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10)),void 0===e)return 0;if("number"==typeof t&&("loaded"!==s._state||s._playLock))return s._queue.push({event:"seek",action:function(){s.seek.apply(s,n)}}),s;var o=s._soundById(e);if(o){if(!("number"==typeof t&&t>=0)){if(s._webAudio){var r=s.playing(e)?i.ctx.currentTime-o._playStart:0,a=o._rateSeek?o._rateSeek-o._seek:0;return o._seek+(a+r*Math.abs(o._rate))}return o._node.currentTime}var h=s.playing(e);h&&s.pause(e,!0),o._seek=t,o._ended=!1,s._clearTimer(e),s._webAudio||!o._node||isNaN(o._node.duration)||(o._node.currentTime=t);var l=function(){h&&s.play(e,!0),s._emit("seek",e)};if(h&&!s._webAudio){var c=function(){s._playLock?setTimeout(c,0):l()};setTimeout(c,0)}else l()}return s},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var s=0;s<e._sounds.length;s++)if(!e._sounds[s]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,s=e._soundById(t);return s&&(i=e._sprite[s._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,s=0;s<e.length;s++)e[s]._paused||t.stop(e[s]._id),t._webAudio||(t._clearSound(e[s]._node),e[s]._node.removeEventListener("error",e[s]._errorFn,!1),e[s]._node.removeEventListener(i._canPlayEvent,e[s]._loadFn,!1),e[s]._node.removeEventListener("ended",e[s]._endFn,!1),i._releaseHtml5Audio(e[s]._node)),delete e[s]._node,t._clearTimer(e[s]._id);var n=i._howls.indexOf(t);n>=0&&i._howls.splice(n,1);var r=!0;for(s=0;s<i._howls.length;s++)if(i._howls[s]._src===t._src||t._src.indexOf(i._howls[s]._src)>=0){r=!1;break}return o&&r&&delete o[t._src],i.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,s){var n=this["_on"+t];return"function"==typeof e&&n.push(s?{id:i,fn:e,once:s}:{id:i,fn:e}),this},off:function(t,e,i){var s=this,n=s["_on"+t],o=0;if("number"==typeof e&&(i=e,e=null),e||i)for(o=0;o<n.length;o++){var r=i===n[o].id;if(e===n[o].fn&&r||!e&&r){n.splice(o,1);break}}else if(t)s["_on"+t]=[];else{var a=Object.keys(s);for(o=0;o<a.length;o++)0===a[o].indexOf("_on")&&Array.isArray(s[a[o]])&&(s[a[o]]=[])}return s},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var s=this,n=s["_on"+t],o=n.length-1;o>=0;o--)n[o].id&&n[o].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(s,n[o].fn),0),n[o].once&&s.off(t,n[o].fn,n[o].id));return s._loadQueue(t),s},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,s=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!(!t._loop&&!e._sprite[s][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=i.ctx.currentTime;var o=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),o)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),i._autoSuspend()),e._webAudio||n||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new n(t)},_drain:function(){var t=this,e=t._pool,i=0,s=0;if(!(t._sounds.length<e)){for(s=0;s<t._sounds.length;s++)t._sounds[s]._ended&&i++;for(s=t._sounds.length-1;s>=0;s--){if(i<=e)return;t._sounds[s]._ended&&(t._webAudio&&t._sounds[s]._node&&t._sounds[s]._node.disconnect(0),t._sounds.splice(s,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=i.ctx.createBufferSource(),t._node.bufferSource.buffer=o[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,i.ctx.currentTime),this},_cleanBuffer:function(t){var e=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=i._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(t){this._parent=t,this.init()};n.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,s=i._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),t._node.gain.setValueAtTime(s,i.ctx.currentTime),t._node.paused=!0,t._node.connect(i.masterGain)):i.noAudio||(t._node=i._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(i._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=s*i.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++i._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(i._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var o={},r=function(t){var e=t._src;if(o[e])return t._duration=o[e].duration,void l(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),s=new Uint8Array(i.length),n=0;n<i.length;++n)s[n]=i.charCodeAt(n);h(s.buffer,t)}else{var r=new XMLHttpRequest;r.open(t._xhr.method,e,!0),r.withCredentials=t._xhr.withCredentials,r.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){r.setRequestHeader(e,t._xhr.headers[e])})),r.onload=function(){var e=(r.status+"")[0];"0"===e||"2"===e||"3"===e?h(r.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete o[e],t.load())},a(r)}},a=function(t){try{t.send()}catch(e){t.onerror()}},h=function(t,e){var s=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(t){t&&e._sounds.length>0?(o[e._src]=t,l(e,t)):s()};"undefined"!=typeof Promise&&1===i.ctx.decodeAudioData.length?i.ctx.decodeAudioData(t).then(n).catch(s):i.ctx.decodeAudioData(t,n,s)},l=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},c=function(){if(i.usingWebAudio){try{"undefined"!=typeof AudioContext?i.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch(t){i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),e=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),s=e?parseInt(e[1],10):null;if(t&&s&&s<9){var n=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!n&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=void 0===i.ctx.createGain?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};wr.Howler=i,wr.Howl=s,void 0!==t?(t.HowlerGlobal=e,t.Howler=i,t.Howl=s,t.Sound=n):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=i,window.Howl=s,window.Sound=n)}(),function(){var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var s=this;return s.ctx&&s.ctx.listener?(e="number"!=typeof e?s._pos[1]:e,i="number"!=typeof i?s._pos[2]:i,"number"!=typeof t?s._pos:(s._pos=[t,e,i],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(t,e,i,s,n,o){var r=this;if(!r.ctx||!r.ctx.listener)return r;var a=r._orientation;return e="number"!=typeof e?a[1]:e,i="number"!=typeof i?a[2]:i,s="number"!=typeof s?a[3]:s,n="number"!=typeof n?a[4]:n,o="number"!=typeof o?a[5]:o,"number"!=typeof t?a:(r._orientation=[t,e,i,s,n,o],void 0!==r.ctx.listener.forwardX?(r.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),r.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),r.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),r.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),r.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),r.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):r.ctx.listener.setOrientation(t,e,i,s,n,o),r)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(t,i)}}),s;var n=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0]}for(var o=s._getSoundIds(i),r=0;r<o.length;r++){var a=s._soundById(o[r]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,n),"spatial"===n?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",a._id)}}return s},Howl.prototype.pos=function(t,i,s,n){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(t,i,s,n)}}),o;if(i="number"!=typeof i?0:i,s="number"!=typeof s?-.5:s,void 0===n){if("number"!=typeof t)return o._pos;o._pos=[t,i,s]}for(var r=o._getSoundIds(n),a=0;a<r.length;a++){var h=o._soundById(r[a]);if(h){if("number"!=typeof t)return h._pos;h._pos=[t,i,s],h._node&&(h._panner&&!h._panner.pan||e(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(t,i,s)),o._emit("pos",h._id)}}return o},Howl.prototype.orientation=function(t,i,s,n){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(t,i,s,n)}}),o;if(i="number"!=typeof i?o._orientation[1]:i,s="number"!=typeof s?o._orientation[2]:s,void 0===n){if("number"!=typeof t)return o._orientation;o._orientation=[t,i,s]}for(var r=o._getSoundIds(n),a=0;a<r.length;a++){var h=o._soundById(r[a]);if(h){if("number"!=typeof t)return h._orientation;h._orientation=[t,i,s],h._node&&(h._panner||(h._pos||(h._pos=o._pos||[0,0,-.5]),e(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,s)),o._emit("orientation",h._id)}}return o},Howl.prototype.pannerAttr=function(){var t,i,s,n=this,o=arguments;if(!n._webAudio)return n;if(0===o.length)return n._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(s=n._soundById(parseInt(o[0],10)))?s._pannerAttr:n._pannerAttr;t=o[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),n._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:n._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:n._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:n._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:n._panningModel})}else 2===o.length&&(t=o[0],i=parseInt(o[1],10));for(var r=n._getSoundIds(i),a=0;a<r.length;a++)if(s=n._soundById(r[a])){var h=s._pannerAttr;h={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:h.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:h.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:h.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:h.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:h.panningModel};var l=s._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel):(s._pos||(s._pos=n._pos||[0,0,-.5]),e(s,"spatial"))}return n},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}();let Vr,Br="",Tr={},Mr=!1;function Ir(t=!1){Br=t?"?"+~~(1e7*Math.random()):""}function Pr(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Er(t){return"string"==typeof t&&(t=t.trim()),!isNaN(t)&&/^[+-]?(\d+(\.\d+)?|\.\d+)$/.test(t)}function Dr(t){return/^data:(.+);base64,(.+)$/.test(t)}let Rr={},Lr=null,Gr=0,kr=[],Fr=function(t,e){if(Gr++>3){let i="melonJS: failed loading "+t;if(!1!==Or)throw new Error(i);zr(),e&&e(),console.log(i+", disabling audio")}else Rr[t].load()},Or=!0;function zr(){Ur()}function jr(t,e,i){let s=[];if(0===kr.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");if(!0===Dr(t.src))s.push(t.src);else for(let e=0;e<kr.length;e++)s.push(t.src+t.name+"."+kr[e]+Br);return Rr[t.name]=new Cr.Howl({src:s,volume:Cr.Howler.volume(),html5:!0===t.stream||!0===t.html5,xhrWithCredentials:Mr,onloaderror(){Fr.call(this,t.name,i)},onload(){Gr=0,"function"==typeof e&&e()}}),1}function Nr(){null!==Lr&&Rr[Lr].pause()}function qr(){null!==Lr&&Rr[Lr].play()}function Ur(){Cr.Howler.mute(!0)}function Jr(t){return t in Rr&&(Rr[t].unload(),delete Rr[t],!0)}function Xr(){for(let t in Rr)Rr.hasOwnProperty(t)&&Jr(t)}var Hr=function(t="mp3"){return kr=t.split(","),!Cr.Howler.noAudio};let Wr={},Yr=!1;try{Yr="undefined"!=typeof globalThis&&void 0!==globalThis.localStorage}catch(t){Yr=!1}function Zr(t){return"add"===t||"remove"===t}xr(ko,(()=>{if(!0===Yr){let t=globalThis.localStorage.getItem("me.save");"string"==typeof t&&t.length>0&&(JSON.parse(t)||[]).forEach((t=>{Wr[t]=JSON.parse(globalThis.localStorage.getItem("me.save."+t))}))}}));let Kr={add(t){let e=Kr;Object.keys(t).forEach((i=>{var s;Zr(i)||(s=i,Object.defineProperty(e,s,{configurable:!0,enumerable:!0,get(){return Wr[s]},set(t){Wr[s]=t,!0===Yr&&globalThis.localStorage.setItem("me.save."+s,JSON.stringify(t))}}),i in Wr||(e[i]=t[i]))})),!0===Yr&&globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Wr)))},remove(t){Zr(t)||void 0!==Wr[t]&&(delete Wr[t],!0===Yr&&(globalThis.localStorage.removeItem("me.save."+t),globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(Wr)))))}};const Qr=["ms","MS","moz","webkit","o"];function $r(t,e){if(t in(e=e||globalThis))return e[t];let i,s=Pr(t);return Qr.some((t=>{let n=t+s;return i=n in e?e[n]:void 0})),i}function ta(t,e,i){if(t in(i=i||globalThis))return void(i[t]=e);let s=Pr(t);return Qr.some((t=>{let n=t+s;if(n in i)return i[n]=e,!0})),!1}const ea=void 0!==globalThis.navigator?globalThis.navigator.userAgent:"",ia=/iPhone|iPad|iPod/i.test(ea),sa=/Android/i.test(ea),na=/Android 2/i.test(ea),oa=/Linux/i.test(ea),ra=/CrOS/.test(ea),aa=/Windows Phone/i.test(ea),ha=/BlackBerry/i.test(ea),la=/Kindle|Silk.*Mobile Safari/i.test(ea),ca=void 0!==globalThis.ejecta,ua=/MicroMessenger/i.test(ea),ma=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name,da=/Mobi/i.test(ea)||ia||sa||aa||ha||la||!1;let pa=!1,_a=!1;function ba(){if(!_a){if(void 0!==globalThis.document&&!globalThis.document.body)return setTimeout(ba,13);void 0!==globalThis.document&&"function"==typeof globalThis.document.removeEventListener&&globalThis.document.removeEventListener("DOMContentLoaded",ba,!1),"function"==typeof globalThis.removeEventListener&&globalThis.removeEventListener("load",ba,!1),gr(Go),_a=!0}}let ya=!1,fa=!1,ga=!0,xa={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};function va(t){return t.preventDefault(),"function"==typeof globalThis.scroll&&globalThis.scroll(0,0),!1}function Aa(t){qa=t.accelerationIncludingGravity.x,Ua=t.accelerationIncludingGravity.y,Ja=t.accelerationIncludingGravity.z}function wa(t){Xa=t.gamma,Ha=t.beta,Wa=t.alpha}let Sa={__proto__:null,BlackBerry:ha,Kindle:la,android:sa,android2:na,chromeOS:ra,ejecta:ca,iOS:ia,isMobile:da,isWeixin:ua,linux:oa,nodeJS:ma,ua:ea,wp:aa};const Ca=!!("ontouchstart"in globalThis),Va=!!globalThis.PointerEvent,Ba=Ca||Va&&globalThis.navigator.maxTouchPoints>0,Ta=Ba?Va?globalThis.navigator.maxTouchPoints||1:10:1,Ma=void 0!==globalThis.document&&"onwheel"in globalThis.document.createElement("div"),Ia=void 0!==globalThis.document&&void 0!==globalThis.document.pointerLockElement,Pa=!!globalThis.DeviceOrientationEvent,Ea="undefined"!=typeof screen&&void 0!==screen.orientation,Da=!!globalThis.DeviceMotionEvent,Ra=void 0!==globalThis.document&&($r("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);!0===Ra&&(globalThis.document.exitFullscreen=$r("cancelFullScreen",globalThis.document)||$r("exitFullscreen",globalThis.document));const La=!(!globalThis.AudioContext&&!globalThis.webkitAudioContext),Ga=void 0!==globalThis.Audio,ka=La||Ga,Fa=function(){try{return!!globalThis.localStorage}catch(t){return!1}}(),Oa=function(){try{return void 0!==globalThis.OffscreenCanvas&&null!==new globalThis.OffscreenCanvas(0,0).getContext("2d")}catch(t){return!1}}(),za="function"==typeof globalThis.atob,ja=void 0!==globalThis.navigator&&(globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage)||"en",Na=globalThis.devicePixelRatio||1;let qa=0,Ua=0,Ja=0,Xa=0,Ha=0,Wa=0,Ya=!0;function Za(t){"function"==typeof globalThis.addEventListener&&(globalThis.addEventListener("blur",(()=>{gr(Oo)}),!1),globalThis.addEventListener("focus",(()=>{gr(zo),!0===Ya&&oh()}),!1)),void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("visibilitychange",(()=>{"visible"===globalThis.document.visibilityState?(gr(zo),!0===Ya&&oh()):gr(Oo)}),!1),function(t){_a?t.call(globalThis,[]):(vr(Go,t,globalThis),pa||(!0===ma||void 0!==globalThis.document&&"complete"===globalThis.document.readyState?globalThis.setTimeout(ba,0):(void 0!==globalThis.document&&"function"==typeof globalThis.document.addEventListener&&globalThis.document.addEventListener("DOMContentLoaded",ba,!1),globalThis.addEventListener("load",ba,!1)),pa=!0))}(t)}function Ka(t){let e=Va?"pointermove":Ca?"touchmove":"mousemove";!1!==t?!1===ga&&(globalThis.document.removeEventListener(e,va),ga=!0):!0===ga&&(globalThis.document.addEventListener(e,va,{passive:!1}),ga=!1)}function Qa(){return!(!Ra||!$r("fullscreenElement",globalThis.document)&&!globalThis.document.mozFullScreenElement)}function $a(){const t="portrait",e="landscape";let i=globalThis.screen;if(!0===Ea){let t=$r("orientation",i);if(void 0!==t&&"string"==typeof t.type)return t.type;if("string"==typeof t)return t}return"number"==typeof globalThis.orientation?90===Math.abs(globalThis.orientation)?e:t:globalThis.outerWidth>globalThis.outerHeight?e:t}function th(t){let e=eh(t);return null!==e.parentNode&&(e=e.parentNode),e}function eh(t){let e=null;return"undefined"!==t&&("string"==typeof t?e=globalThis.document.getElementById(t):"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE&&(e=t)),e||(e=globalThis.document.body),e}function ih(t){return"object"==typeof t&&t!==globalThis.document.body&&void 0!==t.getBoundingClientRect?t.getBoundingClientRect():(xa.width=xa.right=globalThis.innerWidth,xa.height=xa.bottom=globalThis.innerHeight,xa)}function sh(t){return ih(th(t))}function nh(t){let e=!1;try{let i=globalThis.document.createElement("canvas"),s={stencil:!0,failIfMajorPerformanceCaveat:t.failIfMajorPerformanceCaveat};e=!(!globalThis.WebGLRenderingContext||!i.getContext("webgl",s)&&!i.getContext("experimental-webgl",s))}catch(t){e=!1}return e}function oh(){"function"==typeof globalThis.focus&&globalThis.focus()}var rh={__proto__:null,get accelerationX(){return qa},get accelerationY(){return Ua},get accelerationZ(){return Ja},get alpha(){return Wa},autoFocus:Ya,get beta(){return Ha},devicePixelRatio:Na,enableSwipe:Ka,exitFullscreen:function(){Ra&&Qa()&&globalThis.document.exitFullscreen()},focus:oh,get gamma(){return Xa},getElement:eh,getElementBounds:ih,getParentBounds:sh,getParentElement:th,getScreenOrientation:$a,getStorage:function(t="local"){if("local"===t)return Kr;throw new Error("storage type "+t+" not supported")},hasAccelerometer:Da,hasDeviceOrientation:Pa,hasFullscreenSupport:Ra,hasHTML5Audio:Ga,hasPointerLockSupport:Ia,hasWebAudio:La,isFullscreen:Qa,isLandscape:function(){return $a().includes("landscape")},isMobile:Sa.isMobile,isPortrait:function(){return $a().includes("portrait")},isWebGLSupported:nh,language:ja,localStorage:Fa,lockOrientation:function(t){let e=globalThis.screen;if(void 0!==e){let i=$r("lockOrientation",e);if(void 0!==i)return i(t)}return!1},maxTouchPoints:Ta,nativeBase64:za,offscreenCanvas:Oa,onDeviceRotate:wa,onReady:Za,pauseOnBlur:!0,platform:Sa,pointerEvent:Va,requestFullscreen:function(t){Ra&&!Qa()&&((t=t||lh()).requestFullscreen=$r("requestFullscreen",t)||t.mozRequestFullScreen,t.requestFullscreen())},resumeOnFocus:!0,screenOrientation:Ea,sound:ka,stopOnBlur:!1,touch:Ba,touchEvent:Ca,unlockOrientation:function(){let t=globalThis.screen;if(void 0!==t){let e=$r("unlockOrientation",t);if(void 0!==e)return e()}return!1},unwatchAccelerometer:function(){ya&&(globalThis.removeEventListener("devicemotion",Aa,!1),ya=!1)},unwatchDeviceOrientation:function(){fa&&(globalThis.removeEventListener("deviceorientation",wa,!1),fa=!1)},vibrate:function(t){void 0!==globalThis.navigator&&"function"==typeof globalThis.navigator.vibrate&&globalThis.navigator.vibrate(t)},watchAccelerometer:function(){return Da&&!ya&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("devicemotion",Aa,!1),ya=!0)})).catch(console.error):(globalThis.addEventListener("devicemotion",Aa,!1),ya=!0)),ya},watchDeviceOrientation:function(){return Pa&&!fa&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(globalThis.addEventListener("deviceorientation",wa,!1),fa=!0)})).catch(console.error):(globalThis.addEventListener("deviceorientation",wa,!1),fa=!0)),fa},wheel:Ma};let ah=null;function hh(t,e,i=!1){let s;if(0===t||0===e)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===Oa&&!0===i?(s=new globalThis.OffscreenCanvas(0,0),void 0===s.style&&(s.style={})):s=globalThis.document.createElement("canvas"),s.width=t,s.height=e,s}function lh(){return mm.getParentElement()}var ch={__proto__:null,AUTO:2,CANVAS:0,WEBGL:1,createCanvas:hh,getParent:lh,init:function(t,e,i){if(!um)throw new Error("me.video.init() called before engine initialization.");try{mm.init(t,e,i)}catch(t){return console.log(t.message),!1}return ah=mm.renderer,globalThis.addEventListener("resize",Do((t=>{gr(ur,t)}),100),!1),globalThis.addEventListener("orientationchange",(t=>{gr(pr,t)}),!1),globalThis.addEventListener("onmozorientationchange",(t=>{gr(pr,t)}),!1),!0===Ea&&(globalThis.screen.orientation.onchange=function(t){gr(pr,t)}),globalThis.addEventListener("scroll",Do((t=>{gr(_r,t)}),100),!1),gr(Ho,mm.renderer),!0},get renderer(){return ah}};let uh={},mh={},dh={},ph={},_h={},bh={},yh=function(t,e,i){e=e||t.keyCode||t.button;let s=bh[e];if(gr(nr,s,e,!s||!dh[s]),s){if(!dh[s]){let t=void 0!==i?i:e;ph[s][t]||(uh[s]++,ph[s][t]=!0)}return!_h[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},fh=function(t,e,i){e=e||t.keyCode||t.button;let s=bh[e];if(gr(or,s,e),s){let n=void 0!==i?i:e;return ph[s][n]=void 0,uh[s]>0&&uh[s]--,dh[s]=!1,!_h[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},gh=null;function xh(){null===gh&&!1===da&&(gh=globalThis,"function"==typeof gh.addEventListener&&(gh.addEventListener("keydown",yh,!1),gh.addEventListener("keyup",fh,!1)))}function vh(t,e,i){!0===e?yh({},t,i):fh({},t,i)}function Ah(t){return bh[t]}let wh=new Fn;class Sh extends Io{constructor(t=0,e=0,i=1,s=1){super(),this.setMinMax(t,e,t+i,e+s),this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.movementX=0,this.movementY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.isNormalized=!1,this.locked=!1,this.bind=[0,0,0]}setEvent(t,e=0,i=0,s=0,n=0,o=1){this.event=t,this.pageX=e,this.pageY=i,this.clientX=s,this.clientY=n,il(this.pageX,this.pageY,wh),this.gameScreenX=this.x=wh.x,this.gameScreenY=this.y=wh.y,this.isNormalized=void 0!==globalThis.PointerEvent&&!(t instanceof globalThis.PointerEvent),this.locked=el,this.movementX=t.movementX||0,this.movementY=t.movementY||0,"wheel"===t.type?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=o,this.isPrimary=void 0===t.isPrimary||t.isPrimary,this.button=t.button||0,this.type=t.type,void 0!==mm.viewport&&mm.viewport.localToWorld(this.gameScreenX,this.gameScreenY,wh),this.gameWorldX=wh.x,this.gameWorldY=wh.y,!1===this.isNormalized?(this.width=t.width||1,this.height=t.height||1):"number"==typeof t.radiusX?(this.width=2*t.radiusX||1,this.height=2*t.radiusY||1):this.width=this.height=1}}let Ch,Vh=[],Bh=new Map,Th=!1,Mh=0,Ih=[];const Ph=["wheel"],Eh=["pointermove","mousemove","touchmove"],Dh=["pointerdown","mousedown","touchstart"],Rh=["pointerup","mouseup","touchend"],Lh=["pointercancel","mousecancel","touchcancel"],Gh=["pointerenter","mouseenter","touchenter"],kh=["pointerover","mouseover","touchover"],Fh=["pointerleave","mouseleave","touchleave"],Oh=[Ph[0],Eh[0],Dh[0],Rh[0],Lh[0],Gh[0],kh[0],Fh[0]],zh=[Ph[0],Eh[1],Dh[1],Rh[1],Lh[1],Gh[1],kh[1],Fh[1]],jh=[Eh[2],Dh[2],Rh[2],Lh[2],Gh[2],kh[2],Fh[2]],Nh={wheel:Ph,pointermove:Eh,pointerdown:Dh,pointerup:Rh,pointercancel:Lh,pointerenter:Gh,pointerover:kh,pointerleave:Fh};let qh=[];function Uh(){if(!Th){Ch=new wo(0,0,1,1);for(let t=0;t<Ta;t++)Vh.push(new Sh);null===$h&&($h=ah.getCanvas()),Ih=Va?Oh:zh,Ba&&!Va&&(Ih=Ih.concat(jh)),function(t,e){for(let i=0;i<t.length;i++)-1===Eh.indexOf(t[i])&&$h.addEventListener(t[i],e,{passive:!1===_l})}(Ih,Kh),void 0===Qh&&(Qh=~~(1e3/cu.maxfps)),!0===Ya&&(oh(),$h.addEventListener(Ih[2],(()=>{oh()}),{passive:!1===_l}));let t=Xh(Ih,Eh);if(Qh<17)for(let e=0;e<t.length;e++)-1!==Ih.indexOf(t[e])&&$h.addEventListener(t[e],Zh,{passive:!0});else for(let e=0;e<t.length;e++)-1!==Ih.indexOf(t[e])&&$h.addEventListener(t[e],Do(Zh,Qh,!1),{passive:!0});sl($h),Ia&&globalThis.document.addEventListener("pointerlockchange",(()=>{el=globalThis.document.pointerLockElement===mm.getParentElement(),gr(cr,el)}),!0),Th=!0}}function Jh(t,e){for(let i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return e[i]}function Xh(t,e){let i=[];for(let s=0;s<e.length;s++)-1!==t.indexOf(e[s])&&i.push(e[s]);return i}function Hh(t,e,i,s){let n;if(t.callbacks[e]){t.pointerId=s;for(let s=t.callbacks[e].length-1;s>=0&&(n=t.callbacks[e][s]);s--)if(!1===n(i))return!0}return!1}function Wh(t){let e=!1;for(;t.length>0;){let i=t.pop();if(Vh.push(i),!0===i.isNormalized&&void 0!==i.event.timeStamp){if(i.event.timeStamp<Mh)continue;Mh=i.event.timeStamp}Ch.setShape(i.gameWorldX,i.gameWorldY,i.width,i.height),Eh.includes(i.type)&&(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY,gr(lr,i));let s=mm.world.broadphase.retrieve(Ch,mm.world._sortReverseZ);s=s.concat([mm.viewport]);for(let t,n=s.length;n--,t=s[n];){if(Bh.has(t)&&!0!==t.isKinematic){const s=Bh.get(t),n=s.region,o=n.ancestor,r=n.getBounds();let a=!1;if(!0===n.isFloating?(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY):(i.gameX=i.gameLocalX=i.gameWorldX,i.gameY=i.gameLocalY=i.gameWorldY),void 0!==o){let t=o.getBounds();i.gameLocalX=i.gameX-t.x,i.gameLocalY=i.gameY-t.y}switch(a=r.contains(i.gameX,i.gameY),i.type){case Eh[0]:case Eh[1]:case Eh[2]:case Eh[3]:if(s.pointerId!==i.pointerId||a){if(null===s.pointerId&&a&&Hh(s,Jh(Ih,Gh),i,i.pointerId)){e=!0;break}}else if(Hh(s,Jh(Ih,Fh),i,null)){e=!0;break}if(a&&Hh(s,i.type,i,i.pointerId)){e=!0;break}break;case Rh[0]:case Rh[1]:case Rh[2]:case Rh[3]:if(s.pointerId===i.pointerId&&a&&Hh(s,i.type,i,null)){e=!0;break}break;case Lh[0]:case Lh[1]:case Lh[2]:case Lh[3]:if(s.pointerId===i.pointerId&&Hh(s,i.type,i,null)){e=!0;break}break;default:if(a&&Hh(s,i.type,i,i.pointerId)){e=!0;break}}}if(!0===e)break}}return e}function Yh(t){let e;if(Ca&&t.changedTouches)for(let i=0,s=t.changedTouches.length;i<s;i++){const s=t.changedTouches[i];e=Vh.pop(),e.setEvent(t,s.pageX,s.pageY,s.clientX,s.clientY,s.identifier),qh.push(e)}else e=Vh.pop(),e.setEvent(t,t.pageX,t.pageY,t.clientX,t.clientY,t.pointerId),qh.push(e);return!1===t.isPrimary||(qh[0].isPrimary=!0,Object.assign(tl,qh[0])),qh}function Zh(t){Wh(Yh(t))}function Kh(t){Yh(t);let e=qh[0].button;(Wh(qh)||"wheel"===t.type)&&!0===_l&&t.preventDefault();let i=tl.bind[e];i&&vh(i,Dh.includes(t.type),e+1)}let Qh,$h=null,tl=new Sh(0,0,1,1),el=!1;function il(t,e,i){i=i||Bn.pull("Vector2d");let s=ih(ah.getCanvas()),n=globalThis.devicePixelRatio||1;t-=s.left+(globalThis.pageXOffset||0),e-=s.top+(globalThis.pageYOffset||0);let o=ah.scaleRatio;return 1===o.x&&1===o.y||(t/=o.x,e/=o.y),i.set(t*n,e*n)}function sl(t,e){t.style["touch-action"]=e||"none"}function nl(t,e,i){if(-1===Oh.indexOf(t))throw new Error("invalid event type : "+t);let s=Xh(Ih,Nh[t]),n=Bh.get(e);if(void 0!==n){for(let t=0;t<s.length;t++){const e=s[t];if(n.callbacks[e]){if(void 0!==i)Co(n.callbacks[e],i);else for(;n.callbacks[e].length>0;)n.callbacks[e].pop();0===n.callbacks[e].length&&delete n.callbacks[e]}}0===Object.keys(n.callbacks).length&&Bh.delete(e)}}function ol(t){if(Bh.has(t))for(let e=0;e<Oh.length;e++)nl(Oh[e],t)}let rl=.1;function al(t,e,i){return t>0?i===this.GAMEPAD.BUTTONS.L2?Math.max(0,t-2e4)/111070:(t-1)/131070:(65536+t)/131070+.5}const hl=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,ll=/^0+/;function cl(t,e){const i=t.replace(hl,((t,e,i)=>"000".slice(e.length-1)+e+"-"+"000".slice(i.length-1)+i+"-")),s=t.replace(hl,((t,e,i)=>e.replace(ll,"")+"-"+i.replace(ll,"")+"-"));e.analog=e.analog||e.buttons.map((()=>-1)),e.normalize_fn=e.normalize_fn||function(t){return t},dl.set(i,e),dl.set(s,e)}let ul,ml={},dl=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:function(t,e,i){return i===this.GAMEPAD.BUTTONS.L2||i===this.GAMEPAD.BUTTONS.R2?(t+1)/2:t}}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:al}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:al}]].forEach((t=>{cl(t[0],t[1])}));let pl=function(){let t=navigator.getGamepads();Object.keys(ml).forEach((e=>{let i=t[e];if(!i)return;let s=null;"standard"!==i.mapping&&(s=dl.get(i.id));let n=ml[e];Object.keys(n.buttons).forEach((t=>{let o=n.buttons[t],r=t,a=-1;if(s&&(r=s.buttons[t],a=s.analog[t],r<0&&a<0))return;let h=i.buttons[r]||{};if(s&&a>=0){let e=s.normalize_fn(i.axes[a],-1,+t);h={value:e,pressed:h.pressed||Math.abs(e)>=rl}}gr(hr,e,"buttons",+t,h),!o.pressed&&h.pressed?vh(o.keyCode,!0,r+256):o.pressed&&!h.pressed&&vh(o.keyCode,!1,r+256),o.value=h.value,o.pressed=h.pressed})),Object.keys(n.axes).forEach((t=>{let o=n.axes[t],r=t;if(s&&(r=s.axes[t],r<0))return;let a=i.axes[r];if(void 0===a)return;s&&(a=s.normalize_fn(a,+t,-1));let h=Math.sign(a)||1;if(0===o[h].keyCode)return;let l=Math.abs(a)>=rl+Math.abs(o[h].threshold);gr(hr,e,"axes",+t,a),!o[h].pressed&&l?(o[-h].pressed&&(vh(o[-h].keyCode,!1,r+256),o[-h].value=0,o[-h].pressed=!1),vh(o[h].keyCode,!0,r+256)):!o[h].pressed&&!o[-h].pressed||l||(h=o[h].pressed?h:-h,vh(o[h].keyCode,!1,r+256)),o[h].value=a,o[h].pressed=l}))}))};globalThis.navigator&&"function"==typeof globalThis.navigator.getGamepads&&(globalThis.addEventListener("gamepadconnected",(t=>{gr(rr,t.gamepad)}),!1),globalThis.addEventListener("gamepaddisconnected",(t=>{gr(ar,t.gamepad)}),!1));let _l=!0;var bl={__proto__:null,GAMEPAD:{AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}},KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},bindGamepad:function(t,e,i){if(!Ah(i))throw new Error("no action defined for keycode "+i);void 0===ul&&"function"==typeof navigator.getGamepads&&(ul=xr(Zo,pl)),ml[t]||(ml[t]={axes:{},buttons:{}});let s={keyCode:i,value:0,pressed:!1,threshold:e.threshold},n=ml[t][e.type];if("buttons"===e.type)n[e.code]=s;else if("axes"===e.type){let t=Math.sign(e.threshold)||1;n[e.code]||(n[e.code]={});let i=n[e.code];i[t]=s,i[-t]||(i[-t]={keyCode:0,value:0,pressed:!1,threshold:-t})}},bindKey:function(t,e,i,s=_l){bh[t]=e,_h[t]=s,uh[e]=0,mh[e]=i||!1,dh[e]=!1,ph[e]={}},bindPointer:function(){let t=arguments.length<2?tl.LEFT:arguments[0],e=arguments.length<2?arguments[0]:arguments[1];if(Uh(),!Ah(e))throw new Error("no action defined for keycode "+e);tl.bind[t]=e},exitPointerLock:function(){return!!Ia&&(globalThis.document.exitPointerLock(),!0)},getBindingKey:Ah,globalToLocal:il,initKeyboardEvent:xh,isKeyPressed:function(t){return!(!uh[t]||dh[t]||(mh[t]&&(dh[t]=!0),0))},get keyBoardEventTarget(){return gh},keyStatus:function(t){return uh[t]>0},get locked(){return el},pointer:tl,get pointerEventTarget(){return $h},preventDefault:_l,registerPointerEvent:function(t,e,i){if(Uh(),-1===Oh.indexOf(t))throw new Error("invalid event type : "+t);if(void 0===e)throw new Error("registerPointerEvent: region for "+toString(e)+" event is undefined ");let s=Xh(Ih,Nh[t]);Bh.has(e)||Bh.set(e,{region:e,callbacks:{},pointerId:null});let n=Bh.get(e);for(let t=0;t<s.length;t++){const e=s[t];n.callbacks[e]?n.callbacks[e].push(i):n.callbacks[e]=[i]}},releaseAllPointerEvents:ol,releasePointerEvent:nl,requestPointerLock:function(){return!!Ia&&(mm.getParentElement().requestPointerLock(),!0)},setGamepadDeadzone:function(t){rl=t},setGamepadMapping:cl,setTouchAction:sl,get throttlingInterval(){return Qh},triggerKeyEvent:vh,unbindGamepad:function(t,e){if(!ml[t])throw new Error("no bindings for gamepad "+t);ml[t].buttons[e]={}},unbindKey:function(t){let e=bh[t];uh[e]=0,mh[e]=!1,ph[e]={},bh[t]=null,_h[t]=null},unbindPointer:function(t){tl.bind[void 0===t?tl.LEFT:t]=null},unlockKey:function(t){dh[t]=!1}};class yl extends wo{constructor(t,e,i,s){super(t,e,i,s),this.pos instanceof jn?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=Bn.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.anchorPoint instanceof zn?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=Bn.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),void 0===this.currentTransform&&(this.currentTransform=Bn.pull("Matrix2d")),this.currentTransform.identity(),this.body=void 0,this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.shader=void 0,this.blendMode="normal",this.name="",this.isRenderable=!0,this.isKinematic=!0,this.isDirty=!0,this._flip={x:!1,y:!1},this._inViewport=!1,this._tint=Bn.pull("Color",255,255,255,1),this.setOpacity(1)}get isFloating(){return!0===this.floating||void 0!==this.ancestor&&!0===this.ancestor.isFloating}get tint(){return this._tint}set tint(t){this._tint.copy(t),this.isDirty=!0}get depth(){return this.pos.z}set depth(t){this.pos.z=t,this.isDirty=!0}get inViewport(){return this._inViewport}set inViewport(t){this._inViewport!==t&&(this._inViewport=t,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,t))}get isFlippedX(){return!0===this._flip.x}get isFlippedY(){return!0===this._flip.y}getBounds(){return void 0===this._bounds&&(super.getBounds(),this.isFinite()?this.updateBounds():this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds}getOpacity(){return this.alpha}setOpacity(t){"number"==typeof t&&(this.alpha=wn(t,0,1),isNaN(this.alpha)&&(this.alpha=1),this.isDirty=!0)}flipX(t=!0){return this._flip.x=!!t,this.isDirty=!0,this}flipY(t=!0){return this._flip.y=!!t,this.isDirty=!0,this}transform(t){return this.currentTransform.multiply(t),this.updateBounds(),this.isDirty=!0,this}angleTo(t){let e,i,s=this.getBounds();if(t instanceof yl){let n=t.getBounds();e=n.centerX-s.centerX,i=n.centerY-s.centerY}else e=t.x-s.centerX,i=t.y-s.centerY;return Math.atan2(i,e)}distanceTo(t){let e,i,s=this.getBounds();if(t instanceof yl){let n=t.getBounds();e=s.centerX-n.centerX,i=s.centerY-n.centerY}else e=s.centerX-t.x,i=s.centerY-t.y;return Math.sqrt(e*e+i*i)}lookAt(t){let e;e=t instanceof yl?t.pos:t;let i=this.angleTo(e);return this.rotate(i),this}rotate(t,e){return 0!==t&&(this.currentTransform.rotate(t,e),this.updateBounds(),this.isDirty=!0),this}scale(t,e=t){return this.currentTransform.scale(t,e),this.updateBounds(),this.isDirty=!0,this}scaleV(t){return this.scale(t.x,t.y),this}update(t){return this.isDirty}updateBounds(t=!0){if(this.isRenderable){let e=this.getBounds();if(e.clear(),!0!==this.autoTransform||this.currentTransform.isIdentity()?(e.addFrame(0,0,this.width,this.height),e.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y)):(this.currentTransform.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y),e.addFrame(0,0,this.width,this.height,this.currentTransform),this.currentTransform.translate(this.width*this.anchorPoint.x,this.height*this.anchorPoint.y)),!0===t){let t=this.getAbsolutePosition();e.centerOn(t.x+e.x+e.width/2,t.y+e.y+e.height/2)}return e}return super.updateBounds(t)}updateBoundsPos(t=this.pos.x,e=this.pos.y){this.getBounds().translate(t-this.pos.x,e-this.pos.y)}getAbsolutePosition(){return void 0===this._absPos&&(this._absPos=Bn.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),void 0!==this.ancestor&&"function"==typeof this.ancestor.getAbsolutePosition&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos}onAnchorUpdate(t,e){this.anchorPoint.setMuted(t,e),this.updateBounds(),this.isDirty=!0}preDraw(t){let e=this.width*this.anchorPoint.x,i=this.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var s=this._flip.x?this.centerX-e:0,n=this._flip.y?this.centerY-i:0;t.translate(s,n),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-s,-n)}void 0!==this.mask&&(t.translate(this.pos.x,this.pos.y),t.setMask(this.mask),t.translate(-this.pos.x,-this.pos.y)),"object"==typeof this.shader&&void 0!==t.gl&&(t.customShader=this.shader),!0!==this.autoTransform||this.currentTransform.isIdentity()||(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-e,-i),t.setTint(this.tint,this.getOpacity()),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){}postDraw(t){t.clearTint(),void 0!==this.mask&&t.clearMask(),"object"==typeof this.shader&&void 0!==t.gl&&(t.customShader=void 0),t.restore(),this.isDirty=!1}onCollision(t,e){return!1}destroy(){Bn.push(this.currentTransform),this.currentTransform=void 0,Bn.push(this.anchorPoint),this.anchorPoint=void 0,Bn.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(Bn.push(this._absPos),this._absPos=void 0),Bn.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(Bn.push(this.mask),this.mask=void 0),void 0!==this._tint&&(Bn.push(this._tint),this._tint=void 0),this.ancestor=void 0,void 0!==this.body&&"function"==typeof this.body.destroy&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),ol(this),this.onDestroyEvent.apply(this,arguments),"object"==typeof this.shader&&(this.shader.destroy(),this.shader=void 0)}onDestroyEvent(){}}const fl=Math.min,gl=Math.max;let xl,vl=new Fn;class Al extends yl{constructor(t,e,i,s){super(t,e,i-t,s-e),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=Bn.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new qn,this.invCurrentTransform=new Nn,this.offset=new Fn,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,s),this._updateProjectionMatrix(),xr(Yo,this.reset,this),xr(mr,this.resize,this)}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(t){let e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=fl(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=gl(t.x-this.deadzone.pos.x,this.bounds.left)),e}_followV(t){let e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=fl(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=gl(t.y-this.deadzone.pos.y,this.bounds.top)),e}reset(t=0,e=0){this.pos.x=t,this.pos.y=e,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()}setDeadzone(t,e){void 0===this.deadzone&&(this.deadzone=new wo(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-.25*e)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0}resize(t,e){return super.resize(t,e),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),gr(dr,this.width,this.height,this),this}setBounds(t,e,i,s){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,s+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0}follow(t,e,i){if(t instanceof yl)this.target=t.pos;else{if(!(t instanceof Fn||t instanceof On||t instanceof zn||t instanceof jn))throw new Error("invalid target for me.Camera2d.follow");this.target=t}this.follow_axis=void 0===e?this.AXIS.BOTH:e,this.smoothFollow=!1,this.damping="number"!=typeof i?1:wn(i,0,1),this.updateTarget(),this.smoothFollow=!0}unfollow(){this.target=null,this.follow_axis=this.AXIS.NONE}move(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)}moveTo(t,e){let i=this.pos.x,s=this.pos.y;this.pos.x=wn(t,this.bounds.left,this.bounds.width),this.pos.y=wn(e,this.bounds.top,this.bounds.height),i===this.pos.x&&s===this.pos.y||(this.isDirty=!0)}updateTarget(){if(this.target){switch(vl.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:vl.x=this._followH(this.target);break;case this.AXIS.VERTICAL:vl.y=this._followV(this.target);break;case this.AXIS.BOTH:vl.x=this._followH(this.target),vl.y=this._followV(this.target)}if(!this.pos.equals(vl)){if(!0===this.smoothFollow&&this.damping<1){if(Vn(vl.x,this.pos.x,2)&&Vn(vl.y,this.pos.y,2))return void this.pos.setV(vl);this.pos.lerp(vl,this.damping)}else this.pos.setV(vl);this.isDirty=!0}}}update(t){return this.updateTarget(t),this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),this.isDirty=!0),!0===this.isDirty&&gr(br,this.pos),null==this._fadeIn.tween&&null==this._fadeOut.tween||(this.isDirty=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),super.update(t)}shake(t,e,i,s,n){0!==this._shake.duration&&!0!==n||(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete="function"==typeof s?s:void 0)}fadeOut(t,e=1e3,i){this._fadeOut.color=Bn.pull("Color").copy(t),this._fadeOut.tween=Bn.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()}fadeIn(t,e=1e3,i){this._fadeIn.color=Bn.pull("Color").copy(t);let s=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=Bn.pull("Tween",this._fadeIn.color).to({alpha:s},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()}focusOn(t){let e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)}isVisible(t,e=t.floating){return!0===e||!0===t.floating?ah.overlaps(t.getBounds()):t.getBounds().overlaps(this)}localToWorld(t,e,i){return(i=i||Bn.pull("Vector2d")).set(t,e).add(this.pos).sub(mm.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i}worldToLocal(t,e,i){return(i=i||Bn.pull("Vector2d")).set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(mm.world.pos)}drawFX(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,Bn.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,Bn.push(this._fadeOut.color),this._fadeOut.color=null))}draw(t,e){let i=this.pos.x+this.offset.x,s=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-s),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t,this),e.draw(t,this),this.drawFX(t),e.postDraw(t,this),this.postDraw(t),e.currentTransform.translate(i,s)}}let wl={cameras:[]};class Sl{constructor(t){this.cameras=new Map,this.lights=new Map,this.ambientLight=new kn(0,0,0,0),this.settings=Object.assign(wl,t||{})}reset(){if(this.settings.cameras.forEach((t=>{this.cameras.set(t.name,t)})),!1===this.cameras.has("default")){if(void 0===xl){let t=ah.getWidth(),e=ah.getHeight();xl=new Al(0,0,t,e)}this.cameras.set("default",xl)}gr(Xo,this),this.onResetEvent.apply(this,arguments)}update(t){let e=!1;return this.cameras.forEach((i=>{!0===i.update(t)&&(e=!0)})),this.lights.forEach((i=>{!0===i.update(t)&&(e=!0)})),e}draw(t,e){this.cameras.forEach((i=>{i.draw(t,e),0!==this.ambientLight.alpha&&(t.save(),this.lights.forEach((e=>{t.setMask(e.getVisibleArea(),!0)})),t.setColor(this.ambientLight),t.fillRect(0,0,i.width,i.height),t.clearMask(),t.restore()),this.lights.forEach((i=>{i.preDraw(t,e),i.draw(t,e),i.postDraw(t,e)}))}))}destroy(){this.cameras.clear(),this.lights.forEach((t=>{t.destroy()})),this.lights.clear(),this.onDestroyEvent.apply(this,arguments)}onResetEvent(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)}onDestroyEvent(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}const Cl=/^.*(\\|\/|\:)/,Vl=/\.[^\.]*$/;function Bl(t){return t.replace(Cl,"").replace(Vl,"")}function Tl(t){return t.substring(t.lastIndexOf(".")+1,t.length)}let Ml={},Il={},Pl={},El={};function Dl(t,e,i){return Ml[t.name]=new Image,"function"==typeof e&&(Ml[t.name].onload=e),"function"==typeof i&&(Ml[t.name].onerror=i),"string"==typeof Vr&&(Ml[t.name].crossOrigin=Vr),Ml[t.name].src=t.src+Br,1}function Rl(t,e,i){!0===Dr(t.src)&&(t.src.startsWith("url(")||(t.src="url("+t.src+")"));let s=new FontFace(t.name,t.src);return s.load().then((()=>{globalThis.document.fonts.add(s),globalThis.document.body.style.fontFamily=t.name,"function"==typeof e&&e()}),(()=>{"function"==typeof i&&i(t.name)})),1}let Ll="",Gl=0;function kl(t){let e={};if(void 0===t){if(void 0===globalThis.document)return e;{let i=globalThis.document.location;if(!i||!i.hash)return e;t=i.hash}}else{let i=t.indexOf("#");if(-1===i)return e;t=t.slice(i,t.length)}return t.slice(1).split("&").filter((t=>""!==t)).forEach((t=>{let i=t.split("="),s=i.shift(),n=i.join("=");e[s]=n||!0})),e}function Fl(t=1){return Gl+=t,Ll+"-"+(t||Gl)}class Ol{constructor(t){if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){let e=t.source,i=Tl(e);if(("tsx"===i||"json"===i)&&!(t=Nc(Bl(e))))throw new Error(e+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Fn,this.isAnimated=!1,this.isCollection=!1,this.class=t.class,this.animations=new Map,this._lastUpdate=0;let e=t.tiles;for(let t in e)if(e.hasOwnProperty(t)){if("animation"in e[t]&&(this.isAnimated=!0,this.animations.set(e[+t].animation[0].tileid,{dt:0,idx:0,frames:e[+t].animation,cur:e[+t].animation[0]})),"properties"in e[t])if(Array.isArray(e[t].properties)){let i={};for(let s in e[t].properties)i[e[t].properties[s].name]=e[t].properties[s].value;this.setTileProperty(+e[t].id+this.firstgid,i)}else this.setTileProperty(+t+this.firstgid,e[t].properties);if("image"in e[t]){let i=Uc(e[t].image);if(!i)throw new Error("melonJS: '"+e[t].image+"' file for tile '"+(+t+this.firstgid)+"' not found!");this.imageCollection[+t+this.firstgid]=i}}this.isCollection=this.imageCollection.length>0;let i=t.tileoffset;i&&(this.tileoffset.x=+i.x,this.tileoffset.y=+i.y);let s=t.tileproperties;if(s)for(let t in s)s.hasOwnProperty(t)&&this.setTileProperty(+t+this.firstgid,s[t]);if(!1===this.isCollection){if(this.image=Uc(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=ah.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();let e=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),i=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%e>0&&++i,this.lastgid=this.firstgid+(e*i-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){let e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){let e=0,i=cu.getTime(),s=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach((i=>{for(i.dt+=t,e=i.cur.duration;i.dt>=e;)i.dt-=e,i.idx=(i.idx+1)%i.frames.length,i.cur=i.frames[i.idx],e=i.cur.duration,s=!0}))),s}drawTile(t,e,i,s){if(s.flipped&&(t.save(),t.translate(e,i),t.transform(s.currentTransform),e=i=0),!0===this.isCollection)t.drawImage(this.imageCollection[s.tileId],0,0,s.width,s.height,e,i,s.width,s.height);else{let n=this.atlas[this.getViewTileId(s.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}s.flipped&&t.restore()}}const zl=536870911;class jl{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){let e=-1;t&=zl;for(let i=0,s=this.tilesets.length;i<s;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(-1!==e)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}let Nl;function ql(t,e,i){let s;if("string"!=typeof i)return i;switch(e){case"int":case"float":i=Number(i);break;case"bool":i="true"===i;break;default:if(!i||function(t){const e=t.trim();return"true"===e||"false"===e}(i))i=!i||"true"===i;else if(Er(i))i=Number(i);else if(0===i.search(/^json:/i)){s=i.split(/^json:/i)[1];try{i=JSON.parse(s)}catch(t){throw new Error("Unable to parse JSON: "+s)}}else if(0===i.search(/^eval:/i)){s=i.split(/^eval:/i)[1];try{i=Function("'use strict';return ("+s+")")()}catch(t){throw new Error("Unable to evaluate: "+s)}}else((s=i.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(s=i.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(i="#"+s[2]+s[1]);0===t.search(/^(ratio|anchorPoint)$/)&&"number"==typeof i&&(i={x:i,y:i})}return i}function Ul(t,e){let i=e.nodeName;switch(i){case"data":{let i=Xl(e);i.encoding=i.encoding||"xml",void 0!==i.chunks&&(t.chunks=t.chunks||[],i.chunks.forEach((e=>{t.chunks.push({x:+e.x,y:+e.y,width:+e.width,height:+e.height,data:Jl(e.text,i.encoding,i.compression)})})),t.encoding="none"),void 0!==i.text&&void 0===t.chunks&&(t.data=Jl(i.text,i.encoding,i.compression),t.encoding="none");break}case"chunk":t.chunks=t.chunks||[],t.chunks.push(Xl(e));break;case"imagelayer":case"layer":case"objectgroup":case"group":{let s=Xl(e);s.type="layer"===i?"tilelayer":i,s.image&&(s.image=s.image.source),t.layers=t.layers||[],t.layers.push(s);break}case"animation":t.animation=Xl(e).frames;break;case"frame":case"object":{const s=i+"s";t[s]=t[s]||[],t[s].push(Xl(e));break}case"tile":{let i=Xl(e);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),t.tiles=t.tiles||{},t.tiles[i.id]=i;break}case"tileset":{let i=Xl(e);i.image&&(i.imagewidth=i.image.width,i.imageheight=i.image.height,i.image=i.image.source),t.tilesets=t.tilesets||[],t.tilesets.push(i);break}case"polygon":case"polyline":{t[i]=[];let s=Xl(e).points.split(" ");for(let e=0;e<s.length;e++){const n=s[e].split(",");t[i].push({x:+n[0],y:+n[1]})}break}case"properties":t.properties=Xl(e);break;case"property":{const i=Xl(e),s=void 0!==i.value?i.value:i.text;t[i.name]=ql(i.name,i.type||"string",s);break}default:t[i]=Xl(e)}}function Jl(t,e,i){switch(i=i||"none",e=e||"none"){case"csv":return function(t){let e=t.replace("\n","").trim().split(","),i=[];for(let t=0;t<e.length;t++)i.push(+e[t]);return i}(t);case"base64":return t="none"!==i?function(t,e){if("function"==typeof Nl)return Nl(t,e);throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}(t,i):function(t,e=1){let i=globalThis.atob(t.replace(/[^A-Za-z0-9\+\/\=]/g,"")),s=new Uint32Array(i.length/e);for(let t=0,n=i.length/e;t<n;t++){s[t]=0;for(let n=e-1;n>=0;--n)s[t]+=i.charCodeAt(t*e+n)<<(n<<3)}return s}(t,4),t;case"none":return t;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+e)}}function Xl(t){let e={},i="";if(1===t.nodeType&&function(t,e){if(e.attributes&&e.attributes.length>0)for(let i=0;i<e.attributes.length;i++){const s=e.attributes.item(i);void 0!==s.name?t[s.name]=s.value:t[s.nodeName]=s.nodeValue}}(e,t),t.hasChildNodes()){let s=t.childNodes;for(const t of s)switch(t.nodeType){case 1:Ul(e,t);break;case 3:i+=t.nodeValue.trim()}}return i&&(e.text=i),e}function Hl(t,e){let i=e.properties,s=e.propertytypes;if(void 0!==i)for(let e in i)if(i.hasOwnProperty(e)){let n="string",o=e,r=i[e];void 0!==i[e].name&&(o=i[e].name),void 0!==s?n=s[e]:void 0!==i[e].type&&(n=i[e].type),void 0!==i[e].value&&(r=i[e].value),t[o]=ql(o,n,r)}}class Wl extends Io{constructor(t,e,i,s){let n,o;if(super(),s.isCollection){let t=s.getTileImage(i&zl);n=t.width,o=t.height}else n=s.tilewidth,o=s.tileheight;this.setMinMax(0,0,n,o),this.tileset=s,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=0!=(2147483648&this.tileId),this.flippedY=0!=(1073741824&this.tileId),this.flippedAD=0!=(536870912&this.tileId),this.flipped=this.flippedX||this.flippedY||this.flippedAD,!0===this.flipped&&(null===this.currentTransform&&(this.currentTransform=new Nn),this.setTileTransform(this.currentTransform.identity())),this.tileId&=zl}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){let e,i=this.tileset;if(i.animations.has(this.tileId)){let s=[],n=[];i.animations.get(this.tileId).frames.forEach((t=>{n.push(t.tileid),s.push({name:""+t.tileid,delay:t.duration})})),e=i.texture.createAnimationFromName(n,t),e.addAnimation(this.tileId-i.firstgid,s),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(!0===i.isCollection){let s=i.getTileImage(this.tileId);e=new Xc(0,0,Object.assign({image:s})),e.anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),void 0!==t.rotation&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t),e.anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}class Yl{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.class=void 0!==e.class?e.class:e.type,this.text=void 0,this.rotation=An(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPoint=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==e.ellipse?this.isEllipse=!0:void 0!==e.point?this.isPoint=!0:void 0!==e.polygon?(this.points=e.polygon,this.isPolygon=!0):void 0!==e.polyline&&(this.points=e.polyline,this.isPolyLine=!0),void 0!==e.text?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,Hl(this.text,e)):(Hl(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){let e=t.getTilesetByGid(this.gid);!1===e.isCollection&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new Wl(this.x,this.y,this.gid,e)}parseTMXShapes(){let t=[];if(!0===this.isEllipse)t.push(Bn.pull("Ellipse",this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPoint)t.push(Bn.pull("Point",this.x,this.y));else if(!0===this.isPolygon){let e=Bn.pull("Polygon",0,0,this.points),i=e.isConvex();if(!1===i)throw new Error("collision polygones in Tiled should be defined as Convex");if(null===i)throw new Error("invalid polygone");t.push(e.rotate(this.rotation))}else if(!0===this.isPolyLine){let e,i,s=this.points,n=s.length-1;for(let o=0;o<n;o++)e=Bn.pull("Vector2d",s[o].x,s[o].y),i=Bn.pull("Vector2d",s[o+1].x,s[o+1].y),0!==this.rotation&&(e=e.rotate(this.rotation),i=i.rotate(this.rotation)),t.push(Bn.pull("Line",0,0,[e,i]))}else t.push(Bn.pull("Polygon",0,0,[Bn.pull("Vector2d"),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height),Bn.pull("Vector2d",0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(let e=0;e<t.length;e++)"function"==typeof t[e].toIso&&t[e].toIso();return t}getObjectPropertyByName(t){return this[t]}}class Zl{constructor(){this.points=[],this.arcResolution=5,this.vertices=[],this.startPoint=Bn.pull("Point"),this.isDirty=!1}beginPath(){this.points.forEach((t=>{Bn.push(t)})),this.isDirty=!0,this.points.length=0,this.startPoint.set(0,0)}closePath(){let t=this.points;if(t.length>0){let e=t[0];e.equals(t[t.length-1])||this.lineTo(e.x,e.y),this.isDirty=!0}}triangulatePath(){let t=this.vertices;if(this.isDirty){let e=this.points,i=fo(e.flatMap((t=>[t.x,t.y]))),s=i.length;for(;t.length<s;)t.push(Bn.pull("Point"));for(let n=0;n<s;n++){let s=e[i[n]];t[n].set(s.x,s.y)}for(;t.length>s;)Bn.push(t[t.length-1]),t.length-=1;this.isDirty=!1}return t}moveTo(t,e){this.startPoint.set(t,e),this.isDirty=!0}lineTo(t,e){let i=this.points,s=this.startPoint,n=0===i.length?s:i[i.length-1];s.equals(n)?i.push(Bn.pull("Point",n.x,n.y)):i.push(Bn.pull("Point",s.x,s.y)),i.push(Bn.pull("Point",t,e)),s.x=t,s.y=e,this.isDirty=!0}arc(t,e,i,s,n,o=!1){let r=this.points;if(s===n)return;const a=o?Math.abs(s-n)>=fn:Math.abs(n-s)>=fn;(s%=fn)<0&&(s+=fn),(n%=fn)<0&&(n+=fn),s>=n&&(n+=fn);let h=n-s,l=1;o&&(l=-1,h=fn-h),a&&(h=fn);const c=h*i/this.arcResolution,u=h/c*l;let m=s;for(let s=0;s<c;s++)r.push(Bn.pull("Point",t+i*Math.cos(m),e+i*Math.sin(m))),m+=u;r.push(Bn.pull("Point",t+i*Math.cos(n),e+i*Math.sin(n))),this.isDirty=!0}arcTo(t,e,i,s,n){let o=this.points,r=o[o.length-1].x-t,a=o[o.length-1].y-e,h=i-t,l=s-e,c=Math.sqrt(Math.pow(r,2)+Math.pow(a,2)),u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));r/=c,a/=c,h/=u,l/=u;let m=Math.atan2(a,r)-Math.atan2(l,h),d=n/Math.tan(m/2),p=t+r*d,_=e+a*d,b=t+h*d,y=e+l*d;o.push(Bn.pull("Point",p,_));let f=(r+h)/2,g=(a+l)/2,x=Math.sqrt(Math.pow(f,2)+Math.pow(g,2));f/=x,g/=x;let v=Math.sqrt(Math.pow(n,2)+Math.pow(d,2)),A=t+v*f,w=e+v*g,S=Math.atan2(_-w,p-A),C=Math.atan2(y-w,b-A);this.arc(A,w,n,S,C)}ellipse(t,e,i,s,n,o,r,a=!1){let h=this.points;if(o===r)return;let l=a?Math.abs(o-r)>=fn:Math.abs(r-o)>=fn;(o%=fn)<0&&(o+=fn),(r%=fn)<0&&(r+=fn),o>=r&&(r+=fn);let c=r-o,u=1;a&&(u=-1,c=fn-c),l&&(c=fn);const m=(c*i+c*s)/2/this.arcResolution,d=c/m*u;let p=o;const _=Math.cos(n),b=Math.sin(n);for(let n=0;n<m;n++){const n=i*Math.cos(p),o=s*Math.sin(p),r=t+n*_-o*b,a=e+n*b+o*_;h.push(Bn.pull("Point",r,a)),p+=d}this.isDirty=!0}rect(t,e,i,s){this.moveTo(t,e),this.lineTo(t+i,e),this.moveTo(t+i,e),this.lineTo(t+i,e+s),this.moveTo(t+i,e+s),this.lineTo(t,e+s),this.moveTo(t,e+s),this.lineTo(t,e),this.isDirty=!0}roundRect(t,e,i,s,n){this.moveTo(t+n,e),this.lineTo(t+i-n,e),this.arcTo(t+i,e,t+i,e+n,n),this.moveTo(t+i,e+n),this.lineTo(t+i,e+s-n),this.arcTo(t+i,e+s,t+i-n,e+s,n),this.moveTo(t+i-n,e+s),this.lineTo(t+n,e+s),this.arcTo(t,e+s,t,e+s-n,n),this.moveTo(t,e+s-n),this.lineTo(t,e+n),this.arcTo(t,e,t+n,e,n),this.isDirty=!0}}class Kl{constructor(t){this.settings=t,this.designRatio=this.settings.width/this.settings.height,this.scaleRatio=new Fn(this.settings.scale,this.settings.scale),this.isContextValid=!0,this.depthTest="sorting",this.path2D=new Zl,this.type="Generic",this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.maskLevel=0,this.currentBlendMode="none",!0===Sa.ejecta?this.canvas=globalThis.document.getElementById("canvas"):void 0!==globalThis.canvas?this.canvas=globalThis.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=hh(this.settings.width,this.settings.height),this.currentColor=new kn(0,0,0,1),this.currentTint=new kn(255,255,255,1),this.projectionMatrix=new qn,this.uvOffset=0}clear(){}flush(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height,this.clearMask()}getCanvas(){return this.canvas}getContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(null==t)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===t.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof e&&(e=!0);let i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getWidth(){return this.getCanvas().width}getHeight(){return this.getCanvas().height}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.getWidth()&&t.right>=0&&t.top<=this.getHeight()&&t.bottom>=0}resize(t,e){let i=this.getCanvas();t===i.width&&e===i.height||(i.width=t,i.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,gr(mr,t,e))}setAntiAlias(t,e){let i=t.canvas;ta("imageSmoothingEnabled",!0===e,t),!0!==e?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){if(t instanceof So)this.strokeRoundRect(t.left,t.top,t.width,t.height,t.radius,e);else if(t instanceof wo||t instanceof Io)this.strokeRect(t.left,t.top,t.width,t.height,e);else if(t instanceof xo||t instanceof go)this.strokePolygon(t,e);else if(t instanceof vo)this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e);else{if(!(t instanceof Ao))throw new Error("Invalid geometry for fill/stroke");this.strokePoint(t.x,t.y)}}fill(t){this.stroke(t,!0)}tint(t,e,i){let s=hh(t.width,t.height,!0),n=this.getContext2d(s);return n.save(),n.fillStyle=e instanceof kn?e.toRGB():e,n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation=i||"multiply",n.drawImage(t,0,0),n.globalCompositeOperation="destination-atop",n.drawImage(t,0,0),n.restore(),s}setMask(t){}clearMask(){}setTint(t,e=t.alpha){this.currentTint.copy(t),this.currentTint.alpha*=e}clearTint(){this.currentTint.setFloat(1,1,1,1)}toBlob(t){return new Promise((e=>{vr(tr,(()=>{this.canvas.toBlob((t=>{e(t)}),t?t.type:void 0,t?t.quality:void 0)}))}))}toImageBitmap(t){return new Promise((e=>{vr(tr,(()=>{let i=new Image;i.src=this.canvas.toDataURL(t),i.onload=()=>{createImageBitmap(i).then((t=>e(t)))}}))}))}toDataURL(t){return new Promise((e=>{vr(tr,(()=>{e(this.canvas.toDataURL(t))}))}))}}function Ql(t,e,i="default",s="no-repeat"){return{meta:{app:"melonJS",size:{w:t,h:e},repeat:s,image:"default"},frames:[{filename:i,frame:{x:0,y:0,w:t,h:e}}]}}class $l{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t){t=Array.isArray(t)?t:[t];for(let i in t){let s=t[i];if(void 0!==s.meta){if(s.meta.app.includes("texturepacker")||s.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===e){let t=Uc(s.meta.image);if(!t)throw new Error("Atlas texture '"+t+"' not found");this.sources.set(s.meta.image,t)}else this.sources.set(s.meta.image||"default","string"==typeof e?Uc(e):e);this.repeat="no-repeat"}else if(s.meta.app.includes("ShoeBox")){if(!s.meta.exporter||!s.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof e?Uc(e):e)}else s.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=s.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof e?Uc(e):e));this.atlases.set(s.meta.image||"default",this.parse(s))}else void 0!==s.framewidth&&void 0!==s.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==e&&(s.image="string"==typeof e?Uc(e):e),this.atlases.set("default",this.parseFromSpriteSheet(s)),this.sources.set("default",s.image))}}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==i&&this.sources.forEach((t=>{ah.cache.set(t,this)}))}parse(t){let e={};return t.frames.forEach((i=>{if(i.hasOwnProperty("filename")){let s,n,o=i.frame,r=i.spriteSourceSize&&i.sourceSize&&i.pivot;r&&(s=i.sourceSize.w*i.pivot.x-(i.trimmed?i.spriteSourceSize.x:0),n=i.sourceSize.h*i.pivot.y-(i.trimmed?i.spriteSourceSize.y:0)),e[i.filename]={name:i.filename,texture:t.meta.image||"default",offset:new Fn(o.x,o.y),anchorPoint:r?new Fn(s/o.w,n/o.h):null,trimmed:!!i.trimmed,width:o.w,height:o.h,angle:!0===i.rotated?-gn:0},this.addUVs(e,i.filename,t.meta.size.w,t.meta.size.h)}})),e}parseFromSpriteSheet(t){let e={},i=t.image,s=t.spacing||0,n=t.margin||0,o=i.width,r=i.height,a=Bn.pull("Vector2d",~~((o-n+s)/(t.framewidth+s)),~~((r-n+s)/(t.frameheight+s)));if(o%(t.framewidth+s)!=0||r%(t.frameheight+s)!=0){let e=a.x*(t.framewidth+s),n=a.y*(t.frameheight+s);e-o!==s&&n-r!==s&&(o=e,r=n,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+s)+"x"+(t.frameheight+s)+", truncating effective size to "+o+"x"+r))}for(let i=0,h=a.x*a.y;i<h;i++){let h=""+i;e[h]={name:h,texture:"default",offset:new Fn(n+(s+t.framewidth)*(i%a.x),n+(s+t.frameheight)*~~(i/a.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUVs(e,h,o,r)}return Bn.push(a),e}getAtlas(t){return"string"==typeof t?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return"object"==typeof t&&"string"==typeof t.texture?this.sources.get(t.texture):this.sources.values().next().value}addRegion(t,e,i,s,n){!0===ah.settings.verbose&&console.warn("Adding texture region",t,"for texture",this);let o=this.getTexture(),r=this.getAtlas(),a=o.width,h=o.height;return r[t]={name:t,offset:new Fn(e,i),width:s,height:n,angle:0},this.addUVs(r,t,a,h),r[t]}getRegion(t,e){let i;if("string"==typeof e)i=this.getAtlas(e)[t];else for(let e of this.atlases.values())if(void 0!==e[t]){i=e[t];break}return i}getUVs(t){let e=this.getRegion(t);if(void 0===e){let i=t.split(","),s=+i[0],n=+i[1],o=+i[2],r=+i[3];e=this.addRegion(t,s,n,o,r)}return e.uvs}addUVs(t,e,i,s){if(void 0!==ah.gl){let n=t[e].offset,o=t[e].width,r=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/s,(n.x+o)/i,(n.y+r)/s]),t[n.x+","+n.y+","+i+","+s]=t[e]}return t[e].uvs}createSpriteFromName(t,e,i=!1){return Bn.pull(!0===i?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){let i,s=[],n={},o=0,r=0;for(let e=0;e<t.length;++e){if(i=this.getRegion(t[e]),null==i)throw new Error("Texture - region for "+t[e]+" not found");s[e]=i,n[t[e]]=e,o=Math.max(i.width,o),r=Math.max(i.height,r)}return new Xc(0,0,Object.assign({image:this,framewidth:o,frameheight:r,margin:0,spacing:0,atlas:s,atlasIndices:n},e||{}))}}class tc{constructor(t,e){if(this.size_=0,this.map=new Map,this.operator=t,e)for(const[t,i]of e)this.put(t,i);return this}get size(){return this.size_}get(t){const e=this.map.get(t);return e?this.operator.clone(e):this.operator.create()}put(t,e){let i=this.map.get(t);return i||(i=this.operator.create()),!!this.operator.add(e,i)&&(this.map.set(t,i),this.size_++,!0)}putAll(t,e){let i=0;if(e){const s=t,n=e;for(const t of n)this.put(s,t),i++}else{if(!(t instanceof tc))throw new TypeError("unexpected arguments");for(const[e,s]of t.entries())this.put(e,s),i++}return i>0}has(t){return this.map.has(t)}hasEntry(t,e){return this.operator.has(e,this.get(t))}delete(t){return this.size_-=this.operator.size(this.get(t)),this.map.delete(t)}deleteEntry(t,e){const i=this.get(t);return!!this.operator.delete(e,i)&&(this.map.set(t,i),this.size_--,!0)}clear(){this.map.clear(),this.size_=0}keys(){return this.map.keys()}entries(){const t=this;return function*(){for(const[e,i]of t.map.entries())for(const t of i)yield[e,t]}()}values(){const t=this;return function*(){for(const[,e]of t.entries())yield e}()}forEach(t,e){for(const[i,s]of this.entries())t.call(void 0===e?this:e,s,i,this)}[Symbol.iterator](){return this.entries()}asMap(){const t=new Map;for(const e of this.keys())t.set(e,this.operator.clone(this.get(e)));return t}}class ec extends tc{constructor(t){super(new ic,t)}get[Symbol.toStringTag](){return"ArrayMultimap"}}class ic{create(){return[]}clone(t){return t.slice()}add(t,e){return e.push(t),!0}size(t){return t.length}delete(t,e){const i=e.indexOf(t);return i>-1&&(e.splice(i,1),!0)}has(t,e){return e.includes(t)}}Symbol.toStringTag;class sc{constructor(t=1/0){this.cache=new ec,this.tinted=new Map,this.units=new Map,this.usedUnits=new Set,this.max_size=t,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.usedUnits.clear()}allocateTextureUnit(){for(let t=0;t<this.max_size;t++)if(!this.usedUnits.has(t))return this.usedUnits.add(t),t;throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}freeTextureUnit(t){let e=this.units.get(t);void 0!==e&&(this.usedUnits.delete(e),this.units.delete(t))}get(t,e){let i;return void 0===e?i=this.cache.get(t)[0]:this.cache.forEach(((s,n)=>{let o=s.getAtlas()[0];n===t&&o.width===e.framewidth&&o.height===e.frameheight&&(i=s)})),void 0===i&&(e||(e=Ql(t.width,t.height,t.src?Bl(t.src):void 0)),i=new $l(e,t,!1),this.set(t,i)),i}delete(t){if(this.cache.has(t)){let e=this.cache.get(t)[0];void 0!==e&&this.freeTextureUnit(e),this.cache.delete(t)}}tint(t,e){let i=this.tinted.get(t);return void 0===i&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,ah.tint(t,e,"multiply")),i.get(e)}set(t,e){let i=t.width,s=t.height;if(!(1!==ah.WebGLVersion||xn(i)&&xn(s))){let e=void 0!==t.src?t.src:t;console.warn("[Texture] "+e+" is not a POT texture ("+i+"x"+s+")")}return this.cache.put(t,e)}getUnit(t){return this.units.has(t)||this.units.set(t,this.allocateTextureUnit()),this.units.get(t)}}class nc extends Kl{constructor(t){super(t),this.context=this.getContext2d(this.getCanvas(),this.settings.transparent),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new sc,!1===this.settings.textureSeamFix||this.settings.antiAlias||(this.uvOffset=1),this.type="CANVAS",this.getCanvas().addEventListener("contextlost",(t=>{t.preventDefault(),this.isContextValid=!1,gr(yr,this)}),!1),this.getCanvas().addEventListener("contextrestored",(()=>{this.isContextValid=!0,gr(fr,this)}),!1),xr(Yo,(()=>{this.reset()}))}reset(){super.reset(),this.clearColor(this.currentColor,!0!==this.settings.transparent)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(t="normal",e){switch(e=e||this.getContext(),this.currentBlendMode=t,t){case"screen":e.globalCompositeOperation="screen";break;case"lighter":case"additive":e.globalCompositeOperation="lighter";break;case"multiply":e.globalCompositeOperation="multiply";break;default:e.globalCompositeOperation="source-over",this.currentBlendMode="normal"}}clear(){if(!1===this.settings.transparent){let t=this.getCanvas();this.getContext().clearRect(0,0,t.width,t.height)}}clearColor(t="#000000",e=!1){let i=this.getCanvas(),s=this.getContext();this.save(),this.resetTransform(),s.globalAlpha=1,s.globalCompositeOperation=!0===e?"copy":"source-over",s.fillStyle=t instanceof kn?t.toRGBA():t,this.fillRect(0,0,i.width,i.height),this.restore()}clearRect(t,e,i,s){this.getContext().clearRect(t,e,i,s)}createPattern(t,e){return this.getContext().createPattern(t,e)}drawImage(t,e,i,s,n,o,r,a,h){if(this.getGlobalAlpha()<1/255)return;let l=this.getContext();void 0===s?(s=a=t.width,n=h=t.height,o=e,r=i,e=0,i=0):void 0===o&&(o=e,r=i,a=s,h=n,s=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(o=~~o,r=~~r);let c=t,u=this.currentTint.toArray();1===u[0]&&1===u[1]&&1===u[2]||(c=this.cache.tint(t,this.currentTint.toRGB())),l.drawImage(c,e,i,s,n,o,r,a,h)}drawPattern(t,e,i,s,n){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),r=o.fillStyle;o.fillStyle=t,o.fillRect(e,i,s,n),o.fillStyle=r}beginPath(){this.getContext().beginPath()}moveTo(t,e){this.getContext().moveTo(t,e)}lineTo(t,e){this.getContext().lineTo(t,e)}rect(t,e,i,s){this.getContext().rect(t,e,i,s)}roundRect(t,e,i,s,n){this.getContext().roundRect(t,e,i,s,n)}stroke(t,e){void 0===t?!0===e?this.getContext().fill():this.getContext().stroke():super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.getContext().closePath()}strokeArc(t,e,i,s,n,o,r=!1){if(this.getGlobalAlpha()<1/255)return;let a=this.getContext();a.translate(t,e),a.beginPath(),a.arc(0,0,i,s,n,o||!1),a[!0===r?"fill":"stroke"](),a.translate(-t,-e)}fillArc(t,e,i,s,n,o){this.strokeArc(t,e,i,s,n,o||!1,!0)}strokeEllipse(t,e,i,s,n=!1){if(this.getGlobalAlpha()<1/255)return;let o=this.getContext(),r=t-i,a=t+i,h=e-s,l=e+s,c=.551784*i,u=.551784*s,m=t-c,d=t+c,p=e-u,_=e+u;o.beginPath(),o.moveTo(t,h),o.bezierCurveTo(d,h,a,p,a,e),o.bezierCurveTo(a,_,d,l,t,l),o.bezierCurveTo(m,l,r,_,r,e),o.bezierCurveTo(r,p,m,h,t,h),o[!0===n?"fill":"stroke"](),o.closePath()}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!0)}strokeLine(t,e,i,s){if(this.getGlobalAlpha()<1/255)return;let n=this.getContext();n.beginPath(),n.moveTo(t,e),n.lineTo(i,s),n.stroke()}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){if(this.getGlobalAlpha()<1/255)return;let i=this.getContext(),s=t.points,n=s.length,o=s[0];this.translate(t.pos.x,t.pos.y),i.beginPath(),i.moveTo(o.x,o.y);for(let t=1;t<n;t++){const e=s[t];i.lineTo(e.x,e.y)}i.lineTo(o.x,o.y),i[!0===e?"fill":"stroke"](),i.closePath(),this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){this.getGlobalAlpha()<1/255||this.getContext()[!0===n?"fillRect":"strokeRect"](t,e,i,s)}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,o=!1){if(this.getGlobalAlpha()<1/255)return;let r=this.getContext();r.beginPath(),r.roundRect(t,e,i,s,n),r[!0===o?"fill":"stroke"]()}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}restore(){this.getContext().restore(),this.currentColor.glArray[3]=this.getGlobalAlpha(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height}save(){this.getContext().save()}rotate(t){this.getContext().rotate(t)}scale(t,e){this.getContext().scale(t,e)}setColor(t){let e=this.currentColor,i=this.getContext();e.copy(t),i.strokeStyle=i.fillStyle=e.toRGBA()}setGlobalAlpha(t){this.getContext().globalAlpha=t}getGlobalAlpha(){return this.getContext().globalAlpha}setLineWidth(t){this.getContext().lineWidth=t}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){let e=t.toArray(),i=e[0],s=e[1],n=e[3],o=e[4],r=e[6],a=e[7];!1===this.settings.subPixel&&(r|=0,a|=0),this.getContext().transform(i,s,n,o,r,a)}translate(t,e){!1===this.settings.subPixel?this.getContext().translate(~~t,~~e):this.getContext().translate(t,e)}clipRect(t,e,i,s){let n=this.getCanvas();if(0!==t||0!==e||i!==n.width||s!==n.height){let n=this.currentScissor;if(n[0]!==t||n[1]!==e||n[2]!==i||n[3]!==s){let o=this.getContext();o.beginPath(),o.rect(t,e,i,s),o.clip(),n[0]=t,n[1]=e,n[2]=i,n[3]=s}}}setMask(t,e=!1){let i=this.getContext();if(0===this.maskLevel&&(i.save(),i.beginPath()),t instanceof So)i.roundRect(t.top,t.left,t.width,t.height,t.radius);else if(t instanceof wo||t instanceof Io)i.rect(t.top,t.left,t.width,t.height);else if(t instanceof vo){const e=t.pos.x,s=t.pos.y,n=t.radiusV.x,o=t.radiusV.y,r=e-n,a=e+n,h=s-o,l=s+o;let c=.551784*n,u=.551784*o,m=e-c,d=e+c,p=s-u,_=s+u;i.moveTo(e,h),i.bezierCurveTo(d,h,a,p,a,s),i.bezierCurveTo(a,_,d,l,e,l),i.bezierCurveTo(m,l,r,_,r,s),i.bezierCurveTo(r,p,m,h,e,h)}else{const e=t.pos.x,s=t.pos.y;i.moveTo(e+t.points[0].x,s+t.points[0].y);for(let n=1;n<t.points.length;n++){const o=t.points[n];i.lineTo(e+o.x,s+o.y)}}this.maskLevel++,!0===e?(i.closePath(),i.globalCompositeOperation="destination-atop",i.fill()):i.clip()}clearMask(){this.maskLevel>0&&(this.maskLevel=0,this.getContext().restore())}}function oc(t,e,i){let s,n,o=0;void 0===e.rows?(s=e.width,n=e.height):(s=e.cols,n=e.rows);for(let r=0;r<n;r++)for(let n=0;n<s;n++){const s=i[o++];0!==s&&(t.layerData[n+e.x][r+e.y]=t.getTileById(s,n+e.x,r+e.y))}}class rc extends yl{constructor(t,e,i,s,n,o,r){super(0,0,0,0),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||s,this.orientation=n,this.x=0,this.y=0,this.tilesets=o,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(let t=0;t<this.tilesets.length;t++){const e=this.tilesets.getTilesetByIndex(t);this.maxTileSize.width=Math.max(this.maxTileSize.width,e.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,e.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.class=e.class,this.pos.z=r,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;let a=void 0!==e.visible?+e.visible:1;this.setOpacity(a?+e.opacity:0),"string"==typeof e.tintcolor&&this.tint.parseHex(e.tintcolor,!0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),Hl(this,e),this.setRenderer(t.getRenderer()),this.layerData=function(t,e){let i=new Array(e);for(let s=0;s<e;s++){i[s]=new Array(t);for(let e=0;e<t;e++)i[s][e]=null}return i}(this.rows,this.cols),0===t.infinite?oc(this,this,Jl(e.data,e.encoding,e.compression)):1===t.infinite&&e.chunks.forEach((t=>{oc(this,t,Jl(t.data,e.encoding,e.compression))}))}onActivateEvent(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets){let t=this.tilesets.tilesets;for(let e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e])}this.isAnimated=this.animatedTilesets.length>0,void 0===this.preRender&&!1===this.isAnimated?this.preRender=this.ancestor.getRootAncestor().preRender:this.preRender=!1,!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new nc({canvas:hh(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),this.getRenderer().drawTileLayer(this.canvasRenderer,this,this)),this.isDirty=!0}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(t){this.renderer=t,this.isDirty=!0}getRenderer(){return this.renderer}getTileId(t,e){let i=this.getTile(t,e);return i?i.tileId:null}getTile(t,e){let i=null;if(this.contains(t,e)){let s=this.getRenderer().pixelToTileCoords(t,e,Bn.pull("Vector2d"));i=this.cellAt(s.x,s.y),Bn.push(s)}return i}setTile(t,e,i){return this.layerData[e][i]=t,this.isDirty=!0,t}getTileById(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new Wl(e,i,t,this.tileset)}cellAt(t,e,i){let s=~~t,n=~~e,o=this.getRenderer();return!1===i||s>=0&&s<o.cols&&n>=0&&n<o.rows?this.layerData[s][n]:null}clearTile(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight),this.isDirty=!0}update(t){let e=this.isDirty;if(this.isAnimated)for(let i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}draw(t,e){if(this.preRender){const i=Math.min(e.width,this.width),s=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,s,e.pos.x,e.pos.y,i,s)}else this.getRenderer().drawTileLayer(t,this,e)}}class ac{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.class=e.class,this.z=i,this.objects=[];let s=void 0===e.visible||e.visible;this.opacity=!0===s?wn(+e.opacity||1,0,1):0,Hl(this,e),e.objects&&e.objects.forEach((e=>{e.tintcolor=this.tintcolor,this.objects.push(new Yl(t,e,i))})),e.layers&&e.layers.forEach((e=>{let s=new rc(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);s.setRenderer(t.getRenderer()),this.width=Math.max(this.width,s.width),this.height=Math.max(this.height,s.height),this.objects.push(s)}))}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}function hc(t,e){this.removeChildNow(t,e)}let lc=0;class cc extends yl{constructor(t=0,e=0,i,s,n=!1){super(t,e,void 0===i?void 0!==mm.viewport?mm.viewport.width:1/0:i,void 0===s?void 0!==mm.viewport?mm.viewport.height:1/0:s),this.pendingSort=null,this.root=n,this.children=void 0,this.sortOn="z",this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(t){},this.enableChildBoundsUpdate=!1,this.backgroundColor=Bn.pull("Color",0,0,0,0),this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),!0===this.root&&xr(mr,(()=>{this.enableChildBoundsUpdate,this.updateBounds(),this.enableChildBoundsUpdate}))}reset(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);let t=this.getChildren();for(let e,i=t.length;i>=0;e=t[--i])e&&!0!==e.isPersistent&&this.removeChildNow(e);void 0!==this.currentTransform&&this.currentTransform.identity(),this.backgroundColor.setColor(0,0,0,0)}addChild(t,e){if(t.ancestor instanceof cc?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Fl(t.id)),t.ancestor=this,this.getChildren().push(t),"function"==typeof t.updateBounds&&(!0===this.isFloating&&(t.floating=!1),t.updateBounds()),void 0!==t.pos&&("number"==typeof e?t.pos.z=e:!0===this.autoDepth&&(t.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.enableChildBoundsUpdate&&this.updateBounds(),this.isAttachedToRoot()){let e=this.getRootAncestor();t.body instanceof uu&&e.addBody(t.body),t instanceof cc&&t.forEach((t=>{t.body instanceof uu&&e.addBody(t.body)}))}return this.isDirty=!0,this.onChildChange.call(this,this.getChildren().length-1),t}addChildAt(t,e){if(e>=0&&e<this.getChildren().length){if(t.ancestor instanceof cc?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=Fl()),t.ancestor=this,this.getChildren().splice(e,0,t),"function"==typeof t.updateBounds&&(!0===this.isFloating&&(t.floating=!1),t.updateBounds()),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.enableChildBoundsUpdate&&this.updateBounds(),this.isAttachedToRoot()){let e=this.getRootAncestor();t.body instanceof uu&&e.addBody(t.body),t instanceof cc&&t.forEach((t=>{t.body instanceof uu&&e.addBody(t.body)}))}return this.isDirty=!0,this.onChildChange.call(this,e),t}throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")}forEach(t,e){let i=this,s=0,n=this.getChildren(),o=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<o;)t.call(i,n[s],s,n),s++}swapChildren(t,e){let i=this.getChildIndex(t),s=this.getChildIndex(e);if(-1===i||-1===s)throw new Error(t+" Both the supplied childs must be a child of the caller "+this);{let n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[s]=t,this.isDirty=!0}}getChildAt(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")}getChildIndex(t){return this.getChildren().indexOf(t)}getNextChild(t){let e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)}hasChild(t){return this===t.ancestor}getChildByProp(t,e){let i=[];return this.forEach((s=>{!function(t,s){let n=t[s];e instanceof RegExp&&"string"==typeof n?e.test(n)&&i.push(t):n===e&&i.push(t)}(s,t),s instanceof cc&&(i=i.concat(s.getChildByProp(t,e)))})),i}getChildByType(t){let e=[];return this.forEach((i=>{i instanceof t&&e.push(i),i instanceof cc&&(e=e.concat(i.getChildByType(t)))})),e}getChildByName(t){return this.getChildByProp("name",t)}getChildByGUID(t){let e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null}getChildren(){return void 0===this.children&&(this.children=[]),this.children}updateBounds(t=!0){let e=this.getBounds();return super.updateBounds(t),!0===this.enableChildBoundsUpdate&&this.forEach((t=>{if(t.isRenderable){let i=t.updateBounds(!0);i.isFinite()&&e.addBounds(i)}})),e}isAttachedToRoot(){if(!0===this.root)return!0;{let t=this.ancestor;for(;t;){if(!0===t.root)return!0;t=t.ancestor}return!1}}getRootAncestor(){if(!0===this.root)return this;{let t=this.ancestor;for(;t&&!0!==t.root;)t=t.ancestor;return t}}updateBoundsPos(t=this.pos.x,e=this.pos.y){super.updateBoundsPos(t,e),this.forEach((i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)}))}onActivateEvent(){this.forEach((t=>{"function"==typeof t.onActivateEvent&&t.onActivateEvent()}))}removeChild(t,e){if(!this.hasChild(t))throw new Error("Child is not mine.");Eo(hc,this,t,e)}removeChildNow(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent(),t.body instanceof uu&&this.getRootAncestor().removeBody(t.body),e||!1===Bn.push(t,!1)&&"function"==typeof t.destroy&&t.destroy();let i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),!0===this.enableChildBoundsUpdate&&this.updateBounds(),this.isDirty=!0,this.onChildChange.call(this,i)}}setChildsProperty(t,e,i){this.forEach((s=>{!0===i&&s instanceof cc&&s.setChildsProperty(t,e,i),s[t]=e}))}moveUp(t){let e=this.getChildIndex(t);e-1>=0&&(this.swapChildren(t,this.getChildAt(e-1)),this.isDirty=!0)}moveDown(t){let e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&(this.swapChildren(t,this.getChildAt(e+1)),this.isDirty=!0)}moveToTop(t){let e=this.getChildIndex(t);if(e>0){let i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1,this.isDirty=!0}}moveToBottom(t){let e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1,this.isDirty=!0)}sort(t){this.pendingSort||(!0===t&&this.forEach((e=>{e instanceof cc&&e.sort(t)})),this.pendingSort=Eo((function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]),this.pendingSort=null,this.isDirty=!0}),this))}onDeactivateEvent(){this.forEach((t=>{"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent()}))}_sortZ(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0}_sortReverseZ(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0}_sortX(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;return e.pos.z-t.pos.z||e.pos.x-t.pos.x}_sortY(t,e){if(!e.pos||!t.pos)return t.pos?-1/0:1/0;return e.pos.z-t.pos.z||e.pos.y-t.pos.y}destroy(){this.reset(),super.destroy(arguments)}update(t){let e=!1,i=hu.isPaused(),s=this.getChildren();for(let n,o=s.length;o--,n=s[o];)i&&!n.updateWhenPaused||(n.isRenderable?(e=lc>0||n.floating,e&&lc++,n.inViewport=!1,hu.current().cameras.forEach((t=>{t.isVisible(n,e)&&(n.inViewport=!0)})),this.isDirty|=(n.inViewport||n.alwaysUpdate)&&n.update(t),lc>0&&lc--):this.isDirty|=n.update(t));return super.update(t)}draw(t,e){let i=!1,s=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===s.isFinite()&&t.clipRect(s.left,s.top,s.width,s.height),t.translate(this.pos.x,this.pos.y),this.backgroundColor.alpha>1/255&&t.clearColor(this.backgroundColor);let n=this.getChildren();for(let s,o=n.length;o--,s=n[o];)s.isRenderable&&(i=!0===s.floating,(s.inViewport||i)&&(i&&(t.save(),t.resetTransform()),s.preDraw(t),s.draw(t,e),s.postDraw(t),i&&t.restore(),this.drawCount++))}}class uc{constructor(t,e,i,s){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=s,this.bounds=new Io}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){let e=t instanceof rc?Bn.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,s){}drawTileLayer(t,e,i){}}class mc extends uc{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return"orthogonal"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new Fn).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new Fn).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){let n=s.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,s)}drawTileLayer(t,e,i){let s=1,n=1,o=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),Bn.pull("Vector2d")).floorSelf(),r=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,Bn.pull("Vector2d")).ceilSelf();switch(r.x=r.x>this.cols?this.cols:r.x,r.y=r.y>this.rows?this.rows:r.y,e.renderorder){case"right-up":r.y=o.y+(o.y=r.y)-r.y,n=-1;break;case"left-down":r.x=o.x+(o.x=r.x)-r.x,s=-1;break;case"left-up":r.x=o.x+(o.x=r.x)-r.x,r.y=o.y+(o.y=r.y)-r.y,s=-1,n=-1}for(let i=o.y;i!==r.y;i+=n)for(let n=o.x;n!==r.x;n+=s){let s=e.cellAt(n,i,!1);s&&this.drawTile(t,n,i,s)}Bn.push(o),Bn.push(r)}}class dc extends uc{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return"isometric"===t.orientation&&super.canRender(t)}getBounds(t){let e=t instanceof rc?Bn.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new Fn).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new Fn).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){let e=t.x/this.hTilewidth,i=t.y/this.tileheight,s=Bn.pull("Vector2d");this.tileToPixelCoords(e,i,s),t.x=s.x,t.y=s.y,Bn.push(s)}drawTile(t,e,i,s){let n=s.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,s)}drawTileLayer(t,e,i){let s=e.tileset,n=this.pixelToTileCoords(i.pos.x-s.tilewidth,i.pos.y-s.tileheight,Bn.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+s.tilewidth,i.pos.y+i.height+s.tileheight,Bn.pull("Vector2d")).ceilSelf(),r=this.tileToPixelCoords(o.x,o.y,Bn.pull("Vector2d")),a=this.tileToPixelCoords(n.x,n.y,Bn.pull("Vector2d"));a.x-=this.hTilewidth,a.y+=this.tileheight;let h=a.y-i.pos.y>this.hTileheight,l=i.pos.x-a.x<this.hTilewidth;h&&(l?(n.x--,a.x-=this.hTilewidth):(n.y--,a.x+=this.hTilewidth),a.y-=this.hTileheight);let c=h^l,u=n.clone();for(let i=2*a.y;i-2*this.tileheight<2*r.y;i+=this.tileheight){u.setV(n);for(let n=a.x;n<r.x;n+=this.tilewidth){let o=e.cellAt(u.x,u.y);if(o){s=o.tileset;let e=s.tileoffset;s.drawTile(t,e.x+n,e.y+i/2-s.tileheight,o)}u.x++,u.y--}c?(n.y++,a.x-=this.hTilewidth,c=!1):(n.x++,a.x+=this.hTilewidth,c=!0)}Bn.push(u),Bn.push(n),Bn.push(o),Bn.push(r),Bn.push(a)}}const pc=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],_c=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class bc extends uc{constructor(t){super(t.cols,t.rows,-2&t.tilewidth,-2&t.tileheight),this.hexsidelength=t.hexsidelength||0,this.staggerX="x"===t.staggeraxis,this.staggerEven="even"===t.staggerindex,this.sidelengthx=0,this.sidelengthy=0,"hexagonal"===t.orientation&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new Fn,new Fn,new Fn,new Fn]}canRender(t){return"hexagonal"===t.orientation&&super.canRender(t)}getBounds(t){let e=t instanceof rc?Bn.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&1&t^this.staggerEven}doStaggerY(t){return!this.staggerX&&1&t^this.staggerEven}topLeft(t,e,i){let s=i||new Fn;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e):s.set(t-1,e-1):1&e^this.staggerEven?s.set(t,e-1):s.set(t-1,e-1),s}topRight(t,e,i){let s=i||new Fn;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e):s.set(t+1,e-1):1&e^this.staggerEven?s.set(t+1,e-1):s.set(t,e-1),s}bottomLeft(t,e,i){let s=i||new Fn;return this.staggerX?1&t^this.staggerEven?s.set(t-1,e+1):s.set(t-1,e):1&e^this.staggerEven?s.set(t,e+1):s.set(t-1,e+1),s}bottomRight(t,e,i){let s=i||new Fn;return this.staggerX?1&t^this.staggerEven?s.set(t+1,e+1):s.set(t+1,e):1&e^this.staggerEven?s.set(t+1,e+1):s.set(t,e+1),s}pixelToTileCoords(t,e,i){let s=i||new Fn;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;let n,o,r,a,h=Bn.pull("Vector2d",Math.floor(t/(2*this.columnwidth)),Math.floor(e/(2*this.rowheight))),l=Bn.pull("Vector2d",t-h.x*(2*this.columnwidth),e-h.y*(2*this.rowheight));this.staggerX?(h.x=2*h.x,this.staggerEven&&++h.x):(h.y=2*h.y,this.staggerEven&&++h.y),this.staggerX?(n=this.sidelengthx/2,r=n+this.columnwidth,a=this.tileheight/2,this.centers[0].set(n,a),this.centers[1].set(r,a-this.rowheight),this.centers[2].set(r,a+this.rowheight),this.centers[3].set(r+this.columnwidth,a)):(o=this.sidelengthy/2,r=this.tilewidth/2,a=o+this.rowheight,this.centers[0].set(r,o),this.centers[1].set(r-this.columnwidth,a),this.centers[2].set(r+this.columnwidth,a),this.centers[3].set(r,a+this.rowheight));let c=0,u=Number.MAX_VALUE;for(let t=0;t<4;++t){const e=this.centers[t].sub(l).length2();e<u&&(u=e,c=t)}let m=this.staggerX?pc:_c;return s.set(h.x+m[c].x,h.y+m[c].y),Bn.push(h),Bn.push(l),s}tileToPixelCoords(t,e,i){let s=Math.floor(t),n=Math.floor(e),o=i||new Fn;return this.staggerX?(o.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(s)&&(o.y+=this.rowheight),o.x=s*this.columnwidth):(o.x=s*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(o.x+=this.columnwidth),o.y=n*this.rowheight),o}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,s){let n=s.tileset,o=this.tileToPixelCoords(e,i,Bn.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+o.x,n.tileoffset.y+o.y+(this.tileheight-n.tileheight),s),Bn.push(o)}drawTileLayer(t,e,i){let s,n=this.pixelToTileCoords(i.pos.x,i.pos.y,Bn.pull("Vector2d"));n.sub(e.pos);let o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,Bn.pull("Vector2d")),r=n.clone(),a=o.clone(),h=i.pos.y-o.y<this.sideoffsety,l=i.pos.x-o.x<this.sideoffsetx;h&&n.y--,l&&n.x--;let c=e.cols,u=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o);let h=this.doStaggerX(n.x+e.pos.x);for(;o.y<i.bottom&&n.y<u;){for(r.setV(n),a.setV(o);a.x<i.right&&r.x<c;r.x+=2)s=e.cellAt(r.x,r.y,!1),s&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;h?(n.x-=1,n.y+=1,o.x-=this.columnwidth,h=!1):(n.x+=1,o.x+=this.columnwidth,h=!0),o.y+=this.rowheight}Bn.push(r),Bn.push(a)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),o=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,o),this.doStaggerY(n.y)&&(o.x-=this.columnwidth);o.y<i.bottom&&n.y<u;n.y++){for(r.setV(n),a.setV(o),this.doStaggerY(n.y)&&(a.x+=this.columnwidth);a.x<i.right&&r.x<c;r.x++)s=e.cellAt(r.x,r.y,!1),s&&s.tileset.drawTile(t,a.x,a.y,s),a.x+=this.tilewidth+this.sidelengthx;o.y+=this.rowheight}Bn.push(r),Bn.push(a)}Bn.push(n),Bn.push(o)}}class yc extends bc{canRender(t){return"staggered"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){let s=i||new Fn,n=t,o=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:o-=this.staggerEven?this.sideoffsety:0;let r=Bn.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(o/this.tileheight));this.staggerX?(r.x=2*r.x,this.staggerEven&&++r.x):(r.y=2*r.y,this.staggerEven&&++r.y);let a=Bn.pull("Vector2d",n-r.x*this.tilewidth,o-r.y*this.tileheight),h=a.x*(this.tileheight/this.tilewidth);return this.sideoffsety-h>a.y&&(r=this.topLeft(r.x,r.y,r)),-this.sideoffsety+h>a.y&&(r=this.topRight(r.x,r.y,r)),this.sideoffsety+h<a.y&&(r=this.bottomLeft(r.x,r.y,r)),3*this.sideoffsety-h<a.y&&(r=this.bottomRight(r.x,r.y,r)),s=this.tileToPixelCoords(r.x,r.y,s),s.set(t-s.x,e-s.y),s.set(s.x-this.tilewidth/2,s.y*(this.tilewidth/this.tileheight)),s.div(this.tilewidth/Math.sqrt(2)).rotate(An(-45)).add(r),Bn.push(r),Bn.push(a),s}}function fc(t,e,i){const s="melonJS: %s is deprecated since version %s, please use %s";let n=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+s,"font-weight:normal;color:yellow;",t,i,e):console.warn(s,t,i,e),void 0!==n&&console.warn(n),console.groupCollapsed&&console.groupEnd()}class gc{constructor(t,e){this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite||0,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=""+e.version,this.tiledversion=""+e.tiledversion,this.class=e.class,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===e.editor,this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,"undefined"!==this.version&&""!==this.version&&function(t,e){let i=t.split("."),s=e.split("."),n=Math.min(i.length,s.length),o=0;for(let t=0;t<n&&!(o=+i[t]-+s[t]);t++);return o||i.length-s.length}(this.version,"1.5")<0&&fc("("+this.name+") Tiled Map format version 1.4 and below","format 1.5 or higher","10.4.4"),Hl(this,e),this.initialized=!1}getRenderer(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=function(t){switch(t.orientation){case"orthogonal":return new mc(t);case"isometric":return new dc(t);case"hexagonal":return new bc(t);case"staggered":return new yc(t);default:throw new Error(t.orientation+" type TMX Tile Map not supported!")}}(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(!0===this.initialized)return;let e=0;this.tilesets||(this.tilesets=new jl),void 0!==t.tilesets&&t.tilesets.forEach((t=>{this.tilesets.add(function(t){return new Ol(t)}(t))})),this.background_image&&this.layers.push(Bn.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach((t=>{switch(t.type){case"imagelayer":this.layers.push(function(t,e,i){Hl(e.properties,e);let s=Bn.pull("ImageLayer",+e.offsetx||+e.x||0,+e.offsety||+e.y||0,Object.assign({name:e.name,image:e.image,ratio:Bn.pull("Vector2d",+e.parallaxx||1,+e.parallaxy||1),tint:void 0!==e.tintcolor?Bn.pull("Color").parseHex(e.tintcolor,!0):void 0,z:i},e.properties)),n=void 0===e.visible||e.visible;return s.setOpacity(n?+e.opacity:0),s}(0,t,e++));break;case"tilelayer":this.layers.push(function(t,e,i){return new rc(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i)}(this,t,e++));break;case"objectgroup":case"group":this.objectGroups.push(function(t,e,i){return new ac(t,e,i)}(this,t,e++))}})),this.initialized=!0}addTo(t,e,i){let s=t.autoSort,n=t.autoDepth,o=this.getBounds();function r(e,i){mm.viewport.setBounds(0,0,Math.max(o.width,e),Math.max(o.height,i)),t.pos.set(Math.max(0,~~((e-o.width)/2)),Math.max(0,~~((i-o.height)/2)),t.pos.z)}t.autoSort=!1,t.autoDepth=!1,this.backgroundcolor&&t.backgroundColor.parseCSS(this.backgroundcolor),this.getLayers().forEach((e=>{t.addChild(e)})),this.getObjects(e).forEach((e=>{t.addChild(e)})),t.resize(this.bounds.width,this.bounds.height),t.sort(!0),!0===i&&(Ar(dr,r),r(mm.viewport.width,mm.viewport.height),xr(dr,r,this)),t.autoSort=s,t.autoDepth=n}getObjects(t){let e,i=[],s=!1;this.readMapObjects(this.data);for(let n=0;n<this.objectGroups.length;n++){let o=this.objectGroups[n];s=o.name.toLowerCase().includes("collision"),!1===t&&(e=new cc(0,0,this.width,this.height),e.anchorPoint.set(0,0),e.name=o.name,e.pos.z=o.z,e.setOpacity(o.opacity),e.autoSort=!1,e.autoDepth=!1);for(let n=0;n<o.objects.length;n++){let r,a,h=o.objects[n];void 0===h.anchorPoint&&(h.anchorPoint={x:0,y:0}),void 0!==h.tintcolor&&(h.tint=Bn.pull("Color"),h.tint.parseHex(h.tintcolor,!0)),h instanceof rc?r=h:"object"==typeof h.text?(void 0===h.text.anchorPoint&&(h.text.anchorPoint=h.anchorPoint),r=!0===h.text.bitmap?Bn.pull("BitmapText",h.x,h.y,h.text):Bn.pull("Text",h.x,h.y,h.text),r.pos.z=h.z):"object"==typeof h.tile?(a=h.shapes,void 0===a&&(a=Bn.pull("Polygon",0,0,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height)])),r=h.tile.getRenderable(h),r.body=new uu(r,a),r.body.setStatic(!0),r.pos.setMuted(h.x,h.y,h.z)):(void 0!==h.name&&""!==h.name?r=Bn.pull(h.name,h.x,h.y,h):(r=Bn.pull("Renderable",h.x,h.y,h.width,h.height),a=h.shapes,void 0===a&&(a=Bn.pull("Polygon",0,0,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height)])),r.anchorPoint.set(0,0),r.name=h.name,r.type=h.type,r.class=h.class||h.type,r.id=h.id,r.body=new uu(r,a),r.body.setStatic(!0),r.resize(r.body.getBounds().width,r.body.getBounds().height)),r.pos.z=h.z),s&&!h.name&&r.body&&(r.body.collisionType=Po.types.WORLD_SHAPE,r.body.isStatic=!0),!1!==t?(!0===r.isRenderable&&(r.setOpacity(r.getOpacity()*o.opacity),void 0!==r.renderable&&!0===r.renderable.isRenderable&&r.renderable.setOpacity(r.renderable.getOpacity()*o.opacity)),i.push(r)):e.addChild(r)}!1===t&&e.children.length>0&&(e.autoSort=!0,e.autoDepth=!0,i.push(e))}return i}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}let xc={},vc=[],Ac=0;function wc(t,e,i){e.container.reset(),mm.reset(),xc[Vc.getCurrentLevelId()]&&xc[Vc.getCurrentLevelId()].destroy(),Ac=vc.indexOf(t),function(t,e,i,s){let n=xc[t];(function(t,e=0){Ll=function(t){let e="",i=0;for(;i<t.length;)e+=t.charCodeAt(i++).toString(16);return e}(t.toString().toUpperCase()),Gl=e})(t,n.nextobjectid),e.anchorPoint.set(0,0),n.addTo(e,i,s)}(t,e.container,e.flatten,e.setViewportBounds),gr(er,t),e.onLoaded(t),i&&hu.restart()}let Sc,Cc,Vc={add(t,e,i){if("tmx"===t)return null==xc[e]&&(xc[e]=new gc(e,Nc(e)),vc.push(e),i&&i(),!0);throw new Error("no level loader defined for format "+t)},load(t,e){if(e=Object.assign({container:mm.world,onLoaded:mm.onLevelLoaded,flatten:mm.mergeGroup,setViewportBounds:!0},e||{}),void 0===xc[t])throw new Error("level "+t+" not found");if(!(xc[t]instanceof gc))throw new Error("no level loader defined");return hu.isRunning()?(hu.stop(),Eo(wc,this,t,e,!0)):wc(t,e),!0},getCurrentLevelId(){return vc[Ac]},getCurrentLevel(){return xc[this.getCurrentLevelId()]},reload(t){return this.load(this.getCurrentLevelId(),t)},next(t){return Ac+1<vc.length&&this.load(vc[Ac+1],t)},previous(t){return Ac-1>=0&&this.load(vc[Ac-1],t)},levelCount(){return vc.length}};function Bc(t,e,i){function s(e){Il[t.name]=e,"tmx"===t.type&&Vc.add(t.type,t.name)}if(t.data)return s(t.data),void("function"==typeof e&&e());let n=new XMLHttpRequest,o=Tl(t.src);return n.overrideMimeType&&("json"===o?n.overrideMimeType("application/json"):n.overrideMimeType("text/xml")),n.open("GET",t.src+Br,!0),n.withCredentials=Mr,n.ontimeout=i,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status&&n.responseText){let t=null;switch(o){case"xml":case"tmx":case"tsx":{if(ea.match(/msie/i)||!n.responseXML){if(!globalThis.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");t=(new DOMParser).parseFromString(n.responseText,"text/xml")}else t=n.responseXML;const e=Xl(t);switch(o){case"tmx":t=e.map;break;case"tsx":t=e.tilesets[0]}break}case"json":case"tmj":case"tsj":t=JSON.parse(n.responseText);break;default:throw new Error("TMX file format "+o+" not supported !")}s(t),"function"==typeof e&&e()}else"function"==typeof i&&i(t.name)},n.send(),1}function Tc(t,e,i){let s=new XMLHttpRequest;return s.overrideMimeType&&s.overrideMimeType("application/json"),s.open("GET",t.src+Br,!0),s.withCredentials=Mr,s.ontimeout=i,s.onreadystatechange=function(){4===s.readyState&&(200===s.status||0===s.status&&s.responseText?(El[t.name]=JSON.parse(s.responseText),"function"==typeof e&&e()):"function"==typeof i&&i(t.name))},s.send(),1}function Mc(t,e,i){let s=new XMLHttpRequest;return s.open("GET",t.src+Br,!0),s.withCredentials=Mr,s.responseType="arraybuffer",s.onerror=i,s.onload=function(){let i=s.response;if(i){let s=new Uint8Array(i),n=[];for(let t=0;t<s.byteLength;t++)n[t]=String.fromCharCode(s[t]);Pl[t.name]=n.join(""),"function"==typeof e&&e()}},s.send(),1}function Ic(t,e,i){let s=globalThis.document.createElement("script");return s.src=t.src,s.type="text/javascript","string"==typeof Vr&&(s.crossOrigin=Vr),s.defer=!0,"function"==typeof e&&(s.onload=()=>{e()}),"function"==typeof i&&(s.onerror=()=>{i(t.name)}),globalThis.document.getElementsByTagName("body")[0].appendChild(s),1}let Pc=new Map,Ec=!1,Dc=0,Rc=0,Lc=0;function Gc(t){if(Rc===Dc){if("function"!=typeof t&&!Sc)throw new Error("no load callback defined");{clearTimeout(Lc);let e=t||Sc;setTimeout((()=>{e(),gr(ir)}),300)}}else Lc=setTimeout((()=>{Gc(t)}),100)}function kc(t){Rc++;let e=Rc/Dc;gr(sr,e,t)}function Fc(t){throw new Error("Failed loading resource "+t.src)}function Oc(t,e){if("function"!=typeof e)throw new Error("invalid parser function for "+t);void 0!==Pc.get(t)&&fc("overriding parser for "+t+" format"),Pc.set(t,e)}function zc(t,e,i){!1===Ec&&(Oc("binary",Mc),Oc("image",Dl),Oc("json",Tc),Oc("js",Ic),Oc("tmx",Bc),Oc("tsx",Bc),Oc("audio",jr),Oc("fontface",Rl),Ec=!0),void 0!==Tr[t.type]&&(t.src=Tr[t.type]+t.src);let s=Pc.get(t.type);if(void 0===s)throw new Error("load : unknown or invalid resource type : "+t.type);return s.call(this,t,e,i)}function jc(t){switch(t.type){case"binary":return t.name in Pl&&(delete Pl[t.name],!0);case"image":return t.name in Ml&&(delete Ml[t.name],!0);case"json":return t.name in El&&(delete El[t.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return t.name in Il&&(delete Il[t.name],!0);case"audio":return Jr(t.name);default:throw new Error("unload : unknown or invalid resource type : "+t.type)}}function Nc(t){return(t=""+t)in Il?Il[t]:null}function qc(t){return(t=""+t)in Pl?Pl[t]:null}function Uc(t){return(t=Bl(""+t))in Ml?Ml[t]:null}var Jc={__proto__:null,baseURL:Tr,crossOrigin:Vr,getBinary:qc,getImage:Uc,getJSON:function(t){return(t=""+t)in El?El[t]:null},getTMX:Nc,load:zc,get nocache(){return Br},onProgress:Cc,get onload(){return Sc},preload:function(t,e,i=!0){for(let e=0;e<t.length;e++)Dc+=zc(t[e],kc.bind(this,t[e]),Fc.bind(this,t[e]));void 0!==e&&(Sc=e),!0===i&&hu.change(hu.LOADING),Gc(Sc)},setBaseURL:function(t,e){"*"!==t?Tr[t]=e:(Tr.audio=e,Tr.binary=e,Tr.image=e,Tr.json=e,Tr.js=e,Tr.tmx=e,Tr.tsx=e)},setNocache:Ir,unload:jc,unloadAll:function(){let t;for(t in Pl)Pl.hasOwnProperty(t)&&jc({name:t,type:"binary"});for(t in Ml)Ml.hasOwnProperty(t)&&jc({name:t,type:"image"});for(t in Il)Il.hasOwnProperty(t)&&jc({name:t,type:"tmx"});for(t in El)El.hasOwnProperty(t)&&jc({name:t,type:"json"});Xr()},withCredentials:Mr};class Xc extends yl{constructor(t,e,i){if(super(t,e,0,0),this.animationpause=!1,this.animationspeed=100,this.offset=Bn.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:void 0,length:0,offset:Bn.pull("Vector2d"),width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},i.image instanceof $l){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,void 0!==i.region){let t=this.source.getRegion(i.region);if(!t)throw new Error("Texture - region for "+i.region+" not found");this.setRegion(t)}}else{if(this.image="object"==typeof i.image?i.image:Uc(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.width=this.current.width=i.framewidth=i.framewidth||this.image.width,this.height=this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=ah.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}void 0!==i.atlas&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),void 0!==i.flipX&&this.flipX(!!i.flipX),void 0!==i.flipY&&this.flipY(!!i.flipY),void 0!==i.rotation&&this.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),void 0!==i.tint&&(i.tint instanceof kn?this.tint.copy(i.tint):this.tint.parseCSS(i.tint)),"string"==typeof i.name&&(this.name=i.name),void 0!==i.z&&(this.pos.z=i.z),0!==this.addAnimation("default",null)&&this.setCurrentAnimation("default")}isFlickering(){return this._flicker.isFlickering}flicker(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this}addAnimation(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};let s=0;if("object"!=typeof this.textureAtlas)return 0;null==e&&(e=[],Object.keys(this.textureAtlas).forEach(((t,i)=>{e[i]=i})));for(let n=0,o=e.length;n<o;n++){let o,r=e[n];o="number"==typeof r||"string"==typeof r?{name:r,delay:i||this.animationspeed}:r;let a=o.name;if("number"==typeof a)void 0!==this.textureAtlas[a]&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[a],o),s++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[a]],o),s++}}return this.anim[t].length=s,s}setCurrentAnimation(t,e,i=!1){if(void 0===this.anim[t])throw new Error("animation id '"+t+"' not defined");return this.isCurrentAnimation(t)||(this.current.name=t,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof e?this.setCurrentAnimation.bind(this,e,null,!0):"function"==typeof e?e:void 0,this.setAnimationFrame(0),i||(this.dt=0),this.isDirty=!0),this}reverseAnimation(t){return void 0!==t&&void 0!==this.anim[t]?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this}isCurrentAnimation(t){return this.current.name===t}setRegion(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle="number"==typeof t.angle?t.angle:0,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.setMuted(this._flip.x&&!0===t.trimmed?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&!0===t.trimmed?1-t.anchorPoint.y:t.anchorPoint.y),this.updateBounds(),this.isDirty=!0,this}setAnimationFrame(t=0){return this.current.idx=t%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(t){return this.anim[this.current.name].frames[t]}update(t){if(!this.animationpause&&this.current.length>1){let e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;let t=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(t),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),super.update(t)}destroy(){Bn.push(this.offset),this.offset=void 0,super.destroy()}draw(t,e){if(this._flicker.isFlickering&&(this._flicker.state=!this._flicker.state,!this._flicker.state))return;let i=this.current,s=this.pos.x,n=this.pos.y,o=i.width,r=i.height,a=i.offset,h=this.offset;0!==i.angle&&(t.translate(-s,-n),t.rotate(i.angle),s-=r,o=i.height,r=i.width),t.drawImage(this.image,h.x+a.x,h.y+a.y,o,r,s,n,o,r)}}class Hc extends yl{constructor(t,e,i,s){super(t,e,i,s),this.barHeight=s,this.anchorPoint.set(0,0),xr(sr,this.onProgressUpdate,this),xr(dr,this.resize,this),this.anchorPoint.set(0,0),this.progress=0}onProgressUpdate(t){this.progress=~~(t*this.width),this.isDirty=!0}draw(t,e){t.setColor("black"),t.fillRect(this.pos.x,e.centerY,t.getWidth(),this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,e.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){Ar(sr,this.onProgressUpdate),Ar(dr,this.resize)}}class Wc extends Sl{onResetEvent(){mm.world.backgroundColor.parseCSS("#202020"),mm.world.addChild(new Hc(0,ah.getHeight()/2,ah.getWidth(),8),1),zc({name:"melonjs_logo",type:"image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII="},(()=>{mm.world.addChild(new Xc(ah.getWidth()/2,ah.getHeight()/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)}))}onDestroyEvent(){jc({name:"melonjs_logo",type:"image"})}}let Yc=-1,Zc=-1,Kc=!1,Qc={},$c={color:"",duration:0},tu=null,eu=null,iu=0;function su(){-1===Zc&&-1!==Yc&&(Zc=globalThis.requestAnimationFrame(nu))}function nu(t){gr(Fo,t),-1!==Zc&&(Zc=globalThis.requestAnimationFrame(nu))}function ou(){globalThis.cancelAnimationFrame(Zc),Zc=-1}function ru(t){ou(),Qc[Yc]&&Qc[Yc].stage.destroy(),Qc[t]&&(Yc=t,Qc[Yc].stage.reset.apply(Qc[Yc].stage,eu),su(),gr(Jo),tu&&tu())}xr(ko,(()=>{au.set(au.LOADING,new Wc),au.set(au.DEFAULT,new Sl),xr(Ho,(()=>{au.change(au.DEFAULT,!0)}))}));let au={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(t=!1){Yc!==this.LOADING&&this.isRunning()&&(ou(),!0===t&&t(),iu=globalThis.performance.now(),gr(qo))},pause(t=!1){Yc===this.LOADING||this.isPaused()||(Kc=!0,!0===t&&Nr(),iu=globalThis.performance.now(),gr(jo))},restart(t=!1){this.isRunning()||(su(),!0===t&&qr(),iu=globalThis.performance.now()-iu,gr(Uo,iu))},resume(t=!1){this.isPaused()&&(Kc&&-1!==Yc&&(Kc=!1),!0===t&&qr(),iu=globalThis.performance.now()-iu,gr(No,iu))},isRunning(){return-1!==Zc},isPaused(){return Kc},set(t,e,i=!1){if(!(e instanceof Sl))throw new Error(e+" is not an instance of me.Stage");Qc[t]={},Qc[t].stage=e,Qc[t].transition=!0,!0===i&&this.change(t)},get(t=Yc){return void 0!==Qc[t]?Qc[t].stage:void 0},current(){return this.get()},transition(t,e,i){"fade"===t&&($c.color=e,$c.duration=i)},setTransition(t,e){Qc[t].transition=e},change(t,e){if(void 0===Qc[t])throw new Error("Undefined Stage for state '"+t+"'");this.isCurrent(t)||(eu=null,arguments.length>1&&(eu=Array.prototype.slice.call(arguments,1)),$c.duration&&Qc[t].transition?(tu=()=>{mm.viewport.fadeOut($c.color,$c.duration)},mm.viewport.fadeIn($c.color,$c.duration,(function(){Eo(ru,this,t)}))):!0===e?ru(t):Eo(ru,this,t))},isCurrent(t){return Yc===t}};var hu=au;const lu=new class{constructor(){this.tick=1,this.fps=0,this.maxfps=60,this.interpolation=!1,this.framecount=0,this.framedelta=0,this.last=0,this.now=0,this.delta=0,this.step=0,this.minstep=0,this.timers=[],this.timerId=0,xr(ko,(()=>{this.reset(),this.now=this.last=0,xr(Zo,(t=>this.update(t)))})),xr(No,(()=>{this.reset()})),xr(Uo,(()=>{this.reset()})),xr(Jo,(()=>{this.reset()}))}reset(){this.last=this.now=globalThis.performance.now(),this.delta=0,this.framedelta=0,this.framecount=0,this.step=Math.ceil(1e3/this.maxfps),this.minstep=1e3/this.maxfps*1.25}setTimeout(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}setInterval(t,e,i,...s){return this.timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++this.timerId,pauseable:!0===i||!0,args:s}),this.timerId}clearTimeout(t){t>0&&Eo(this.clearTimer.bind(this),this,t)}clearInterval(t){t>0&&Eo(this.clearTimer.bind(this),this,t)}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++,this.framedelta+=this.delta,this.framecount%10==0&&(this.fps=wn(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps),this.framedelta=0,this.framecount=0)}update(t){this.last=this.now,this.now=t,this.delta=this.now-this.last,this.delta<0&&(this.delta=0),this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1,this.updateTimers()}clearTimer(t){for(let e=0,i=this.timers.length;e<i;e++)if(this.timers[e].timerId===t){this.timers.splice(e,1);break}}updateTimers(){for(let t=0,e=this.timers.length;t<e;t++){let e=this.timers[t];e.pauseable&&hu.isPaused()||(e.elapsed+=this.delta),e.elapsed>=e.delay&&(e.fn.apply(null,e.args),!0===e.repeat?e.elapsed-=e.delay:this.clearTimeout(e.timerId))}}};var cu=lu;class uu{constructor(t,e,i){if(this.ancestor=t,void 0===this.bounds&&(this.bounds=Bn.pull("Bounds")),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=Po.types.ALL_OBJECT,this.collisionType=Po.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=Bn.pull("Vector2d")),this.vel.set(0,0),void 0===this.force&&(this.force=Bn.pull("Vector2d")),this.force.set(0,0),void 0===this.friction&&(this.friction=Bn.pull("Vector2d")),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=Bn.pull("Vector2d")),this.maxVel.set(490,490),this.isStatic=!1,this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof i&&(this.onBodyUpdate=i),this.bounds.clear(),void 0!==e)if(Array.isArray(e))for(let t=0;t<e.length;t++)this.addShape(e[t]);else this.addShape(e);this.ancestor.isKinematic=!1}setStatic(t=!0){this.isStatic=!0===t}addShape(t){if(t instanceof wo||t instanceof Io){let e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof vo?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof go?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):t instanceof Ao?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addPoint(t)):this.fromJSON(t);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){let s=this.getShape(e);s instanceof go?s.setShape(0,0,t):this.shapes[e]=Bn.pull("Polygon",0,0,t),this.bounds.add(this.shapes[e].points,i),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){let i=t;if(void 0!==e&&(i=t[e]),void 0===i)throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(let t=0;t<i.length;t++)this.addVertices(i[t].shape,t);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),Co(this.shapes,t);for(let t=0;t<this.shapes.length;t++)this.addShape(this.shapes[t]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=Po.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(void 0!==t){if(void 0===Po.types[t])throw new Error("Invalid value for the collisionType property");this.collisionType=Po.types[t]}}respondToCollision(t){let e=t.overlapV;if(this.ancestor.pos.sub(e),0!==e.x&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==e.y&&(this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce),!this.ignoreGravity)){let t=!0===this.falling?1:!0===this.jumping?-1:0;this.falling=e.y>=t,this.jumping=e.y<=-t}}forEach(t,e){let i=this,s=0,n=this.shapes,o=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);s<o;)t.call(i,n[s],s,n),s++}contains(){let t,e;if(2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e))for(let i,s=this.shapes.length;s--,i=this.shapes[s];)if(i.contains(t,e))return!0;return!1}rotate(t,e=this.getBounds().center){return 0!==t&&(this.bounds.clear(),this.forEach((i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds())}))),this}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t=0,e=0){this.friction.x=t,this.friction.y=e}update(t){let e=cu.tick;if(0!==this.force.x&&(this.vel.x+=this.force.x*e),0!==this.force.y&&(this.vel.y+=this.force.y*e),this.friction.x>0){let t=this.friction.x*e,i=this.vel.x+t,s=this.vel.x-t;this.vel.x=i<0?i:s>0?s:0}if(this.friction.y>0){let t=this.friction.y*e,i=this.vel.y+t,s=this.vel.y-t;this.vel.y=i<0?i:s>0?s:0}return 0!==this.vel.y&&(this.vel.y=wn(this.vel.y,-this.maxVel.y,this.maxVel.y)),0!==this.vel.x&&(this.vel.x=wn(this.vel.x,-this.maxVel.x,this.maxVel.x)),this.falling=this.vel.y*Math.sign(this.force.y)>0,this.jumping=!this.falling&&this.jumping,this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}destroy(){Bn.push(this.bounds),Bn.push(this.vel),Bn.push(this.force),Bn.push(this.friction),Bn.push(this.maxVel),this.shapes.forEach((t=>{Bn.push(t,!1)})),this.onBodyUpdate=void 0,this.ancestor=void 0,this.bounds=void 0,this.vel=void 0,this.force=void 0,this.friction=void 0,this.maxVel=void 0,this.shapes.length=0,this.setStatic(!1)}}let mu={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){const e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-mu.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*mu.Bounce.In(2*t):.5*mu.Bounce.Out(2*t-1)+.5}}},du={Linear:function(t,e){let i=t.length-1,s=i*e,n=Math.floor(s),o=du.Utils.Linear;return e<0?o(t[0],t[1],s):e>1?o(t[i],t[i-1],i-s):o(t[n],t[n+1>i?i:n+1],s-n)},Bezier:function(t,e){let i,s=0,n=t.length-1,o=Math.pow,r=du.Utils.Bernstein;for(i=0;i<=n;i++)s+=o(1-e,n-i)*o(e,i)*t[i]*r(n,i);return s},CatmullRom:function(t,e){let i=t.length-1,s=i*e,n=Math.floor(s),o=du.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(s=i*(1+e))),o(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):o(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){let i=du.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){let t=[1];return function(e){let i,s=1;if(t[e])return t[e];for(i=e;i>1;i--)s*=i;return t[e]=s,s}}(),CatmullRom:function(t,e,i,s,n){let o=.5*(i-t),r=.5*(s-e),a=n*n;return(2*e-2*i+o+r)*(n*a)+(-3*e+3*i-2*o-r)*a+o*n+e}}};class pu{constructor(t){this.setProperties(t)}onResetEvent(t){this.setProperties(t)}setProperties(t){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=mu.Linear.None,this._interpolationFunction=du.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._tweenTimeTracker=mm.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,this.isRenderable=!1;for(let e in t)"object"!=typeof t&&(this._valuesStart[e]=parseFloat(t[e]))}_resumeCallback(t){this._startTime&&(this._startTime+=t)}onActivateEvent(){xr(No,this._resumeCallback,this)}onDeactivateEvent(){Ar(No,this._resumeCallback)}to(t,e){return this._valuesEnd=t,void 0!==e&&("number"==typeof e?this._duration=e:"object"==typeof e&&(e.duration&&(this._duration=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this}start(t=cu.getTime()){this._onStartCallbackFired=!1,mm.world.addChild(this),this._startTime=t+this._delayTime;for(let t in this._valuesEnd){if(this._valuesEnd[t]instanceof Array){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],this._valuesStart[t]instanceof Array==0&&(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this}stop(){return mm.world.removeChildNow(this),this}delay(t){return this._delayTime=t,this}repeat(t){return this._repeat=t,this}yoyo(t){return this._yoyo=t,this}easing(t){if("function"!=typeof t)throw new Error("invalid easing function for me.Tween.easing()");return this._easingFunction=t,this}interpolation(t){return this._interpolationFunction=t,this}chain(){return this._chainedTweens=arguments,this}onStart(t){return this._onStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}update(t){this._tweenTimeTracker=mm.lastUpdate>this._tweenTimeTracker?mm.lastUpdate:this._tweenTimeTracker+t;let e,i=this._tweenTimeTracker;if(i<this._startTime)return!0;!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback.call(this._object),this._onStartCallbackFired=!0);let s=(i-this._startTime)/this._duration;s=s>1?1:s;let n=this._easingFunction(s);for(e in this._valuesEnd){let t=this._valuesStart[e]||0,i=this._valuesEnd[e];i instanceof Array?this._object[e]=this._interpolationFunction(i,n):("string"==typeof i&&(i=t+parseFloat(i)),"number"==typeof i&&(this._object[e]=t+(i-t)*n))}if(null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._object,n),1===s){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo){let t=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=i+this._delayTime,!0}mm.world.removeChildNow(this),null!==this._onCompleteCallback&&this._onCompleteCallback.call(this._object);for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].start(i);return!1}return!0}static get Easing(){return mu}static get Interpolation(){return du}}const _u={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function bu(t,e,i){let s=t.createShader(e);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s));return s}function yu(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;"+t:t}function fu(t){return t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?"highp":t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function gu(t){return(t=(t=(t=t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}class xu{constructor(t,e,i,s){this.gl=t,this.vertex=yu(gu(e),s||fu(this.gl)),this.fragment=yu(gu(i),s||fu(this.gl)),this.attributes=function(t,e){let i,s={},n=/attribute\s+\w+\s+(\w+)/g,o=0;for(;i=n.exec(e.vertex);)s[i[1]]=o++;return s}(this.gl,this),this.program=function(t,e,i,s){let n=bu(t,t.VERTEX_SHADER,e),o=bu(t,t.FRAGMENT_SHADER,i),r=t.createProgram();t.attachShader(r,n),t.attachShader(r,o);for(let e in s)t.bindAttribLocation(r,s[e],e);if(t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)){let e="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+t.getProgramParameter(r,t.VALIDATE_STATUS)+"\ngl.getError()"+t.getError()+"\ngl.getProgramInfoLog()"+t.getProgramInfoLog(r);throw t.deleteProgram(r),r=null,new Error(e)}return t.useProgram(r),t.deleteShader(n),t.deleteShader(o),r}(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=function(t,e){let i,s={},n=/uniform\s+(\w+)\s+(\w+)/g,o={},r={},a={};return[e.vertex,e.fragment].forEach((t=>{for(;i=n.exec(t);)o[i[2]]=i[1]})),Object.keys(o).forEach((i=>{let s=o[i];a[i]=t.getUniformLocation(e.program,i),r[i]={get:function(t){return function(){return a[t]}}(i),set:function(e,i,s){return 0===i.indexOf("mat")?function(i){t[s](a[e],!1,i)}:function(i){let n=s;i.length&&"v"!==s.slice(-1)&&(n+="v"),t[n](a[e],i)}}(i,s,"uniform"+_u[s])}})),Object.defineProperties(s,r),s}(this.gl,this),xr(yr,this.destroy,this)}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){let e=this.attributes[t];return void 0!==e?e:-1}setUniform(t,e){let i=this.uniforms;if(void 0===i[t])throw new Error("undefined ("+t+") uniform for shader "+this);"object"==typeof e&&"function"==typeof e.toArray?i[t]=e.toArray():i[t]=e}setVertexAttributes(t,e,i){for(let s=0;s<e.length;++s){let n=e[s],o=this.getAttribLocation(n.name);-1!==o?(t.enableVertexAttribArray(o),t.vertexAttribPointer(o,n.size,n.type,n.normalized,i,n.offset)):t.disableVertexAttribArray(s)}}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}class vu{constructor(t,e){this.vertexSize=t,this.objSize=e,this.maxVertex=256,this.vertexCount=0,this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(t=this.objSize){return this.vertexCount+t>=this.maxVertex}resize(t){for(;t>this.maxVertex;)this.maxVertex<<=1;let e=this.bufferF32;return this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize),this.bufferF32=new Float32Array(this.buffer),this.bufferU32=new Uint32Array(this.buffer),this.bufferF32.set(e),this}push(t,e,i,s,n){let o=this.vertexCount*this.vertexSize;return this.vertexCount>=this.maxVertex&&this.resize(this.vertexCount),this.bufferF32[o]=t,this.bufferF32[++o]=e,void 0!==i&&(this.bufferF32[++o]=i,this.bufferF32[++o]=s),void 0!==n&&(this.bufferU32[++o]=n),this.vertexCount++,this}toFloat32(t,e){return void 0!==e?this.bufferF32.subarray(t,e):this.bufferF32}toUint32(t,e){return void 0!==e?this.bufferU32.subarray(t,e):this.bufferU32}length(){return this.vertexCount}isEmpty(){return 0===this.vertexCount}}class Au{constructor(t,e){this.init(t,e)}init(t,e){if(this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.viewMatrix=t.currentTransform,this.defaultShader=void 0,this.currentShader=void 0,this.mode=this.gl.TRIANGLES,this.attributes=[],this.vertexByteSize=0,this.vertexSize=0,this.vertexData=null,void 0===e||!Array.isArray(e.attributes))throw new Error("attributes definition missing");if(e.attributes.forEach((t=>{this.addAttribute(t.name,t.size,t.type,t.normalized,t.offset),this.vertexData=new vu(this.vertexSize,6)})),void 0===e||void 0===e.shader)throw new Error("shader definition missing");this.defaultShader=new xu(this.gl,e.shader.vertex,e.shader.fragment)}reset(){this.gl=this.renderer.gl,this.vertexData.clear()}bind(){this.renderer.currentProgram!==this.defaultShader.program&&this.useShader(this.defaultShader)}useShader(t){this.renderer.currentProgram!==t.program&&(this.flush(),t.bind(),t.setUniform("uProjectionMatrix",this.renderer.projectionMatrix),t.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize),this.currentShader=t,this.renderer.currentProgram=this.currentShader.program)}addAttribute(t,e,i,s,n){switch(this.attributes.push({name:t,size:e,type:i,normalized:s,offset:n}),i){case this.gl.BYTE:this.vertexByteSize+=e*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=e*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=e*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=e*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=e*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=e*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=e*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setProjection(t){this.currentShader.setUniform("uProjectionMatrix",t)}flush(t=this.mode){let e=this.vertexData,i=e.vertexCount;if(i>0){let s=this.gl,n=e.vertexSize;this.renderer.WebGLVersion>1?s.bufferData(s.ARRAY_BUFFER,e.toFloat32(),s.STREAM_DRAW,0,i*n):s.bufferData(s.ARRAY_BUFFER,e.toFloat32(0,i*n),s.STREAM_DRAW),s.drawArrays(t,0,i),e.clear()}}}class wu extends Au{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:2*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:"// Current vertex point\nattribute vec2 aVertex;\nattribute vec4 aColor;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n}\n",fragment:"varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n"}})}drawVertices(t,e,i=e.length){let s=this.viewMatrix,n=this.vertexData,o=this.renderer.getGlobalAlpha(),r=this.renderer.currentColor.toUint32(o);n.isFull(i)&&this.flush(),t!==this.mode&&(this.flush(this.mode),this.mode=t),s.isIdentity()?e.forEach((t=>{n.push(t.x,t.y,void 0,void 0,r)})):e.forEach((t=>{s.apply(t),n.push(t.x,t.y,void 0,void 0,r)})),this.mode!==this.gl.LINE_STRIP&&this.mode!==this.gl.LINE_LOOP||this.flush(this.mode)}}let Su=[new Fn,new Fn,new Fn,new Fn];class Cu extends Au{init(t){super.init(t,{attributes:[{name:"aVertex",size:2,type:t.gl.FLOAT,normalized:!1,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aRegion",size:2,type:t.gl.FLOAT,normalized:!1,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:t.gl.UNSIGNED_BYTE,normalized:!0,offset:4*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:"// Current vertex point\nattribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n",fragment:"uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n"}}),this.currentTextureUnit=-1,this.boundTextures=[]}reset(){super.reset();for(let t=0;t<this.renderer.maxTextures;t++){let e=this.getTexture2D(t);void 0!==e&&this.deleteTexture2D(e)}this.currentTextureUnit=-1}createTexture2D(t,e=null,i,s="no-repeat",n=e.width,o=e.height,r=!0,a=!0){let h=this.gl,l=xn(n)&&xn(o),c=0===s.search(/^repeat(-x)?$/)&&(l||this.renderer.WebGLVersion>1)?h.REPEAT:h.CLAMP_TO_EDGE,u=0===s.search(/^repeat(-y)?$/)&&(l||this.renderer.WebGLVersion>1)?h.REPEAT:h.CLAMP_TO_EDGE,m=h.createTexture();return this.bindTexture2D(m,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,c),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,u),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),null===e||void 0!==e.byteLength?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,n,o,0,h.RGBA,h.UNSIGNED_BYTE,e,0):void 0!==globalThis.OffscreenCanvas&&e instanceof globalThis.OffscreenCanvas?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,e.transferToImageBitmap()):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,e),l&&!0===a&&h.generateMipmap(h.TEXTURE_2D),m}deleteTexture2D(t){this.gl.deleteTexture(t),this.unbindTexture2D(t)}getTexture2D(t){return this.boundTextures[t]}bindTexture2D(t,e){let i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}unbindTexture2D(t,e){return void 0===e&&(e=this.boundTextures.indexOf(t)),-1!==e&&(delete this.boundTextures[e],e===this.currentTextureUnit&&(this.currentTextureUnit=-1)),e}uploadTexture(t,e,i,s=!1){let n=this.renderer.cache.getUnit(t),o=this.boundTextures[n];return void 0===o||s?this.createTexture2D(n,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,t.premultipliedAlpha):this.bindTexture2D(o,n),this.currentTextureUnit}addQuad(t,e,i,s,n,o,r,a,h,l){let c=this.vertexData;c.isFull(6)&&this.flush();let u=this.uploadTexture(t);this.currentShader.setUniform("uSampler",u);let m=this.viewMatrix,d=Su[0].set(e,i),p=Su[1].set(e+s,i),_=Su[2].set(e,i+n),b=Su[3].set(e+s,i+n);m.isIdentity()||(m.apply(d),m.apply(p),m.apply(_),m.apply(b)),c.push(d.x,d.y,o,r,l),c.push(p.x,p.y,a,r,l),c.push(_.x,_.y,o,h,l),c.push(_.x,_.y,o,h,l),c.push(p.x,p.y,a,r,l),c.push(b.x,b.y,a,h,l)}}class Vu extends Kl{constructor(t){super(t),this.WebGLVersion=1,this.GPUVendor=void 0,this.GPURenderer=void 0,this.context=this.gl=this.getContextGL(this.getCanvas(),t.transparent,"z-buffer"===t.depthTest),this.vertexBuffer=this.gl.createBuffer(),this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._blendStack=[],this.currentTransform=new Nn,this.currentCompositor=void 0,this.currentProgram=void 0,this.compositors=new Map,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.addCompositor(new(this.settings.compositor||Cu)(this),"quad",!0),this.addCompositor(new(this.settings.compositor||wu)(this),"primitive"),this.depthTest=t.depthTest,"z-buffer"===this.depthTest?(this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.depthMask(!0)):(this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!1)),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);let e=this.gl.getExtension("WEBGL_debug_renderer_info");null!==e&&(this.GPUVendor=this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL)),this.customShader=void 0,this.cache=new sc(this.maxTextures),this.type="WebGL"+this.WebGLVersion,this.getCanvas().addEventListener("webglcontextlost",(t=>{t.preventDefault(),this.isContextValid=!1,gr(yr,this)}),!1),this.getCanvas().addEventListener("webglcontextrestored",(()=>{this.reset(),this.isContextValid=!0,gr(fr,this)}),!1),xr(Yo,(()=>{this.reset()})),xr(mr,((t,e)=>{this.flush(),this.setViewport(0,0,t,e)}))}reset(){super.reset(),this._colorStack.forEach((t=>{Bn.push(t)})),this._matrixStack.forEach((t=>{Bn.push(t)})),this._colorStack.length=0,this._matrixStack.length=0,this._blendStack.length=0,this.clear(),this.setViewport(),this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING)!==this.vertexBuffer&&this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.currentCompositor=void 0,this.currentProgram=void 0,this.customShader=void 0,this.compositors.forEach((t=>{!1===this.isContextValid?t.init(this):t.reset()})),this.setCompositor("quad"),this.gl.disable(this.gl.SCISSOR_TEST)}addCompositor(t,e="default",i=!1){if(void 0!==this.compositors.get(e))throw new Error("Invalid Compositor name");this.compositors.set(e,t),!0===i&&this.setCompositor(e)}setCompositor(t="default",e=this.customShader){let i=this.compositors.get(t);if(void 0===i)throw new Error("Invalid Compositor");return this.currentCompositor!==i&&(void 0!==this.currentCompositor&&this.currentCompositor.flush(),this.currentCompositor=i),"quad"===t&&"object"==typeof e?this.currentCompositor.useShader(e):this.currentCompositor.bind(),this.currentCompositor}resetTransform(){this.currentTransform.identity()}createPattern(t,e){if(this.setCompositor("quad"),!(1!==ah.WebGLVersion||xn(t.width)&&xn(t.height))){let e=void 0!==t.src?t.src:t;throw new Error("[WebGL Renderer] "+e+" is not a POT texture ("+t.width+"x"+t.height+")")}let i=new $l(Ql(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(i),i}flush(){this.currentCompositor.flush()}setProjection(t){super.setProjection(t),this.currentCompositor.setProjection(t)}setViewport(t=0,e=0,i=this.getCanvas().width,s=this.getCanvas().height){this.gl.viewport(t,e,i,s)}clear(){let t=this.gl;t.clearColor(0,0,0,this.settings.transparent?0:1),"z-buffer"===this.depthTest?t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}clearColor(t="#000000",e=!1){let i,s=this.gl;if(t instanceof kn)i=t.toArray();else{let e=Bn.pull("me.Color");i=e.parseCSS(t).toArray(),Bn.push(e)}s.clearColor(i[0],i[1],i[2],!0===e?1:i[3]),s.clear(s.COLOR_BUFFER_BIT)}clearRect(t,e,i,s){this.save(),this.clipRect(t,e,i,s),this.clearColor(),this.restore()}drawImage(t,e,i,s,n,o,r,a,h){void 0===s?(s=a=t.width,n=h=t.height,o=e,r=i,e=0,i=0):void 0===o&&(o=e,r=i,a=s,h=n,s=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(o|=0,r|=0),this.setCompositor("quad");let l=this.cache.get(t),c=l.getUVs(e+","+i+","+s+","+n);this.currentCompositor.addQuad(l,o,r,a,h,c[0],c[1],c[2],c[3],this.currentTint.toUint32(this.getGlobalAlpha()))}drawPattern(t,e,i,s,n){let o=t.getUVs("0,0,"+s+","+n);this.setCompositor("quad"),this.currentCompositor.addQuad(t,e,i,s,n,o[0],o[1],o[2],o[3],this.currentTint.toUint32(this.getGlobalAlpha()))}beginPath(){this.path2D.beginPath()}moveTo(t,e){this.path2D.moveTo(t,e)}lineTo(t,e){this.path2D.lineTo(t,e)}rect(t,e,i,s){this.path2D.rect(t,e,i,s)}roundRect(t,e,i,s,n){this.path2D.roundRect(t,e,i,s,n)}stroke(t,e){this.setCompositor("primitive"),void 0===t?!0===e?this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()):this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):super.stroke(t,e)}fill(t){this.stroke(t,!0)}closePath(){this.path2D.closePath()}getContextGL(t,e=!1,i=!1){if(null==t)throw new Error("You must pass a canvas element in order to create a GL context");let s,n={alpha:e,antialias:this.settings.antiAlias,depth:i,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:!!e&&this.settings.premultipliedAlpha,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(s=t.getContext("webgl2",n),s&&(this.WebGLVersion=2)),s||(this.WebGLVersion=1,s=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)),!s)throw new Error("A WebGL context could not be created.");return s}getContext(){return this.gl}setBlendMode(t="normal",e=this.gl){if(this.currentBlendMode!==t)switch(this.flush(),e.enable(e.BLEND),this.currentBlendMode=t,t){case"screen":e.blendFunc(e.ONE,e.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":e.blendFunc(e.ONE,e.ONE);break;case"multiply":e.blendFunc(e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA);break;default:e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal"}}restore(){if(0!==this._matrixStack.length){let t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),this.setBlendMode(this._blendStack.pop()),Bn.push(t),Bn.push(e)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.getCanvas().width,this.currentScissor[3]=this.getCanvas().height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice()),this._blendStack.push(this.getBlendMode())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.alpha=t}getGlobalAlpha(){return this.currentColor.alpha}setColor(t){let e=this.currentColor.alpha;this.currentColor.copy(t),this.currentColor.alpha*=e}setLineWidth(t){this.getContext().lineWidth(t)}strokeArc(t,e,i,s,n,o=!1,r=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.arc(t,e,i,s,n,o),!1===r?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillArc(t,e,i,s,n,o=!1){this.strokeArc(t,e,i,s,n,o,!0)}strokeEllipse(t,e,i,s,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.ellipse(t,e,i,s,0,0,360),!1===n?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillEllipse(t,e,i,s){this.strokeEllipse(t,e,i,s,!1)}strokeLine(t,e,i,s){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.moveTo(t,e),this.path2D.lineTo(i,s),this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}fillLine(t,e,i,s){this.strokeLine(t,e,i,s)}strokePolygon(t,e=!1){const i=t.points,s=i.length;this.setCompositor("primitive"),this.translate(t.pos.x,t.pos.y),this.path2D.beginPath();for(let t=0;t<s-1;t++){const e=i[t],s=i[t+1];this.path2D.moveTo(e.x,e.y),this.path2D.lineTo(s.x,s.y)}this.path2D.closePath(),!1===e?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath()),this.translate(-t.pos.x,-t.pos.y)}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,s,n=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.rect(t,e,i,s),!1===n?this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRect(t,e,i,s){this.strokeRect(t,e,i,s,!0)}strokeRoundRect(t,e,i,s,n,o=!1){this.setCompositor("primitive"),this.path2D.beginPath(),this.path2D.roundRect(t,e,i,s,n),!1===o?this.currentCompositor.drawVertices(this.gl.LINE_STRIP,this.path2D.points):this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}fillRoundRect(t,e,i,s,n){this.strokeRoundRect(t,e,i,s,n,!0)}strokePoint(t,e){this.strokeLine(t,e,t+1,e+1)}fillPoint(t,e){this.strokePoint(t,e)}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){let e=this.currentTransform;if(e.multiply(t),!1===this.settings.subPixel){let t=e.toArray();t[6]|=0,t[7]|=0}}translate(t,e){let i=this.currentTransform;if(i.translate(t,e),!1===this.settings.subPixel){let t=i.toArray();t[6]|=0,t[7]|=0}}clipRect(t,e,i,s){let n=this.getCanvas(),o=this.gl;if(0!==t||0!==e||i!==n.width||s!==n.height){let r=this.currentScissor;if(o.isEnabled(o.SCISSOR_TEST)&&r[0]===t&&r[1]===e&&r[2]===i&&r[3]===s)return;this.flush(),o.enable(this.gl.SCISSOR_TEST),o.scissor(t+this.currentTransform.tx,n.height-s-e-this.currentTransform.ty,i,s),r[0]=t,r[1]=e,r[2]=i,r[3]=s}else o.disable(o.SCISSOR_TEST)}setMask(t,e=!1){let i=this.gl;this.flush(),0===this.maskLevel&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT)),this.maskLevel++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,this.maskLevel,1),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),this.fill(t),this.flush(),i.colorMask(!0,!0,!0,!0),!0===e?i.stencilFunc(i.EQUAL,this.maskLevel+1,1):i.stencilFunc(i.NOTEQUAL,this.maskLevel+1,1),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}clearMask(){this.maskLevel>0&&(this.flush(),this.maskLevel=0,this.gl.disable(this.gl.STENCIL_TEST))}}let Bu={offscreenCanvas:!1,willReadFrequently:!1,antiAlias:!1,context:"2d"};class Tu{constructor(t,e,i=Bu){i=Object.assign(Bu,i||{}),this.canvas=hh(t,e,i.offscreenCanvas),this.context=this.canvas.getContext(i.context,{willReadFrequently:i.willReadFrequently}),this.setAntiAlias(i.antiAlias)}onResetEvent(t,e){this.clear(),this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(t=!1){let e=this.canvas;ta("imageSmoothingEnabled",t,this.context),void 0!==e.style&&(!0!==t?(e.style["image-rendering"]="optimizeSpeed",e.style["image-rendering"]="-moz-crisp-edges",e.style["image-rendering"]="-o-crisp-edges",e.style["image-rendering"]="-webkit-optimize-contrast",e.style["image-rendering"]="optimize-contrast",e.style["image-rendering"]="crisp-edges",e.style["image-rendering"]="pixelated",e.style.msInterpolationMode="nearest-neighbor"):e.style["image-rendering"]="auto")}resize(t,e){this.canvas.width=Math.round(t),this.canvas.height=Math.round(e)}getImageData(t,e,i,s){return t=wn(Math.floor(t),0,this.canvas.width-1),e=wn(Math.floor(e),0,this.canvas.height-1),i=wn(i,1,this.canvas.width-t),s=wn(s,1,this.canvas.height-e),this.context.getImageData(t,e,i,s)}toBlob(t){return"function"==typeof this.canvas.convertToBlob?this.canvas.convertToBlob(t):new Promise((function(e){this.canvas.toBlob((t=>{e(t)}),t?t.type:void 0,t?t.quality:void 0)}))}toImageBitmap(t){return new Promise((e=>{if("function"==typeof this.canvas.transferToImageBitmap)e(this.canvas.transferToImageBitmap());else{let i=new Image;i.src=this.canvas.toDataURL(t),i.onload=()=>{createImageBitmap(i).then((t=>e(t)))}}}))}toDataURL(t){return new Promise((e=>{e(this.canvas.toDataURL(t))}))}invalidate(t){void 0!==t.gl&&(t.setCompositor("quad"),this.glTextureUnit=t.cache.getUnit(t.cache.get(this.canvas)),t.currentCompositor.unbindTexture2D(null,this.glTextureUnit))}destroy(){this.context=void 0,this.canvas=void 0}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}class Mu extends yl{constructor(t,e,i){super(0,0,1/0,1/0),this.color=Bn.pull("Color").parseCSS(e),this.onResetEvent(t,e,i)}onResetEvent(t,e,i=0){this.name=t,this.pos.z=i,this.floating=!0,this.color.parseCSS(e)}draw(t,e){t.save(),t.clipRect(0,0,e.width,e.height),t.clearColor(this.color),t.restore()}destroy(){Bn.push(this.color),this.color=void 0,super.destroy()}}class Iu extends Xc{constructor(t,e,i){super(t,e,i),this.floating=!0,this.offset.set(t,e),this.ratio=Bn.pull("Vector2d",1,1),void 0!==i.ratio&&(Er(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),void 0===i.anchorPoint?this.anchorPoint.set(0,0):"number"==typeof i.anchorPoint?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),this.repeat=i.repeat||"repeat",xr(fr,this.createPattern,this)}get repeat(){return this._repeat}set repeat(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(mm.viewport.width,mm.viewport.height),this.createPattern()}onActivateEvent(){xr(br,this.updateLayer,this),xr(dr,this.resize,this),vr(er,(()=>{this.updateLayer(mm.viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(mm.viewport.pos)}resize(t,e){return super.resize(this.repeatX?1/0:t,this.repeatY?1/0:e)}createPattern(){this._pattern=ah.createPattern(this.image,this._repeat)}updateLayer(t){const e=this.ratio.x,i=this.ratio.y;if(0===e&&0===i)return;const s=this.width,n=this.height,o=mm.viewport.bounds.width,r=mm.viewport.bounds.height,a=this.anchorPoint.x,h=this.anchorPoint.y,l=a*(e-1)*(o-mm.viewport.width)+this.offset.x-e*t.x,c=h*(i-1)*(r-mm.viewport.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=l%s:this.pos.x=l,this.repeatY?this.pos.y=c%n:this.pos.y=c,this.isDirty=!0}preDraw(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint),this.blendMode!==t.getBlendMode()&&t.setBlendMode(this.blendMode)}draw(t,e){const i=this.width,s=this.height,n=e.bounds.width,o=e.bounds.height,r=this.anchorPoint.x,a=this.anchorPoint.y;let h=this.pos.x,l=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(h+=r*(n-i),l+=a*(o-s)),t.translate(h,l),t.drawPattern(this._pattern,0,0,2*e.width,2*e.height)}onDeactivateEvent(){Ar(br,this.updateLayer),Ar(dr,this.resize)}destroy(){Bn.push(this.ratio),this.ratio=void 0,Ar(fr,this.createPattern),super.destroy()}}class Pu extends Xc{constructor(t,e,i){if(super(t,e,i),"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory");this.width=Math.floor(i.width),this.height=Math.floor(i.height),this.nss_width=this.width,this.nss_height=this.height,this.insetx=i.insetx,this.insety=i.insety}get width(){return super.width}set width(t){super.width=this.nss_width=t}get height(){return super.height}set height(t){super.height=this.nss_height=t}draw(t){let e=this.current,i=this.pos.x,s=this.pos.y,n=e.width,o=e.height,r=e.offset,a=this.offset;0!==e.angle&&(t.translate(-i,-s),t.rotate(e.angle),i-=o,n=e.height,o=e.width);let h=a.x+r.x,l=a.y+r.y,c=this.insetx||n/4,u=this.insety||o/4;t.drawImage(this.image,h,l,c,u,i,s,c,u),t.drawImage(this.image,h+n-c,l,c,u,i+this.nss_width-c,s,c,u),t.drawImage(this.image,h,l+o-u,c,u,i,s+this.nss_height-u,c,u),t.drawImage(this.image,h+n-c,l+o-u,c,u,i+this.nss_width-c,s+this.nss_height-u,c,u);let m=n-(c<<1),d=o-(u<<1),p=this.nss_width-(c<<1),_=this.nss_height-(u<<1);t.drawImage(this.image,h+c,l,m,u,i+c,s,p,u),t.drawImage(this.image,h+c,l+o-u,m,u,i+c,s+this.nss_height-u,p,u),t.drawImage(this.image,h,l+u,c,d,i,s+u,c,_),t.drawImage(this.image,h+n-c,l+u,c,d,i+this.nss_width-c,s+u,c,_),t.drawImage(this.image,h+c,l+u,m,d,i+c,s+u,p,_)}}function Eu(t,e){t.font=e.font,t.fillStyle=e.fillStyle.toRGBA(),t.strokeStyle=e.strokeStyle.toRGBA(),t.lineWidth=e.lineWidth,t.textAlign=e.textAlign,t.textBaseline=e.textBaseline}const Du=["ex","em","pt","px"],Ru=[12,24,.75,1];class Lu extends yl{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.fillStyle=Bn.pull("Color",0,0,0),this.strokeStyle=Bn.pull("Color",0,0,0),this.lineWidth=0,this.textAlign="left",this.textBaseline="top",this.lineHeight=1,this.wordWrapWidth=-1,this.fontSize=10,this._text=[],this.onResetEvent(t,e,i)}onResetEvent(t,e,i){void 0===this.fillStyle&&(this.fillStyle=Bn.pull("Color",0,0,0)),void 0===this.strokeStyle&&(this.strokeStyle=Bn.pull("Color",0,0,0)),void 0!==i.fillStyle&&(i.fillStyle instanceof kn?this.fillStyle.copy(i.fillStyle):this.fillStyle.parseCSS(i.fillStyle)),void 0!==i.strokeStyle&&(i.strokeStyle instanceof kn?this.strokeStyle.copy(i.strokeStyle):this.strokeStyle.parseCSS(i.strokeStyle)),this.lineWidth=i.lineWidth||0,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this.fontSize=10,void 0!==i.anchorPoint?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),void 0!==i.floating&&(this.floating=!!i.floating),this.setFont(i.font,i.size),!0===i.bold&&this.bold(),!0===i.italic&&this.italic(),this.canvasTexture=Bn.pull("CanvasTexture",2,2,{offscreenCanvas:!1}),this.metrics=new Gu(this),this.setText(i.text)}bold(){return this.font="bold "+this.font,this.isDirty=!0,this}italic(){return this.font="italic "+this.font,this.isDirty=!0,this}setFont(t,e=10){let i=t.split(",").map((t=>(t=t.trim(),/(^".*"$)|(^'.*'$)/.test(t)?t:'"'+t+'"')));if("number"==typeof e)this.fontSize=e,e+="px";else{let t=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(t[1]),t[2]?this.fontSize*=Ru[Du.indexOf(t[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this}setText(t=""){let e=this.getBounds();this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n")),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,this.canvasTexture.context)),e.addBounds(this.metrics.measureText(this._text,this.canvasTexture.context),!0);let i=Math.ceil(this.metrics.width),s=Math.ceil(this.metrics.height);return 1===ah.WebGLVersion&&(i=vn(this.metrics.width),s=vn(this.metrics.height)),this.canvasTexture.invalidate(ah),(this.canvasTexture.width<i||this.canvasTexture.height<s)&&this.canvasTexture.resize(i,s),this.canvasTexture.clear(),this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y),this.isDirty=!0,this}measureText(t,e=this._text){return this.metrics.measureText(e,this.canvasTexture.context)}draw(t,e,i=this.pos.x,s=this.pos.y){void 0===this.ancestor&&(this.pos.x===i&&this.pos.y===s||(this.pos.x=i,this.pos.y=s,this.isDirty=!0),this.setText(e),t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())),i=this.metrics.x,s=this.metrics.y,!1===t.settings.subPixel&&(i=~~i,s=~~s),t.drawImage(this.canvasTexture.canvas,i,s),void 0===this.ancestor&&t.restore()}drawStroke(t,e,i,s){this.draw(t,e,i,s)}_drawFont(t,e,i,s){Eu(t,this);for(let n=0;n<e.length;n++){const o=e[n].trimEnd();this.fillStyle.alpha>0&&t.fillText(o,i,s),this.lineWidth>0&&this.strokeStyle.alpha>0&&t.strokeText(o,i,s),s+=this.metrics.lineHeight()}return this.metrics}destroy(){void 0!==ah.gl&&(ah.setCompositor("quad"),ah.currentCompositor.deleteTexture2D(ah.currentCompositor.getTexture2D(this.glTextureUnit)),this.glTextureUnit=void 0),ah.cache.delete(this.canvasTexture.canvas),Bn.push(this.canvasTexture),this.canvasTexture=void 0,Bn.push(this.fillStyle),Bn.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this.metrics=void 0,this._text.length=0,super.destroy()}}class Gu extends Io{constructor(t){super(),this.ancestor=t,this.setMinMax(0,0,0,0)}lineHeight(){return this.ancestor instanceof Lu?this.ancestor.fontSize*this.ancestor.lineHeight:this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}lineWidth(t,e){if(this.ancestor instanceof Lu)return e.measureText(t).width;{let e=t.split("");const i=e.length;let s=0,n=null;for(let t=0;t<i;t++){let i=e[t].charCodeAt(0),o=this.ancestor.fontData.glyphs[i];if(void 0!==o){let t=n&&n.kerning?n.getKerning(i):0;s+=(o.xadvance+t)*this.ancestor.fontScale.x,n=o}}return s}}measureText(t,e){let i;i=Array.isArray(t)?t:(""+t).split("\n"),void 0!==e&&(e.save(),Eu(e,this.ancestor)),this.width=this.height=0;for(let t=0;t<i.length;t++)this.width=Math.max(this.lineWidth(i[t].trimEnd(),e),this.width),this.height+=this.lineHeight();return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this.x=Math.floor("right"===this.ancestor.textAlign?this.ancestor.pos.x-this.width:"center"===this.ancestor.textAlign?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x),this.y=Math.floor(0===this.ancestor.textBaseline.search(/^(top|hanging)$/)?this.ancestor.pos.y:"middle"===this.ancestor.textBaseline?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight()),void 0!==e&&e.restore(),this}wordWrap(t,e,i){let s,n="",o=[];Array.isArray(t)&&(t=t.join(" ")),s=t.replace(/[\r\n]+/g," ").split(" "),void 0!==i&&(i.save(),Eu(i,this.ancestor));for(let t=0;t<s.length;t++){let r=s[t];this.lineWidth(n+r+" ",i)<e?n+=r+" ":(o.push(n+"\n"),n=r+" ")}return o.push(n),void 0!==i&&i.restore(),o}}class ku extends yl{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this.wordWrapWidth=i.wordWrapWidth||-1,this._text=[],this.fontScale=Bn.pull("Vector2d",1,1),this.fontImage="object"==typeof i.font?i.font:Uc(i.font),"string"!=typeof i.fontData?this.fontData=Bn.pull("BitmapTextData",qc(i.font)):this.fontData=Bn.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:qc(i.fontData)),void 0!==i.floating&&(this.floating=!!i.floating),void 0!==i.fillStyle&&(this.fillStyle=i.fillStyle),void 0!==i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.metrics=new Gu(this),"number"==typeof i.size&&1!==i.size&&this.resize(i.size),this.setText(i.text)}set(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this}setText(t=""){return this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n"),this.isDirty=!0),this._text.length>0&&this.wordWrapWidth>0&&(this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)),this.updateBounds(),this}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),void 0!==this.metrics){let t,i;switch(e.addBounds(this.metrics.measureText(this._text)),this.textAlign){case"right":t=1*this.metrics.width;break;case"center":t=.5*this.metrics.width;break;default:t=0*this.metrics.width}switch(this.textBaseline){case"middle":i=.5*this.metrics.height;break;case"ideographic":case"alphabetic":case"bottom":i=1*this.metrics.height;break;default:i=0*this.metrics.height}e.translate(t,i)}return!0===t&&void 0!==this.ancestor&&"function"==typeof this.ancestor.getAbsolutePosition&&!0!==this.floating&&e.translate(this.ancestor.getAbsolutePosition()),e}get fillStyle(){return this.tint}set fillStyle(t){t instanceof kn?this.tint.copy(t):this.tint.parseCSS(t)}resize(t){return this.fontScale.set(t,t),this.updateBounds(),this.isDirty=!0,this}measureText(t=this._text){return this.metrics.measureText(t)}draw(t,e,i,s){let n=t.globalAlpha();void 0===this.ancestor?(this.setText(e),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,s=this.pos.y);let o=i,r=this.metrics.lineHeight(),a=0;for(let e=0;e<this._text.length;e++){i=o;const n=this._text[e].trimEnd();let h=this.metrics.lineWidth(n);switch(this.textAlign){case"right":i-=h;break;case"center":i-=.5*h}switch(this.textBaseline){case"middle":s-=.5*r;break;case"ideographic":case"alphabetic":case"bottom":s-=r}!0===this.isDirty&&void 0===this.ancestor&&(0===e&&(this.pos.y=s),a<h&&(a=h,this.pos.x=i));let l=null;for(let e=0,o=n.length;e<o;e++){let o=n.charCodeAt(e),r=this.fontData.glyphs[o];if(void 0!==r){let e=r.width,n=r.height,a=l&&l.kerning?l.getKerning(o):0,h=this.fontScale.x,c=this.fontScale.y;0!==e&&0!==n&&t.drawImage(this.fontImage,r.x,r.y,e,n,i+r.xoffset*h,s+r.yoffset*c,e*h,n*c),i+=(r.xadvance+a)*h,l=r}else console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(o))}s+=r}void 0===this.ancestor&&t.setGlobalAlpha(n),this.isDirty=!1}destroy(){Bn.push(this.fontScale),this.fontScale=void 0,Bn.push(this.fontData),this.fontData=void 0,this._text.length=0,this.metrics=void 0,super.destroy()}}class Fu extends Xc{constructor(t,e,i){super(t,e,i),this.name=i.name,this.type=i.type,this.id=i.id;let s=i.shapes;void 0===s&&(s=Bn.pull("Polygon",0,0,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height)])),this.body=new uu(this,s),this.body.collisionType=Po.types.COLLECTABLE_OBJECT,this.body.setCollisionMask(Po.types.PLAYER_OBJECT),this.body.setStatic(!0),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}class Ou extends yl{constructor(t,e,i){super(t,e,i.width||0,i.height||0),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach((t=>{void 0!==i[t]&&(this.triggerSettings[t]=i[t])}));let s=i.shapes;void 0===s&&(s=Bn.pull("Polygon",0,0,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height)])),this.body=new uu(this,s),this.body.collisionType=Po.types.ACTION_OBJECT,this.body.setCollisionMask(Po.types.PLAYER_OBJECT),this.body.setStatic(!0),this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){let t=this.ancestor.getRootAncestor();return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=t.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings}onFadeComplete(){let t=this.ancestor.getRootAncestor();Vc.load(this.gotolevel,this.getTriggerSettings()),t.app.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){let t=this.getTriggerSettings(),e=this.ancestor.getRootAncestor();if("level"!==t.event)throw new Error("Trigger invalid type");this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,e.app.viewport.fadeIn(this.fade,this.duration,(()=>this.onFadeComplete()))):Vc.load(this.gotolevel,t)}onCollision(t,e){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}class zu extends yl{constructor(t,e,i,s=i,n="#FFF",o=.7){super(t,e,2*i,2*s),this.color=Bn.pull("Color").parseCSS(n),this.radiusX=i,this.radiusY=s,this.intensity=o,this.blendMode="lighter",this.visibleArea=Bn.pull("Ellipse",this.centerX,this.centerY,this.width,this.height),this.texture=Bn.pull("CanvasTexture",this.width,this.height,{offscreenCanvas:!1}),this.anchorPoint.set(0,0),function(t){let e,i,s,n,o,r=t.texture.context,a=t.texture.width/2,h=t.texture.height/2,l=t.radiusX,c=t.radiusY;t.texture.clear(),l>=c?(e=1,s=1,i=c/l,n=l/c,o=r.createRadialGradient(a,h*n,0,a,c*n,l)):(i=1,n=1,e=l/c,s=c/l,o=r.createRadialGradient(a*s,h,0,a*s,h,c)),o.addColorStop(0,t.color.toRGBA(t.intensity)),o.addColorStop(1,t.color.toRGBA(0)),r.fillStyle=o,r.setTransform(e,0,0,i,0,0),r.fillRect(0,0,t.texture.width*s,t.texture.height*n)}(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}draw(t,e){t.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){Bn.push(this.color),this.color=void 0,Bn.push(this.texture),this.texture=void 0,Bn.push(this.visibleArea),this.visibleArea=void 0,super.destroy()}}class ju{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){let e=this.kerning[t>>>9];if(e)return e[511&t]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});let i=this.kerning[t>>>9];void 0===i&&(this.kerning[t>>>9]={},i=this.kerning[t>>>9]),i[511&t]=e}}const Nu=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function qu(t,e){let i=t.match(e);if(!i)throw new Error("Could not find pattern "+e+" in string: "+t);return i[0].split("=")[1]}class Uu{constructor(t){this.onResetEvent(t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");let e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");let s=i[0].split("=")[1].split(",");this.padTop=parseFloat(s[0]),this.padLeft=parseFloat(s[1]),this.padBottom=parseFloat(s[2]),this.padRight=parseFloat(s[3]),this.lineHeight=parseFloat(qu(e[1],/lineHeight\=\d+/g));let n=parseFloat(qu(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,r=null;for(let t=4;t<e.length;t++){let i=e[t],s=i.split(/=|\s+/);if(i&&!/^kernings/.test(i))if(/^kerning\s/.test(i)){let t=parseFloat(s[2]),e=parseFloat(s[4]),i=parseFloat(s[6]);r=this.glyphs[t],null!=r&&r.setKerning(e,i)}else{r=new ju;let t=parseFloat(s[2]);r.id=t,r.x=parseFloat(s[4]),r.y=parseFloat(s[6]),r.width=parseFloat(s[8]),r.height=parseFloat(s[10]),r.xoffset=parseFloat(s[12]),r.yoffset=parseFloat(s[14]),r.xadvance=parseFloat(s[16]),r.width>0&&r.height>0&&(this.descent=Math.min(n+r.yoffset,this.descent)),this.glyphs[t]=r}}this.descent+=this.padBottom,function(t){let e=" ".charCodeAt(0),i=t[e];i||(i=new ju,i.id=e,i.xadvance=function(t){let e=Object.keys(t);for(let i=0;i<e.length;i++)if(e[i]>32)return t[e[i]];return null}(t).xadvance,t[e]=i)}(this.glyphs);let a=null;for(let t=0;t<Nu.length;t++){let e=Nu[t];if(a=this.glyphs[e.charCodeAt(0)],a)break}if(a)this.capHeight=a.height;else for(let t in this.glyphs)if(this.glyphs.hasOwnProperty(t)){if(r=this.glyphs[t],0===r.height||0===r.width)continue;this.capHeight=Math.max(this.capHeight,r.height)}this.capHeight-=o}}const Ju=-1,Xu=0,Hu=1;let Wu=[];for(let t=0;t<10;t++)Wu.push(new Fn);let Yu=[];for(let t=0;t<5;t++)Yu.push([]);function Zu(t,e,i){let s=Number.MAX_VALUE,n=-Number.MAX_VALUE,o=t.length;for(let i=0;i<o;i++){const o=t[i].dot(e);o<s&&(s=o),o>n&&(n=o)}i[0]=s,i[1]=n}function Ku(t,e,i,s,n,o){let r=Yu.pop(),a=Yu.pop(),h=Wu.pop().copy(e).sub(t),l=h.dot(n);if(Zu(i,n,r),Zu(s,n,a),a[0]+=l,a[1]+=l,r[0]>a[1]||a[0]>r[1])return Wu.push(h),Yu.push(r),Yu.push(a),!0;if(o){let t=0;if(r[0]<a[0])if(o.aInB=!1,r[1]<a[1])t=r[1]-a[0],o.bInA=!1;else{let e=r[1]-a[0],i=a[1]-r[0];t=e<i?e:-i}else if(o.bInA=!1,r[1]>a[1])t=r[0]-a[1],o.aInB=!1;else{let e=r[1]-a[0],i=a[1]-r[0];t=e<i?e:-i}let e=Math.abs(t);e<o.overlap&&(o.overlap=e,o.overlapN.copy(n),t<0&&o.overlapN.negateSelf())}return Wu.push(h),Yu.push(r),Yu.push(a),!1}function Qu(t,e){let i=t.length2(),s=e.dot(t);return s<0?Ju:s>i?Hu:Xu}function $u(t,e,i,s,n){let o=Wu.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),r=s.radius,a=r*r,h=e.points,l=e.edges,c=l.length,u=Wu.pop(),m=Wu.pop(),d=Wu.pop(),p=0;for(let t=0;t<c;t++){const i=t===c-1?0:t+1,s=0===t?c-1:t-1;let _=0,b=null;u.copy(l[t]),d.copy(o).sub(h[t]),n&&d.length2()>a&&(n.aInB=!1);let y=Qu(u,d),f=!0;if(y===Ju){let t=null;if(c>1&&(u.copy(l[s]),t=Wu.pop().copy(o).sub(h[s]),y=Qu(u,t),y!==Hu&&(f=!1)),f){if(p=d.length(),p>r)return Wu.push(o),Wu.push(u),Wu.push(m),Wu.push(d),t&&Wu.push(t),!1;n&&(n.bInA=!1,b=d.normalize(),_=r-p)}t&&Wu.push(t)}else if(y===Hu){if(c>1&&(u.copy(l[i]),d.copy(o).sub(h[i]),y=Qu(u,d),y!==Ju&&(f=!1)),f){if(p=d.length(),p>r)return Wu.push(o),Wu.push(u),Wu.push(m),Wu.push(d),!1;n&&(n.bInA=!1,b=d.normalize(),_=r-p)}}else{m.copy(e.normals[t]),p=d.dot(m);let i=Math.abs(p);if((1===c||p>0)&&i>r)return Wu.push(o),Wu.push(u),Wu.push(m),Wu.push(d),!1;n&&(b=m,_=r-p,(p>=0||_<2*r)&&(n.bInA=!1))}b&&n&&Math.abs(_)<Math.abs(n.overlap)&&(n.overlap=_,n.overlapN.copy(b))}return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),Wu.push(o),Wu.push(u),Wu.push(m),Wu.push(d),!0}var tm={__proto__:null,testEllipseEllipse:function(t,e,i,s,n){let o=Wu.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),r=e.radius,a=s.radius,h=r+a,l=h*h,c=o.length2();if(c>l)return Wu.push(o),!1;if(n){let e=Math.sqrt(c);n.a=t,n.b=i,n.overlap=h-e,n.overlapN.copy(o.normalize()),n.overlapV.copy(o).scale(n.overlap),n.aInB=r<=a&&e<=a-r,n.bInA=a<=r&&e<=r-a}return Wu.push(o),!0},testEllipsePolygon:function(t,e,i,s,n){let o=$u(i,s,t,e,n);if(o&&n){let t=n.a,e=n.aInB;n.overlapN.negateSelf(),n.overlapV.negateSelf(),n.a=n.b,n.b=t,n.aInB=n.bInA,n.bInA=e}return o},testPolygonEllipse:$u,testPolygonPolygon:function(t,e,i,s,n){let o=e.points,r=e.normals,a=r.length,h=s.points,l=s.normals,c=l.length,u=Wu.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(e.pos),m=Wu.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(s.pos);for(let t=0;t<a;t++)if(Ku(u,m,o,h,r[t],n))return Wu.push(u),Wu.push(m),!1;for(let t=0;t<c;t++)if(Ku(u,m,o,h,l[t],n))return Wu.push(u),Wu.push(m),!1;return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),Wu.push(u),Wu.push(m),!0}};class em{constructor(){this.a=null,this.b=null,this.overlapN=new Fn,this.overlapV=new Fn,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}let im={pos:new Fn(0,0),ancestor:{_absPos:new Fn(0,0),getAbsolutePosition:function(){return this._absPos}}},sm=new Io,nm=new Io;class om{constructor(t){this.world=t,this.response=new em}shouldCollide(t,e){let i=t.body,s=e.body;return"object"==typeof i&&"object"==typeof s&&t!==e&&!0!==t.isKinematic&&!0!==e.isKinematic&&i.shapes.length>0&&s.shapes.length>0&&!(!0===i.isStatic&&!0===s.isStatic)&&0!=(i.collisionMask&s.collisionType)&&0!=(i.collisionType&s.collisionMask)}collides(t,e,i=this.response){for(let s,n=t.shapes.length;n--,s=t.shapes[n];)for(let o,r=e.shapes.length;r--,o=e.shapes[r];)if(!0===tm["test"+s.shapeType+o.shapeType].call(this,t.ancestor,s,e.ancestor,o,i.clear()))return i.indexShapeA=n,i.indexShapeB=r,!0;return!1}collisions(t){let e=0,i=this.world.broadphase.retrieve(t);return sm.addBounds(t.getBounds(),!0),sm.addBounds(t.body.getBounds()),i.forEach((i=>{this.shouldCollide(t,i)&&(nm.addBounds(i.getBounds(),!0),nm.addBounds(i.body.getBounds()),sm.overlaps(nm)&&this.collides(t.body,i.body)&&(e++,t.onCollision&&!1!==t.onCollision(this.response,i)&&!1===t.body.isStatic&&t.body.respondToCollision.call(t.body,this.response),i.onCollision&&!1!==i.onCollision(this.response,t)&&!1===i.body.isStatic&&i.body.respondToCollision.call(i.body,this.response)))})),e>0}rayCast(t,e=[]){let i=0,s=this.world.broadphase.retrieve(t);for(let n,o=s.length;o--,n=s[o];)if(n.body&&t.getBounds().overlaps(n.getBounds())){const s=n.body.shapes.length;if(0===n.body.shapes.length)continue;let o=t,r=0;do{let t=n.body.getShape(r);tm["test"+o.shapeType+t.shapeType].call(this,im,o,n,t)&&(e[i]=n,i++),r++}while(r<s)}return e.length=i,e}}class rm extends cc{constructor(t=0,e=0,i=1/0,s=1/0){super(t,e,i,s,!0),this.name="rootContainer",this.anchorPoint.set(0,0),this.app=void 0,this.physic="builtin",this.fps=60,this.gravity=new Fn(0,.98),this.preRender=!1,this.bodies=new Set,this.broadphase=new Mo(this,this.getBounds().clone(),Po.maxChildren,Po.maxDepth),this.detector=new om(this),xr(Yo,this.reset,this),xr(er,(()=>{this.broadphase.clear(this.getBounds())}))}reset(){this.broadphase.clear(),this.anchorPoint.set(0,0),super.reset(),this.bodies.clear()}addBody(t){return"builtin"===this.physic&&this.bodies.add(t),this}removeBody(t){return"builtin"===this.physic&&this.bodies.delete(t),this}bodyApplyGravity(t){if(!t.ignoreGravity&&0!==t.gravityScale){let e=this.gravity;t.force.x+=t.mass*e.x*t.gravityScale,t.force.y+=t.mass*e.y*t.gravityScale}}update(t){let e=hu.isPaused();return this.broadphase.clear(),this.broadphase.insertContainer(this),"builtin"===this.physic&&this.bodies.forEach((i=>{if(!i.isStatic){let s=i.ancestor;e&&!s.updateWhenPaused||!s.inViewport&&!s.alwaysUpdate||(this.bodyApplyGravity(i),!0===i.update(t)&&(s.isDirty=!0),this.detector.collisions(s),i.force.set(0,0))}})),super.update(t)}}Math.PI;class am extends yl{constructor(t){super(t.getRandomPointX(),t.getRandomPointY(),t.settings.image.width,t.settings.image.height),this.onResetEvent(t,!0)}onResetEvent(t,e=!1){!1===e?(this.pos.set(t.getRandomPointX(),t.getRandomPointY()),this.resize(t.settings.image.width,t.settings.image.height),this.currentTransform.identity()):this.vel=Bn.pull("Vector2d"),this.image=t.settings.image,this.alwaysUpdate=!0,"string"==typeof t.settings.tint&&this.tint.parseCSS(t.settings.tint),!0===t.settings.textureAdditive&&(this.blendMode="additive"),"normal"!==t.settings.blendMode&&(this.blendMode=t.settings.blendMode);let i=t.settings.angle+(t.settings.angleVariation>0?(Cn(0,2)-1)*t.settings.angleVariation:0),s=t.settings.speed+(t.settings.speedVariation>0?(Cn(0,2)-1)*t.settings.speedVariation:0);this.vel.set(s*Math.cos(i),-s*Math.sin(i)),this.life=Cn(t.settings.minLife,t.settings.maxLife),this.startLife=this.life,this.startScale=wn(Cn(t.settings.minStartScale,t.settings.maxStartScale),t.settings.minStartScale,t.settings.maxStartScale),this.endScale=wn(Cn(t.settings.minEndScale,t.settings.maxEndScale),t.settings.minEndScale,t.settings.maxEndScale),this.gravity=t.settings.gravity,this.wind=t.settings.wind,this.followTrajectory=t.settings.followTrajectory,this.onlyInViewport=t.settings.onlyInViewport,this._deltaInv=cu.maxfps/1e3,t.settings.followTrajectory||(this.angle=Cn(t.settings.minRotation,t.settings.maxRotation))}update(t){let e=t*this._deltaInv;if(this.life=this.life>t?this.life-t:0,this.life<=0)return this.ancestor.removeChild(this),!1;let i=this.life/this.startLife,s=this.startScale;this.startScale>this.endScale?(s*=i,s=s<this.endScale?this.endScale:s):this.startScale<this.endScale&&(s/=i,s=s>this.endScale?this.endScale:s),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;let n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(s,0,0,0,s,0,this.pos.x,this.pos.y,1).rotate(n),this.isDirty=this.inViewport||!this.onlyInViewport,super.update(t)}draw(t){let e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}class hm extends yl{constructor(t,e,i){if("number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");super(t,e,i.width,i.height),this.children=[],i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new Xc(0,0,i)),i.anchorPoint?this.anchorPoint.setMuted(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.setMuted(0,0),"string"==typeof i.name&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,void 0===i.shapes&&(i.shapes=Bn.pull("Polygon",0,0,[Bn.pull("Vector2d",0,0),Bn.pull("Vector2d",this.width,0),Bn.pull("Vector2d",this.width,this.height),Bn.pull("Vector2d",0,this.height)])),this.body=new uu(this,i.shapes,(()=>this.onBodyUpdate())),0===this.width&&0===this.height&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1}get renderable(){return this.children[0]}set renderable(t){if(!(t instanceof yl))throw new Error(t+"should extend me.Renderable");this.children[0]=t,this.children[0].ancestor=this,this.updateBounds()}update(t){return this.renderable&&(this.isDirty|=this.renderable.update(t)),super.update(t)}updateBounds(t=!0){let e=this.getBounds();if(e.clear(),e.addFrame(0,0,this.width,this.height),this.children&&this.children.length>0&&e.addBounds(this.children[0].getBounds()),this.body&&e.addBounds(this.body.getBounds()),!0===t){let t=this.getAbsolutePosition();e.centerOn(t.x+e.x+e.width/2,t.y+e.y+e.height/2)}return e}onBodyUpdate(){this.updateBounds()}preDraw(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof yl&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}draw(t,e){let i=this.renderable;i instanceof yl&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))}destroy(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),super.destroy(arguments)}onDeactivateEvent(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()}}function lm(t){let e,i=t.renderer,s=i.settings,n=s.scale,o=s.scale;if(s.autoScale){let r=1/0,a=1/0;if(globalThis.getComputedStyle){let t=globalThis.getComputedStyle(i.getCanvas(),null);r=parseInt(t.maxWidth,10)||1/0,a=parseInt(t.maxHeight,10)||1/0}e=void 0!==t.settings.scaleTarget?ih(t.settings.scaleTarget):sh(t.getParentElement());let h=Math.min(r,e.width),l=Math.min(a,e.height),c=h/l;if("fill-min"===s.scaleMethod&&c>i.designRatio||"fill-max"===s.scaleMethod&&c<i.designRatio||"flex-width"===s.scaleMethod){let t=Math.min(r,s.height*c);n=o=h/t,i.resize(Math.floor(t),s.height)}else if("fill-min"===s.scaleMethod&&c<i.designRatio||"fill-max"===s.scaleMethod&&c>i.designRatio||"flex-height"===s.scaleMethod){let t=Math.min(a,s.width*(l/h));n=o=l/t,i.resize(s.width,Math.floor(t))}else"flex"===s.scaleMethod?i.resize(Math.floor(h),Math.floor(l)):"stretch"===s.scaleMethod?(n=h/s.width,o=l/s.height):n=o=c<i.designRatio?h/s.width:l/s.height}!function(t,e,i){let s=t.renderer,n=s.getCanvas(),o=s.getContext(),r=s.settings,a=Na,h=r.zoomX=n.width*e*a,l=r.zoomY=n.height*i*a;s.scaleRatio.set(e*a,i*a),n.style.width=h/a+"px",n.style.height=l/a+"px",s.setAntiAlias(o,r.antiAlias),s.setBlendMode(r.blendMode,o),t.repaint()}(t,n,o)}const cm={parent:void 0,renderer:2,autoScale:!1,scale:1,scaleMethod:"manual",scaleTarget:void 0,transparent:!1,premultipliedAlpha:!0,blendMode:"normal",physic:"builtin",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0,legacy:!1};Object.defineProperty(Kl.prototype,"Texture",{get:function(){return fc("me.video.renderer.Texture","me.TextureAtlas","10.4.0"),$l}}),Kl.prototype.getScreenCanvas=function(){return fc("getScreenCanvas","getCanvas","13.1.0"),this.getCanvas()},Kl.prototype.getScreenContext=function(){return fc("getScreenContext","getContext","13.1.0"),this.getContext()};let um=!1;const mm=new class{constructor(t,e,i){this.parentElement=void 0,this.renderer=void 0,this.viewport=void 0,this.world=void 0,this.mergeGroup=!0,this.lastUpdate=0,this.isInitialized=!1,this.settings=void 0,this.pauseOnBlur=!0,this.resumeOnFocus=!0,this.stopOnBlur=!1,this.isDirty=!0,this.isAlwaysDirty=!1,this.frameCounter=0,this.frameRate=1,this.accumulator=0,this.accumulatorMax=0,this.accumulatorUpdateDelta=0,this.stepSize=1e3/60,this.updateDelta=0,this.lastUpdateStart=null,this.updateAverageDelta=0,!0!==i.legacy&&this.init(t,e,i)}init(t,e,i){this.settings=Object.assign(cm,i||{}),this.settings.width=t,this.settings.height=e,this.settings.transparent=!!this.settings.transparent,this.settings.antiAlias=!!this.settings.antiAlias,this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat,this.settings.depthTest="z-buffer"===this.settings.depthTest?"z-buffer":"sorting",this.settings.subPixel=!!this.settings.subPixel,this.settings.verbose=!!this.settings.verbose,-1!==this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?this.settings.autoScale="auto"===this.settings.scale||!0:(this.settings.scaleMethod="fit",this.settings.autoScale="auto"===this.settings.scale||!1);let s=kl();if(!0===s.webgl||!0===s.webgl1||!0===s.webgl2?(this.settings.renderer=1,!0===s.webgl1&&(this.settings.preferWebGL1=!0)):!0===s.canvas&&(this.settings.renderer=0),this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1,this.settings.zoomX=t*this.settings.scale,this.settings.zoomY=e*this.settings.scale,this.parentElement=eh(this.settings.parent),void 0!==this.settings.scaleTarget&&(this.settings.scaleTarget=eh(this.settings.scaleTarget)),"number"==typeof this.settings.renderer)switch(this.settings.renderer){case 2:case 1:this.renderer=function(t){try{if(nh(t))return new Vu(t)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new nc(t)}(this.settings);break;default:this.renderer=new nc(this.settings)}else{let t=this.settings.renderer;this.renderer=new t(this.settings)}xr(ur,(()=>lm(this)),this),xr(pr,(()=>lm(this)),this),this.parentElement.appendChild(this.renderer.getCanvas()),Sa.isMobile&&Ka(!1),lm(this),"MutationObserver"in globalThis&&new MutationObserver((()=>lm(this))).observe(this.parentElement,{attributes:!1,childList:!0,subtree:!0}),!1!==this.settings.consoleHeader&&function(t){let e=t.renderer.type,i="string"==typeof t.renderer.GPURenderer?" ("+t.renderer.GPURenderer+")":"",s=e.includes("WebGL")&&"z-buffer"===t.renderer.depthTest?"Depth Test | ":"",n=La?"Web Audio":"HTML5 Audio";console.log(e+" renderer"+i+" | "+s+n+" | pixel ratio "+Na+" | "+(Sa.nodeJS?"node.js":Sa.isMobile?"mobile":"desktop")+" | "+$a()+" | "+ja),console.log("resolution: requested "+t.settings.width+"x"+t.settings.height+", got "+t.renderer.getWidth()+"x"+t.renderer.getHeight())}(this),this.world=new rm(0,0,this.settings.width,this.settings.height),this.world.app=this,this.world.physic=this.settings.physic,this.lastUpdate=globalThis.performance.now(),this.world.autoSort=!("WEBGL"===this.renderer.type&&"z-buffer"===this.settings.depthTest),this.isInitialized=!0,gr(Wo,this),xr(Jo,this.repaint,this),xr(Uo,this.repaint,this),xr(No,this.repaint,this),xr(Xo,this.reset,this),xr(Fo,(t=>{this.update(t),this.draw()}),this),xr(Oo,(()=>{!0===this.stopOnBlur&&hu.stop(!0),!0===this.pauseOnBlur&&hu.pause(!0)})),xr(zo,(()=>{!0===this.stopOnBlur&&hu.restart(!0),!0===this.resumeOnFocus&&hu.resume(!0)}))}reset(){let t=hu.get();void 0!==t&&(this.viewport=t.cameras.get("default")),gr(Yo),this.updateFrameRate()}get sortOn(){return this.world.sortOn}set sortOn(t){this.world.sortOn=t}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0,this.frameRate=~~(.5+60/cu.maxfps),this.stepSize=1e3/this.world.fps,this.accumulator=0,this.accumulatorMax=10*this.stepSize,this.isAlwaysDirty=cu.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=!0}update(t){if(++this.frameCounter%this.frameRate==0){for(this.frameCounter=0,gr(Zo,t),this.accumulator+=cu.getDelta(),this.accumulator=Math.min(this.accumulator,this.accumulatorMax),this.updateDelta=cu.interpolation?cu.getDelta():this.stepSize,this.accumulatorUpdateDelta=cu.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);this.accumulator>=this.accumulatorUpdateDelta||cu.interpolation;)if(this.lastUpdateStart=globalThis.performance.now(),!0!==hu.isPaused()&&gr(Qo,t),this.isDirty=this.world.update(this.updateDelta),this.isDirty=hu.current().update(this.updateDelta)||this.isDirty,this.lastUpdate=globalThis.performance.now(),this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart,this.accumulator-=this.accumulatorUpdateDelta,cu.interpolation){this.accumulator=0;break}gr(Ko,this.lastUpdate)}}draw(){!0===this.renderer.isContextValid&&(this.isDirty||this.isAlwaysDirty)&&(gr($o,globalThis.performance.now()),this.renderer.clear(),hu.current().draw(this.renderer,this.world),this.isDirty=!1,this.renderer.flush(),gr(tr,globalThis.performance.now()))}}(0,0,{legacy:!0});Za((()=>{!0!==um&&(console.log("melonJS 2 (v15.8.0) | http://melonjs.org"),Bn.register("me.Entity",hm),Bn.register("me.Collectable",Fu),Bn.register("me.Trigger",Ou),Bn.register("me.Light2d",zu),Bn.register("me.Tween",pu,!0),Bn.register("me.Color",kn,!0),Bn.register("me.Particle",am,!0),Bn.register("me.Sprite",Xc),Bn.register("me.NineSliceSprite",Pu),Bn.register("me.Renderable",yl),Bn.register("me.Text",Lu,!0),Bn.register("me.BitmapText",ku),Bn.register("me.BitmapTextData",Uu,!0),Bn.register("me.ImageLayer",Iu),Bn.register("me.ColorLayer",Mu,!0),Bn.register("me.Vector2d",Fn,!0),Bn.register("me.Vector3d",On,!0),Bn.register("me.ObservableVector2d",zn,!0),Bn.register("me.ObservableVector3d",jn,!0),Bn.register("me.Matrix2d",Nn,!0),Bn.register("me.Matrix3d",qn,!0),Bn.register("me.Rect",wo,!0),Bn.register("me.RoundRect",So,!0),Bn.register("me.Polygon",go,!0),Bn.register("me.Line",xo,!0),Bn.register("me.Point",Ao,!0),Bn.register("me.Ellipse",vo,!0),Bn.register("me.Bounds",Io,!0),Bn.register("Entity",hm),Bn.register("Collectable",Fu),Bn.register("Trigger",Ou),Bn.register("Light2d",zu),Bn.register("Tween",pu,!0),Bn.register("Color",kn,!0),Bn.register("Particle",am,!0),Bn.register("Sprite",Xc),Bn.register("NineSliceSprite",Pu),Bn.register("Renderable",yl),Bn.register("Text",Lu,!0),Bn.register("BitmapText",ku),Bn.register("BitmapTextData",Uu,!0),Bn.register("ImageLayer",Iu),Bn.register("ColorLayer",Mu,!0),Bn.register("Vector2d",Fn,!0),Bn.register("Vector3d",On,!0),Bn.register("ObservableVector2d",zn,!0),Bn.register("ObservableVector3d",jn,!0),Bn.register("Matrix2d",Nn,!0),Bn.register("Matrix3d",qn,!0),Bn.register("Rect",wo,!0),Bn.register("RoundRect",So,!0),Bn.register("Polygon",go,!0),Bn.register("Line",xo,!0),Bn.register("Point",Ao,!0),Bn.register("Ellipse",vo,!0),Bn.register("Bounds",Io,!0),Bn.register("CanvasTexture",Tu,!0),gr(ko),Ir(kl().nocache||!1),xh(),um=!0)}));var dm={texture:null},pm=(i(7834),i(2511));let _m=null;function bm(t,e){const i=new pm.b2PolygonShape;return i.SetAsBox(t/2,e/2),i}var ym=class extends Sl{onResetEvent(){Vc.load("simple-level"),this.title=new ku(160,32,{font:"SuperPlumberBrothers",size:1,textAlign:"center",textBaseline:"top",text:["Mario 2D Jumps","a Box2D/melonJS demo","visit us at melonjs.org"],fillStyle:"#D3D3D3"}),mm.world.addChild(this.title)}onDestroyEvent(){}},fm=class extends yl{constructor(t,e,i){const s=i.width,n=i.height;super(t,e,s,n),this.anchorPoint.set(0,0),this.colliderBody=function(t,e,i){const s=_m.CreateBody({type:pm.b2BodyType.b2_staticBody,position:{x:t,y:e}});return s.SetUserData(i),s}(this.pos.x+s/2,this.pos.y+n/2,i.name),this.fixture=this.colliderBody.CreateFixture({shape:bm(s,n),density:0}),this.fixture.SetFriction(1),this.fixture.SetRestitution(0)}};const gm="idle";var xm=class extends yl{constructor(t,e){super(t,e,16,16),this.anchorPoint.set(0,0),this.sprite=dm.texture.createAnimationFromName(["mario_idle.png","mario_run_0.png","mario_run_1.png","mario_run_2.png","mario_jump.png","simple_level.png"]),this.sprite.addAnimation("idle",[{name:"mario_idle.png"}]),this.sprite.addAnimation("run",[{name:"mario_run_0.png",delay:125},{name:"mario_run_1.png",delay:125},{name:"mario_run_2.png",delay:125}]),this.sprite.addAnimation("jump",[{name:"mario_jump.png"}]),this.sprite.setCurrentAnimation("idle"),this.sprite.anchorPoint.set(0,0),this.currentDir=1,this.currentPlayerState=gm,this.touchLeft=!1,this.touchRight=!1,this.touchBottom=!1,this.playerBody=function(t,e,i){const s=_m.CreateBody({type:pm.b2BodyType.b2_dynamicBody,position:{x:t,y:e},bullet:!0});return s.SetUserData("player"),s}(this.pos.x+this.sprite.width/2,this.pos.y+this.sprite.height/2),this.playerBody.SetLinearDamping(1),this.playerFixture=this.playerBody.CreateFixture({shape:(7,new pm.b2CircleShape(7)),density:.1}),this.playerFixture.SetRestitution(0),function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};pm.b2ContactListener.BeginContact=t,pm.b2ContactListener.EndContact=e,pm.b2ContactListener.PreSolve=i,pm.b2ContactListener.PostSolve=s,_m.SetContactListener(pm.b2ContactListener)}(this.beginContact.bind(this),this.endContact.bind(this))}update(t){const e=this.playerBody.GetLinearVelocity();return bl.isKeyPressed("left")&&!this.touchLeft?(e.x=-1,this.currentDir=-1,this.currentPlayerState="run"):bl.isKeyPressed("right")&&!this.touchRight&&(e.x=1,this.currentDir=1,this.currentPlayerState="run"),bl.isKeyPressed("jump")&&(e.y=-50,this.currentPlayerState="jump"),0===e.x&&0===e.x&&(this.currentPlayerState=gm),this.playerBody.SetLinearVelocity(e),this.sprite.setCurrentAnimation(this.currentPlayerState),this.sprite.update(t)||0!==e.x||0!==e.y}draw(t){this.pos.set(this.playerBody.GetPosition().x-this.sprite.width/2,this.playerBody.GetPosition().y-this.sprite.height/2),t.save(),t.translate(this.pos.x,this.pos.y),this.sprite.anchorPoint.set(0,0),this.sprite.preDraw(t),this.sprite.flipX(-1===this.currentDir),this.sprite.draw(t),this.sprite.postDraw(t),t.restore()}beginContact(t){if("ground"!==t.GetFixtureA().GetBody().GetUserData()){const t=this.playerBody.GetLinearVelocity();t.x<0?(this.touchLeft=!0,t.x=0):t.x>0&&(this.touchRight=!0,t.x=0),this.playerBody.SetLinearVelocity(t)}}endContact=t=>{"ground"!==t.GetFixtureA().GetBody().GetUserData()&&(this.touchLeft=!1,this.touchRight=!1)}},vm=[{name:"simple-level",type:"tmx",src:"data/map/simple_level.json"},{name:"simple_level_tileset",type:"tsx",src:"data/map/simple_level_tileset.tsj"},{name:"simple_level",type:"image",src:"data/map/simple_level.png"},{name:"texture",type:"json",src:"data/img/texture.json"},{name:"texture",type:"image",src:"data/img/texture.png"},{name:"SuperPlumberBrothers",type:"image",src:"data/fnt/SuperPlumberBrothers.png"},{name:"SuperPlumberBrothers",type:"binary",src:"data/fnt/SuperPlumberBrothers.fnt"}],Am=i(3379),wm=i.n(Am),Sm=i(7795),Cm=i.n(Sm),Vm=i(569),Bm=i.n(Vm),Tm=i(3565),Mm=i.n(Tm),Im=i(9216),Pm=i.n(Im),Em=i(4589),Dm=i.n(Em),Rm=i(1424),Lm={};Lm.styleTagTransform=Dm(),Lm.setAttributes=Mm(),Lm.insert=Bm().bind(null,"head"),Lm.domAPI=Cm(),Lm.insertStyleElement=Pm(),wm()(Rm.Z,Lm),Rm.Z&&Rm.Z.locals&&Rm.Z.locals,rh.onReady((()=>{ch.init(320,240,{parent:"screen",scale:"auto",renderer:ch.AUTO})?(Hr("mp3,ogg"),mm.world.physic="none",_m=new pm.b2World(new pm.b2Vec2(0,10)),Sr.on(Sr.GAME_AFTER_UPDATE,(t=>{_m.GetBodyCount()>0&&_m.Step(t/1e3,{velocityIterations:3,positionIterations:2})})),Jc.crossOrigin="anonymous",Jc.preload(vm,(function(){hu.set(hu.PLAY,new ym),Bn.register("player",xm),Bn.register("ground",fm),Bn.register("pipe",fm),Bn.register("bricks",fm),Bn.register("side2",fm),Bn.register("side1",fm),Bn.register("side0",fm),dm.texture=new $l(Jc.getJSON("texture"),Jc.getImage("texture")),bl.bindKey(bl.KEY.LEFT,"left"),bl.bindKey(bl.KEY.RIGHT,"right"),bl.bindKey(bl.KEY.X,"jump"),bl.bindKey(bl.KEY.UP,"jump"),bl.bindKey(bl.KEY.SPACE,"jump"),bl.bindKey(bl.KEY.DOWN,"down"),bl.bindKey(bl.KEY.A,"left"),bl.bindKey(bl.KEY.D,"right"),bl.bindKey(bl.KEY.W,"jump"),bl.bindKey(bl.KEY.S,"down"),hu.change(hu.PLAY)}))):alert("Your browser does not support HTML5 canvas.")}))}()}();